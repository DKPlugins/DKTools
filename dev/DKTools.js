/*
Title: DKTools
Author: DK (Denis Kuznetsov)
Site: https://dk-plugins.ru
E-mail: kuznetsovdenis96@gmail.com
Version: 6.2.1
Release: 24.12.2018
First release: 13.01.2016
Supported languages: Russian, English
*/

/*ru
Название: DKTools
Автор: DK (Денис Кузнецов)
Сайт: https://dk-plugins.ru
E-mail: kuznetsovdenis96@gmail.com
Версия: 6.2.1
Релиз: 24.12.2018
Первый релиз: 13.01.2016
Поддерживаемые языки: Русский, Английский
*/

/*:
* @plugindesc v.6.2.1 Library for RPG Maker. Made with ♥ by DKPlugins
* @author DK (Denis Kuznetsov)
* @help

 ### Info about plugin ###
 Title: DKTools
 Author: DK (Denis Kuznetsov)
 Site: https://dk-plugins.ru
 Version: 6.2.1
 Release: 24.12.2018
 First release: 13.01.2016
 Supported languages: Russian, English
 Thank you for your support: https://dk-plugins.ru/donate

 ### DKTools on DKPlugins ###
 https://dk-plugins.ru/mv/dktools/

 ### DKTools on GitHub ###
 https://github.com/DKPlugins/DKTools

 ### Online documentation ###
 https://dk-plugins.ru/documentation/DKTools/index.html

 ### Requirements and dependencies ###
 Version of RPG Maker 1.6+

 ### Instructions ###

 ### 1 ### Templates for the filename of the screenshot ###
 %year - Year
 %month - Month
 %day - Day
 %hours - Hours
 %minutes - Minutes
 %seconds - Seconds

 ### 2 ### Grid ###
 Available grid sizes: 64, 48, 32, 16

 ### 2.1 ### Using the ruler ###
 Move the mouse while holding down the middle key

 ### 2.2 ### Color of the ruler ###
 If the color of the ruler is not specified, random color will be selected automatically

 ### Plugin commands ###
 1. Checks for plugins updates from DKPlugins
 DKPluginsCheckUpdates

 ### Elements ###
 DKTools.Utils
 DKTools.Utils.Object
 DKTools.Utils.Number
 DKTools.Utils.String
 DKTools.Utils.Array
 DKTools.Utils.Point
 DKTools.Utils.Rectangle
 DKTools.Utils.WebAudio
 DKTools.Utils.Bitmap
 DKTools.Utils.Event
 DKTools.Utils.Random
 DKTools.IO
 DKTools.IO.Entity
 DKTools.IO.File
 DKTools.IO.Directory
 DKTools.IO.WebStorage
 DKTools.Network
 DKTools.ParameterManager
 DKTools.PluginManager
 DKTools.PluginCommandManager
 DKTools.PreloadManager
 DKTools.Audio
 DKTools.Event
 DKTools.Animation
 DKTools.Animation.Action
 DKTools.OptionManager
 DKTools.EventManager
 DKTools.Unit
 DKTools.Unit.Property
 DKTools.Unit.Properties
 DKTools.Unit.Function
 DKTools.Base
 DKTools.Sprite
 DKTools.Sprite.Button
 DKTools.Sprite.Cursor
 DKTools.Sprite.Arrow
 DKTools.Sprite.Selectable
 DKTools.Sprite.ProgressBar
 DKTools.Sprite.ProgressBar.Rectangle
 DKTools.Sprite.ProgressBar.Circle
 DKTools.Sprite.ProgressBar.SemiCircle
 DKTools.Sprite.CheckBox
 DKTools.Viewport
 DKTools.Layout
 DKTools.Window
 DKTools.Window.Selectable
 DKTools.Scene

 ### Licenses and terms of use ###

 DKTools uses a third-party library "lodash": https://lodash.com/license

 Recent information about the terms of use: https://dk-plugins.ru/terms-of-use

 You can:
 -Free to use the plugin for your commercial and non commercial projects.
 -Translate the plugin to other languages (inform if you do this)
 -Change the plugin code, but you must specify a link to the original plugin

 You can't:
 -Delete or change any information about the plugin (Title, authorship, contact information, version and release)

 * @param Functions
 * @default ---------------------------------

 * @param Check Updates
 * @parent Functions
 * @desc Check updates
 * @type struct<CheckUpdates>
 * @default {"Enabled":"false","Show New Plugins":"false"}

 * @param Debugging Console
 * @parent Functions
 * @desc Debug console
 * @type struct<DebuggingConsole>
 * @default {"Enabled":"false","Open On Error":"false"}

 * @param FPS Meter
 * @parent Functions
 * @desc FPS Meter
 * @type struct<FPSMeter>
 * @default {"Enabled":"false","Mode":"FPS","Theme":"transparent","History":"20"}

 * @param Screen Resolution
 * @parent Functions
 * @desc Screen resolution
 * @type struct<ScreenResolution>
 * @default {"Enabled":"false","Width":"816","Height":"624"}

 * @param Quick Start
 * @parent Functions
 * @desc Quick start
 * @type struct<QuickStart>
 * @default {"Enabled":"false","Scene Name":"Scene_Map","Skip Saves":"false"}

 * @param Quick Load
 * @parent Functions
 * @desc Quick load
 * @type struct<QuickLoad>
 * @default {"Enabled":"false","Key Code":"117"}

 * @param Preload Manager
 * @parent Functions
 * @desc Preloading resources
 * @type struct<PreloadManager>
 * @default {"Enabled":"false","Debugging":"false","Images":"[]"}

 * @param Screenshots
 * @parent Functions
 * @desc Screenshots
 * @type struct<Screenshots>
 * @default {"Enabled":"false","Key Code":"44","Path":"screenshots/","Filename":"%year_%month_%day_%hours_%minutes_%seconds.png","Type":"png","Quality":"0.9"}

 * @param Errors Log
 * @parent Functions
 * @desc Errors logging
 * @type struct<ErrorsLog>
 * @default {"Enabled":"None","Filename":"errors_log.txt","File Size":"10"}

 * @param Tile Size
 * @parent Functions
 * @desc Tile size
 * @type struct<TileSize>
 * @default {"Enabled":"false","Size":"48"}

 * @param Grid
 * @parent Functions
 * @desc Displaying the grid on the screen. Details in the help (2)
 * @type struct<Grid>
 * @default {"Enabled":"false","Key Code":"118","Grid Color":"white","Grid Width":"1","Ruler Color":"","Ruler Width":"3"}

 * @param Image Cache Limit
 * @parent Functions
 * @desc Image cache limit
 * @type struct<ImageCacheLimit>
 * @default {"Enabled":"false","Limit":"10000000"}

 * @param Cursor Graphic
 * @parent Functions
 * @desc Cursor graphic
 * @type struct<CursorGraphic>
 * @default {"Enabled":"false","Graphic": ""}

*/

/*:ru
* @plugindesc v.6.2.1 Библиотека для RPG Maker. Сделано с ♥ от DKPlugins
* @author DK (Денис Кузнецов)
* @help

 ### Информация о плагине ###
 Название: DKTools
 Автор: DK (Денис Кузнецов)
 Сайт: https://dk-plugins.ru
 Версия: 6.2.1
 Релиз: 24.12.2018
 Первый релиз: 13.01.2016
 Поддерживаемые языки: Русский, Английский
 Спасибо за Вашу поддержку: https://dk-plugins.ru/donate

 ### DKTools на DKPlugins ###
 https://dk-plugins.ru/mv/dktools/

 ### DKTools на GitHub ###
 https://github.com/DKPlugins/DKTools

 ### Онлайн документация ###
 https://dk-plugins.ru/documentation/DKTools/index.html

 ### Требования и зависимости ###
 Версия мейкера 1.6+

 ### Инструкции ###

 ### 1 ### Шаблоны для названия файла скриншота ###
 %year - Год
 %month - Месяц
 %day - День
 %hours - Часы
 %minutes - Минуты
 %seconds - Секунды

 ### 2 ### Сетка ###
 Доступные размеры сетки: 64, 48, 32, 16

 ### 2.1 ### Использование линейки ###
 Перемещайте мышь, удерживая среднюю клавишу

 ### 2.2 ### Цвет линейки ###
 Если не указан цвет линейки, то автоматически будет выбран случайный цвет

 ### Команды плагина ###
 1. Проверить обновления плагинов от DKPlugins
 DKPluginsCheckUpdates

 ### Элементы ###
 DKTools.Utils
 DKTools.Utils.Object
 DKTools.Utils.Number
 DKTools.Utils.String
 DKTools.Utils.Array
 DKTools.Utils.Point
 DKTools.Utils.Rectangle
 DKTools.Utils.WebAudio
 DKTools.Utils.Bitmap
 DKTools.Utils.Event
 DKTools.Utils.Random
 DKTools.IO
 DKTools.IO.Entity
 DKTools.IO.File
 DKTools.IO.Directory
 DKTools.IO.WebStorage
 DKTools.Network
 DKTools.ParameterManager
 DKTools.PluginManager
 DKTools.PluginCommandManager
 DKTools.PreloadManager
 DKTools.Audio
 DKTools.Event
 DKTools.Animation
 DKTools.Animation.Action
 DKTools.OptionManager
 DKTools.EventManager
 DKTools.Unit
 DKTools.Unit.Property
 DKTools.Unit.Properties
 DKTools.Unit.Function
 DKTools.Base
 DKTools.Sprite
 DKTools.Sprite.Button
 DKTools.Sprite.Cursor
 DKTools.Sprite.Arrow
 DKTools.Sprite.Selectable
 DKTools.Sprite.ProgressBar
 DKTools.Sprite.ProgressBar.Rectangle
 DKTools.Sprite.ProgressBar.Circle
 DKTools.Sprite.ProgressBar.SemiCircle
 DKTools.Sprite.CheckBox
 DKTools.Viewport
 DKTools.Layout
 DKTools.Window
 DKTools.Window.Selectable
 DKTools.Scene

 ### Лицензии и правила использования плагина ###

 DKTools использует стороннюю библиотеку "lodash": https://lodash.com/license

 Актуальная информация о правилах использования: https://dk-plugins.ru/terms-of-use

 Вы можете:
 -Бесплатно использовать данный плагин в некоммерческих и коммерческих проектах
 -Переводить плагин на другие языки (сообщите мне, если Вы перевели плагин на другой язык)
 -Изменять код плагина, но Вы обязаны указать ссылку на оригинальный плагин

 Вы не можете:
 -Убирать или изменять любую информацию о плагине (Название, авторство, контактная информация, версия и дата релиза)

 * @param Functions
 * @text Функции
 * @default ---------------------------------

 * @param Check Updates
 * @text Проверка обновлений
 * @parent Functions
 * @desc Проверка обновлений
 * @type struct<CheckUpdates>
 * @default {"Enabled":"false","Show New Plugins":"false"}

 * @param Debugging Console
 * @text Отладочная консоль
 * @parent Functions
 * @desc Отладочная консоль
 * @type struct<DebuggingConsole>
 * @default {"Enabled":"false","Open On Error":"false"}

 * @param FPS Meter
 * @text Счетчик FPS
 * @parent Functions
 * @desc Счетчик FPS
 * @type struct<FPSMeter>
 * @default {"Enabled":"false","Mode":"FPS","Theme":"transparent","History":"20"}

 * @param Screen Resolution
 * @text Разрешение экрана
 * @parent Functions
 * @desc Настройки разрешения экрана
 * @type struct<ScreenResolution>
 * @default {"Enabled":"false","Width":"816","Height":"624"}

 * @param Quick Start
 * @text Быстрый старт
 * @parent Functions
 * @desc Быстрый старт
 * @type struct<QuickStart>
 * @default {"Enabled":"false","Scene Name":"Scene_Map","Skip Saves":"false"}

 * @param Quick Load
 * @text Быстрая загрузка
 * @parent Functions
 * @desc Быстрая загрузка игры
 * @type struct<QuickLoad>
 * @default {"Enabled":"false","Key Code":"117"}

 * @param Preload Manager
 * @text Предзагрузка ресурсов
 * @parent Functions
 * @desc Предварительная загрузка ресурсов
 * @type struct<PreloadManager>
 * @default {"Enabled":"false","Debugging":"false","Images":"[]"}

 * @param Screenshots
 * @text Скриншоты
 * @parent Functions
 * @desc Скриншоты
 * @type struct<Screenshots>
 * @default {"Enabled":"false","Key Code":"44","Path":"screenshots/","Filename":"%year_%month_%day_%hours_%minutes_%seconds.png","Type":"png","Quality":"0.9"}

 * @param Errors Log
 * @text Логирование ошибок
 * @parent Functions
 * @desc Логирование ошибок
 * @type struct<ErrorsLog>
 * @default {"Enabled":"None","Filename":"errors_log.txt","File Size":"10"}

 * @param Tile Size
 * @text Размер тайла
 * @parent Functions
 * @desc Размер тайла
 * @type struct<TileSize>
 * @default {"Enabled":"false","Size":"48"}

 * @param Grid
 * @text Сетка
 * @parent Functions
 * @desc Отображение сетки на экране. Подробности в справке (2)
 * @type struct<Grid>
 * @default {"Enabled":"false","Key Code":"118","Grid Color":"white","Grid Width":"1","Ruler Color":"","Ruler Width":"3"}

 * @param Image Cache Limit
 * @text Лимит кэша изображений
 * @parent Functions
 * @desc Лимит кэша изображений
 * @type struct<ImageCacheLimit>
 * @default {"Enabled":"false","Limit":"10000000"}

 * @param Cursor Graphic
 * @text Графика курсора
 * @parent Functions
 * @desc Графика курсора
 * @type struct<CursorGraphic>
 * @default {"Enabled":"false","Graphic": ""}

*/

/*~struct~CheckUpdates:

 * @param Enabled
 * @desc Enable automatic update checking ? Information is displayed in the console during the game test
 * @type boolean
 * @default false

 * @param Show New Plugins
 * @text Show new plugins
 * @desc Show new plugins ? Information is displayed in the console during the game test
 * @type boolean
 * @default false

 */

/*~struct~CheckUpdates:ru

 * @param Enabled
 * @text Проверка обновлений
 * @desc Включить автоматическую проверку обновлений ? Информация выводится в консоль при тесте игры
 * @type boolean
 * @default false

 * @param Show New Plugins
 * @text Показать новые плагины
 * @desc Показывать новые плагины ? Информация выводится в консоль при тесте игры
 * @type boolean
 * @default false

 */

/*~struct~DebuggingConsole:

 * @param Enabled
 * @desc Open the debug console when the game test starts ?
 * @type boolean
 * @default false

 * @param Open On Error
 * @text Open on error
 * @desc Enable the debugging console when an error is received ?
 * @type boolean
 * @default false

 */

/*~struct~DebuggingConsole:ru

 * @param Enabled
 * @text Включено
 * @desc Открыть отладочную консоль при запуске теста игры ?
 * @type boolean
 * @default false

 * @param Open On Error
 * @text Открытие при ошибке
 * @desc Включить отладочную консоль при получении ошибки ?
 * @type boolean
 * @default false

 */

/*~struct~FPSMeter:

 * @param Enabled
 * @desc Show the FPS counter when the game test starts ?
 * @type boolean
 * @default false

 * @param Mode
 * @desc Mode
 * @type select
 * @option FPS
 * @option Duration
 * @default FPS

 * @param Theme
 * @desc Theme
 * @type select
 * @option transparent
 * @option dark
 * @option light
 * @default transparent

 * @param History
 * @desc Number of entries in history
 * @type number
 * @min 5
 * @max 100
 * @default 20

 */

/*~struct~FPSMeter:ru

 * @param Enabled
 * @text Включено
 * @desc Показать счетчик FPS при запуске теста игры ?
 * @type boolean
 * @default false

 * @param Mode
 * @text Режим
 * @desc Режим счетчика FPS
 * @type select
 * @option FPS
 * @option Duration
 * @default FPS

 * @param Theme
 * @text Тема
 * @desc Тема счетчика FPS
 * @type select
 * @option transparent
 * @option dark
 * @option light
 * @default transparent

 * @param History
 * @text История
 * @desc Количество записей в истории
 * @type number
 * @min 5
 * @max 100
 * @default 20

 */

/*~struct~ScreenResolution:

 * @param Enabled
 * @desc Enable the Screen Resolution function ?
 * @type boolean
 * @default false

 * @param Width
 * @desc Screen width
 * @type number
 * @min 0
 * @default 816

 * @param Height
 * @desc Screen height
 * @type number
 * @min 0
 * @default 624

 */

/*~struct~ScreenResolution:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения разрешения экрана ?
 * @type boolean
 * @default false

 * @param Width
 * @text Ширина экрана
 * @desc Ширина экрана
 * @type number
 * @min 0
 * @default 816

 * @param Height
 * @text Высота экрана
 * @desc Высота экрана
 * @type number
 * @min 0
 * @default 624

 */

/*~struct~QuickStart:

 * @param Enabled
 * @desc Enable the Quick Start function ?
 * @type boolean
 * @default false

 * @param Scene Name
 * @desc Name of scene which will be launched instead the title screen. Standard: Scene_Map
 * @default Scene_Map

 * @param Skip Saves
 * @desc Does it need skip the title screen if save files exists?
 * @type boolean
 * @default false

 */

/*~struct~QuickStart:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию быстрого старта ?
 * @type boolean
 * @default false

 * @param Scene Name
 * @text Название сцены
 * @desc Название сцены, которая запускается вместо титульного экрана. Стандартно: Scene_Map
 * @default Scene_Map

 * @param Skip Saves
 * @text Пропуск сохранений
 * @desc Пропускать титульный экран, если есть сохранения ?
 * @type boolean
 * @default false

 */

/*~struct~QuickLoad:

 * @param Enabled
 * @desc Enable the Quick Load function ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible for the quick loading. 117 - F6
 * @type number
 * @default 117

 * @param Savefile ID
 * @desc Savefile number for quick loading. Specify 0 to show the load scene
 * @type number
 * @default 0

 */

/*~struct~QuickLoad:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию быстрой загрузки ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за быструю загрузку. 117 - F6
 * @default 117

 * @param Savefile ID
 * @text Файл сохранения
 * @desc Номер файла сохранения для быстрой загрузки. Укажите 0, чтобы показывать экран загрузки
 * @type number
 * @default 0

 */

/*~struct~PreloadManager:

 * @param Enabled
 * @desc Enable resources preloading function ?
 * @type boolean
 * @default false

 * @param Debugging
 * @desc Display preload information in the console ?
 * @type boolean
 * @default false

 * @param Audio Files
 * @desc Preloading audio files
 * @type struct<PreloadManagerAudio>[]
 * @default []

 * @param Image Files
 * @desc Preloading image files
 * @type struct<PreloadManagerImage>[]
 * @default []

 */

/*~struct~PreloadManager:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию предзагрузки ресурсов ?
 * @type boolean
 * @default false

 * @param Debugging
 * @text Отладка
 * @desc Выводить информацию о предзагрузке в консоль ?
 * @type boolean
 * @default false

 * @param Audio Files
 * @text Звуки
 * @desc Предзагрузка звуков
 * @type struct<PreloadManagerAudio>[]
 * @default []

 * @param Image Files
 * @text Изображения
 * @desc Предзагрузка изображений
 * @type struct<PreloadManagerImage>[]
 * @default []

 */

/*~struct~PreloadManagerImage:

 * @param Path
 * @desc Path to file (with extension) or directory. For example, img/system/Window.png for file or img/system/ for directory

 * @param Hue
 * @desc Hue
 * @type number
 * @min 0
 * @max 360
 * @default 0

 * @param Caching
 * @desc Image caching
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerImage:ru

 * @param Path
 * @text Путь
 * @desc Путь к файлу (с расширением) или директории. Например, img/system/Window.png для файла или img/system/ для директории

 * @param Hue
 * @text Оттенок
 * @desc Оттенок
 * @type number
 * @min 0
 * @max 360
 * @default 0

 * @param Caching
 * @text Кэширование
 * @desc Кэширование изображений
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerAudio:

 * @param Path
 * @desc Path to file (with extension) or directory. For example, audio/bgm/Battle1.ogg for file or audio/bgm/ for directory

 * @param Caching
 * @desc Audio caching
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerAudio:ru

 * @param Path
 * @text Путь
 * @desc Путь к файлу (с расширением) или директории. Например, audio/bgm/Battle1.ogg для файла или audio/bgm/ для директории

 * @param Caching
 * @text Кэширование
 * @desc Кэширование звуков
 * @type boolean
 * @default false

 */

/*~struct~Screenshots:

 * @param Enabled
 * @desc Enable the Screenshots function ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible for saving the screenshot. 122 - F11
 * @type number
 * @default 122

 * @param Path
 * @text Path for saving screenshots
 * @desc Local path for saving screenshots
 * @default screenshots/

 * @param Filename
 * @desc The entire list of templates is given in the help (1)
 * @default %year_%month_%day_%hours_%minutes_%seconds.png

 * @param Type
 * @text Screenshot type
 * @desc Screenshot type
 * @type select
 * @option png
 * @option jpeg
 * @option webp
 * @default png

 * @param Quality
 * @text Screenshot quality
 * @desc Screenshot quality
 * @type select
 * @option 0%
 * @option 10%
 * @option 20%
 * @option 30%
 * @option 40%
 * @option 50%
 * @option 60%
 * @option 70%
 * @option 80%
 * @option 90%
 * @option 100%
 * @default 90%

 */

/*~struct~Screenshots:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию сохранения скриншота ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за сохранение скриншота. 122 - F11
 * @type number
 * @default 122

 * @param Path
 * @text Путь для сохранения скриншотов
 * @desc Локальный путь для сохранения скриншотов
 * @default screenshots/

 * @param Filename
 * @text Название файла скриншота
 * @desc Весь список шаблонов приведен в справке (1)
 * @default %year_%month_%day_%hours_%minutes_%seconds.png

 * @param Type
 * @text Тип скриншота
 * @desc Тип скриншота
 * @type select
 * @option png
 * @option jpeg
 * @option webp
 * @default png

 * @param Quality
 * @text Качество скриншота
 * @desc Качество скриншота
 * @type select
 * @option 0%
 * @value 0
 * @option 10%
 * @value 0.1
 * @option 20%
 * @value 0.2
 * @option 30%
 * @value 0.3
 * @option 40%
 * @value 0.4
 * @option 50%
 * @value 0.5
 * @option 60%
 * @value 0.6
 * @option 70%
 * @value 0.7
 * @option 80%
 * @value 0.8
 * @option 90%
 * @value 0.9
 * @option 100%
 * @value 1
 * @default 90%

 */

/*~struct~ErrorsLog:

 * @param Enabled
 * @desc Enable error logging ?
 * @type select
 * @option None
 * @option Only Test
 * @option Only Game
 * @option Always
 * @default None

 * @param Filename
 * @desc Filename
 * @default errors_log.txt

 * @param File Size
 * @desc Maximum file size in megabytes. If this value is exceeded, the old logs will be deleted.
 * @default 10

 */

/*~struct~ErrorsLog:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию логирования ошибок ?
 * @type select
 * @option Никогда
 * @value None
 * @option Только тест
 * @value Only Test
 * @option Только игра
 * @value Only Game
 * @option Всегда
 * @value Always
 * @default None

 * @param Filename
 * @text Название файла
 * @desc Название файла
 * @default errors_log.txt

 * @param File Size
 * @text Размер файла
 * @desc Максимальный размер файла в мегабайтах. При превышении этого значения старые логи будут удалены.
 * @default 10

 */

/*~struct~TileSize:

 * @param Enabled
 * @desc Enable the function of resizing tiles ?
 * @type boolean
 * @default false

 * @param Size
 * @desc Tile size
 * @type number
 * @min 1
 * @default 48

 */

/*~struct~TileSize:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения размера тайла ?
 * @type boolean
 * @default false

 * @param Size
 * @text Размер тайла
 * @desc Размер тайла
 * @type number
 * @min 1
 * @default 48

 */

/*~struct~Grid:

 * @param Enabled
 * @desc Enable the function of displaying the grid ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible displaying the grid. 118 - F7
 * @type number
 * @default 118

 * @param Grid Color
 * @desc Grid line color in Web format
 * @default white

 * @param Grid Width
 * @desc Grid line width
 * @type number
 * @min 1
 * @default 1

 * @param Ruler Color
 * @desc Ruler color in Web format. Details in the help (2.2)
 * @default

 * @param Ruler Width
 * @desc Ruler width
 * @type number
 * @min 1
 * @default 3

 */

/*~struct~Grid:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию отображения сетки ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за отображение сетки. 118 - F7
 * @type number
 * @default 118

 * @param Grid Color
 * @text Цвет сетки
 * @desc Цвет сетки в Web формате
 * @default white

 * @param Grid Width
 * @text Ширина линии сетки
 * @desc Ширина линии сетки
 * @type number
 * @min 1
 * @default 1

 * @param Ruler Color
 * @text Цвет линейки
 * @desc Цвет линейки в Web формате. Подробности в справке (2.2)
 * @default

 * @param Ruler Width
 * @text Ширина линейки
 * @desc Ширина линейки
 * @type number
 * @min 1
 * @default 3

 */

/*~struct~ImageCacheLimit:

 * @param Enabled
 * @desc Enable the image cache limit function ?
 * @type boolean
 * @default false

 * @param Limit
 * @desc Image cache limit
 * @type number
 * @min 0
 * @default 10000000

*/

/*~struct~ImageCacheLimit:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения лимита кэша изображений ?
 * @type boolean
 * @default false

 * @param Limit
 * @text Лимит
 * @desc Лимит кэша изображений
 * @type number
 * @min 0
 * @default 10000000

*/

/*~struct~CursorGraphic:

 * @param Enabled
 * @desc Enable the function to change the cursor graphics ?
 * @type boolean
 * @default false

 * @param Graphic
 * @desc Cursor graphic
 * @type file
 * @dir img/system

*/

/*~struct~CursorGraphic:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения графики курсора ?
 * @type boolean
 * @default false

 * @param Graphic
 * @text Графика
 * @desc Графика курсора
 * @type file
 * @dir img/system

*/

!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";(function(t){var n;window.Imported=window.Imported||{},window.Imported.DKTools="6.2.1",function(){function s(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function r(t,e,i,n){for(var s=-1,r=null==t?0:t.length;++s<r;){var o=t[s];e(n,o,i(o),t)}return n}function o(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function a(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function l(t,e){for(var i=-1,n=null==t?0:t.length,s=0,r=[];++i<n;){var o=t[i];e(o,i,t)&&(r[s++]=o)}return r}function h(t,e){return!(null==t||!t.length)&&-1<y(t,e,0)}function u(t,e,i){for(var n=-1,s=null==t?0:t.length;++n<s;)if(i(e,t[n]))return!0;return!1}function c(t,e){for(var i=-1,n=null==t?0:t.length,s=Array(n);++i<n;)s[i]=e(t[i],i,t);return s}function p(t,e){for(var i=-1,n=e.length,s=t.length;++i<n;)t[s+i]=e[i];return t}function d(t,e,i,n){var s=-1,r=null==t?0:t.length;for(n&&r&&(i=t[++s]);++s<r;)i=e(i,t[s],s,t);return i}function f(t,e,i,n){var s=null==t?0:t.length;for(n&&s&&(i=t[--s]);s--;)i=e(i,t[s],s,t);return i}function g(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function _(t,e,i){var n;return i(t,function(t,i,s){if(e(t,i,s))return n=i,!1}),n}function m(t,e,i,n){var s=t.length;for(i+=n?1:-1;n?i--:++i<s;)if(e(t[i],i,t))return i;return-1}function y(t,e,i){if(e==e)t:{--i;for(var n=t.length;++i<n;)if(t[i]===e){t=i;break t}t=-1}else t=m(t,v,i);return t}function T(t,e,i,n){--i;for(var s=t.length;++i<s;)if(n(t[i],e))return i;return-1}function v(t){return t!=t}function w(t,e){var i=null==t?0:t.length;return i?A(t,e)/i:L}function D(t){return function(e){return null==e?k:e[t]}}function S(t){return function(e){return null==t?k:t[e]}}function b(t,e,i,n,s){return s(t,function(t,s,r){i=n?(n=!1,t):e(i,t,s,r)}),i}function A(t,e){for(var i,n=-1,s=t.length;++n<s;){var r=e(t[n]);r!==k&&(i=i===k?r:i+r)}return i}function K(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function O(t){return function(e){return t(e)}}function C(t,e){return c(e,function(e){return t[e]})}function I(t,e){return t.has(e)}function x(t,e){for(var i=-1,n=t.length;++i<n&&-1<y(e,t[i],0););return i}function E(t,e){for(var i=t.length;i--&&-1<y(e,t[i],0););return i}function P(t){return"\\"+Rt[t]}function R(t){var e=-1,i=Array(t.size);return t.forEach(function(t,n){i[++e]=[n,t]}),i}function M(t,e){return function(i){return t(e(i))}}function B(t,e){for(var i=-1,n=t.length,s=0,r=[];++i<n;){var o=t[i];o!==e&&"__lodash_placeholder__"!==o||(t[i]="__lodash_placeholder__",r[s++]=i)}return r}function H(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function F(t){if(Ct.test(t)){for(var e=Kt.lastIndex=0;Kt.test(t);)++e;t=e}else t=Xt(t);return t}function W(t){return Ct.test(t)?t.match(Kt)||[]:t.split("")}var k,U=1/0,L=NaN,j=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],N=/\b__p\+='';/g,z=/\b(__p\+=)''\+/g,V=/(__e\(.*?\)|\b__t\))\+'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,Y=/[&<>"']/g,q=RegExp(G.source),$=RegExp(Y.source),X=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,Z=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,nt=RegExp(it.source),st=/^\s+|\s+$/g,rt=/^\s+/,ot=/\s+$/,at=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,lt=/\{\n\/\* \[wrapped with (.+)\] \*/,ht=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ct=/\\(\\)?/g,pt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,ft=/^[-+]0x[0-9a-f]+$/i,gt=/^0b[01]+$/i,_t=/^\[object .+?Constructor\]$/,mt=/^0o[0-7]+$/i,yt=/^(?:0|[1-9]\d*)$/,Tt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,Dt="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*",St="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+Dt,bt=RegExp("['’]","g"),At=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),Kt=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])"+Dt,"g"),Ot=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",St].join("|"),"g"),Ct=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),It=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,xt="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Et={};Et["[object Float32Array]"]=Et["[object Float64Array]"]=Et["[object Int8Array]"]=Et["[object Int16Array]"]=Et["[object Int32Array]"]=Et["[object Uint8Array]"]=Et["[object Uint8ClampedArray]"]=Et["[object Uint16Array]"]=Et["[object Uint32Array]"]=!0,Et["[object Arguments]"]=Et["[object Array]"]=Et["[object ArrayBuffer]"]=Et["[object Boolean]"]=Et["[object DataView]"]=Et["[object Date]"]=Et["[object Error]"]=Et["[object Function]"]=Et["[object Map]"]=Et["[object Number]"]=Et["[object Object]"]=Et["[object RegExp]"]=Et["[object Set]"]=Et["[object String]"]=Et["[object WeakMap]"]=!1;var Pt={};Pt["[object Arguments]"]=Pt["[object Array]"]=Pt["[object ArrayBuffer]"]=Pt["[object DataView]"]=Pt["[object Boolean]"]=Pt["[object Date]"]=Pt["[object Float32Array]"]=Pt["[object Float64Array]"]=Pt["[object Int8Array]"]=Pt["[object Int16Array]"]=Pt["[object Int32Array]"]=Pt["[object Map]"]=Pt["[object Number]"]=Pt["[object Object]"]=Pt["[object RegExp]"]=Pt["[object Set]"]=Pt["[object String]"]=Pt["[object Symbol]"]=Pt["[object Uint8Array]"]=Pt["[object Uint8ClampedArray]"]=Pt["[object Uint16Array]"]=Pt["[object Uint32Array]"]=!0,Pt["[object Error]"]=Pt["[object Function]"]=Pt["[object WeakMap]"]=!1;var Rt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mt=parseFloat,Bt=parseInt,Ht="object"==typeof global&&global&&global.Object===Object&&global,Ft="object"==typeof self&&self&&self.Object===Object&&self,Wt=Ht||Ft||Function("return this")(),kt=e&&!e.nodeType&&e,Ut=kt&&"object"==typeof t&&t&&!t.nodeType&&t,Lt=Ut&&Ut.exports===kt,jt=Lt&&Ht.process,Nt=function(){try{var t=Ut&&Ut.f&&Ut.f("util").types;return t||jt&&jt.binding&&jt.binding("util")}catch(t){}}(),zt=Nt&&Nt.isArrayBuffer,Vt=Nt&&Nt.isDate,Gt=Nt&&Nt.isMap,Yt=Nt&&Nt.isRegExp,qt=Nt&&Nt.isSet,$t=Nt&&Nt.isTypedArray,Xt=D("length"),Jt=S({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Zt=S({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Qt=S({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),te=function t(e){function i(t){if(jn(t)&&!xo(t)&&!(t instanceof Dt)){if(t instanceof S)return t;if(xs.call(t,"__wrapped__"))return fn(t)}return new S(t)}function n(){}function S(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=k}function Dt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function St(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Kt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Rt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ht(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Rt;++e<i;)this.add(t[e])}function Ft(t){this.size=(this.__data__=new Kt(t)).size}function kt(t,e){var i,n=xo(t),s=!n&&Io(t),r=!n&&!s&&Po(t),o=!n&&!s&&!r&&Fo(t),a=(s=(n=n||s||r||o)?K(t.length,bs):[]).length;for(i in t)!e&&!xs.call(t,i)||n&&("length"==i||r&&("offset"==i||"parent"==i)||o&&("buffer"==i||"byteLength"==i||"byteOffset"==i)||tn(i,a))||s.push(i);return s}function Ut(t){var e=t.length;return e?t[Le(0,e-1)]:k}function jt(t,e,i){(i===k||Mn(t[e],i))&&(i!==k||e in t)||ne(t,e,i)}function Nt(t,e,i){var n=t[e];xs.call(t,e)&&Mn(n,i)&&(i!==k||e in t)||ne(t,e,i)}function Xt(t,e){for(var i=t.length;i--;)if(Mn(t[i][0],e))return i;return-1}function ee(t,e,i,n){return Cr(t,function(t,s,r){e(n,t,i(t),r)}),n}function ie(t,e){return t&&gi(e,is(e),t)}function ne(t,e,i){"__proto__"==e&&qs?qs(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function se(t,e){for(var i=-1,n=e.length,s=ms(n),r=null==t;++i<n;)s[i]=r?k:ts(t,e[i]);return s}function re(t,e,i){return t==t&&(i!==k&&(t=t<=i?t:i),e!==k&&(t=t>=e?t:e)),t}function oe(t,e,i,n,s,r){var a,l=1&e,h=2&e,u=4&e;if(i&&(a=s?i(t,n,s,r):i(t)),a!==k)return a;if(!Ln(t))return t;if(n=xo(t)){if(a=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&xs.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!l)return fi(t,a)}else{var c=kr(t),p="[object Function]"==c||"[object GeneratorFunction]"==c;if(Po(t))return li(t,l);if("[object Object]"==c||"[object Arguments]"==c||p&&!s){if(a=h||p?{}:Zi(t),!l)return h?function(t,e){return gi(t,Wr(t),e)}(t,function(t,e){return t&&gi(e,ns(e),t)}(a,t)):function(t,e){return gi(t,Fr(t),e)}(t,ie(a,t))}else{if(!Pt[c])return s?t:{};a=function(t,e,i){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return hi(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return e=i?hi(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ui(t,i);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return(e=new t.constructor(t.source,dt.exec(t))).lastIndex=t.lastIndex,e;case"[object Set]":return new n;case"[object Symbol]":return Ar?Ds(Ar.call(t)):{}}}(t,c,l)}}if(r||(r=new Ft),s=r.get(t))return s;if(r.set(t,a),Ho(t))return t.forEach(function(n){a.add(oe(n,e,i,n,t,r))}),a;if(Mo(t))return t.forEach(function(n,s){a.set(s,oe(n,e,i,s,t,r))}),a;h=u?h?zi:Ni:h?ns:is;var d=n?k:h(t);return o(d||t,function(n,s){d&&(n=t[s=n]),Nt(a,s,oe(n,e,i,s,t,r))}),a}function ae(t,e,i){var n=i.length;if(null==t)return!n;for(t=Ds(t);n--;){var s=i[n],r=e[s],o=t[s];if(o===k&&!(s in t)||!r(o))return!1}return!0}function le(t,e,i){if("function"!=typeof t)throw new As("Expected a function");return jr(function(){t.apply(k,i)},e)}function he(t,e,i,n){var s=-1,r=h,o=!0,a=t.length,l=[],p=e.length;if(!a)return l;i&&(e=c(e,O(i))),n?(r=u,o=!1):200<=e.length&&(r=I,o=!1,e=new Ht(e));t:for(;++s<a;){var d=t[s],f=null==i?d:i(d);d=n||0!==d?d:0;if(o&&f==f){for(var g=p;g--;)if(e[g]===f)continue t;l.push(d)}else r(e,f,n)||l.push(d)}return l}function ue(t,e){var i=!0;return Cr(t,function(t,n,s){return i=!!e(t,n,s)}),i}function ce(t,e,i){for(var n=-1,s=t.length;++n<s;){var r=t[n],o=e(r);if(null!=o&&(a===k?o==o&&!Gn(o):i(o,a)))var a=o,l=r}return l}function pe(t,e){var i=[];return Cr(t,function(t,n,s){e(t,n,s)&&i.push(t)}),i}function de(t,e,i,n,s){var r=-1,o=t.length;for(i||(i=Qi),s||(s=[]);++r<o;){var a=t[r];0<e&&i(a)?1<e?de(a,e-1,i,n,s):p(s,a):n||(s[s.length]=a)}return s}function fe(t,e){return t&&xr(t,e,is)}function ge(t,e){return t&&Er(t,e,is)}function _e(t,e){return l(e,function(e){return Wn(t[e])})}function me(t,e){for(var i=0,n=(e=oi(e,t)).length;null!=t&&i<n;)t=t[cn(e[i++])];return i&&i==n?t:k}function ye(t,e,i){return e=e(t),xo(t)?e:p(e,i(t))}function Te(t){if(null==t)t=t===k?"[object Undefined]":"[object Null]";else if(Ys&&Ys in Ds(t)){var e=xs.call(t,Ys),i=t[Ys];try{t[Ys]=k;var n=!0}catch(t){}var s=Rs.call(t);n&&(e?t[Ys]=i:delete t[Ys]),t=s}else t=Rs.call(t);return t}function ve(t,e){return t>e}function we(t,e){return null!=t&&xs.call(t,e)}function De(t,e){return null!=t&&e in Ds(t)}function Se(t,e,i){for(var n=i?u:h,s=t[0].length,r=t.length,o=r,a=ms(r),l=1/0,p=[];o--;){var d=t[o];o&&e&&(d=c(d,O(e))),l=or(d.length,l),a[o]=!i&&(e||120<=s&&120<=d.length)?new Ht(o&&d):k}d=t[0];var f=-1,g=a[0];t:for(;++f<s&&p.length<l;){var _=d[f],m=e?e(_):_;_=i||0!==_?_:0;if(g?!I(g,m):!n(p,m,i)){for(o=r;--o;){var y=a[o];if(y?!I(y,m):!n(t[o],m,i))continue t}g&&g.push(m),p.push(_)}}return p}function be(t,e,i){return null==(e=null==(t=2>(e=oi(e,t)).length?t:me(t,Ve(e,0,-1)))?t:t[cn(Tn(e))])?k:s(e,t,i)}function Ae(t){return jn(t)&&"[object Arguments]"==Te(t)}function Ke(t,e,i,n,s){if(t===e)e=!0;else if(null==t||null==e||!jn(t)&&!jn(e))e=t!=t&&e!=e;else t:{var r=xo(t),o=xo(e),a=r?"[object Array]":kr(t),l=o?"[object Array]":kr(e),h="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);o="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l);if((l=a==l)&&Po(t)){if(!Po(e)){e=!1;break t}r=!0,h=!1}if(l&&!h)s||(s=new Ft),e=r||Fo(t)?Li(t,e,i,n,Ke,s):function(t,e,i,n,s,r,o){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!r(new ks(t),new ks(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Mn(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=R;case"[object Set]":if(a||(a=H),t.size!=e.size&&!(1&n))break;return(i=o.get(t))?i==e:(n|=2,o.set(t,e),e=Li(a(t),a(e),n,s,r,o),o.delete(t),e);case"[object Symbol]":if(Ar)return Ar.call(t)==Ar.call(e)}return!1}(t,e,a,i,n,Ke,s);else{if(!(1&i)&&(r=h&&xs.call(t,"__wrapped__"),a=o&&xs.call(e,"__wrapped__"),r||a)){t=r?t.value():t,e=a?e.value():e,s||(s=new Ft),e=Ke(t,e,i,n,s);break t}if(l)e:if(s||(s=new Ft),r=1&i,a=Ni(t),o=a.length,l=Ni(e).length,o==l||r){for(h=o;h--;){var u=a[h];if(!(r?u in e:xs.call(e,u))){e=!1;break e}}if((l=s.get(t))&&s.get(e))e=l==e;else{l=!0,s.set(t,e),s.set(e,t);for(var c=r;++h<o;){var p=t[u=a[h]],d=e[u];if(n)var f=r?n(d,p,u,e,t,s):n(p,d,u,t,e,s);if(f===k?p!==d&&!Ke(p,d,i,n,s):!f){l=!1;break}c||(c="constructor"==u)}l&&!c&&((i=t.constructor)!=(n=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof i&&i instanceof i&&"function"==typeof n&&n instanceof n)&&(l=!1)),s.delete(t),s.delete(e),e=l}}else e=!1;else e=!1}}return e}function Oe(t,e,i,n){var s=i.length,r=s,o=!n;if(null==t)return!r;for(t=Ds(t);s--;){var a=i[s];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<r;){var l=(a=i[s])[0],h=t[l],u=a[1];if(o&&a[2]){if(h===k&&!(l in t))return!1}else{if(a=new Ft,n)var c=n(h,u,l,t,e,a);if(c===k?!Ke(u,h,3,n,a):!c)return!1}}return!0}function Ce(t){return!(!Ln(t)||Ps&&Ps in t)&&(Wn(t)?Hs:_t).test(pn(t))}function Ie(t){return"function"==typeof t?t:null==t?us:"object"==typeof t?xo(t)?Me(t[0],t[1]):Re(t):fs(t)}function xe(t){if(!rn(t))return sr(t);var e,i=[];for(e in Ds(t))xs.call(t,e)&&"constructor"!=e&&i.push(e);return i}function Ee(t,e){return t<e}function Pe(t,e){var i=-1,n=Bn(t)?ms(t.length):[];return Cr(t,function(t,s,r){n[++i]=e(t,s,r)}),n}function Re(t){var e=$i(t);return 1==e.length&&e[0][2]?on(e[0][0],e[0][1]):function(i){return i===t||Oe(i,t,e)}}function Me(t,e){return nn(t)&&e==e&&!Ln(e)?on(cn(t),e):function(i){var n=ts(i,t);return n===k&&n===e?es(i,t):Ke(e,n,3)}}function Be(t,e,i,n,s){t!==e&&xr(e,function(r,o){if(Ln(r)){s||(s=new Ft);var a=s,l="__proto__"==o?k:t[o],h="__proto__"==o?k:e[o];if(f=a.get(h))jt(t,o,f);else{var u=(f=n?n(l,h,o+"",t,e,a):k)===k;if(u){var c=xo(h),p=!c&&Po(h),d=!c&&!p&&Fo(h),f=h;c||p||d?xo(l)?f=l:Hn(l)?f=fi(l):p?(u=!1,f=li(h,!0)):d?(u=!1,f=ui(h,!0)):f=[]:zn(h)||Io(h)?(f=l,Io(l)?f=Zn(l):(!Ln(l)||i&&Wn(l))&&(f=Zi(h))):u=!1}u&&(a.set(h,f),Be(f,h,i,n,a),a.delete(h)),jt(t,o,f)}}else(a=n?n("__proto__"==o?k:t[o],r,o+"",t,e,s):k)===k&&(a=r),jt(t,o,a)},ns)}function He(t,e){var i=t.length;if(i)return tn(e+=0>e?i:0,i)?t[e]:k}function Fe(t,e,i){var n=-1;return e=c(e.length?e:[us],O(Yi())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].c;return t}(t=Pe(t,function(t){return{a:c(e,function(e){return e(t)}),b:++n,c:t}}),function(t,e){var n;t:{n=-1;for(var s=t.a,r=e.a,o=s.length,a=i.length;++n<o;){var l=ci(s[n],r[n]);if(l){n=n>=a?l:l*("desc"==i[n]?-1:1);break t}}n=t.b-e.b}return n})}function We(t,e,i){for(var n=-1,s=e.length,r={};++n<s;){var o=e[n],a=me(t,o);i(a,o)&&ze(r,oi(o,t),a)}return r}function ke(t,e,i,n){var s=n?T:y,r=-1,o=e.length,a=t;for(t===e&&(e=fi(e)),i&&(a=c(t,O(i)));++r<o;){var l=0,h=e[r];for(h=i?i(h):h;-1<(l=s(a,h,l,n));)a!==t&&zs.call(a,l,1),zs.call(t,l,1)}return t}function Ue(t,e){for(var i=t?e.length:0,n=i-1;i--;){var s=e[i];if(i==n||s!==r){var r=s;tn(s)?zs.call(t,s,1):Qe(t,s)}}}function Le(t,e){return t+Qs(hr()*(e-t+1))}function je(t,e){var i="";if(!t||1>e||9007199254740991<e)return i;do{e%2&&(i+=t),(e=Qs(e/2))&&(t+=t)}while(e);return i}function Ne(t,e){return Nr(an(t,e,us),t+"")}function ze(t,e,i,n){if(!Ln(t))return t;for(var s=-1,r=(e=oi(e,t)).length,o=r-1,a=t;null!=a&&++s<r;){var l=cn(e[s]),h=i;if(s!=o){var u=a[l];(h=n?n(u,l,a):k)===k&&(h=Ln(u)?u:tn(e[s+1])?[]:{})}Nt(a,l,h),a=a[l]}return t}function Ve(t,e,i){var n=-1,s=t.length;for(0>e&&(e=-e>s?0:s+e),0>(i=i>s?s:i)&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0,i=ms(s);++n<s;)i[n]=t[n+e];return i}function Ge(t,e){var i;return Cr(t,function(t,n,s){return!(i=e(t,n,s))}),!!i}function Ye(t,e,i){var n=0,s=null==t?n:t.length;if("number"==typeof e&&e==e&&2147483647>=s){for(;n<s;){var r=n+s>>>1,o=t[r];null!==o&&!Gn(o)&&(i?o<=e:o<e)?n=r+1:s=r}return s}return qe(t,e,us,i)}function qe(t,e,i,n){e=i(e);for(var s=0,r=null==t?0:t.length,o=e!=e,a=null===e,l=Gn(e),h=e===k;s<r;){var u=Qs((s+r)/2),c=i(t[u]),p=c!==k,d=null===c,f=c==c,g=Gn(c);(o?n||f:h?f&&(n||p):a?f&&p&&(n||!d):l?f&&p&&!d&&(n||!g):!d&&!g&&(n?c<=e:c<e))?s=u+1:r=u}return or(r,4294967294)}function $e(t,e){for(var i=-1,n=t.length,s=0,r=[];++i<n;){var o=t[i],a=e?e(o):o;if(!i||!Mn(a,l)){var l=a;r[s++]=0===o?0:o}}return r}function Xe(t){return"number"==typeof t?t:Gn(t)?L:+t}function Je(t){if("string"==typeof t)return t;if(xo(t))return c(t,Je)+"";if(Gn(t))return Kr?Kr.call(t):"";var e=t+"";return"0"==e&&1/t==-U?"-0":e}function Ze(t,e,i){var n=-1,s=h,r=t.length,o=!0,a=[],l=a;if(i)o=!1,s=u;else if(200<=r){if(s=e?null:Br(t))return H(s);o=!1,s=I,l=new Ht}else l=e?[]:a;t:for(;++n<r;){var c=t[n],p=e?e(c):c;c=i||0!==c?c:0;if(o&&p==p){for(var d=l.length;d--;)if(l[d]===p)continue t;e&&l.push(p),a.push(c)}else s(l,p,i)||(l!==a&&l.push(p),a.push(c))}return a}function Qe(t,e){return null==(t=2>(e=oi(e,t)).length?t:me(t,Ve(e,0,-1)))||delete t[cn(Tn(e))]}function ti(t,e,i,n){for(var s=t.length,r=n?s:-1;(n?r--:++r<s)&&e(t[r],r,t););return i?Ve(t,n?0:r,n?r+1:s):Ve(t,n?r+1:0,n?s:r)}function ei(t,e){var i=t;return i instanceof Dt&&(i=i.value()),d(e,function(t,e){return e.func.apply(e.thisArg,p([t],e.args))},i)}function ii(t,e,i){var n=t.length;if(2>n)return n?Ze(t[0]):[];for(var s=-1,r=ms(n);++s<n;)for(var o=t[s],a=-1;++a<n;)a!=s&&(r[s]=he(r[s]||o,t[a],e,i));return Ze(de(r,1),e,i)}function ni(t,e,i){for(var n=-1,s=t.length,r=e.length,o={};++n<s;)i(o,t[n],n<r?e[n]:k);return o}function si(t){return Hn(t)?t:[]}function ri(t){return"function"==typeof t?t:us}function oi(t,e){return xo(t)?t:nn(t,e)?[t]:zr(Qn(t))}function ai(t,e,i){var n=t.length;return i=i===k?n:i,!e&&i>=n?t:Ve(t,e,i)}function li(t,e){if(e)return t.slice();var i=t.length;i=Us?Us(i):new t.constructor(i);return t.copy(i),i}function hi(t){var e=new t.constructor(t.byteLength);return new ks(e).set(new ks(t)),e}function ui(t,e){return new t.constructor(e?hi(t.buffer):t.buffer,t.byteOffset,t.length)}function ci(t,e){if(t!==e){var i=t!==k,n=null===t,s=t==t,r=Gn(t),o=e!==k,a=null===e,l=e==e,h=Gn(e);if(!a&&!h&&!r&&t>e||r&&o&&l&&!a&&!h||n&&o&&l||!i&&l||!s)return 1;if(!n&&!r&&!h&&t<e||h&&i&&s&&!n&&!r||a&&i&&s||!o&&s||!l)return-1}return 0}function pi(t,e,i,n){var s=-1,r=t.length,o=i.length,a=-1,l=e.length,h=rr(r-o,0),u=ms(l+h);for(n=!n;++a<l;)u[a]=e[a];for(;++s<o;)(n||s<r)&&(u[i[s]]=t[s]);for(;h--;)u[a++]=t[s++];return u}function di(t,e,i,n){var s=-1,r=t.length,o=-1,a=i.length,l=-1,h=e.length,u=rr(r-a,0),c=ms(u+h);for(n=!n;++s<u;)c[s]=t[s];for(u=s;++l<h;)c[u+l]=e[l];for(;++o<a;)(n||s<r)&&(c[u+i[o]]=t[s++]);return c}function fi(t,e){var i=-1,n=t.length;for(e||(e=ms(n));++i<n;)e[i]=t[i];return e}function gi(t,e,i,n){var s=!i;i||(i={});for(var r=-1,o=e.length;++r<o;){var a=e[r],l=n?n(i[a],t[a],a,i,t):k;l===k&&(l=t[a]),s?ne(i,a,l):Nt(i,a,l)}return i}function _i(t,e){return function(i,n){var s=xo(i)?r:ee,o=e?e():{};return s(i,t,Yi(n,2),o)}}function mi(t){return Ne(function(e,i){var n=-1,s=i.length,r=1<s?i[s-1]:k,o=2<s?i[2]:k;r=3<t.length&&"function"==typeof r?(s--,r):k;for(o&&en(i[0],i[1],o)&&(r=3>s?k:r,s=1),e=Ds(e);++n<s;)(o=i[n])&&t(e,o,n,r);return e})}function yi(t,e){return function(i,n){if(null==i)return i;if(!Bn(i))return t(i,n);for(var s=i.length,r=e?s:-1,o=Ds(i);(e?r--:++r<s)&&!1!==n(o[r],r,o););return i}}function Ti(t){return function(e,i,n){for(var s=-1,r=Ds(e),o=(n=n(e)).length;o--;){var a=n[t?o:++s];if(!1===i(r[a],a,r))break}return e}}function vi(t){return function(e){e=Qn(e);var i=Ct.test(e)?W(e):k,n=i?i[0]:e.charAt(0);return e=i?ai(i,1).join(""):e.slice(1),n[t]()+e}}function wi(t){return function(e){return d(ls(as(e).replace(bt,"")),t,"")}}function Di(t){return function(){switch((e=arguments).length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var e,i=Or(t.prototype);return Ln(e=t.apply(i,e))?e:i}}function Si(t,e,i){var n=Di(t);return function r(){for(var o=arguments.length,a=ms(o),l=o,h=Gi(r);l--;)a[l]=arguments[l];return(o-=(l=3>o&&a[0]!==h&&a[o-1]!==h?[]:B(a,h)).length)<i?Mi(t,e,Ki,r.placeholder,k,a,l,k,k,i-o):s(this&&this!==Wt&&this instanceof r?n:t,this,a)}}function bi(t){return function(e,i,n){var s=Ds(e);if(!Bn(e)){var r=Yi(i,3);e=is(e),i=function(t){return r(s[t],t,s)}}return-1<(i=t(e,i,n))?s[r?e[i]:i]:k}}function Ai(t){return ji(function(e){var i=e.length,n=i,s=S.prototype.thru;for(t&&e.reverse();n--;){if("function"!=typeof(o=e[n]))throw new As("Expected a function");if(s&&!r&&"wrapper"==Vi(o))var r=new S([],!0)}for(n=r?n:i;++n<i;){var o,a="wrapper"==(s=Vi(o=e[n]))?Hr(o):k;r=a&&sn(a[0])&&424==a[1]&&!a[4].length&&1==a[9]?r[Vi(a[0])].apply(r,a[3]):1==o.length&&sn(o)?r[s]():r.thru(o)}return function(){var t=(s=arguments)[0];if(r&&1==s.length&&xo(t))return r.plant(t).value();for(var n=0,s=i?e[n].apply(this,s):t;++n<i;)s=e[n].call(this,s);return s}})}function Ki(t,e,i,n,s,r,o,a,l,h){var u=128&e,c=1&e,p=2&e,d=24&e,f=512&e,g=p?k:Di(t);return function _(){for(var m=arguments.length,y=ms(m),T=m;T--;)y[T]=arguments[T];if(d){var v,w=Gi(_);for(T=y.length,v=0;T--;)y[T]===w&&++v}if(n&&(y=pi(y,n,s,d)),r&&(y=di(y,r,o,d)),m-=v,d&&m<h)return w=B(y,w),Mi(t,e,Ki,_.placeholder,i,y,w,a,l,h-m);if(w=c?i:this,T=p?w[t]:t,m=y.length,a){v=y.length;for(var D=or(a.length,v),S=fi(y);D--;){var b=a[D];y[D]=tn(b,v)?S[b]:k}}else f&&1<m&&y.reverse();return u&&l<m&&(y.length=l),this&&this!==Wt&&this instanceof _&&(T=g||Di(T)),T.apply(w,y)}}function Oi(t,e){return function(i,n){return function(t,e,i){var n={};return fe(t,function(t,s,r){e(n,i(t),s,r)}),n}(i,t,e(n))}}function Ci(t,e){return function(i,n){var s;if(i===k&&n===k)return e;if(i!==k&&(s=i),n!==k){if(s===k)return n;"string"==typeof i||"string"==typeof n?(i=Je(i),n=Je(n)):(i=Xe(i),n=Xe(n)),s=t(i,n)}return s}}function Ii(t){return ji(function(e){return e=c(e,O(Yi())),Ne(function(i){var n=this;return t(e,function(t){return s(t,n,i)})})})}function xi(t,e){var i=(e=e===k?" ":Je(e)).length;return 2>i?i?je(e,t):e:(i=je(e,Zs(t/F(e))),Ct.test(e)?ai(W(i),0,t).join(""):i.slice(0,t))}function Ei(t,e,i,n){var r=1&e,o=Di(t);return function e(){for(var a=-1,l=arguments.length,h=-1,u=n.length,c=ms(u+l),p=this&&this!==Wt&&this instanceof e?o:t;++h<u;)c[h]=n[h];for(;l--;)c[h++]=arguments[++a];return s(p,r?i:this,c)}}function Pi(t){return function(e,i,n){n&&"number"!=typeof n&&en(e,i,n)&&(i=n=k),e=qn(e),i===k?(i=e,e=0):i=qn(i),n=n===k?e<i?1:-1:qn(n);var s=-1;i=rr(Zs((i-e)/(n||1)),0);for(var r=ms(i);i--;)r[t?i:++s]=e,e+=n;return r}}function Ri(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Jn(e),i=Jn(i)),t(e,i)}}function Mi(t,e,i,n,s,r,o,a,l,h){var u=8&e,c=u?o:k;o=u?k:o;var p=u?r:k;return r=u?k:r,4&(e=(e|(u?32:64))&~(u?64:32))||(e&=-4),s=[t,e,s,p,c,r,o,a,l,h],i=i.apply(k,s),sn(t)&&Lr(i,s),i.placeholder=n,ln(i,t,e)}function Bi(t){var e=ws[t];return function(t,i){if(t=Jn(t),i=null==i?0:or($n(i),292)){var n=(Qn(t)+"e").split("e");return+((n=(Qn(n=e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}function Hi(t){return function(e){var i=kr(e);return"[object Map]"==i?R(e):"[object Set]"==i?function(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=[t,t]}),i}(e):function(t,e){return c(e,function(e){return[e,t[e]]})}(e,t(e))}}function Fi(t,e,i,n,s,r,o,a){var l=2&e;if(!l&&"function"!=typeof t)throw new As("Expected a function");var h=n?n.length:0;if(h||(e&=-97,n=s=k),o=o===k?o:rr($n(o),0),a=a===k?a:$n(a),h-=s?s.length:0,64&e){var u=n,c=s;n=s=k}var p=l?k:Hr(t);return r=[t,e,i,n,s,u,c,r,o,a],p&&(e=(i=r[1])|(t=p[1]),n=128==t&&8==i||128==t&&256==i&&r[7].length<=p[8]||384==t&&p[7].length<=p[8]&&8==i,131>e||n)&&(1&t&&(r[2]=p[2],e|=1&i?0:4),(i=p[3])&&(n=r[3],r[3]=n?pi(n,i,p[4]):i,r[4]=n?B(r[3],"__lodash_placeholder__"):p[4]),(i=p[5])&&(n=r[5],r[5]=n?di(n,i,p[6]):i,r[6]=n?B(r[5],"__lodash_placeholder__"):p[6]),(i=p[7])&&(r[7]=i),128&t&&(r[8]=null==r[8]?p[8]:or(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=e),t=r[0],e=r[1],i=r[2],n=r[3],s=r[4],!(a=r[9]=r[9]===k?l?0:t.length:rr(r[9]-h,0))&&24&e&&(e&=-25),ln((p?Pr:Lr)(e&&1!=e?8==e||16==e?Si(t,e,a):32!=e&&33!=e||s.length?Ki.apply(k,r):Ei(t,e,i,n):function(t,e,i){var n=1&e,s=Di(t);return function e(){return(this&&this!==Wt&&this instanceof e?s:t).apply(n?i:this,arguments)}}(t,e,i),r),t,e)}function Wi(t,e,i,n){return t===k||Mn(t,Os[i])&&!xs.call(n,i)?e:t}function ki(t,e,i,n,s,r){return Ln(t)&&Ln(e)&&(r.set(e,t),Be(t,e,k,ki,r),r.delete(e)),t}function Ui(t){return zn(t)?k:t}function Li(t,e,i,n,s,r){var o=1&i,a=t.length;if(a!=(l=e.length)&&!(o&&l>a))return!1;if((l=r.get(t))&&r.get(e))return l==e;var l=-1,h=!0,u=2&i?new Ht:k;for(r.set(t,e),r.set(e,t);++l<a;){var c=t[l],p=e[l];if(n)var d=o?n(p,c,l,e,t,r):n(c,p,l,t,e,r);if(d!==k){if(d)continue;h=!1;break}if(u){if(!g(e,function(t,e){if(!I(u,e)&&(c===t||s(c,t,i,n,r)))return u.push(e)})){h=!1;break}}else if(c!==p&&!s(c,p,i,n,r)){h=!1;break}}return r.delete(t),r.delete(e),h}function ji(t){return Nr(an(t,k,mn),t+"")}function Ni(t){return ye(t,is,Fr)}function zi(t){return ye(t,ns,Wr)}function Vi(t){for(var e=t.name+"",i=yr[e],n=xs.call(yr,e)?i.length:0;n--;){var s=i[n],r=s.func;if(null==r||r==t)return s.name}return e}function Gi(t){return(xs.call(i,"placeholder")?i:t).placeholder}function Yi(){var t=(t=i.iteratee||cs)===cs?Ie:t;return arguments.length?t(arguments[0],arguments[1]):t}function qi(t,e){var i=t.__data__,n=typeof e;return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?i["string"==typeof e?"string":"hash"]:i.map}function $i(t){for(var e=is(t),i=e.length;i--;){var n=e[i],s=t[n];e[i]=[n,s,s==s&&!Ln(s)]}return e}function Xi(t,e){var i=null==t?k:t[e];return Ce(i)?i:k}function Ji(t,e,i){for(var n=-1,s=(e=oi(e,t)).length,r=!1;++n<s;){var o=cn(e[n]);if(!(r=null!=t&&i(t,o)))break;t=t[o]}return r||++n!=s?r:!!(s=null==t?0:t.length)&&Un(s)&&tn(o,s)&&(xo(t)||Io(t))}function Zi(t){return"function"!=typeof t.constructor||rn(t)?{}:Or(Ls(t))}function Qi(t){return xo(t)||Io(t)||!!(Vs&&t&&t[Vs])}function tn(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&yt.test(t))&&-1<t&&0==t%1&&t<e}function en(t,e,i){if(!Ln(i))return!1;var n=typeof e;return!!("number"==n?Bn(i)&&tn(e,i.length):"string"==n&&e in i)&&Mn(i[e],t)}function nn(t,e){if(xo(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Gn(t))||tt.test(t)||!Q.test(t)||null!=e&&t in Ds(e)}function sn(t){var e=Vi(t),n=i[e];return"function"==typeof n&&e in Dt.prototype&&(t===n||!!(e=Hr(n))&&t===e[0])}function rn(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Os)}function on(t,e){return function(i){return null!=i&&i[t]===e&&(e!==k||t in Ds(i))}}function an(t,e,i){return e=rr(e===k?t.length-1:e,0),function(){for(var n=arguments,r=-1,o=rr(n.length-e,0),a=ms(o);++r<o;)a[r]=n[e+r];for(r=-1,o=ms(e+1);++r<e;)o[r]=n[r];return o[e]=i(a),s(t,this,o)}}function ln(t,e,i){var n=e+"";e=Nr;var s,r=dn;return(r=(i=r(s=(s=n.match(lt))?s[1].split(ht):[],i)).length)&&(i[s=r-1]=(1<r?"& ":"")+i[s],i=i.join(2<r?", ":" "),n=n.replace(at,"{\n/* [wrapped with "+i+"] */\n")),e(t,n)}function hn(t){var e=0,i=0;return function(){var n=ar(),s=16-(n-i);if(i=n,0<s){if(800<=++e)return arguments[0]}else e=0;return t.apply(k,arguments)}}function un(t,e){var i=-1,n=(s=t.length)-1;for(e=e===k?s:e;++i<e;){var s,r=t[s=Le(i,n)];t[s]=t[i],t[i]=r}return t.length=e,t}function cn(t){if("string"==typeof t||Gn(t))return t;var e=t+"";return"0"==e&&1/t==-U?"-0":e}function pn(t){if(null!=t){try{return Is.call(t)}catch(t){}return t+""}return""}function dn(t,e){return o(j,function(i){var n="_."+i[0];e&i[1]&&!h(t,n)&&t.push(n)}),t.sort()}function fn(t){if(t instanceof Dt)return t.clone();var e=new S(t.__wrapped__,t.__chain__);return e.__actions__=fi(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function gn(t,e,i){var n=null==t?0:t.length;return n?(0>(i=null==i?0:$n(i))&&(i=rr(n+i,0)),m(t,Yi(e,3),i)):-1}function _n(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n-1;return i!==k&&(s=$n(i),s=0>i?rr(n+s,0):or(s,n-1)),m(t,Yi(e,3),s,!0)}function mn(t){return null!=t&&t.length?de(t,1):[]}function yn(t){return t&&t.length?t[0]:k}function Tn(t){var e=null==t?0:t.length;return e?t[e-1]:k}function vn(t,e){return t&&t.length&&e&&e.length?ke(t,e):t}function wn(t){return null==t?t:ur.call(t)}function Dn(t){if(!t||!t.length)return[];var e=0;return t=l(t,function(t){if(Hn(t))return e=rr(t.length,e),!0}),K(e,function(e){return c(t,D(e))})}function Sn(t,e){if(!t||!t.length)return[];var i=Dn(t);return null==e?i:c(i,function(t){return s(e,k,t)})}function bn(t){return(t=i(t)).__chain__=!0,t}function An(t,e){return e(t)}function Kn(t,e){return(xo(t)?o:Cr)(t,Yi(e,3))}function On(t,e){return(xo(t)?function(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}:Ir)(t,Yi(e,3))}function Cn(t,e){return(xo(t)?c:Pe)(t,Yi(e,3))}function In(t,e,i){return e=i?k:e,e=t&&null==e?t.length:e,Fi(t,128,k,k,k,k,e)}function xn(t,e){var i;if("function"!=typeof e)throw new As("Expected a function");return t=$n(t),function(){return 0<--t&&(i=e.apply(this,arguments)),1>=t&&(e=k),i}}function En(t,e,i){function n(e){var i=l,n=h;return l=h=k,f=e,c=t.apply(n,i)}function s(t){var i=t-d;return t-=f,d===k||i>=e||0>i||_&&t>=u}function r(){var t=yo();if(s(t))return o(t);var i,n=jr;i=t-f,t=e-(t-d),i=_?or(t,u-i):t,p=n(r,i)}function o(t){return p=k,m&&l?n(t):(l=h=k,c)}function a(){var t=yo(),i=s(t);if(l=arguments,h=this,d=t,i){if(p===k)return f=t=d,p=jr(r,e),g?n(t):c;if(_)return p=jr(r,e),n(d)}return p===k&&(p=jr(r,e)),c}var l,h,u,c,p,d,f=0,g=!1,_=!1,m=!0;if("function"!=typeof t)throw new As("Expected a function");return e=Jn(e)||0,Ln(i)&&(g=!!i.leading,u=(_="maxWait"in i)?rr(Jn(i.maxWait)||0,e):u,m="trailing"in i?!!i.trailing:m),a.cancel=function(){p!==k&&Mr(p),f=0,l=d=h=p=k},a.flush=function(){return p===k?c:o(yo())},a}function Pn(t,e){function i(){var n=arguments,s=e?e.apply(this,n):n[0],r=i.cache;return r.has(s)?r.get(s):(n=t.apply(this,n),i.cache=r.set(s,n)||r,n)}if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new As("Expected a function");return i.cache=new(Pn.Cache||Rt),i}function Rn(t){if("function"!=typeof t)throw new As("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Mn(t,e){return t===e||t!=t&&e!=e}function Bn(t){return null!=t&&Un(t.length)&&!Wn(t)}function Hn(t){return jn(t)&&Bn(t)}function Fn(t){if(!jn(t))return!1;var e=Te(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!zn(t)}function Wn(t){return!!Ln(t)&&("[object Function]"==(t=Te(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)}function kn(t){return"number"==typeof t&&t==$n(t)}function Un(t){return"number"==typeof t&&-1<t&&0==t%1&&9007199254740991>=t}function Ln(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function jn(t){return null!=t&&"object"==typeof t}function Nn(t){return"number"==typeof t||jn(t)&&"[object Number]"==Te(t)}function zn(t){return!(!jn(t)||"[object Object]"!=Te(t))&&(null===(t=Ls(t))||"function"==typeof(t=xs.call(t,"constructor")&&t.constructor)&&t instanceof t&&Is.call(t)==Ms)}function Vn(t){return"string"==typeof t||!xo(t)&&jn(t)&&"[object String]"==Te(t)}function Gn(t){return"symbol"==typeof t||jn(t)&&"[object Symbol]"==Te(t)}function Yn(t){if(!t)return[];if(Bn(t))return Vn(t)?W(t):fi(t);if(Gs&&t[Gs]){t=t[Gs]();for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}return("[object Map]"==(e=kr(t))?R:"[object Set]"==e?H:rs)(t)}function qn(t){return t?(t=Jn(t))===U||t===-U?1.7976931348623157e308*(0>t?-1:1):t==t?t:0:0===t?t:0}function $n(t){var e=(t=qn(t))%1;return t==t?e?t-e:t:0}function Xn(t){return t?re($n(t),0,4294967295):0}function Jn(t){if("number"==typeof t)return t;if(Gn(t))return L;if(Ln(t)&&(t=Ln(t="function"==typeof t.valueOf?t.valueOf():t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;t=t.replace(st,"");var e=gt.test(t);return e||mt.test(t)?Bt(t.slice(2),e?2:8):ft.test(t)?L:+t}function Zn(t){return gi(t,ns(t))}function Qn(t){return null==t?"":Je(t)}function ts(t,e,i){return(t=null==t?k:me(t,e))===k?i:t}function es(t,e){return null!=t&&Ji(t,e,De)}function is(t){return Bn(t)?kt(t):xe(t)}function ns(t){if(Bn(t))t=kt(t,!0);else if(Ln(t)){var e,i=rn(t),n=[];for(e in t)("constructor"!=e||!i&&xs.call(t,e))&&n.push(e);t=n}else{if(e=[],null!=t)for(i in Ds(t))e.push(i);t=e}return t}function ss(t,e){if(null==t)return{};var i=c(zi(t),function(t){return[t]});return e=Yi(e),We(t,i,function(t,i){return e(t,i[0])})}function rs(t){return null==t?[]:C(t,is(t))}function os(t){return ha(Qn(t).toLowerCase())}function as(t){return(t=Qn(t))&&t.replace(Tt,Jt).replace(At,"")}function ls(t,e,i){return t=Qn(t),(e=i?k:e)===k?It.test(t)?t.match(Ot)||[]:t.match(ut)||[]:t.match(e)||[]}function hs(t){return function(){return t}}function us(t){return t}function cs(t){return Ie("function"==typeof t?t:oe(t,1))}function ps(t,e,i){var n=is(e),s=_e(e,n);null!=i||Ln(e)&&(s.length||!n.length)||(i=e,e=t,t=this,s=_e(e,is(e)));var r=!(Ln(i)&&"chain"in i&&!i.chain),a=Wn(t);return o(s,function(i){var n=e[i];t[i]=n,a&&(t.prototype[i]=function(){var e=this.__chain__;if(r||e){var i=t(this.__wrapped__);return(i.__actions__=fi(this.__actions__)).push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,p([this.value()],arguments))})}),t}function ds(){}function fs(t){return nn(t)?D(cn(t)):function(t){return function(e){return me(e,t)}}(t)}function gs(){return[]}function _s(){return!1}var ms=(e=null==e?Wt:te.defaults(Wt.Object(),e,te.pick(Wt,xt))).Array,ys=e.Date,Ts=e.Error,vs=e.Function,ws=e.Math,Ds=e.Object,Ss=e.RegExp,bs=e.String,As=e.TypeError,Ks=ms.prototype,Os=Ds.prototype,Cs=e["__core-js_shared__"],Is=vs.prototype.toString,xs=Os.hasOwnProperty,Es=0,Ps=function(){var t=/[^.]+$/.exec(Cs&&Cs.keys&&Cs.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Rs=Os.toString,Ms=Is.call(Ds),Bs=Wt._,Hs=Ss("^"+Is.call(xs).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fs=Lt?e.Buffer:k,Ws=e.Symbol,ks=e.Uint8Array,Us=Fs?Fs.g:k,Ls=M(Ds.getPrototypeOf,Ds),js=Ds.create,Ns=Os.propertyIsEnumerable,zs=Ks.splice,Vs=Ws?Ws.isConcatSpreadable:k,Gs=Ws?Ws.iterator:k,Ys=Ws?Ws.toStringTag:k,qs=function(){try{var t=Xi(Ds,"defineProperty");return t({},"",{}),t}catch(t){}}(),$s=e.clearTimeout!==Wt.clearTimeout&&e.clearTimeout,Xs=ys&&ys.now!==Wt.Date.now&&ys.now,Js=e.setTimeout!==Wt.setTimeout&&e.setTimeout,Zs=ws.ceil,Qs=ws.floor,tr=Ds.getOwnPropertySymbols,er=Fs?Fs.isBuffer:k,ir=e.isFinite,nr=Ks.join,sr=M(Ds.keys,Ds),rr=ws.max,or=ws.min,ar=ys.now,lr=e.parseInt,hr=ws.random,ur=Ks.reverse,cr=Xi(e,"DataView"),pr=Xi(e,"Map"),dr=Xi(e,"Promise"),fr=Xi(e,"Set"),gr=Xi(e,"WeakMap"),_r=Xi(Ds,"create"),mr=gr&&new gr,yr={},Tr=pn(cr),vr=pn(pr),wr=pn(dr),Dr=pn(fr),Sr=pn(gr),br=Ws?Ws.prototype:k,Ar=br?br.valueOf:k,Kr=br?br.toString:k,Or=function(){function t(){}return function(e){return Ln(e)?js?js(e):(t.prototype=e,e=new t,t.prototype=k,e):{}}}();i.templateSettings={escape:X,evaluate:J,interpolate:Z,variable:"",imports:{_:i}},i.prototype=n.prototype,i.prototype.constructor=i,S.prototype=Or(n.prototype),S.prototype.constructor=S,Dt.prototype=Or(n.prototype),Dt.prototype.constructor=Dt,St.prototype.clear=function(){this.__data__=_r?_r(null):{},this.size=0},St.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},St.prototype.get=function(t){var e=this.__data__;return _r?"__lodash_hash_undefined__"===(t=e[t])?k:t:xs.call(e,t)?e[t]:k},St.prototype.has=function(t){var e=this.__data__;return _r?e[t]!==k:xs.call(e,t)},St.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=_r&&e===k?"__lodash_hash_undefined__":e,this},Kt.prototype.clear=function(){this.__data__=[],this.size=0},Kt.prototype.delete=function(t){var e=this.__data__;return!(0>(t=Xt(e,t))||(t==e.length-1?e.pop():zs.call(e,t,1),--this.size,0))},Kt.prototype.get=function(t){var e=this.__data__;return 0>(t=Xt(e,t))?k:e[t][1]},Kt.prototype.has=function(t){return-1<Xt(this.__data__,t)},Kt.prototype.set=function(t,e){var i=this.__data__,n=Xt(i,t);return 0>n?(++this.size,i.push([t,e])):i[n][1]=e,this},Rt.prototype.clear=function(){this.size=0,this.__data__={hash:new St,map:new(pr||Kt),string:new St}},Rt.prototype.delete=function(t){return t=qi(this,t).delete(t),this.size-=t?1:0,t},Rt.prototype.get=function(t){return qi(this,t).get(t)},Rt.prototype.has=function(t){return qi(this,t).has(t)},Rt.prototype.set=function(t,e){var i=qi(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Ht.prototype.add=Ht.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ht.prototype.has=function(t){return this.__data__.has(t)},Ft.prototype.clear=function(){this.__data__=new Kt,this.size=0},Ft.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},Ft.prototype.get=function(t){return this.__data__.get(t)},Ft.prototype.has=function(t){return this.__data__.has(t)},Ft.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Kt){var n=i.__data__;if(!pr||199>n.length)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Rt(n)}return i.set(t,e),this.size=i.size,this};var Cr=yi(fe),Ir=yi(ge,!0),xr=Ti(),Er=Ti(!0),Pr=mr?function(t,e){return mr.set(t,e),t}:us,Rr=qs?function(t,e){return qs(t,"toString",{configurable:!0,enumerable:!1,value:hs(e),writable:!0})}:us,Mr=$s||function(t){return Wt.clearTimeout(t)},Br=fr&&1/H(new fr([,-0]))[1]==U?function(t){return new fr(t)}:ds,Hr=mr?function(t){return mr.get(t)}:ds,Fr=tr?function(t){return null==t?[]:(t=Ds(t),l(tr(t),function(e){return Ns.call(t,e)}))}:gs,Wr=tr?function(t){for(var e=[];t;)p(e,Fr(t)),t=Ls(t);return e}:gs,kr=Te;(cr&&"[object DataView]"!=kr(new cr(new ArrayBuffer(1)))||pr&&"[object Map]"!=kr(new pr)||dr&&"[object Promise]"!=kr(dr.resolve())||fr&&"[object Set]"!=kr(new fr)||gr&&"[object WeakMap]"!=kr(new gr))&&(kr=function(t){var e=Te(t);if(t=(t="[object Object]"==e?t.constructor:k)?pn(t):"")switch(t){case Tr:return"[object DataView]";case vr:return"[object Map]";case wr:return"[object Promise]";case Dr:return"[object Set]";case Sr:return"[object WeakMap]"}return e});var Ur=Cs?Wn:_s,Lr=hn(Pr),jr=Js||function(t,e){return Wt.setTimeout(t,e)},Nr=hn(Rr),zr=function(t){var e=(t=Pn(t,function(t){return 500===e.size&&e.clear(),t})).cache;return t}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(et,function(t,i,n,s){e.push(n?s.replace(ct,"$1"):i||t)}),e}),Vr=Ne(function(t,e){return Hn(t)?he(t,de(e,1,Hn,!0)):[]}),Gr=Ne(function(t,e){var i=Tn(e);return Hn(i)&&(i=k),Hn(t)?he(t,de(e,1,Hn,!0),Yi(i,2)):[]}),Yr=Ne(function(t,e){var i=Tn(e);return Hn(i)&&(i=k),Hn(t)?he(t,de(e,1,Hn,!0),k,i):[]}),qr=Ne(function(t){var e=c(t,si);return e.length&&e[0]===t[0]?Se(e):[]}),$r=Ne(function(t){var e=Tn(t),i=c(t,si);return e===Tn(i)?e=k:i.pop(),i.length&&i[0]===t[0]?Se(i,Yi(e,2)):[]}),Xr=Ne(function(t){var e=Tn(t),i=c(t,si);return(e="function"==typeof e?e:k)&&i.pop(),i.length&&i[0]===t[0]?Se(i,k,e):[]}),Jr=Ne(vn),Zr=ji(function(t,e){var i=null==t?0:t.length,n=se(t,e);return Ue(t,c(e,function(t){return tn(t,i)?+t:t}).sort(ci)),n}),Qr=Ne(function(t){return Ze(de(t,1,Hn,!0))}),to=Ne(function(t){var e=Tn(t);return Hn(e)&&(e=k),Ze(de(t,1,Hn,!0),Yi(e,2))}),eo=Ne(function(t){var e="function"==typeof(e=Tn(t))?e:k;return Ze(de(t,1,Hn,!0),k,e)}),io=Ne(function(t,e){return Hn(t)?he(t,e):[]}),no=Ne(function(t){return ii(l(t,Hn))}),so=Ne(function(t){var e=Tn(t);return Hn(e)&&(e=k),ii(l(t,Hn),Yi(e,2))}),ro=Ne(function(t){var e="function"==typeof(e=Tn(t))?e:k;return ii(l(t,Hn),k,e)}),oo=Ne(Dn),ao=Ne(function(t){var e;return Sn(t,e="function"==typeof(e=1<(e=t.length)?t[e-1]:k)?(t.pop(),e):k)}),lo=ji(function(t){function e(e){return se(e,t)}var i=t.length,n=i?t[0]:0,s=this.__wrapped__;return!(1<i||this.__actions__.length)&&s instanceof Dt&&tn(n)?((s=s.slice(n,+n+(i?1:0))).__actions__.push({func:An,args:[e],thisArg:k}),new S(s,this.__chain__).thru(function(t){return i&&!t.length&&t.push(k),t})):this.thru(e)}),ho=_i(function(t,e,i){xs.call(t,i)?++t[i]:ne(t,i,1)}),uo=bi(gn),co=bi(_n),po=_i(function(t,e,i){xs.call(t,i)?t[i].push(e):ne(t,i,[e])}),fo=Ne(function(t,e,i){var n=-1,r="function"==typeof e,o=Bn(t)?ms(t.length):[];return Cr(t,function(t){o[++n]=r?s(e,t,i):be(t,e,i)}),o}),go=_i(function(t,e,i){ne(t,i,e)}),_o=_i(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]}),mo=Ne(function(t,e){if(null==t)return[];var i=e.length;return 1<i&&en(t,e[0],e[1])?e=[]:2<i&&en(e[0],e[1],e[2])&&(e=[e[0]]),Fe(t,de(e,1),[])}),yo=Xs||function(){return Wt.Date.now()},To=Ne(function(t,e,i){var n=1;if(i.length){var s=B(i,Gi(To));n=32|n}return Fi(t,n,e,i,s)}),vo=Ne(function(t,e,i){var n=3;if(i.length){var s=B(i,Gi(vo));n=32|n}return Fi(e,n,t,i,s)}),wo=Ne(function(t,e){return le(t,1,e)}),Do=Ne(function(t,e,i){return le(t,Jn(e)||0,i)});Pn.Cache=Rt;var So=Ne(function(t,e){var i=(e=1==e.length&&xo(e[0])?c(e[0],O(Yi())):c(de(e,1),O(Yi()))).length;return Ne(function(n){for(var r=-1,o=or(n.length,i);++r<o;)n[r]=e[r].call(this,n[r]);return s(t,this,n)})}),bo=Ne(function(t,e){return Fi(t,32,k,e,B(e,Gi(bo)))}),Ao=Ne(function(t,e){return Fi(t,64,k,e,B(e,Gi(Ao)))}),Ko=ji(function(t,e){return Fi(t,256,k,k,k,e)}),Oo=Ri(ve),Co=Ri(function(t,e){return t>=e}),Io=Ae(function(){return arguments}())?Ae:function(t){return jn(t)&&xs.call(t,"callee")&&!Ns.call(t,"callee")},xo=ms.isArray,Eo=zt?O(zt):function(t){return jn(t)&&"[object ArrayBuffer]"==Te(t)},Po=er||_s,Ro=Vt?O(Vt):function(t){return jn(t)&&"[object Date]"==Te(t)},Mo=Gt?O(Gt):function(t){return jn(t)&&"[object Map]"==kr(t)},Bo=Yt?O(Yt):function(t){return jn(t)&&"[object RegExp]"==Te(t)},Ho=qt?O(qt):function(t){return jn(t)&&"[object Set]"==kr(t)},Fo=$t?O($t):function(t){return jn(t)&&Un(t.length)&&!!Et[Te(t)]},Wo=Ri(Ee),ko=Ri(function(t,e){return t<=e}),Uo=mi(function(t,e){if(rn(e)||Bn(e))gi(e,is(e),t);else for(var i in e)xs.call(e,i)&&Nt(t,i,e[i])}),Lo=mi(function(t,e){gi(e,ns(e),t)}),jo=mi(function(t,e,i,n){gi(e,ns(e),t,n)}),No=mi(function(t,e,i,n){gi(e,is(e),t,n)}),zo=ji(se),Vo=Ne(function(t,e){t=Ds(t);var i=-1,n=e.length;for((s=2<n?e[2]:k)&&en(e[0],e[1],s)&&(n=1);++i<n;)for(var s,r=ns(s=e[i]),o=-1,a=r.length;++o<a;){var l=r[o],h=t[l];(h===k||Mn(h,Os[l])&&!xs.call(t,l))&&(t[l]=s[l])}return t}),Go=Ne(function(t){return t.push(k,ki),s(Jo,k,t)}),Yo=Oi(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Rs.call(e)),t[e]=i},hs(us)),qo=Oi(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Rs.call(e)),xs.call(t,e)?t[e].push(i):t[e]=[i]},Yi),$o=Ne(be),Xo=mi(function(t,e,i){Be(t,e,i)}),Jo=mi(function(t,e,i,n){Be(t,e,i,n)}),Zo=ji(function(t,e){var i={};if(null==t)return i;var n=!1;e=c(e,function(e){return e=oi(e,t),n||(n=1<e.length),e}),gi(t,zi(t),i),n&&(i=oe(i,7,Ui));for(var s=e.length;s--;)Qe(i,e[s]);return i}),Qo=ji(function(t,e){return null==t?{}:function(t,e){return We(t,e,function(e,i){return es(t,i)})}(t,e)}),ta=Hi(is),ea=Hi(ns),ia=wi(function(t,e,i){return e=e.toLowerCase(),t+(i?os(e):e)}),na=wi(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),sa=wi(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),ra=vi("toLowerCase"),oa=wi(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}),aa=wi(function(t,e,i){return t+(i?" ":"")+ha(e)}),la=wi(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),ha=vi("toUpperCase"),ua=Ne(function(t,e){try{return s(t,k,e)}catch(t){return Fn(t)?t:new Ts(t)}}),ca=ji(function(t,e){return o(e,function(e){e=cn(e),ne(t,e,To(t[e],t))}),t}),pa=Ai(),da=Ai(!0),fa=Ne(function(t,e){return function(i){return be(i,t,e)}}),ga=Ne(function(t,e){return function(i){return be(t,i,e)}}),_a=Ii(c),ma=Ii(a),ya=Ii(g),Ta=Pi(),va=Pi(!0),wa=Ci(function(t,e){return t+e},0),Da=Bi("ceil"),Sa=Ci(function(t,e){return t/e},1),ba=Bi("floor"),Aa=Ci(function(t,e){return t*e},1),Ka=Bi("round"),Oa=Ci(function(t,e){return t-e},0);return i.after=function(t,e){if("function"!=typeof e)throw new As("Expected a function");return t=$n(t),function(){if(1>--t)return e.apply(this,arguments)}},i.ary=In,i.assign=Uo,i.assignIn=Lo,i.assignInWith=jo,i.assignWith=No,i.at=zo,i.before=xn,i.bind=To,i.bindAll=ca,i.bindKey=vo,i.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return xo(t)?t:[t]},i.chain=bn,i.chunk=function(t,e,i){if(e=(i?en(t,e,i):e===k)?1:rr($n(e),0),!(i=null==t?0:t.length)||1>e)return[];for(var n=0,s=0,r=ms(Zs(i/e));n<i;)r[s++]=Ve(t,n,n+=e);return r},i.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,s=[];++e<i;){var r=t[e];r&&(s[n++]=r)}return s},i.concat=function(){var t=arguments.length;if(!t)return[];for(var e=ms(t-1),i=arguments[0];t--;)e[t-1]=arguments[t];return p(xo(i)?fi(i):[i],de(e,1))},i.cond=function(t){var e=null==t?0:t.length,i=Yi();return t=e?c(t,function(t){if("function"!=typeof t[1])throw new As("Expected a function");return[i(t[0]),t[1]]}):[],Ne(function(i){for(var n=-1;++n<e;){var r=t[n];if(s(r[0],this,i))return s(r[1],this,i)}})},i.conforms=function(t){return function(t){var e=is(t);return function(i){return ae(i,t,e)}}(oe(t,1))},i.constant=hs,i.countBy=ho,i.create=function(t,e){var i=Or(t);return null==e?i:ie(i,e)},i.curry=function t(e,i,n){return(e=Fi(e,8,k,k,k,k,k,i=n?k:i)).placeholder=t.placeholder,e},i.curryRight=function t(e,i,n){return(e=Fi(e,16,k,k,k,k,k,i=n?k:i)).placeholder=t.placeholder,e},i.debounce=En,i.defaults=Vo,i.defaultsDeep=Go,i.defer=wo,i.delay=Do,i.difference=Vr,i.differenceBy=Gr,i.differenceWith=Yr,i.drop=function(t,e,i){var n=null==t?0:t.length;return n?Ve(t,0>(e=i||e===k?1:$n(e))?0:e,n):[]},i.dropRight=function(t,e,i){var n=null==t?0:t.length;return n?Ve(t,0,0>(e=n-(e=i||e===k?1:$n(e)))?0:e):[]},i.dropRightWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3),!0,!0):[]},i.dropWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3),!0):[]},i.fill=function(t,e,i,n){var s=null==t?0:t.length;if(!s)return[];for(i&&"number"!=typeof i&&en(t,e,i)&&(i=0,n=s),s=t.length,0>(i=$n(i))&&(i=-i>s?0:s+i),0>(n=n===k||n>s?s:$n(n))&&(n+=s),n=i>n?0:Xn(n);i<n;)t[i++]=e;return t},i.filter=function(t,e){return(xo(t)?l:pe)(t,Yi(e,3))},i.flatMap=function(t,e){return de(Cn(t,e),1)},i.flatMapDeep=function(t,e){return de(Cn(t,e),U)},i.flatMapDepth=function(t,e,i){return i=i===k?1:$n(i),de(Cn(t,e),i)},i.flatten=mn,i.flattenDeep=function(t){return null!=t&&t.length?de(t,U):[]},i.flattenDepth=function(t,e){return null!=t&&t.length?de(t,e=e===k?1:$n(e)):[]},i.flip=function(t){return Fi(t,512)},i.flow=pa,i.flowRight=da,i.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var s=t[e];n[s[0]]=s[1]}return n},i.functions=function(t){return null==t?[]:_e(t,is(t))},i.functionsIn=function(t){return null==t?[]:_e(t,ns(t))},i.groupBy=po,i.initial=function(t){return null!=t&&t.length?Ve(t,0,-1):[]},i.intersection=qr,i.intersectionBy=$r,i.intersectionWith=Xr,i.invert=Yo,i.invertBy=qo,i.invokeMap=fo,i.iteratee=cs,i.keyBy=go,i.keys=is,i.keysIn=ns,i.map=Cn,i.mapKeys=function(t,e){var i={};return e=Yi(e,3),fe(t,function(t,n,s){ne(i,e(t,n,s),t)}),i},i.mapValues=function(t,e){var i={};return e=Yi(e,3),fe(t,function(t,n,s){ne(i,n,e(t,n,s))}),i},i.matches=function(t){return Re(oe(t,1))},i.matchesProperty=function(t,e){return Me(t,oe(e,1))},i.memoize=Pn,i.merge=Xo,i.mergeWith=Jo,i.method=fa,i.methodOf=ga,i.mixin=ps,i.negate=Rn,i.nthArg=function(t){return t=$n(t),Ne(function(e){return He(e,t)})},i.omit=Zo,i.omitBy=function(t,e){return ss(t,Rn(Yi(e)))},i.once=function(t){return xn(2,t)},i.orderBy=function(t,e,i,n){return null==t?[]:(xo(e)||(e=null==e?[]:[e]),xo(i=n?k:i)||(i=null==i?[]:[i]),Fe(t,e,i))},i.over=_a,i.overArgs=So,i.overEvery=ma,i.overSome=ya,i.partial=bo,i.partialRight=Ao,i.partition=_o,i.pick=Qo,i.pickBy=ss,i.property=fs,i.propertyOf=function(t){return function(e){return null==t?k:me(t,e)}},i.pull=Jr,i.pullAll=vn,i.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?ke(t,e,Yi(i,2)):t},i.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?ke(t,e,k,i):t},i.pullAt=Zr,i.range=Ta,i.rangeRight=va,i.rearg=Ko,i.reject=function(t,e){return(xo(t)?l:pe)(t,Rn(Yi(e,3)))},i.remove=function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,s=[],r=t.length;for(e=Yi(e,3);++n<r;){var o=t[n];e(o,n,t)&&(i.push(o),s.push(n))}return Ue(t,s),i},i.rest=function(t,e){if("function"!=typeof t)throw new As("Expected a function");return Ne(t,e=e===k?e:$n(e))},i.reverse=wn,i.sampleSize=function(t,e,i){return e=(i?en(t,e,i):e===k)?1:$n(e),(xo(t)?function(t,e){return un(fi(t),re(e,0,t.length))}:function(t,e){var i=rs(t);return un(i,re(e,0,i.length))})(t,e)},i.set=function(t,e,i){return null==t?t:ze(t,e,i)},i.setWith=function(t,e,i,n){return n="function"==typeof n?n:k,null==t?t:ze(t,e,i,n)},i.shuffle=function(t){return(xo(t)?function(t){return un(fi(t))}:function(t){return un(rs(t))})(t)},i.slice=function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&en(t,e,i)?(e=0,i=n):(e=null==e?0:$n(e),i=i===k?n:$n(i)),Ve(t,e,i)):[]},i.sortBy=mo,i.sortedUniq=function(t){return t&&t.length?$e(t):[]},i.sortedUniqBy=function(t,e){return t&&t.length?$e(t,Yi(e,2)):[]},i.split=function(t,e,i){return i&&"number"!=typeof i&&en(t,e,i)&&(e=i=k),(i=i===k?4294967295:i>>>0)?(t=Qn(t))&&("string"==typeof e||null!=e&&!Bo(e))&&(!(e=Je(e))&&Ct.test(t))?ai(W(t),0,i):t.split(e,i):[]},i.spread=function(t,e){if("function"!=typeof t)throw new As("Expected a function");return e=null==e?0:rr($n(e),0),Ne(function(i){var n=i[e];return i=ai(i,0,e),n&&p(i,n),s(t,this,i)})},i.tail=function(t){var e=null==t?0:t.length;return e?Ve(t,1,e):[]},i.take=function(t,e,i){return t&&t.length?Ve(t,0,0>(e=i||e===k?1:$n(e))?0:e):[]},i.takeRight=function(t,e,i){var n=null==t?0:t.length;return n?Ve(t,0>(e=n-(e=i||e===k?1:$n(e)))?0:e,n):[]},i.takeRightWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3),!1,!0):[]},i.takeWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3)):[]},i.tap=function(t,e){return e(t),t},i.throttle=function(t,e,i){var n=!0,s=!0;if("function"!=typeof t)throw new As("Expected a function");return Ln(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),En(t,e,{leading:n,maxWait:e,trailing:s})},i.thru=An,i.toArray=Yn,i.toPairs=ta,i.toPairsIn=ea,i.toPath=function(t){return xo(t)?c(t,cn):Gn(t)?[t]:fi(zr(Qn(t)))},i.toPlainObject=Zn,i.transform=function(t,e,i){var n=xo(t),s=n||Po(t)||Fo(t);if(e=Yi(e,4),null==i){var r=t&&t.constructor;i=s?n?new r:[]:Ln(t)&&Wn(r)?Or(Ls(t)):{}}return(s?o:fe)(t,function(t,n,s){return e(i,t,n,s)}),i},i.unary=function(t){return In(t,1)},i.union=Qr,i.unionBy=to,i.unionWith=eo,i.uniq=function(t){return t&&t.length?Ze(t):[]},i.uniqBy=function(t,e){return t&&t.length?Ze(t,Yi(e,2)):[]},i.uniqWith=function(t,e){return e="function"==typeof e?e:k,t&&t.length?Ze(t,k,e):[]},i.unset=function(t,e){return null==t||Qe(t,e)},i.unzip=Dn,i.unzipWith=Sn,i.update=function(t,e,i){return null==t?t:ze(t,e,ri(i)(me(t,e)),void 0)},i.updateWith=function(t,e,i,n){return n="function"==typeof n?n:k,null!=t&&(t=ze(t,e,ri(i)(me(t,e)),n)),t},i.values=rs,i.valuesIn=function(t){return null==t?[]:C(t,ns(t))},i.without=io,i.words=ls,i.wrap=function(t,e){return bo(ri(e),t)},i.xor=no,i.xorBy=so,i.xorWith=ro,i.zip=oo,i.zipObject=function(t,e){return ni(t||[],e||[],Nt)},i.zipObjectDeep=function(t,e){return ni(t||[],e||[],ze)},i.zipWith=ao,i.entries=ta,i.entriesIn=ea,i.extend=Lo,i.extendWith=jo,ps(i,i),i.add=wa,i.attempt=ua,i.camelCase=ia,i.capitalize=os,i.ceil=Da,i.clamp=function(t,e,i){return i===k&&(i=e,e=k),i!==k&&(i=(i=Jn(i))==i?i:0),e!==k&&(e=(e=Jn(e))==e?e:0),re(Jn(t),e,i)},i.clone=function(t){return oe(t,4)},i.cloneDeep=function(t){return oe(t,5)},i.cloneDeepWith=function(t,e){return oe(t,5,e="function"==typeof e?e:k)},i.cloneWith=function(t,e){return oe(t,4,e="function"==typeof e?e:k)},i.conformsTo=function(t,e){return null==e||ae(t,e,is(e))},i.deburr=as,i.defaultTo=function(t,e){return null==t||t!=t?e:t},i.divide=Sa,i.endsWith=function(t,e,i){t=Qn(t),e=Je(e);var n=t.length;n=i=i===k?n:re($n(i),0,n);return 0<=(i-=e.length)&&t.slice(i,n)==e},i.eq=Mn,i.escape=function(t){return(t=Qn(t))&&$.test(t)?t.replace(Y,Zt):t},i.escapeRegExp=function(t){return(t=Qn(t))&&nt.test(t)?t.replace(it,"\\$&"):t},i.every=function(t,e,i){var n=xo(t)?a:ue;return i&&en(t,e,i)&&(e=k),n(t,Yi(e,3))},i.find=uo,i.findIndex=gn,i.findKey=function(t,e){return _(t,Yi(e,3),fe)},i.findLast=co,i.findLastIndex=_n,i.findLastKey=function(t,e){return _(t,Yi(e,3),ge)},i.floor=ba,i.forEach=Kn,i.forEachRight=On,i.forIn=function(t,e){return null==t?t:xr(t,Yi(e,3),ns)},i.forInRight=function(t,e){return null==t?t:Er(t,Yi(e,3),ns)},i.forOwn=function(t,e){return t&&fe(t,Yi(e,3))},i.forOwnRight=function(t,e){return t&&ge(t,Yi(e,3))},i.get=ts,i.gt=Oo,i.gte=Co,i.has=function(t,e){return null!=t&&Ji(t,e,we)},i.hasIn=es,i.head=yn,i.identity=us,i.includes=function(t,e,i,n){return t=Bn(t)?t:rs(t),i=i&&!n?$n(i):0,n=t.length,0>i&&(i=rr(n+i,0)),Vn(t)?i<=n&&-1<t.indexOf(e,i):!!n&&-1<y(t,e,i)},i.indexOf=function(t,e,i){var n=null==t?0:t.length;return n?(0>(i=null==i?0:$n(i))&&(i=rr(n+i,0)),y(t,e,i)):-1},i.inRange=function(t,e,i){return e=qn(e),i===k?(i=e,e=0):i=qn(i),(t=Jn(t))>=or(e,i)&&t<rr(e,i)},i.invoke=$o,i.isArguments=Io,i.isArray=xo,i.isArrayBuffer=Eo,i.isArrayLike=Bn,i.isArrayLikeObject=Hn,i.isBoolean=function(t){return!0===t||!1===t||jn(t)&&"[object Boolean]"==Te(t)},i.isBuffer=Po,i.isDate=Ro,i.isElement=function(t){return jn(t)&&1===t.nodeType&&!zn(t)},i.isEmpty=function(t){if(null==t)return!0;if(Bn(t)&&(xo(t)||"string"==typeof t||"function"==typeof t.splice||Po(t)||Fo(t)||Io(t)))return!t.length;var e=kr(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(rn(t))return!xe(t).length;for(var i in t)if(xs.call(t,i))return!1;return!0},i.isEqual=function(t,e){return Ke(t,e)},i.isEqualWith=function(t,e,i){var n=(i="function"==typeof i?i:k)?i(t,e):k;return n===k?Ke(t,e,k,i):!!n},i.isError=Fn,i.isFinite=function(t){return"number"==typeof t&&ir(t)},i.isFunction=Wn,i.isInteger=kn,i.isLength=Un,i.isMap=Mo,i.isMatch=function(t,e){return t===e||Oe(t,e,$i(e))},i.isMatchWith=function(t,e,i){return i="function"==typeof i?i:k,Oe(t,e,$i(e),i)},i.isNaN=function(t){return Nn(t)&&t!=+t},i.isNative=function(t){if(Ur(t))throw new Ts("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ce(t)},i.isNil=function(t){return null==t},i.isNull=function(t){return null===t},i.isNumber=Nn,i.isObject=Ln,i.isObjectLike=jn,i.isPlainObject=zn,i.isRegExp=Bo,i.isSafeInteger=function(t){return kn(t)&&-9007199254740991<=t&&9007199254740991>=t},i.isSet=Ho,i.isString=Vn,i.isSymbol=Gn,i.isTypedArray=Fo,i.isUndefined=function(t){return t===k},i.isWeakMap=function(t){return jn(t)&&"[object WeakMap]"==kr(t)},i.isWeakSet=function(t){return jn(t)&&"[object WeakSet]"==Te(t)},i.join=function(t,e){return null==t?"":nr.call(t,e)},i.kebabCase=na,i.last=Tn,i.lastIndexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n;if(i!==k&&(s=0>(s=$n(i))?rr(n+s,0):or(s,n-1)),e==e){for(i=s+1;i--&&t[i]!==e;);t=i}else t=m(t,v,s,!0);return t},i.lowerCase=sa,i.lowerFirst=ra,i.lt=Wo,i.lte=ko,i.max=function(t){return t&&t.length?ce(t,us,ve):k},i.maxBy=function(t,e){return t&&t.length?ce(t,Yi(e,2),ve):k},i.mean=function(t){return w(t,us)},i.meanBy=function(t,e){return w(t,Yi(e,2))},i.min=function(t){return t&&t.length?ce(t,us,Ee):k},i.minBy=function(t,e){return t&&t.length?ce(t,Yi(e,2),Ee):k},i.stubArray=gs,i.stubFalse=_s,i.stubObject=function(){return{}},i.stubString=function(){return""},i.stubTrue=function(){return!0},i.multiply=Aa,i.nth=function(t,e){return t&&t.length?He(t,$n(e)):k},i.noConflict=function(){return Wt._===this&&(Wt._=Bs),this},i.noop=ds,i.now=yo,i.pad=function(t,e,i){t=Qn(t);var n=(e=$n(e))?F(t):0;return!e||n>=e?t:xi(Qs(e=(e-n)/2),i)+t+xi(Zs(e),i)},i.padEnd=function(t,e,i){t=Qn(t);var n=(e=$n(e))?F(t):0;return e&&n<e?t+xi(e-n,i):t},i.padStart=function(t,e,i){t=Qn(t);var n=(e=$n(e))?F(t):0;return e&&n<e?xi(e-n,i)+t:t},i.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),lr(Qn(t).replace(rt,""),e||0)},i.random=function(t,e,i){if(i&&"boolean"!=typeof i&&en(t,e,i)&&(e=i=k),i===k&&("boolean"==typeof e?(i=e,e=k):"boolean"==typeof t&&(i=t,t=k)),t===k&&e===k?(t=0,e=1):(t=qn(t),e===k?(e=t,t=0):e=qn(e)),t>e){var n=t;t=e,e=n}return i||t%1||e%1?(i=hr(),or(t+i*(e-t+Mt("1e-"+((i+"").length-1))),e)):Le(t,e)},i.reduce=function(t,e,i){var n=xo(t)?d:b,s=3>arguments.length;return n(t,Yi(e,4),i,s,Cr)},i.reduceRight=function(t,e,i){var n=xo(t)?f:b,s=3>arguments.length;return n(t,Yi(e,4),i,s,Ir)},i.repeat=function(t,e,i){return e=(i?en(t,e,i):e===k)?1:$n(e),je(Qn(t),e)},i.replace=function(){var t=arguments,e=Qn(t[0]);return 3>t.length?e:e.replace(t[1],t[2])},i.result=function(t,e,i){var n=-1,s=(e=oi(e,t)).length;for(s||(s=1,t=k);++n<s;){var r=null==t?k:t[cn(e[n])];r===k&&(n=s,r=i),t=Wn(r)?r.call(t):r}return t},i.round=Ka,i.runInContext=t,i.sample=function(t){return(xo(t)?Ut:function(t){return Ut(rs(t))})(t)},i.size=function(t){if(null==t)return 0;if(Bn(t))return Vn(t)?F(t):t.length;var e=kr(t);return"[object Map]"==e||"[object Set]"==e?t.size:xe(t).length},i.snakeCase=oa,i.some=function(t,e,i){var n=xo(t)?g:Ge;return i&&en(t,e,i)&&(e=k),n(t,Yi(e,3))},i.sortedIndex=function(t,e){return Ye(t,e)},i.sortedIndexBy=function(t,e,i){return qe(t,e,Yi(i,2))},i.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var n=Ye(t,e);if(n<i&&Mn(t[n],e))return n}return-1},i.sortedLastIndex=function(t,e){return Ye(t,e,!0)},i.sortedLastIndexBy=function(t,e,i){return qe(t,e,Yi(i,2),!0)},i.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=Ye(t,e,!0)-1;if(Mn(t[i],e))return i}return-1},i.startCase=aa,i.startsWith=function(t,e,i){return t=Qn(t),i=null==i?0:re($n(i),0,t.length),e=Je(e),t.slice(i,i+e.length)==e},i.subtract=Oa,i.sum=function(t){return t&&t.length?A(t,us):0},i.sumBy=function(t,e){return t&&t.length?A(t,Yi(e,2)):0},i.template=function(t,e,n){var s=i.templateSettings;n&&en(t,e,n)&&(e=k),t=Qn(t),e=jo({},e,s,Wi);var r,o,a=is(n=jo({},e.imports,s.imports,Wi)),l=C(n,a),h=0;n=e.interpolate||vt;var u="__p+='";n=Ss((e.escape||vt).source+"|"+n.source+"|"+(n===Z?pt:vt).source+"|"+(e.evaluate||vt).source+"|$","g");var c="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";if(t.replace(n,function(e,i,n,s,a,l){return n||(n=s),u+=t.slice(h,l).replace(wt,P),i&&(r=!0,u+="'+__e("+i+")+'"),a&&(o=!0,u+="';"+a+";\n__p+='"),n&&(u+="'+((__t=("+n+"))==null?'':__t)+'"),h=l+e.length,e}),u+="';",(e=e.variable)||(u="with(obj){"+u+"}"),u=(o?u.replace(N,""):u).replace(z,"$1").replace(V,"$1;"),u="function("+(e||"obj")+"){"+(e?"":"obj||(obj={});")+"var __t,__p=''"+(r?",__e=_.escape":"")+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+u+"return __p}",(e=ua(function(){return vs(a,c+"return "+u).apply(k,l)})).source=u,Fn(e))throw e;return e},i.times=function(t,e){if(1>(t=$n(t))||9007199254740991<t)return[];var i=4294967295,n=or(t,4294967295);for(t-=4294967295,n=K(n,e=Yi(e));++i<t;)e(i);return n},i.toFinite=qn,i.toInteger=$n,i.toLength=Xn,i.toLower=function(t){return Qn(t).toLowerCase()},i.toNumber=Jn,i.toSafeInteger=function(t){return t?re($n(t),-9007199254740991,9007199254740991):0===t?t:0},i.toString=Qn,i.toUpper=function(t){return Qn(t).toUpperCase()},i.trim=function(t,e,i){return(t=Qn(t))&&(i||e===k)?t.replace(st,""):t&&(e=Je(e))?ai(t=W(t),e=x(t,i=W(e)),i=E(t,i)+1).join(""):t},i.trimEnd=function(t,e,i){return(t=Qn(t))&&(i||e===k)?t.replace(ot,""):t&&(e=Je(e))?ai(t=W(t),0,e=E(t,W(e))+1).join(""):t},i.trimStart=function(t,e,i){return(t=Qn(t))&&(i||e===k)?t.replace(rt,""):t&&(e=Je(e))?ai(t=W(t),e=x(t,W(e))).join(""):t},i.truncate=function(t,e){var i=30,n="...";if(Ln(e)){var s="separator"in e?e.separator:s;i="length"in e?$n(e.length):i,n="omission"in e?Je(e.omission):n}var r=(t=Qn(t)).length;if(Ct.test(t)){var o=W(t);r=o.length}if(i>=r)return t;if(1>(r=i-F(n)))return n;if(i=o?ai(o,0,r).join(""):t.slice(0,r),s===k)return i+n;if(o&&(r+=i.length-r),Bo(s)){if(t.slice(r).search(s)){var a=i;for(s.global||(s=Ss(s.source,Qn(dt.exec(s))+"g")),s.lastIndex=0;o=s.exec(a);)var l=o.index;i=i.slice(0,l===k?r:l)}}else t.indexOf(Je(s),r)!=r&&(-1<(s=i.lastIndexOf(s))&&(i=i.slice(0,s)));return i+n},i.unescape=function(t){return(t=Qn(t))&&q.test(t)?t.replace(G,Qt):t},i.uniqueId=function(t){var e=++Es;return Qn(t)+e},i.upperCase=la,i.upperFirst=ha,i.each=Kn,i.eachRight=On,i.first=yn,ps(i,function(){var t={};return fe(i,function(e,n){xs.call(i.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),i.VERSION="4.17.10",o("bind bindKey curry curryRight partial partialRight".split(" "),function(t){i[t].placeholder=i}),o(["drop","take"],function(t,e){Dt.prototype[t]=function(i){i=i===k?1:rr($n(i),0);var n=this.__filtered__&&!e?new Dt(this):this.clone();return n.__filtered__?n.__takeCount__=or(i,n.__takeCount__):n.__views__.push({size:or(i,4294967295),type:t+(0>n.__dir__?"Right":"")}),n},Dt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),o(["filter","map","takeWhile"],function(t,e){var i=e+1,n=1==i||3==i;Dt.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Yi(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}}),o(["head","last"],function(t,e){var i="take"+(e?"Right":"");Dt.prototype[t]=function(){return this[i](1).value()[0]}}),o(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");Dt.prototype[t]=function(){return this.__filtered__?new Dt(this):this[i](1)}}),Dt.prototype.compact=function(){return this.filter(us)},Dt.prototype.find=function(t){return this.filter(t).head()},Dt.prototype.findLast=function(t){return this.reverse().find(t)},Dt.prototype.invokeMap=Ne(function(t,e){return"function"==typeof t?new Dt(this):this.map(function(i){return be(i,t,e)})}),Dt.prototype.reject=function(t){return this.filter(Rn(Yi(t)))},Dt.prototype.slice=function(t,e){t=$n(t);var i=this;return i.__filtered__&&(0<t||0>e)?new Dt(i):(0>t?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==k&&(i=0>(e=$n(e))?i.dropRight(-e):i.take(e-t)),i)},Dt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Dt.prototype.toArray=function(){return this.take(4294967295)},fe(Dt.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),r=i[s?"take"+("last"==e?"Right":""):e],o=s||/^find/.test(e);r&&(i.prototype[e]=function(){function e(t){return t=r.apply(i,p([t],l)),s&&d?t[0]:t}var a=this.__wrapped__,l=s?[1]:arguments,h=a instanceof Dt,u=l[0],c=h||xo(a);c&&n&&"function"==typeof u&&1!=u.length&&(h=c=!1);var d=this.__chain__,f=!!this.__actions__.length;u=o&&!d,h=h&&!f;return!o&&c?(a=h?a:new Dt(this),(a=t.apply(a,l)).__actions__.push({func:An,args:[e],thisArg:k}),new S(a,d)):u&&h?t.apply(this,l):(a=this.thru(e),u?s?a.value()[0]:a.value():a)})}),o("pop push shift sort splice unshift".split(" "),function(t){var e=Ks[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);i.prototype[t]=function(){var t=arguments;if(s&&!this.__chain__){var i=this.value();return e.apply(xo(i)?i:[],t)}return this[n](function(i){return e.apply(xo(i)?i:[],t)})}}),fe(Dt.prototype,function(t,e){var n=i[e];if(n){var s=n.name+"";(yr[s]||(yr[s]=[])).push({name:e,func:n})}}),yr[Ki(k,2).name]=[{name:"wrapper",func:k}],Dt.prototype.clone=function(){var t=new Dt(this.__wrapped__);return t.__actions__=fi(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=fi(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=fi(this.__views__),t},Dt.prototype.reverse=function(){if(this.__filtered__){var t=new Dt(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Dt.prototype.value=function(){var t,e=this.__wrapped__.value(),i=this.__dir__,n=xo(e),s=0>i,r=n?e.length:0;t=r;for(var o=this.__views__,a=0,l=-1,h=o.length;++l<h;){var u=o[l],c=u.size;switch(u.type){case"drop":a+=c;break;case"dropRight":t-=c;break;case"take":t=or(t,a+c);break;case"takeRight":a=rr(a,t-c)}}if(o=(t={start:a,end:t}).start,t=(a=t.end)-o,o=s?a:o-1,l=(a=this.__iteratees__).length,h=0,u=or(t,this.__takeCount__),!n||!s&&r==t&&u==t)return ei(e,this.__actions__);n=[];t:for(;t--&&h<u;){for(s=-1,r=e[o+=i];++s<l;){c=(p=a[s]).type;var p=(0,p.iteratee)(r);if(2==c)r=p;else if(!p){if(1==c)continue t;break t}}n[h++]=r}return n},i.prototype.at=lo,i.prototype.chain=function(){return bn(this)},i.prototype.commit=function(){return new S(this.value(),this.__chain__)},i.prototype.next=function(){this.__values__===k&&(this.__values__=Yn(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?k:this.__values__[this.__index__++]}},i.prototype.plant=function(t){for(var e,i=this;i instanceof n;){var s=fn(i);s.__index__=0,s.__values__=k,e?r.__wrapped__=s:e=s;var r=s;i=i.__wrapped__}return r.__wrapped__=t,e},i.prototype.reverse=function(){var t=this.__wrapped__;return t instanceof Dt?(this.__actions__.length&&(t=new Dt(this)),(t=t.reverse()).__actions__.push({func:An,args:[wn],thisArg:k}),new S(t,this.__chain__)):this.thru(wn)},i.prototype.toJSON=i.prototype.valueOf=i.prototype.value=function(){return ei(this.__wrapped__,this.__actions__)},i.prototype.first=i.prototype.head,Gs&&(i.prototype[Gs]=function(){return this}),i}();Wt._=te,void 0===(n=function(){return te}.call(e,i,e,t))||(t.exports=n)}.call(this),window.DKTools={},Object.defineProperties(DKTools,{SITE:{value:"https://dk-plugins.ru"},VERSION:{value:Imported.DKTools}}),DKTools.Sprite=function(t,e,i,n){this.initialize.apply(this,arguments)},DKTools.Window=function(t,e,i,n){this.initialize.apply(this,arguments)},DKTools.Scene=function(){this.initialize.apply(this,arguments)},DKTools.Utils=class{constructor(){return DKTools.Utils}static initialize(){this._saidHello=!1,this._isNwjs=Utils.isNwjs(),this._isTest=!!Utils.isOptionValid("test"),this._isMobileDevice=Utils.isMobileDevice(),this._isMobileSafari=Utils.isMobileSafari(),this._isAndroidChrome=Utils.isAndroidChrome(),this._gridSize=64,this._sayHello(),this.__tileSize(),this.__imageCacheLimit(),s.get("Debugging Console","Enabled")&&this.openConsole(),s.get("Check Updates","Enabled")&&this._checkUpdates()}static _checkRPGMakerVersion(){if(Utils.RPGMAKER_VERSION<"1.6.0")throw Error("Required to update RPG Maker MV to minimal version 1.6.0 (Installed: %1)".format(Utils.RPGMAKER_VERSION))}static async _checkUpdates(){if(!this.isNwjs()||!this.isTest())return;let t=[];try{const e=new FormData;e.append("version",DKTools.VERSION),t=await DKTools.Network.fetchJson(`${DKTools.SITE}/plugins.php`,{method:"POST",body:e})}catch(t){return void console.error("DKTools can not check updates")}const e=s.get("Check Updates","Show New Plugins");_.forEach(t,t=>{const i=t.version;if(DKTools.PluginManager.isRegistered(t.name)){if(i>DKTools.PluginManager.getVersion(t.name)){const e=[`Available a new version of ${t.name}: ${i} \n`,`Visit site: ${t.url} \n`,`Download: ${DKTools.SITE}/download/${t.name}.js`];console.log.apply(console,e)}}else if(e){const e=[`Try the new plugin: ${t.name} \n`,`Description: ${t.description} \n`,`Visit site: ${t.url} \n`,`Download: ${DKTools.SITE}/download/${t.name}.js`];console.log.apply(console,e)}})}static __hideGrid(){this._gridSprite&&(SceneManager._scene.removeChild(this._gridSprite),this._gridSprite=null)}static __imageCacheLimit(){const t=s.get("Image Cache Limit");t.Enabled&&(ImageCache.limit=t.Limit)}static isAndroidChrome(){return this._isAndroidChrome}static isArrayLike(t){return!!Array.isArray(t)||"[object Arguments]"===String(t)}static isBoolean(t){return"boolean"==typeof t}static isFunction(t){return"function"==typeof t}static isMobileDevice(){return this._isMobileDevice}static isMobileSafari(){return this._isMobileSafari}static isNumber(t){return Number.isFinite(t)}static isNwjs(){return this._isNwjs}static isString(t){return!!t&&"string"==typeof t}static isTest(){return this._isTest}static async logError(t){if(!t||!this.isNwjs())return;const e=s.get("Errors Log"),i=DKTools.Utils.isTest(),n=e.Enabled;if("None"===n||"Only Game"===n&&i||"Only Test"===n&&!i)return;const r=DKTools.IO.fs,o=DKTools.IO.os;if(!r||!o)return;const a=1024*e["File Size"]*1024,l=e.Filename,h=new DKTools.IO.File(l),u=await h.getStatsAsync().then(t=>t.data);let c=await r.openSync(l,"a");if(u&&u.size>a&&(await r.closeSync(c),await h.removeAsync(),c=await r.openSync(l,"a")),t instanceof Object){let e=`Date: ${(new Date).toString()}`+o.EOL+`Name: ${t.name}`+o.EOL+`Message: ${t.message}`+o.EOL;void 0!==t.filename&&(e+=`Filename: ${t.filename}`+o.EOL),void 0!==t.lineNumber&&(e+=`Line: ${t.lineNumber}`+o.EOL),void 0!==t.columnNumber&&(e+=`Column: ${t.columnNumber}`+o.EOL),e+=`Stack: ${t.stack}`+o.EOL+o.EOL,await r.writeSync(c,e)}else{const e=`Date: ${(new Date).toString()}`+o.EOL+`Error: ${t}`+o.EOL+o.EOL;await r.writeSync(c,e)}await r.closeSync(c)}static makeScreenshot(){if(!this.isNwjs())return;const t=s.get("Screenshots"),e=t.Path,i=t.Type,n=t.Quality,r=SceneManager.snap().canvas.toDataURL("image/"+i,n),o=new RegExp(`^data:image/${i};base64,`),a=r.replace(o,""),l=new Date;let h=t.Filename;const u=(h=(h=(h=(h=(h=(h=h.replace(/%year/gi,l.getFullYear())).replace(/%month/gi,l.getMonth()+1)).replace(/%day/gi,l.getDate())).replace(/%hours/gi,l.getHours())).replace(/%minutes/gi,l.getMinutes())).replace(/%seconds/gi,l.getSeconds()))+"."+i,c=DKTools.IO.normalizePath(e+"/"+u);new DKTools.IO.File(c).save(a,{createDirectory:!0,options:"base64"}),console.log("The screenshot is saved with the name: "+u)}static mixin(t,e){Object.defineProperties(t,Object.getOwnPropertyDescriptors(e))}static openConsole(){if(this.isTest()&&this.isNwjs())try{const t=i(2).Window.get();t.showDevTools(null,()=>t.focus())}catch(t){this.logError(t),console.error("DKTools can not open the console")}}static __tileSize(){const t=s.get("Tile Size");t.Enabled&&(Tilemap.TILE_WIDTH=t.Size,Tilemap.TILE_HEIGHT=t.Size)}static throwError(t){setTimeout(()=>{throw t},0)}static __quickLoad(){if(!DKTools.Utils.isTest()||!s.get("Quick Load","Enabled"))return;const t=s.get("Quick Load","Savefile ID"),e=SceneManager._scene;t>0?DataManager.loadGame(t)&&(SoundManager.playLoad(),e instanceof Scene_Base&&e.fadeOutAll(),$gameSystem.versionId()!==$dataSystem.versionId&&($gamePlayer.reserveTransfer($gameMap.mapId(),$gamePlayer.x,$gamePlayer.y),$gamePlayer.requestMapReload()),SceneManager.goto(Scene_Map)):e instanceof Scene_Load||SceneManager.push(Scene_Load)}static _sayHello(){if(!this._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>=0){const t=[`%c %c %c DKTools.js ${DKTools.VERSION} %c  %c  ${DKTools.SITE}  %c \n`,"background: #279EE8; padding:5px 0;","background: #279EE8; padding:5px 0;","color: #4CCBF5; background: #030307; padding:5px 0;","background: #279EE8; padding:5px 0;","background: #BDE5F2; padding:5px 0;","background: #279EE8; padding:5px 0;"];console.log.apply(console,t)}else window.console&&console.log(`DKTools.js ${DKTools.VERSION} - ${DKTools.SITE}`);this._saidHello=!0}}static __showGrid(){if(!DKTools.Utils.isTest()||!s.get("Grid","Enabled"))return;if(this._gridSprite)return void(this._gridSize>=32?(this._gridSize-=16,this._gridSprite.refreshAll()):(this._gridSize=64,this.__hideGrid()));const t=s.get("Grid");let e=null;this._gridSprite=new DKTools.Sprite.Button(Graphics),this._gridSprite.addEvent({type:"draw-all",onUpdate:()=>{const i=Graphics.boxWidth,n=Graphics.boxHeight,s=this._gridSize,r=t["Grid Color"],o=t["Grid Width"];_.times(Math.ceil(i/s),t=>{this._gridSprite.drawLine({x1:s*t,y1:0,x2:s*t,y2:n,color:r,lineWidth:o})}),_.times(Math.ceil(n/s),t=>{this._gridSprite.drawLine({x1:0,y1:s*t,x2:i,y2:s*t,color:r,lineWidth:o})}),e&&this._gridSprite.drawLine({x1:e.x,y1:e.y,x2:TouchInput.mouseX,y2:TouchInput.mouseY,color:e.color,lineWidth:t["Ruler Width"]})}}),this._gridSprite.addEvent({type:"mouse-inside",onUpdate:()=>{const t=TouchInput.mouseX,e=TouchInput.mouseY,n=Graphics.boxWidth,s=Graphics.boxHeight;let r=t+8,o=e+8;r+i.width>n&&(r=t-i.width-8),o+i.height>s&&(o=e-i.height-8),i.move(r,o),i.refreshAll()}}),this._gridSprite.addEvent({type:"mouse-down-middle",onUpdate:()=>{e||(e={x:TouchInput.mouseX,y:TouchInput.mouseY,color:t["Ruler Color"]||DKTools.Utils.Random.getHexColor()}),this._gridSprite.refreshAll()}}),this._gridSprite.addEvent({type:"mouse-up-middle",onUpdate:()=>{e=null,this._gridSprite.refreshAll()}}),this._gridSprite.start(!0);const i=new DKTools.Sprite(0,0,220,"2");i.addEvent({type:"draw-all",onUpdate:()=>{if(e){const t={x:TouchInput.mouseX,y:TouchInput.mouseY},n=Math.floor(DKTools.Utils.Point.getDistance(e,t));i.drawText(`line: ${n} (${e.x}, ${e.y})`,{y:"0",align:"left"})}i.drawText(`x: ${TouchInput.mouseX}, y: ${TouchInput.mouseY}`,{y:"1",align:"left"})}}),i.start(),this._gridSprite.addChild(i),this._gridSprite.updateMouseInsideEvents(),SceneManager._scene.addChild(this._gridSprite)}},DKTools.Utils.Object=class{static toCamelCase(t){return _.forEach(_.keys(t),e=>{const i=_.camelCase(e);i!==e&&(t[i]=t[e],delete t[e])}),t}},DKTools.Utils.Number=class{static clamp(t,e,i){return _.clamp(t,e,i)}static inRange(t,e,i){return _.inRange(t,e,i)}},DKTools.Utils.String=class{static toBooleanArray(t){return _.map(this.toStringArray(t),Boolean)}static toNumberArray(t){return _.map(this.toStringArray(t),Number)}static toStringArray(t){return t.trim().replace(/\s*\,\s*/g,",").split(",")}},DKTools.Utils.Array=class{static avg(t){return this.sum(t)/t.length}static compact(t){return _.pull(t,"",null,void 0,Number.NaN)}static conjunction(t){return _.every(t,_.isEqual.bind(this,!0))}static contains(t,e){return _.includes(t,e)}static count(t,e){return _.size(t)-_.size(_.without(t,e))}static counts(t,e){return _.size(t)-_.size(_.difference(t,e))}static disjunction(t){return _.some(t,_.isEqual.bind(this,!0))}static insert(t,e,i=0){t.splice(i,0,e)}static isBitmapArray(t){return _.every(t,t=>t instanceof Bitmap)}static isBooleanArray(t){return _.every(t,t=>DKTools.Utils.isBoolean(t))}static isEmpty(t){return _.isEmpty(t)}static isNumberArray(t){return _.every(t,t=>DKTools.Utils.isNumber(t))}static isSpriteArray(t){return _.every(t,t=>t instanceof Sprite)}static isStringArray(t){return _.every(t,t=>DKTools.Utils.isString(t))}static isWindowArray(t){return _.every(t,t=>t instanceof Window)}static max(t){return Math.max.apply(Math,t)}static min(t){return Math.min.apply(Math,t)}static remove(t,e){return _.pull(t,e)}static sum(t){return _.reduce(t,(t,e)=>t+=e,0)}},DKTools.Utils.Point=class{static clone(t=0,e=0){return this.toPoint(t,e)}static equals(t,e=0,i=0){if(0===arguments.length)return!1;const n=this.toPoint(e,i);return(t=this.toPoint(t)).x===n.x&&t.y===n.y}static getDistance(t,e=0,i=0){const n=this.toPoint(e,i);return t=this.toPoint(t),Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}static toArray(t){return[t.x,t.y]}static toPoint(t=0,e=0){const i=this.tryToPoint(t,e);if(null!==i)return i;const n=t=>Number.isFinite(t)?t:0;let s;return t instanceof Object&&(s=t.x,e=t.y),s=n(s),e=n(e),new Point(s,e)}static tryToPoint(t,e){let i,n;return t instanceof Object?(i=t.x,n=t.y):(i=t,n=e),DKTools.Utils.Array.isNumberArray([i,n])?new Point(i,n):null}},DKTools.Utils.Rectangle=class{static clone(t=0,e=0,i=0,n=0){return this.toRectangle(t,e,i,n)}static equals(t,e=0,i=0,n=0,s=0){if(0===arguments.length)return!1;const r=this.toRectangle(e,i,n,s);return(t=this.toRectangle(t)).x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height}static isEmpty(t){return this.equals(t,Rectangle.emptyRectangle)}static toArray(t){return[t.x,t.y,t.width,t.height]}static toRectangle(t=0,e=0,i=0,n=0){const s=this.tryToRectangle(t,e,i,n);if(s)return s;const r=t=>Number.isFinite(t)?t:0;let o;return t instanceof Object&&(o=t.x,e=t.y,i=t.width,n=t.height),o=r(o),e=r(e),i=r(i),n=r(n),new Rectangle(o,e,i,n)}static tryToRectangle(t,e,i,n){let s,r,o,a;return t instanceof Object?(s=t.x,r=t.y,o=t.width,a=t.height):(s=t,r=e,o=i,a=n),DKTools.Utils.Array.isNumberArray([s,r,o,a])?new Rectangle(s,r,o,a):null}},DKTools.Utils.WebAudio=class{static load(t,e,i){if(!t)return null;if(t instanceof WebAudio)return t;if(DKTools.Utils.isArrayLike(t))return this.load.apply(this,t);if(t instanceof Object)return this.load(t.folder,t.filename,t.listener,t.hue,t.smooth);if(!DKTools.Utils.isString(t))return null;const n=AudioManager.createBuffer(t,e);return DKTools.Utils.isFunction(i)&&n.addLoadListener(i),n}static async loadAsync(t,e,i){return new Promise(n=>{const s=this.load(t,e,i);s?s.addLoadListener(()=>n(s)):n(s)})}static loadBuffers(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.load(t));const n=[];let s=0;const r=(r,o)=>{e&&(n[r]=o,s++,DKTools.Utils.isFunction(i)&&i(o,n,t),t.length===s&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof WebAudio?t.addLoadListener(t=>r(e,t)):r(e,t)})}static async loadBuffersAsync(t){const e=_.map(t,t=>this.loadAsync(t));return Promise.all(e)}},DKTools.Utils.Bitmap=class{static clone(t){if(!t||t.url)return t;const e=t.canvas,i=new Bitmap(e.width,e.height);return i.context.drawImage(e,0,0),i}static drawLine(t,e,i,n,s,r="white",o=1){const a=t.context;a.save(),a.strokeStyle=r,a.lineWidth=o,a.beginPath(),a.moveTo(e,i),a.lineTo(n,s),a.stroke(),a.restore(),t._setDirty()}static fillArc(t,e,i,n,s,r,o="white",a=!1){const l=t.context;l.save(),l.fillStyle=o,l.beginPath(),l.arc(e,i,n,s,r,a),l.fill(),l.restore(),t._setDirty()}static getBase64(t){return t&&t.canvas?t.canvas.toDataURL("image/png"):null}static load(t,e,i,n,s){if(!t)return null;if(t instanceof Bitmap)return t;if(DKTools.Utils.isArrayLike(t))return this.load.apply(this,t);if(t instanceof Object)return this.load(t.folder,t.filename,t.listener,t.hue,t.smooth);if(!DKTools.Utils.isString(t))return null;const r=DKTools.IO.normalizePath(t+"/",!0),o=ImageManager.loadBitmap(r,e,n,s);return DKTools.Utils.isFunction(i)&&o.addLoadListener(i),o}static async loadAsync(t,e,i,n,s){return new Promise(r=>{const o=this.load(t,e,i,n,s);o?o.addLoadListener(()=>r(o)):r(o)})}static loadBitmaps(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.load(t));const n=[];let s=0;const r=(r,o)=>{e&&(n[r]=o,s++,DKTools.Utils.isFunction(i)&&i(o,n,t),t.length===s&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof Bitmap?t.addLoadListener(t=>r(e,t)):r(e,t)})}static async loadBitmapsAsync(t){Array.isArray(t)||(t=[t]);const e=_.map(t,t=>this.loadAsync(t));return Promise.all(e)}static reserve(t,e,i,n,s,r){if(!t)return null;if(t instanceof Bitmap)return t;if(DKTools.Utils.isArrayLike(t))return this.reserve.apply(this,t);if(t instanceof Object)return this.reserve(t.folder,t.filename,t.listener,t.hue,t.smooth,t.reservationId);if(!DKTools.Utils.isString(t))return null;const o=DKTools.IO.normalizePath(t+"/",!0),a=ImageManager.reserveBitmap(o,e,n,s,r);return DKTools.Utils.isFunction(i)&&a.addLoadListener(i),a}static async reserveAsync(t,e,i,n,s,r){return new Promise(o=>{const a=this.reserve(t,e,i,n,s,r);a?a.addLoadListener(()=>o(a)):o(a)})}static reserveBitmaps(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.reserve(t));const n=[];let s=0;const r=(r,o)=>{e&&(n[r]=o,s++,DKTools.Utils.isFunction(i)&&i(o,n,t),t.length===s&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof Bitmap?t.addLoadListener(t=>r(e,t)):r(e,t)})}static async reserveBitmapsAsync(t){Array.isArray(t)||(t=[t]);const e=_.map(t,t=>this.reserveAsync(t));return Promise.all(e)}static strokeArc(t,e,i,n,s,r,o="white",a=1,l=!1){const h=t.context;h.save(),h.strokeStyle=o,h.lineWidth=a,h.beginPath(),h.arc(e,i,n,s,r,l),h.stroke(),h.restore(),t._setDirty()}static strokeRect(t,e,i,n,s,r="white",o=1){const a=t.context;a.save(),a.strokeStyle=r,a.lineWidth=o,a.strokeRect(e,i,n,s),a.restore(),t._setDirty()}},DKTools.Utils.Event=class{static getAllComments(t){return Number.isFinite(t)&&(t=$gameMap.events()[t]),t?(t instanceof Game_Event&&(t=t.event()),_.reduce(t.pages,(t,e,i)=>(t[i+1]=_.reduce(e.list,(t,e)=>(108!==e.code&&408!==e.code||t.push(e.parameters[0]),t),[]),t),{})):[]}static getComments(t){return Number.isFinite(t)&&(t=$gameMap.events()[t]),t&&t.page()?_.reduce(t.list(),(t,e)=>(108!==e.code&&408!==e.code||t.push(e.parameters[0]),t),[]):[]}},DKTools.Utils.Random=class{constructor(){return DKTools.Utils.Random}static getBoolean(){return this.getInt(1)%2==0}static getFloat(t=1){return _.random(0,t,!0)}static getHexColor(){return"#"+(16777215*Math.random()<<0).toString(16)}static getInt(t=1){return _.random(0,t)}static getRgbaColor(t=1){const e=this.getInt(255),i=this.getInt(255),n=this.getInt(255);return"rgba(%1, %2, %3, %4)".format(e,i,n,t)}},DKTools.IO=class{constructor(){return DKTools.IO}static initialize(){let t="";this.isLocalMode()&&(this._fs=i(3),this._os=i(4),this._path=i(5),t=this.joinPath(this._path.dirname(process.mainModule.filename),"/")),this._projectPath=t}static absolutePathExists(t){return!!this.isLocalMode()&&this._fs.existsSync(t)}static getRootDirectory(){return new DKTools.IO.Directory("/")}static getAbsolutePath(t){const e=this.joinPath(this._projectPath,t||"");return this.normalizePath(e)}static isLocalMode(){return DKTools.Utils.isNwjs()}static isFile(t){if(!this.isLocalMode())return!1;const e=this.getAbsolutePath(t);return!!this.absolutePathExists(e)&&this._fs.lstatSync(e).isFile()}static isDirectory(t){if(!this.isLocalMode())return!1;const e=this.getAbsolutePath(t);return!!this.absolutePathExists(e)&&this._fs.lstatSync(e).isDirectory()}static joinPath(){if(this.isLocalMode())return this._path.join(...arguments);const t=_.filter(arguments,t=>DKTools.Utils.isString(t));let e=t.join("\\");return/^[\\\/]{2}[^\\\/]/.test(t[0])||(e=e.replace(/^[\\\/]{2,}/,"\\")),this.normalizePath(e)}static normalizePath(t,e=!1){if(this.isLocalMode()){const i=this._path.normalize(t);return e?i.replace(/\\/g,"/"):i}const i=this._statPath(t),n=i.isUnc,s=i.isAbsolute;let r=i.device,o=i.tail;const a=/[\\\/]$/.test(o),l=_.filter(o.split(/[\\\/]+/),t=>t&&"."!==t),h=[];for(const t of l)".."===t?h.length>0&&".."!==h[h.length-1]?h.pop():s||h.push(".."):h.push(t);(o=h.join("\\"))||s||(o="."),o&&a&&(o+="\\"),n&&(r="\\\\"+r.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\"));const u=r+(s?"\\":"")+o;return e?u.replace(/\\/g,"/"):u}static parsePath(t){if(this.isLocalMode())return this._path.parse(t);const e=this._splitPath(t);return{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}}static pathExists(t){return this.absolutePathExists(this.getAbsolutePath(t))}static _statPath(t){const e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=e[1]||"",n=!!i&&":"!==i[1];return{device:i,isUnc:n,isAbsolute:n||!!e[2],tail:e[3]}}static _splitPath(t){const e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=(e[1]||"")+(e[2]||""),n=e[3]||"",s=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/.exec(n);return[i,s[1],s[2],s[3]]}},Object.defineProperties(DKTools.IO,{fs:{get:function(){return this._fs},configurable:!0},os:{get:function(){return this._os},configurable:!0},path:{get:function(){return this._path},configurable:!0},projectPath:{get:function(){return this._projectPath},configurable:!0},OK:{value:0},WAIT_FOR_ASYNC_OPERATION:{value:1},ERROR_NOT_LOCAL_MODE:{value:2},ERROR_PATH_DOES_NOT_EXIST:{value:3},ERROR_CALLBACK_IS_NOT_AVAILABLE:{value:4},ERROR_DIRECTORY_ALREADY_EXISTS:{value:5},ERROR_DIRECTORY_IS_NOT_EMPTY:{value:6},ERROR_NEW_NAME_IS_NOT_AVAILABLE:{value:7},ERROR_KEY_IS_NOT_AVAILABLE:{value:8},ERROR_OPTIONS_IS_NOT_AVAILABLE:{value:9}}),DKTools.IO.Entity=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){const e=DKTools.IO.parsePath(t);this._path=DKTools.IO.normalizePath(e.dir+"/"),this._name=e.name,this._initialExtension=e.ext,this._extension=e.ext}exists(){return DKTools.IO.absolutePathExists(this.getAbsolutePath())}getPath(){return this._path}getName(){return this._name}getExtension(){return this._extension}getFullPath(){return DKTools.IO.joinPath(this.getPath(),"/",this.getFullName())}getFullName(){return this._name+this._extension}getAbsolutePath(){return DKTools.IO.getAbsolutePath(this.getFullPath())}getStats(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=DKTools.IO.fs,i=this.getAbsolutePath();if(t.sync){return{data:e.statSync(i),status:DKTools.IO.OK}}return DKTools.Utils.isFunction(t.onSuccess)?(e.stat(i,(e,i)=>{e?this.__processError(e,t.onError):t.onSuccess({data:i,status:DKTools.IO.OK},this)}),{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}):{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE}}async getStatsAsync(){return new Promise((t,e)=>{const i=this.getStats({sync:!1,onSuccess:t,onError:e});i.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&t(i)})}hasExtension(){return!!this._extension}isFile(){if(this instanceof DKTools.IO.File){if(DKTools.IO.isLocalMode()){if(Decrypter.hasEncryptedAudio&&this.isAudio()||Decrypter.hasEncryptedImages&&this.isImage()){const t=DKTools.IO.normalizePath(this.getPath()+"/"+Decrypter.extToEncryptExt(this.getFullName()));return DKTools.IO.isFile(t)}return DKTools.IO.isFile(this.getFullPath())}return!!this.hasExtension()}return!1}isDirectory(){return this instanceof DKTools.IO.Directory&&(DKTools.IO.isLocalMode()?DKTools.IO.isDirectory(this.getFullPath()):!this.hasExtension())}__processError(t,e){DKTools.Utils.isFunction(e)?e(t,this):DKTools.Utils.throwError(t)}rename(t){if(!t)return DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE;if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!t.newName)return DKTools.IO.ERROR_NEW_NAME_IS_NOT_AVAILABLE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const e=DKTools.IO.fs,i=t.newName,n=this.getAbsolutePath(),s=DKTools.IO.normalizePath(this._path+"/"+i+"."+this._extension),r=DKTools.IO.getAbsolutePath(s);return DKTools.IO.absolutePathExists(r)?t.sync?(e.renameSync(n,r),this._name=i,DKTools.IO.OK):(e.rename(n,r,e=>{e?this.__processError(e,t.onError):(this._name=i,DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this))}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION):DKTools.IO.ERROR_NEW_NAME_IS_NOT_AVAILABLE}async renameAsync(t){return new Promise((e,i)=>{const n=this.rename({...t,sync:!1,onSuccess:e,onError:i});n!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}},Object.defineProperties(DKTools.IO.Entity.prototype,{path:{get:function(){return this._path},configurable:!0},name:{get:function(){return this._name},configurable:!0},initialExtension:{get:function(){return this._initialExtension},configurable:!0},extension:{get:function(){return this._extension},configurable:!0}}),DKTools.IO.File=class extends DKTools.IO.Entity{initialize(t){DKTools.IO.Entity.prototype.initialize.call(this,t),this._detectExtension()}_detectExtension(){let t=this._extension;this.isAudio()?t=AudioManager.audioFileExt():this.isImage()?t=".png":this.isVideo()&&(t=Graphics.canPlayVideoType("video/webm")&&!DKTools.Utils.isMobileDevice()?".webm":".mp4"),this._extension=t}exists(){if(DKTools.IO.isLocalMode()&&(Decrypter.hasEncryptedAudio&&this.isAudio()||Decrypter.hasEncryptedImages&&this.isImage())){const t=DKTools.IO.normalizePath(this.getPath()+"/"+Decrypter.extToEncryptExt(this.getFullName()));return DKTools.IO.pathExists(t)}return DKTools.IO.Entity.prototype.exists.call(this)}getDirectory(){return new DKTools.IO.Directory(this._path)}getDirectoryName(){return this.getDirectory().getName()}isAudio(){return".ogg"===this._extension||".m4a"===this._extension||".rpgmvo"===this._extension}isJson(){return".json"===this._extension}isTxt(){return".txt"===this._extension}isImage(){return".png"===this._extension||".rpgmvp"===this._extension||".webp"===this._extension}isScript(){return".js"===this._extension}isVideo(){return".webm"===this._extension||".mp4"===this._extension}isSave(){return".rpgsave"===this._extension}load(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const e=this.getAbsolutePath(),i=e=>(e&&(t.decompress&&(e=LZString.decompressFromBase64(e)),t.parse instanceof Object?e=JSON.parse(e,t.parse.reviver):t.parse&&(e=JSON.parse(e))),{data:e,status:DKTools.IO.OK});if(DKTools.IO.isLocalMode()){if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const n=DKTools.IO.fs,s=t.options||{encoding:"utf8"};if(t.sync){const t=n.readFileSync(e,s);return i(t)}n.readFile(e,s,(e,n)=>{e?this.__processError(e,t.onError):t.onSuccess(i(n),this)})}else{const n=new XMLHttpRequest;n.open("GET",e,!t.sync),n.overrideMimeType(t.mimeType||"application/json"),n.onload=(()=>{4===n.readyState&&(200===n.status?t.onSuccess(i(n.responseText),this):this.__processError(n,t.onError))}),n.onerror=(()=>{this.__processError(n,t.onError)});try{n.send()}catch(t){}}return{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}}async loadAsync(t={}){return new Promise((e,i)=>{const n=this.load({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}loadAudio(){return!this.isAudio()||DKTools.IO.isLocalMode()&&!this.exists()?null:DKTools.Utils.WebAudio.load(this.getDirectoryName(),this.getName())}async loadAudioAsync(){return DKTools.Utils.WebAudio.loadAsync(this.loadAudio())}loadJson(t={}){return(t=t||{}).parse||(t.parse=!0),this.load(t)}async loadJsonAsync(t={}){return new Promise((e,i)=>{const n=this.loadJson({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}loadBitmap(t,e,i){return t instanceof Object?this.loadBitmap(t.listener,t.hue,t.smooth):!this.isImage()||DKTools.IO.isLocalMode()&&!this.exists()?null:DKTools.Utils.Bitmap.load({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i})}async loadBitmapAsync(t,e,i){return DKTools.Utils.Bitmap.loadAsync(this.loadBitmap(t,e,i))}remove(t={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const e=DKTools.IO.fs,i=this.getAbsolutePath();return t.sync?(e.unlinkSync(i),DKTools.IO.OK):(e.unlink(i,e=>{e?this.__processError(e,t.onError):DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION)}async removeAsync(t={}){return new Promise((e,i)=>{const n=this.remove({...t,sync:!1,onSuccess:e,onError:i});n!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}reserveBitmap(t,e,i,n){return t instanceof Object?this.reserveBitmap(t.listener,t.hue,t.smooth,t.reservationId):this.isImage()&&this.exists()?DKTools.Utils.Bitmap.reserve({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i,reservationId:n}):null}async reserveBitmapAsync(t,e,i,n){return t instanceof Object?this.reserveBitmapAsync(t.listener,t.hue,t.smooth,t.reservationId):this.isImage()&&this.exists()?DKTools.Utils.Bitmap.reserveAsync({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i,reservationId:n}):null}save(t,e={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;const i=DKTools.IO.fs,n=this.getAbsolutePath(),s=this.getDirectory();return(e=e||{}).createDirectory&&!s.exists()&&s.create(),s.exists()?(e.stringify instanceof Object?t=JSON.stringify(t,e.stringify.replacer,e.stringify.space):e.stringify&&(t=JSON.stringify(t)),e.compress&&(t=LZString.compressToBase64(t)),e.sync?(i.writeFileSync(n,t,e.options),DKTools.IO.OK):(i.writeFile(n,t,e.options,t=>{t?this.__processError(t,e.onError):DKTools.Utils.isFunction(e.onSuccess)&&e.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION)):DKTools.IO.ERROR_PATH_DOES_NOT_EXIST}async saveAsync(t,e={}){return new Promise((i,n)=>{const s=this.save(t,{...e,sync:!1,onSuccess:i,onError:n});s!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&i(s)})}saveJson(t,e={}){return(e=e||{}).stringify||(e.stringify={space:"\t"}),this.save(t,e)}async saveJsonAsync(t,e={}){return new Promise((i,n)=>{const s=this.saveJson(t,{...e,sync:!1,onSuccess:i,onError:n});s!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&i(s)})}},DKTools.IO.Directory=class extends DKTools.IO.Entity{create(){return DKTools.IO.isLocalMode()?this.exists()?DKTools.IO.ERROR_DIRECTORY_ALREADY_EXISTS:(DKTools.IO.fs.mkdirSync(this.getAbsolutePath()),DKTools.IO.OK):DKTools.IO.ERROR_NOT_LOCAL_MODE}async createAsync(){return new Promise((t,e)=>{DKTools.IO.isLocalMode()||t(DKTools.IO.ERROR_NOT_LOCAL_MODE),this.exists()&&t(DKTools.IO.ERROR_DIRECTORY_ALREADY_EXISTS),DKTools.IO.fs.mkdir(this.getAbsolutePath(),i=>{i?e(i):t(DKTools.IO.OK)})})}findFiles(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=t.searchLimit||1,i=[];let n=1,s=0;const r=s=>{_.forEach(s,s=>{if(s.isFile()){const e=s.getFullName();t.template instanceof RegExp&&t.template.test(e)?i.push(s):t.template&&e!==t.template||i.push(s)}else n<e&&s.isDirectory()&&(n++,o(s))})},o=e=>{if(t.sync){const i=e.getAll({sync:!0,options:t.options}).data;r(i)}else e.getAll({sync:!1,options:t.options,onError:t.onError,onSuccess:e=>{s++,r(e.data),n===s&&t.onSuccess({data:i,status:DKTools.IO.OK})}})};return o(this),t.sync?{data:i,status:DKTools.IO.OK}:{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}}async findFilesAsync(t={}){return new Promise((e,i)=>{const n=this.findFiles({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}findDirectories(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=t.searchLimit||1,i=[];let n=1,s=0;const r=s=>{_.forEach(s,s=>{const r=s.getFullName();t.template instanceof RegExp&&t.template.test(r)?i.push(s):t.template&&r!==t.template||i.push(s),n<e&&(n++,o(s))})},o=e=>{if(t.sync){const i=e.getDirectories({sync:!0,options:t.options}).data;r(i)}else e.getDirectories({sync:!1,options:t.options,onError:t.onError,onSuccess:e=>{s++,r(e.data),n===s&&t.onSuccess({data:i,status:DKTools.IO.OK})}})};return o(this),t.sync?{data:i,status:DKTools.IO.OK}:{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}}async findDirectoriesAsync(t={}){return new Promise((e,i)=>{const n=this.findDirectories({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}getAll(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=DKTools.IO.fs,i=this.getFullPath(),n=this.getAbsolutePath(),s=e=>{return t.template instanceof RegExp?e=_.filter(e,e=>t.template.test(e)):DKTools.Utils.isString(t.template)&&(e=_.filter(e,e=>e===t.template)),{data:_.reduce(e,(t,e)=>{const n=DKTools.IO.normalizePath(i+"/"+e);return DKTools.IO.isFile(n)?t.push(new DKTools.IO.File(n)):DKTools.IO.isDirectory(n)&&t.push(new DKTools.IO.Directory(n)),t},[]),status:DKTools.IO.OK}};if(t.sync){const i=e.readdirSync(n,t.options);return s(i)}return DKTools.Utils.isFunction(t.onSuccess)?(e.readdir(n,t.options,(e,i)=>{e?this.__processError(e,t.onError):t.onSuccess(s(i),this)}),{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}):{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE}}async getAllAsync(t={}){return new Promise((e,i)=>{const n=this.getAll({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}getFiles(t){const e=t=>_.filter(t,t=>t.isFile());if((t=t||{}).sync){const i=this.getAll(t);return i.status===DKTools.IO.OK?{...i,data:e(i.data)}:i}{if(!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const i=t.onSuccess;return t.onSuccess=((t,n)=>{i({...t,data:e(t.data)},n)}),this.getAll(t)}}async getFilesAsync(t={}){return this.getAllAsync(t).then(t=>{if(t.status===DKTools.IO.OK){const e=_.filter(t.data,t=>t.isFile());return{...t,data:e}}return t})}getDirectories(t){const e=t=>_.filter(t,t=>t.isDirectory());if(t.sync){const i=this.getAll(t);return i.status===DKTools.IO.OK?{...i,data:e(i.data)}:i}{if(!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const i=t.onSuccess;return t.onSuccess=((t,n)=>{i({...t,data:e(t.data)},n)}),this.getAll(t)}}async getDirectoriesAsync(t={}){return this.getAllAsync(t).then(t=>{if(t.status===DKTools.IO.OK){const e=_.filter(t.data,t=>t.isDirectory());return{...t,data:e}}return t})}getAudioFiles(t){return this.getFiles({...t,template:/(.ogg|.rpgmvo)/})}async getAudioFilesAsync(t={}){return new Promise((e,i)=>{const n=this.getAudioFiles({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}getJsonFiles(t){return this.getFiles({...t,template:/(.json)/})}async getJsonFilesAsync(t={}){return new Promise((e,i)=>{const n=this.getJsonFiles({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}getTxtFiles(t){return this.getFiles({...t,template:/(.txt)/})}async getTxtFilesAsync(t={}){return new Promise((e,i)=>{const n=this.getTxtFiles({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}getImageFiles(t){return this.getFiles({...t,template:/(.png|.rpgmvp)/})}async getImageFilesAsync(t={}){return new Promise((e,i)=>{const n=this.getImageFiles({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}getVideoFiles(t){return this.getFiles({...t,template:/(.webm)/})}async getVideoFilesAsync(t={}){return new Promise((e,i)=>{const n=this.getVideoFiles({...t,sync:!1,onSuccess:e,onError:i});n.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(n)})}isEmpty(){const t=this.getAll({sync:!0}).data;return!t||0===t.length}loadAudioFiles(){const t=this.getAudioFiles({sync:!0});return t.status!==DKTools.IO.OK?[]:_.map(t.data,t=>t.loadAudio())}async loadAudioFilesAsync(){const t=await this.getAudioFilesAsync();if(t.status!==DKTools.IO.OK)return[];const e=_.map(t.data,t=>t.loadAudioAsync());return Promise.all(e)}loadBitmaps(t,e,i){const n=this.getImageFiles({sync:!0});return n.status!==DKTools.IO.OK?[]:_.map(n.data,n=>n.loadBitmap(t,e,i))}async loadBitmapsAsync(t,e,i){const n=await this.getImageFilesAsync();if(n.status!==DKTools.IO.OK)return[];const s=_.map(n.data,n=>n.loadBitmapAsync(t,e,i));return Promise.all(s)}remove(t={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;if(!this.isEmpty())return DKTools.IO.ERROR_DIRECTORY_IS_NOT_EMPTY;const e=DKTools.IO.fs,i=this.getAbsolutePath();return t.sync?(e.rmdirSync(i),DKTools.IO.OK):(e.rmdir(i,e=>{e?this.__processError(e,t.onError):DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION)}async removeAync(){return new Promise((t,e)=>{const i=this.remove({sync:!1,onSuccess:t,onError:e});i!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&t(i)})}reserveBitmaps(t,e,i,n){const s=this.getImageFiles({sync:!0});return s.status!==DKTools.IO.OK?[]:_.map(s.data,s=>s.reserveBitmap(t,e,i,n))}async reserveBitmapsAsync(t,e,i,n){const s=await this.getImageFilesAsync();if(s.status!==DKTools.IO.OK)return[];const r=_.map(s.data,s=>s.reserveBitmapAsync(t,e,i,n));return Promise.all(r)}},DKTools.IO.WebStorage=class{static exists(t){return localStorage.hasOwnProperty(t)}static load(t,e={}){if(!this.exists(t))return{data:null,status:DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE};let i=localStorage.getItem(t);return i&&(e.decompress&&(i=LZString.decompressFromBase64(i)),e.parse&&(i=JSON.parse(i))),{data:i,status:DKTools.IO.OK}}static remove(t){return this.exists(t)?(localStorage.removeItem(t),DKTools.IO.OK):DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE}static rename(t,e){if(!this.exists(t))return DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE;if(this.exists(e)||null==e)return DKTools.IO.ERROR_NEW_NAME_IS_NOT_AVAILABLE;const i=localStorage.getItem(t);return localStorage.setItem(e,i),localStorage.removeItem(t),DKTools.IO.OK}static save(t,e,i={}){return null==t||""===t?DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE:(i.stringify&&(e=JSON.stringify(e)),i.compress&&(e=LZString.compressToBase64(e)),localStorage.setItem(t,e),DKTools.IO.OK)}},DKTools.Network=class{constructor(){return DKTools.Network}static async fetchFile(t,e={}){return fetch(t,e).then(t=>{if(t.ok)return this._toFile(t);throw t})}static async fetchJson(t,e={}){return e.headers||(e.headers={}),e.headers.Accept="application/json",fetch(t,e).then(t=>{if(t.ok)return this._toJson(t);throw t})}static async _toFile(t){return t.arrayBuffer().then(t=>t,()=>null)}static async _toJson(t){return t.json().then(t=>t,()=>null)}},DKTools.ParameterManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){this._pluginName=t,this._params={},this.initializeParams()}initializeParams(){_.forEach(PluginManager.parameters(this._pluginName),(t,e)=>{this._params[e]=DKTools.ParameterManager.parse(t)})}get(t,e,i){if(!DKTools.Utils.isString(t))return void console.error("Parameter name is not a string!",this._pluginName,t,e,i);let n=this._params[t];return void 0!==n?(e instanceof Object?n=_.find(n,e):void 0!==e&&(n=n[e]),n instanceof Object&&(i instanceof Object?(void 0!==i.key&&(n=n[i.key]),void 0!==i.index&&(n=n[i.index])):void 0!==i&&(n=n[i])),n):void 0}static parse(t){try{return DKTools.Utils.isNumber(t)||DKTools.Utils.isBoolean(t)?t:JSON.parse(t,(t,e)=>{if(Array.isArray(e))return _.map(e,t=>this.parse(t));try{return this.parse(e)}catch(t){return e}})}catch(e){return t}}},Object.defineProperties(DKTools.ParameterManager.prototype,{pluginName:{get:function(){return this._pluginName},configurable:!0},initialParams:{get:function(){return this._initialParams||(this._initialParams=PluginManager.parameters(this._pluginName)),this._initialParams},configurable:!0},params:{get:function(){return this._params},configurable:!0}}),DKTools.PluginManager=class{constructor(){return DKTools.PluginManager}static initialize(){this.registerPlugins(Imported),this._checkRequirements()}static _checkRequirements(){_.forEach(this._requirements,(t,e)=>{const i=_.max(t),n=this.getVersion(e);if(void 0===n){const t='Required to install the plugin "%1". Minimal version: %2'.format(e,i);throw new Error(t)}if(n<i){const t='Required to update the plugin "%1" to minimal version %2 (Installed: %3)'.format(e,i,n);throw new Error(t)}})}static getVersion(t){return this._plugins[t]}static isRegistered(t){return!!this._plugins[t]}static isRequired(t){return!!this._requirements[t]}static registerPlugin(t,e){!e||this.isRegistered(t)||DKTools.Utils.isBoolean(e)||(this._plugins[t]=e)}static registerPlugins(t){_.forEach(t,(t,e)=>{this.registerPlugin(e,t)})}static requirePlugin(t,e){this._requirements[t]||(this._requirements[t]=[]),this._requirements[t].push(e)}static requirePlugins(t){_.forEach(t,(t,e)=>{this.requirePlugin(e,t)})}},Object.defineProperties(DKTools.PluginManager,{_plugins:{value:{}},_requirements:{value:{}},plugins:{get:function(){return this._plugins},configurable:!0},requirements:{get:function(){return this._requirements},configurable:!0}}),DKTools.PluginCommandManager=class{constructor(){return DKTools.PluginCommandManager}static has(t){return!!this._pluginCommands[t.toLowerCase()]}static process(t,e,i){const n=this._pluginCommands[e.toLowerCase()];DKTools.Utils.isFunction(n)&&n.call(t,i)}static set(t,e){this._pluginCommands[t.toLowerCase()]=e}},Object.defineProperties(DKTools.PluginCommandManager,{_pluginCommands:{value:{}}}),DKTools.PreloadManager=class{constructor(){return DKTools.PreloadManager}static initialize(){this.clearCache();const t=s.get("Preload Manager");this._enabled=t.Enabled,this.isEnabled()&&(_.forEach(t["Audio Files"],t=>{this.preloadAudio({path:t.Path,caching:t.Caching})}),_.forEach(t["Image Files"],t=>{this.preloadImage({path:t.Path,hue:t.Hue,caching:t.Caching})}),this.start())}static clearCache(){this._cache={audio:{},image:{}}}static clearQueue(){this._queue={audio:[],image:[]}}static _finish(){this._finishTime=new Date,this.clearQueue(),this._log("Preloading complete! \nLoaded/Skipped/Total: "+this._loaded+"/"+this._skipped+"/"+this._total+"\nPreloading time: "+(this._finishTime-this._startTime)/1e3+" sec"),Graphics.endLoading()}static _generateAudioKey(t){return DKTools.IO.normalizePath(t,!0)}static _generateImageKey(t,e=0){return DKTools.IO.normalizePath(ImageManager._generateCacheKey(t,e||0),!0)}static getCachedAudioByKey(t){return this._cache.audio[t]}static getCachedAudioByPath(t){return this.getCachedAudioByKey(this._generateAudioKey(t))}static getCachedImageByKey(t){return this._cache.image[t]}static getCachedImageByPath(t){return this.getCachedImageByKey(this._generateImageKey(t))}static isAudioCachedByKey(t){return!!this._cache.audio[t]}static isAudioCachedByPath(t){return this.isAudioCachedByKey(this._generateAudioKey(t))}static isEnabled(){return this._enabled}static isFinished(){return!!this._finishTime}static isReady(){return!this.isEnabled()||this.isFinished()}static isImageCachedByKey(t){return!!this._cache.image[t]}static isImageCachedByPath(t,e){return this.isImageCachedByKey(this._generateImageKey(t,e))}static _log(t){this.isEnabled()&&DKTools.Utils.isTest()&&s.get("Preload Manager","Debugging")&&t&&console.log(t)}static _onFileLoad(t){this._loaded++,this._log(`Loaded ${t instanceof WebAudio?"audio":"image"}: ${t.url}`),Graphics.updateLoading()}static _preload(t,e){if(this.isEnabled()&&e instanceof Object&&DKTools.Utils.isString(e.path)){const i=new DKTools.IO.Directory(e.path);if(i.isDirectory()){if(!DKTools.IO.isLocalMode())throw new Error("Web browsers and mobile phones cannot load directories!");{const n={sync:!0};let s=[];"audio"===t?s=i.getAudioFiles(n).data:"image"===t&&(s=i.getImageFiles(n).data),_.forEach(s,i=>{const n=i.getFullPath();this._queue[t][n]||(this._queue[t][n]={...e,path:n})})}}else{const i=new DKTools.IO.File(e.path),n=i.getFullPath();i.isFile()?this._queue[t][n]||(this._queue[t][n]=e):console.error("This is not a file: "+n)}}}static _processLoadAudioFiles(){const t=[];return _.forEach(this._queue.audio,e=>{const i=new DKTools.IO.File(e.path),n=i.getFullPath();if(i.isFile())if(i.isAudio()){if(this.isAudioCachedByPath(n))return this._skipped++,void this._log("Audio already preloaded: "+n+". Skipped...");const s=i.loadAudio();s?(e.caching&&(this._cache.audio[this._generateAudioKey(s.url)]=s),t.push(s)):(this._skipped++,this._log("Cannot load an audio: "+n+". Skipped..."))}else this._skipped++,this._log("This is not an audio: "+n+". Skipped...");else this._skipped++,this._log("This is not a file: "+e.path+". Skipped...")}),_.map(t,t=>DKTools.Utils.WebAudio.loadAsync(t).then(()=>this._onFileLoad(t)))}static _processLoadImageFiles(){const t=[];return _.forEach(this._queue.image,e=>{const i=new DKTools.IO.File(e.path),n=i.getFullPath();if(i.isFile())if(i.isImage()){if(this.isImageCachedByPath(n,e.hue))return this._skipped++,void this._log("Image already preloaded: "+n+". Skipped...");const s=DKTools.Utils.Bitmap.reserve({folder:i.getPath(),filename:i.getName(),hue:e.hue});s?(e.caching&&(this._cache.image[this._generateImageKey(s.url,e.hue)]=s),t.push(s)):(this._skipped++,this._log("Cannot load an image: "+n+". Skipped..."))}else this._skipped++,this._log("This is not an image: "+n+". Skipped...");else this._skipped++,this._log("This is not a file: "+e.path+". Skipped...")}),_.map(t,t=>DKTools.Utils.Bitmap.loadAsync(t).then(()=>this._onFileLoad(t)))}static preloadAudio(t){this._preload("audio",t)}static preloadImage(t){this._preload("image",t)}static releaseAudioByKey(t){this._cache.audio[t]=void 0}static releaseAudioByPath(t){this.releaseAudioByKey(this._generateAudioKey(t))}static releaseImageByKey(t){this._cache.image[t]=void 0}static releaseImageByPath(t,e){this.releaseImageByKey(this._generateImageKey(t,e))}static start(){if(!this.isEnabled())return;if(this._loaded=0,this._skipped=0,this._total=_.size(this._queue.audio)+_.size(this._queue.image),this._startTime=new Date,this._finishTime=null,this._log("DKTools Preload Manager is running... \nTotal files to load: "+this._total),0===this._total)return void this._finish();const t=Promise.all(this._processLoadAudioFiles()),e=Promise.all(this._processLoadImageFiles());Promise.all([t,e]).then(()=>this._finish())}},Object.defineProperties(DKTools.PreloadManager,{_queue:{value:{audio:{},image:{}},writable:!0},_cache:{value:{audio:[],image:[]},writable:!0}}),DKTools.Audio=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this._id=t.id,this._type=t.type.toLowerCase(),this._name=t.name,this._volume=_.defaultTo(t.volume,this.standardVolume()),this._pitch=_.defaultTo(t.pitch,this.standardPitch()),this._pan=_.defaultTo(t.pan,this.standardPan()),this._loop=_.defaultTo(t.loop,this.standardLoop()),this._buffer=this._createBuffer(),this._pausePos=null}_createBuffer(){return AudioManager.createBuffer(this._type,this._name)}clone(){return new DKTools.Audio(this)}equals(t){return!!t&&(this._type===t.type&&this._name===t.name&&this._volume===t.volume&&this._pitch===t.pitch&&this._pan===t.pan&&this._loop===t.loop)}fadeIn(t=0){this._buffer.fadeIn(t)}fadeOut(t=0){this._buffer.fadeOut(t)}isPaused(){return!this.isPlaying()&&null!=this._pausePos}isPlaying(){return this._buffer.isPlaying()}pause(){this.isPlaying()&&(this._pausePos=this.seek(),this.stop())}play(t=0){this._buffer.play(this._loop,t),this._updateBufferParameters(),this._pausePos=null}resume(){this.isPaused()&&this.play(this._pausePos)}seek(){return this._buffer.seek()}standardLoop(){return"bgm"===this._type||"bgs"===this._type}standardPan(){return 0}standardPitch(){return 100}standardVolume(){return 90}stop(){this.isPlaying()&&this._buffer.stop()}_updateBufferParameters(){const t=this._buffer;let e=AudioManager[this._type+"Volume"];Number.isFinite(e)||(e=100),t.volume=e*this._volume/1e4,t.pitch=this._pitch/100,t.pan=this._pan/100}},Object.defineProperties(DKTools.Audio.prototype,{id:{get:function(){return this._id},configurable:!0},type:{get:function(){return this._type},configurable:!0},name:{get:function(){return this._name},configurable:!0},volume:{get:function(){return this._volume},set:function(t){this._volume!==t&&(this._volume=t,this._updateBufferParameters())},configurable:!0},pitch:{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this._updateBufferParameters())},configurable:!0},pan:{get:function(){return this._pan},set:function(t){this._pan!==t&&(this._pan=t,this._updateBufferParameters())},configurable:!0},loop:{get:function(){return this._loop},configurable:!0},buffer:{get:function(){return this._buffer},configurable:!0},pos:{get:function(){return this.seek()},set:function(t){this.play(t)},configurable:!0}}),DKTools.Event=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this._id=t.id,this._target=t.target,this._type=t.type,this._repeatTime=t.repeatTime||-1,this._repeats=_.defaultTo(t.repeats,-1),this._remainingPauseTime=t.remainingPauseTime||0,this._onStart=t.onStart,this._onUpdate=t.onUpdate,this._onPause=t.onPause,this._onReset=t.onReset,this._onRepeat=t.onRepeat,this._onSuccess=t.onSuccess,this._onFail=t.onFail,this._started=!1,this._resetRemainingTime(),this._resetRemainingRepeats()}addRemainingPauseTime(t=1){this._remainingPauseTime+=t}addRemainingRepeats(t=1){this._remainingRepeats+=t}addRemainingTime(t=1){this._remainingTime+=t}_callOnPauseHandler(){this._canCallOnPauseHandler()&&this._onPause(this)}_callOnRepeatHandler(){this._canCallOnRepeatHandler()&&this._onRepeat(this)}_callOnResetHandler(){this._canCallOnResetHandler()&&this._onReset(this)}_callOnStartHandler(){this._canCallOnStartHandler()&&this._onStart(this),this._started=!0}_callOnSuccessHandler(t=!1){(this._canCallOnSuccessHandler()||t)&&this._onSuccess(this)}_callOnUpdateHandler(){this._canCallOnUpdateHandler()&&this._onUpdate(this)}_callonFailHandler(){this._canCallonFailHandler()&&this._onFail(this)}_canCallOnPauseHandler(){return this.hasOnPauseHandler()&&this.isPaused()}_canCallOnRepeatHandler(){return this.hasOnRepeatHandler()}_canCallOnResetHandler(){return this.hasOnResetHandler()}_canCallOnStartHandler(){return this.hasOnStartHandler()&&!this.isStarted()}_canCallOnSuccessHandler(){return this.hasOnSuccessHandler()&&this.isFinished()}_canCallOnUpdateHandler(){return this.hasOnUpdateHandler()&&this.isUpdated()}_canCallonFailHandler(){return this.hasonFailHandler()}_clearRemainingRepeats(){this._remainingRepeats=0}_clearRemainingTime(){this._remainingTime=0}clone(){return new this.constructor(this)}finish(t=!1){this.isFinished()||t?this._callOnSuccessHandler(t):this._callonFailHandler(),this._clearRemainingTime(),this._clearRemainingRepeats()}getElapsedRepeats(){return this._repeats-this._remainingRepeats}getElapsedTime(){return this._repeatTime-this._remainingTime}hasManager(){return!!this._manager}hasOnPauseHandler(){return!!this._onPause}hasOnRepeatHandler(){return!!this._onRepeat}hasOnResetHandler(){return!!this._onReset}hasOnStartHandler(){return!!this._onStart}hasOnSuccessHandler(){return!!this._onSuccess}hasOnUpdateHandler(){return!!this._onUpdate}hasTarget(){return!!this._target}hasType(){return!!this._type}hasonFailHandler(){return!!this._onFail}isAnimation(){return this instanceof DKTools.Animation}isAnimationAction(){return this instanceof DKTools.Animation.Action}isFinished(){return 0===this._remainingTime&&0===this._remainingRepeats}isPaused(){return 0!==this._remainingPauseTime}isStarted(){return this._started}isUpdated(){return this.isStarted()&&!this.isPaused()&&!this.isFinished()}pause(t=-1){this._remainingPauseTime=t}_resetRemainingRepeats(){this._remainingRepeats=this._repeats}_resetRemainingTime(){this._remainingTime=this._repeatTime}remove(){this.hasTarget()&&this._target.removeEvent(this)}repeat(){this._remainingRepeats>0&&this._remainingRepeats--,this._resetRemainingTime(),this._callOnRepeatHandler()}reset(){this._resetRemainingTime(),this._resetRemainingRepeats(),this._callOnResetHandler()}resume(){this._remainingPauseTime=0}setManager(t){this._manager=t}setOnPauseHandler(t){this._onPause=t}setOnRepeatHandler(t){this._onRepeat=t}setOnResetHandler(t){this._onReset=t}setOnStartHandler(t){this._onStart=t}setOnSuccessHandler(t){this._onSuccess=t}setOnUpdateHandler(t){this._onUpdate=t}setTarget(t){this._target=t}setonFailHandler(t){this._onFail=t}stop(t=!1){this.finish(t),this.reset()}_update(){this._callOnUpdateHandler(),this._updateRemainingRepeats()}_updatePause(){this._callOnPauseHandler(),this._updateRemainingPauseTime()}_updateRemainingPauseTime(){this._remainingPauseTime>0&&this._remainingPauseTime--}_updateRemainingRepeats(){this.isFinished()||(0===this._remainingTime?this.repeat():this._updateRemainingTime())}_updateRemainingTime(){this._remainingTime>0&&this._remainingTime--}update(){this.isPaused()?this._updatePause():(this._callOnStartHandler(),this._update(),this.isFinished()&&this.finish())}},Object.defineProperties(DKTools.Event.prototype,{id:{get:function(){return this._id},configurable:!0},target:{get:function(){return this._target},configurable:!0},manager:{get:function(){return this._manager},configurable:!0},type:{get:function(){return this._type},configurable:!0},repeatTime:{get:function(){return this._duration},configurable:!0},repeats:{get:function(){return this._repeats},configurable:!0},remainingTime:{get:function(){return this._remainingTime},set:function(t){this._remainingTime=t},configurable:!0},remainingRepeats:{get:function(){return this._remainingRepeats},set:function(t){this._remainingRepeats=t},configurable:!0},remainingPauseTime:{get:function(){return this._remainingPauseTime},set:function(t){this._remainingPauseTime=t},configurable:!0},onStart:{get:function(){return this._onStart},configurable:!0},onUpdate:{get:function(){return this._onUpdate},configurable:!0},onPause:{get:function(){return this._onPause},configurable:!0},onReset:{get:function(){return this._onReset},configurable:!0},onRepeat:{get:function(){return this._onRepeat},configurable:!0},onSuccess:{get:function(){return this._onSuccess},configurable:!0},onFail:{get:function(){return this._onFail},configurable:!0}}),DKTools.Animation=class extends DKTools.Event{initialize(t){this._actions=[],DKTools.Event.prototype.initialize.call(this,t)}addAction(t){t&&(Number.isFinite(t.startTime)||(t.startTime=0),Number.isFinite(t.endTime)||(t.endTime=this._repeatTime),t.setAnimation(this),this._actions.push(t))}addActions(t){_.forEach(t,this.addAction.bind(this))}_canUpdateAction(t){return _.inRange(this.getElapsedTime(),t.startTime,t.endTime)}hasAction(t){return DKTools.Utils.Array.contains(this._actions,t)}hasActions(){return!DKTools.Utils.Array.isEmpty(this._actions)}isActionFinished(t){return t.isStarted()&&!t.isPaused()&&this.getElapsedTime()>=t.endTime}isActionUpdated(t){return t.isStarted()&&!t.isPaused()&&this._canUpdateAction(t)}isFinished(){return DKTools.Event.prototype.isFinished.call(this)||!this.hasActions()}removeAction(t){this.hasAction(t)&&DKTools.Utils.Array.remove(this._actions,t)}repeat(){this.repeatActions(),DKTools.Event.prototype.repeat.call(this)}repeatActions(){_.forEach(this._actions,function(t){t.repeat()})}reset(){this.resetActions(),DKTools.Event.prototype.reset.call(this)}resetActions(){_.forEach(this._actions,function(t){t.reset()})}_update(){this._updateActions(),DKTools.Event.prototype._update.call(this)}_updateAction(t){this._canUpdateAction(t)?t.update():this.getElapsedTime()===t.endTime&&this.isActionFinished(t)&&t.finish()}_updateActions(){_.forEach(this._actions,this._updateAction.bind(this))}},Object.defineProperties(DKTools.Animation.prototype,{actions:{get:function(){return this._actions},configurable:!0}}),DKTools.Animation.Action=class extends DKTools.Event{static Anchor(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,n=e.anchor,s=(i.x-n.x)/t,r=(i.y-n.y)/t,o=n.x+s,a=n.y+r;e.setAnchor(o,a)}.bind(e)),e}static Close(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=-e.openness/t,n=e.openness+i;e.openness=n}.bind(e)),e}static Frame(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,n=e.frame,s=(i.x-n.x)/t,r=(i.y-n.y)/t,o=(i.width-n.width)/t,a=(i.height-n.height)/t,l=new Rectangle(n.x+s,n.y+r,n.width+o,n.height+a);e.setFrame(l)}.bind(e)),e}static Move(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data.x-e.x)/t,n=(this._data.y-e.y)/t,s=e.x+i,r=e.y+n;e.move(s,r)}.bind(e)),e}static OpacitySprite(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.opacity)/t,n=e.opacity+i;e.setOpacity(n)}.bind(e)),e}static OpacityWindow(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data.windowOpacity-e.windowOpacity)/t,n=(this._data.contentsOpacity-e.contentsOpacity)/t,s=(this._data.frameOpacity-e.frameOpacity)/t,r=(this._data.backOpacity-e.backOpacity)/t,o={windowOpacity:e.windowOpacity+i,contentsOpacity:e.contentsOpacity+n,frameOpacity:e.frameOpacity+s,backOpacity:e.backOpacity+r};e.setOpacity(o)}.bind(e)),e}static Open(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(255-e.openness)/t;e.openness=e.openness+i}.bind(e)),e}static Pivot(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,n=e.pivot,s=(i.x-n.x)/t,r=(i.y-n.y)/t,o=n.x+s,a=n.y+r;e.setPivot(o,a)}.bind(e)),e}static Rotation(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.rotation)/t,n=e.rotation+i;e.setRotation(n)}.bind(e)),e}static Scale(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,n=e.scale,s=(i.x-n.x)/t,r=(i.y-n.y)/t,o=n.x+s,a=n.y+r;e.setScale(o,a)}.bind(e)),e}static Skew(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,n=e.skew,s=(i.x-n.x)/t,r=(i.y-n.y)/t,o=n.x+s,a=n.y+r;e.setSkew(o,a)}.bind(e)),e}static Sound(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this._data;t.isPlaying()||t.play()}.bind(e)),e}static Tint(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.tint)/t,n=e.tint+i;e.setTint(n)}.bind(e)),e}static Tone(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=e.tone,n=(this._data[0]-i[0])/t,s=(this._data[1]-i[1])/t,r=(this._data[2]-i[2])/t,o=i[0]+n,a=i[1]+s,l=i[2]+r;e.setTone([o,a,l])}.bind(e)),e}initialize(t){t=t||{},this._animation=null,this._startTime=t.startTime,this._endTime=t.endTime,this._data=t.data,DKTools.Event.prototype.initialize.call(this,t)}getElapsedTime(){return this._animation.getElapsedTime()-this._startTime}getRemainingTime(){return this._endTime-this._animation.getElapsedTime()}isFinished(){return this._animation.isActionFinished(this)}isUpdated(){return this._animation.isActionUpdated(this)}remove(){this._animation.removeAction(this)}repeat(){this._callOnRepeatHandler()}reset(){this._callOnResetHandler()}setAnimation(t){this._animation=t}},Object.defineProperties(DKTools.Animation.Action.prototype,{animation:{get:function(){return this._animation},configurable:!0},startTime:{get:function(){return this._startTime},set:function(t){this._startTime=t},configurable:!0},endTime:{get:function(){return this._endTime},set:function(t){this._endTime=t},configurable:!0},data:{get:function(){return this._data},configurable:!0}}),DKTools.OptionManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(){this.clear()}addOptionChangeListener(t,e){this._optionChangeListeners[t]||(this._optionChangeListeners[t]=[]),this._optionChangeListeners[t].push(e)}clear(){this._options=[],this._optionChangeListeners={}}clone(t=!1){const e=new DKTools.OptionManager;return e.enableOptions(this._options),t&&_.forEach(this._optionChangeListeners,(t,i)=>{_.forEach(t,t=>{e.addOptionChangeListener(i,t)})}),e}disableOption(t){this.isOptionEnabled(t)&&(DKTools.Utils.Array.remove(this._options,t),this._onOptionChange(t,!1))}disableOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.disableOption.bind(this))}enableOption(t){this.isOptionDisabled(t)&&(this._options.push(t),this._onOptionChange(t,!0))}enableOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.enableOption.bind(this))}equals(t){return t instanceof DKTools.OptionManager&&_.isEqual(this._options,t.options)}isOptionDisabled(t){return!this.isOptionEnabled(t)}isOptionEnabled(t){return DKTools.Utils.Array.contains(this._options,t)}isOptionsDisabled(t){const e=arguments.length>1?arguments:t;return _.every(e,this.isOptionDisabled.bind(this))}isOptionsEnabled(t){const e=arguments.length>1?arguments:t;return _.every(e,this.isOptionEnabled.bind(this))}isSomeOptionEnabled(){return this._options.length>0}isSomeOptionsDisabled(t){const e=arguments.length>1?arguments:t;return _.some(e,this.isOptionDisabled.bind(this))}isSomeOptionsEnabled(t){const e=arguments.length>1?arguments:t;return _.some(e,this.isOptionEnabled.bind(this))}_onOptionChange(t,e){_.forEach(this._optionChangeListeners[t],i=>{i(t,e)})}removeOptionChangeListener(t,e){DKTools.Utils.Array.remove(this._optionChangeListeners[t],e)}switchOption(t){this.isOptionEnabled(t)?this.disableOption(t):this.enableOption(t)}switchOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.switchOption.bind(this))}},Object.defineProperties(DKTools.OptionManager,{options:{get:function(){return this._options},configurable:!0}}),DKTools.EventManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){this._target=t,this._events={}}addAnimation(t){return this.addEventToContainer(t)}addEvent(t){let e;return t instanceof DKTools.Event||t instanceof DKTools.Animation?e=t:t instanceof Object&&(e=new DKTools.Event(t)),this.addEventToContainer(e)}addEventToContainer(t){if(!t)return null;return t.hasTarget()||t.setTarget(this._target),t.setManager(this),this.getEventsContainer(t).push(t),t}addOneTimeEvent(t){return t.repeatTime=1,t.repeats=0,this.addEvent(t)}_checkEvent(t){return t&&!t.isFinished()}_checkEvents(){_.forEach(this._events,(t,e)=>{this._events[e]=this._checkEventsContainer(t)})}_checkEventsContainer(t){return _.filter(t,this._checkEvent.bind(this))}clearEvents(t){t?Array.isArray(t)?_.forEach(t,t=>{this._events[t]=[]}):this._events[t]=[]:this._events={}}createEventsContainer(t){return this._events[t]=[],this._events[t]}findAnimation(t,e){return _.find(this.getAnimations(e),{id:t})}findEvent(t,e){return _.find(this.getEvents(e),{id:t})}finishEvents(t,e=!1){this.iterateEventsContainer(t,t=>{t.finish(e)})}getAnimations(t){return _.filter(this.getEvents(t),t=>t instanceof DKTools.Animation)}getEventIndex(t){return this.getEventsContainer(t).indexOf(t)}getEvents(t){if(t)return this.getEventsContainerByType(t);let e=[];return _.forEach(this._events,t=>{e=e.concat(t)}),e}getEventsContainer(t){return this.getEventsContainerByType(t.type)}getEventsContainerByType(t){return this._events[t]||this.createEventsContainer(t)}hasAnimation(t){return t instanceof DKTools.Animation&&this.getEventIndex(t)>=0}hasAnimations(t){return!DKTools.Utils.Array.isEmpty(this.getAnimations(t))}hasEvent(t){return this.getEventIndex(t)>=0}hasEvents(t){return!DKTools.Utils.Array.isEmpty(this.getEvents(t))}isEventsPaused(t){const e=this.getEventsContainerByType(t);return _.every(e,t=>t.isPaused())}iterateEventsContainer(t,e){const i=this.getEventsContainerByType(t);_.forEach(i,e)}pauseEvents(t,e=-1){this.iterateEventsContainer(t,t=>{t.pause(e)})}removeEvent(t){const e=this.getEventIndex(t);if(e>=0){return this.getEventsContainer(t)[e]=null,!0}return!1}resumeEvents(t){this.iterateEventsContainer(t,t=>{t.resume()})}stopEvents(t,e=!1){this.iterateEventsContainer(t,t=>{t.stop(e)})}update(){this._checkEvents()}updateEvent(t){t&&t.update()}updateEventsContainer(t){this.iterateEventsContainer(t,this.updateEvent.bind(this))}},Object.defineProperties(DKTools.EventManager,{events:{get:function(){return this._events},configurable:!0}}),DKTools.Unit=class{constructor(t){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this.setSource(t.source),this.setPercents(t.percents),this.setGetValueHandler(t.getValueHandler)}add(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.add(e):this._source+=e,this):this}clone(){return new this.constructor(this)}div(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.div(e):this._source/=e,this):this}equals(t){return!!t&&(this._source===t.source&&this._percents===t.percents)}_getValueFromUnit(t){return t instanceof DKTools.Unit?t.getValue():t}getPercents(){return DKTools.Utils.isFunction(this._percents)?this._percents(this)||100:this._percents||100}getValue(){let t;return(t=DKTools.Utils.isFunction(this._getValueHandler)?this._getValueHandler(this):this.getValueBase())||0}getValueBase(){const t=this.getPercents()/100;return this._source instanceof DKTools.Unit?this._source.getValue()*t:Number.isFinite(this._source)?this._source*t:0}mul(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.mul(e):this._source*=e,this):this}setGetValueHandler(t){this._getValueHandler=t}setPercents(t=100){this._percents=t}setSource(t){this._source=t}sub(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.rem(e):this._source-=e,this):this}},Object.defineProperties(DKTools.Unit.prototype,{source:{get:function(){return this._source},configurable:!0},percents:{get:function(){return this._percents},configurable:!0},getValueHandler:{get:function(){return this._getValueHandler},configurable:!0}}),DKTools.Unit.Property=class extends DKTools.Unit{initialize(t){t=t||{},DKTools.Unit.prototype.initialize.call(this,t),this.setProperty(t.property)}add(t){if(!t)return this;const e=this._property,i=this._source[e];let n=this._getValueFromUnit(t);return n instanceof Object&&(n=n[e]),n?(i instanceof DKTools.Unit?i.add(n):this._source[e]+=n,this):this}div(t){if(!t)return this;const e=this._property,i=this._source[e];let n=this._getValueFromUnit(t);return n instanceof Object&&(n=n[e]),n?(i instanceof DKTools.Unit?i.div(n):this._source[e]/=n,this):this}equals(t){return!!t&&(_.isEqual(this._source,t.source)&&this._percents===t.percents&&this._property===t.property)}getValueBase(){if(!(this._source instanceof Object))return 0;return new DKTools.Unit({source:this._source[this._property],percents:this.getPercents()}).getValue()}mul(t){if(!t)return this;const e=this._property,i=this._source[e];let n=this._getValueFromUnit(t);return n instanceof Object&&(n=n[e]),n?(i instanceof DKTools.Unit?i.mul(n):this._source[e]*=n,this):this}setProperty(t){this._property=t}sub(t){if(!t)return this;const e=this._property,i=this._source[e];let n=this._getValueFromUnit(t);return n instanceof Object&&(n=n[e]),n?(i instanceof DKTools.Unit?i.rem(n):this._source[e]-=n,this):this}},Object.defineProperties(DKTools.Unit.Property.prototype,{property:{get:function(){return this._property},configurable:!0}}),DKTools.Unit.Properties=class extends DKTools.Unit{initialize(t){t=t||{},DKTools.Unit.prototype.initialize.call(this,t),this.setProperties(t.properties)}add(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].add(i):this._source[e]+=i)}),this}addProperty(t){Array.isArray(this._properties)&&this._properties.push(t)}div(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].div(i):this._source[e]/=i)}),this}equals(t){return!!t&&(_.isEqual(this._source,t.source)&&_.isEqual(this._percents,t.percents)&&_.isEqual(this._properties,t.properties))}getPercents(t){return DKTools.Utils.isFunction(this._percents)?this._percents(t,this)||100:this._percents instanceof Object?DKTools.Utils.isFunction(this._percents[t])?this._percents[t](this)||100:this._percents[t]||100:this._percents||100}getValue(t){return DKTools.Utils.isFunction(this._getValueHandler)?this._getValueHandler(t,this):this.getValueBase(t)}getValueBase(t){const e=t=>{const e=this.getPercents(t);return this._source[t]instanceof DKTools.Unit?this._source[t].getValue(t)*e/100:new DKTools.Unit.Property({source:this._source,property:t,percents:e}).getValue()};return t?e(t):_.reduce(this._properties,(t,i)=>(t[i]=e(i),t),{})}mul(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].mul(i):this._source[e]*=i)}),this}removeProperty(t){Array.isArray(this._properties)&&DKTools.Utils.Array.remove(this._properties,t)}setProperties(t){this._properties=DKTools.Utils.isFunction(t)?t:_.clone(t)}sub(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].rem(i):this._source[e]-=i)}),this}},Object.defineProperties(DKTools.Unit.Properties.prototype,{properties:{get:function(){return this._properties},configurable:!0}}),DKTools.Unit.Function=class extends DKTools.Unit{add(){return this}div(){return this}getValueBase(){return this._source(this)*this.getPercents()/100}mul(){return this}sub(){return this}},DKTools.Base=class{constructor(){throw new Error("This is an abstract class!")}initialize(t,e,i,n){let s;t instanceof Graphics?(i=Graphics.boxWidth,n=Graphics.boxHeight):t instanceof Object?(s=t.x,e=t.y,i=t.width,n=t.height):Number.isFinite(t)&&(s=t),this.move(s,e),this.setupSize(i,n),this._clearAll(),this._createAll(),this._setupAll(),this._addAllChildren(),this.setupAll(t)}_addAllChildren(){}activate(){this.setActive(!0)&&this.updateActivateEvents()}actorName(t){const e=t>=1?$gameActors.actor(t):null;return e?e.name():""}addAllChildren(){this.updateAddAllChildrenEvents()}addAnimation(t){this._eventManager.addAnimation(t)}addEvent(t){return this._eventManager.addEvent(t)}addOneTimeEvent(t){return this._eventManager.addOneTimeEvent(t)}addOptionChangeListener(t,e){this._optionManager.addOptionChangeListener(t,e)}addFilter(t){t&&(this.filters&&this.filters.length>0?this.filters.push(t):this.filters=[t])}_clearAll(){this._clearMouseEnterTime(),this._clearWheel()}_clearMouseEnterTime(){this._mouseEnterTime=0}_clearWheel(){this._clearWheelX(),this._clearWheelY()}_clearWheelX(){this._wheelX=0}_clearWheelY(){this._wheelY=0}_createAll(){this._createOptionManager(),this._createEventManager()}_createEventManager(){this._eventManager=new DKTools.EventManager(this)}_createOptionManager(){this._optionManager=new DKTools.OptionManager}_checkHeight(t){const e=this.getMinHeight();return t?Math.max(e,t):e}_checkWidth(t){const e=this.getMinWidth();return t?Math.max(e,t):e}calcTextHeight(t,e=!1){if(!this.hasBitmap()||!t)return 0;const i=this.bitmap.fontSize,n=t.text.slice(t.index).split("\n"),s=e?n.length:1;let r=0;for(let t=0;t<s;t++){const e=/\x1b[\{\}]/g;let i=this.bitmap.fontSize;for(;;){const s=e.exec(n[t]);if(!s)break;"{"===s[0]&&this.makeFontBigger(),"}"===s[0]&&this.makeFontSmaller(),i<this.bitmap.fontSize&&(i=this.bitmap.fontSize)}r+=i+8}return this.bitmap.fontSize=i,r}canRedrawAll(){return this.hasBitmap()}canvasToLocalX(t){let e=this;for(;e;)t-=e.x,e=e.parent;return t}canvasToLocalY(t){let e=this;for(;e;)t-=e.y,e=e.parent;return t}checkAll(){this.updateCheckAllEvents(),this.checkSize()}checkSize(){}clear(){return this.clearRect()}clearEvents(t){this._eventManager.clearEvents(t)}clearFilters(){this.filters=null}clearLine(t){return this.clearRect(this.getLineRect(t))}clearOptions(){this._optionManager.clear()}clearRect(t,e,i,n){if(!this.hasBitmap())return!1;let s=t;return t instanceof Object&&(s=t.x,e=t.y,i=t.width,n=t.height),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),DKTools.Utils.isString(n)&&(e=this.getLineHeight()*parseFloat(n)),s=s||0,e=e||0,i=i||this.standardDrawingWidth(),n=n||this.standardDrawingHeight(),this.bitmap.clearRect(s,e,i,n),!0}clone(t={}){t=t||{};const e=new this.constructor(this);return t.cloneTexts&&_.forEach(this._texts,t=>{e.addText(t.text,{...t.options})}),t.cloneOptions&&e.enableOptions(this._optionManager.options),t.blockStart||e.start(),t.activate&&e.activate(),e}convertEscapeCharacters(t){try{return Window_Base.prototype.convertEscapeCharacters.call(this,t)}catch(e){return t=(t=(t=(t=(t=(t=(t=t.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(){return this.actorName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(){return this.partyMemberName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)}}createAll(){this.updateCreateAllEvents()}deactivate(){this.setActive(!1)&&this.updateDeactivateEvents()}disableOption(t){this._optionManager.disableOption(t)}disableOptions(t){this._optionManager.disableOptions.apply(this._optionManager,arguments)}drawAll(){}drawArrow(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=ImageManager.loadSystem(this.standardWindowskin()),n=DKTools.Sprite.Arrow.getRect(t);return this.drawBitmap(i,{...e,source:n})}drawBitmap(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=DKTools.Utils.Bitmap.load(t);return!(!i||e.sync&&!i.isReady())&&(i.addLoadListener(()=>{const t=DKTools.Utils.isFunction,n=DKTools.Utils.isString,s=this.getLineHeight(),{paintOpacity:r,resetPaintOpacity:o}=e;let{source:a,destination:l}=e,h={};t(e.callback)&&(h=e.callback(i,this)),a=a||h.source||{},l=l||h.destination||{},t(a)&&(a=a(i,this)),t(l)&&(l=l(i,this));const u=_.defaultTo(a.x,0),c=_.defaultTo(a.width,i.width);let p=_.defaultTo(a.y,0),d=_.defaultTo(a.height,i.height);const f=_.defaultTo(l.x,0),g=_.defaultTo(l.width,c);let m=_.defaultTo(l.y,0),y=_.defaultTo(l.height,d);n(p)&&(p=s*parseFloat(p)),n(d)&&(d=s*parseFloat(d)),n(m)&&(m=s*parseFloat(m)),n(y)&&(y=s*parseFloat(y)),Number.isFinite(r)&&this.changePaintOpacity(r),this.bitmap.blt(i,u,p,c,d,f,m,g,y),o&&this.resetPaintOpacity()}),!0)}async drawBitmapAsync(t,e={}){if(!t)return!1;const i=await DKTools.Utils.Bitmap.loadAsync(t);return this.drawBitmap(i,e)}drawCharacter(t,e,i={}){if(!this.hasBitmap()||null==t||null==e)return!1;i=i||{};const n=ImageManager.loadCharacter(t),s=ImageManager.isBigCharacter(t),r=n.width/(s?3:12),o=n.height/(s?4:8),a=(e%4*3+1)*r,l=4*Math.floor(e/4)*o,h=new Rectangle(a,l,r,o),u=i.pos;let{x:c,y:p}=i;return u instanceof Object&&(c=u.x,p=u.y),c=c||0,p=p||0,this.drawBitmap(n,{...i,source:h,destination:{x:c,y:p}})}drawCircle(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:n,paintOpacity:s,resetPaintOpacity:r}=t;let{x:o,y:a}=t;return e instanceof Object&&(o=e.x,a=e.y),DKTools.Utils.isString(a)&&(a=this.getLineHeight()*parseFloat(a)),Number.isFinite(s)&&this.changePaintOpacity(s),this.bitmap.drawCircle(o||0,a||0,i||1,n||"white"),r&&this.resetPaintOpacity(),!0}drawFace(t,e,i={}){if(!this.hasBitmap()||null==t||null==e)return!1;i=i||{};const{pos:n,rect:s}=i;let{x:r,y:o,width:a,height:l}=i;n instanceof Object&&(r=n.x,o=n.y),s instanceof Object&&(r=s.x,o=s.y,a=s.width,l=s.height),a=a||Window_Base._faceWidth,l=l||Window_Base._faceHeight;const h=ImageManager.loadFace(t),u=Window_Base._faceWidth,c=Window_Base._faceHeight,p=Math.min(a,u),d=Math.min(l,c),f=e%4*u+(u-p)/2,g=Math.floor(e/4)*c+(c-d)/2,_=new Rectangle(f,g,p,d);return r=Math.floor((r||0)+Math.max(a-u,0)/2),o=Math.floor((o||0)+Math.max(l-c,0)/2),this.drawBitmap(h,{...i,source:_,destination:{x:r,y:o}})}drawIcon(t,e={}){if(!this.hasBitmap()||null==t)return!1;const i=ImageManager.loadSystem("IconSet"),n=Window_Base._iconWidth,s=Window_Base._iconHeight,r=t%16*n,o=Math.floor(t/16)*s,a=new Rectangle(r,o,n,s),l=e.pos;let{x:h,y:u}=e;return l instanceof Object&&(h=l.x,u=l.y),this.drawBitmap(i,{...e,source:a,destination:{x:h,y:u}})}drawItemName(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=Window_Base._iconWidth+4,{pos:n,iconPos:s,paintOpacity:r,resetPaintOpacity:o}=e;let{x:a,y:l,iconX:h,iconY:u}=e;return n instanceof Object&&(a=n.x,l=n.y),s instanceof Object&&(h=s.x,u=s.y),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),Number.isFinite(r)&&this.changePaintOpacity(r),a=a||0,l=l||0,h=_.defaultTo(h,a+2),u=_.defaultTo(u,l+2),this.drawIcon(t.iconIndex,{x:h,y:u}),this.drawText(t.name,{x:a+i,y:l,width:(e.width||312)-i,height:e.height,align:"left",font:e.font,textColor:e.textColor,resetFont:e.resetFont,resetTextColor:e.resetTextColor}),o&&this.resetPaintOpacity(),!0}drawLine(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos1:e,pos2:i,color:n,lineWidth:s,paintOpacity:r,resetPaintOpacity:o}=t;let{x1:a,y1:l,x2:h,y2:u}=t;return e instanceof Object&&(a=e.x,l=e.y),i instanceof Object&&(h=i.x,u=i.y),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),Number.isFinite(r)&&this.changePaintOpacity(r),DKTools.Utils.Bitmap.drawLine(this.bitmap,a||0,l||0,h||0,u||0,n,s),o&&this.resetPaintOpacity(),!0}drawPolygon(t){if(!this.hasBitmap())return!1;t=t||{};const{points:e,paintOpacity:i,resetPaintOpacity:n}=t;Number.isFinite(i)&&this.changePaintOpacity(i);for(let i=0;i<e.length-1;i++){const n=e[i],s=e[i+1];this.drawLine({...t,pos1:n,pos2:s})}return n&&this.resetPaintOpacity(),!0}drawTextEx(t,e={}){if(!this.hasBitmap()||""===t||null==t)return 0;t=String(t),(e=e||{}).wrap instanceof Object&&(t=this.textWrap(t,e.wrap));const i=e.pos;let{x:n,y:s,index:r,left:o}=e;i instanceof Object&&(n=i.x,s=i.y),DKTools.Utils.isString(s)&&(s=this.getLineHeight()*parseFloat(s));const a={x:n=_.defaultTo(n,0),y:s=_.defaultTo(s,0),index:r=_.defaultTo(r,0),left:o=_.defaultTo(o,n)};for(a.text=this.convertEscapeCharacters(t),a.height=this.calcTextHeight(a,!1);a.index<a.text.length;)this.processCharacter(a);return a.width||a.x-n}drawWindowskinBack(t={}){if(!this.hasBitmap())return!1;t=t||{};const e=ImageManager.loadSystem(this.standardWindowskin());if(!e)return!1;const i=96,{pos:n,rect:s}=t;let{x:r,y:o,width:a,height:l,tone:h}=t;n instanceof Object&&(r=n.x,o=n.y),s instanceof Object&&(r=s.x,o=s.y,a=s.width,l=s.height);try{h=h||$gameSystem.windowTone()}catch(t){}r=r||0,o=o||0,a=a||this.standardDrawingWidth(),l=l||this.standardDrawingHeight(),h=h||[0,0,0];const u=new Bitmap(a,l);u.blt(e,0,0,i,i,0,0,a,l);for(let t=0;t<l;t+=i)for(let n=0;n<a;n+=i)u.blt(e,0,i,i,i,n,t,i,i);return u.adjustTone(...h),this.drawBitmap(u,{...t,source:{width:a,height:l},destination:{x:r,y:o}})}enableOption(t){this._optionManager.enableOption(t)}enableOptions(t){this._optionManager.enableOptions.apply(this._optionManager,arguments)}fillAll(t){return this.fillRect({color:t})}fillArc(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:n,lineWidth:s,anticlockwise:r,paintOpacity:o,resetPaintOpacity:a}=t;let{x:l,y:h,startAngle:u,endAngle:c}=t;return e instanceof Object&&(l=e.x,h=e.y),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),Number.isFinite(o)&&this.changePaintOpacity(o),l=l||0,h=h||0,u=u||0,c=_.defaultTo(c,2*Math.PI),DKTools.Utils.Bitmap.fillArc(this.bitmap,l,h,i,u,c,n,r),a&&this.resetPaintOpacity(),!0}fillRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,rect:i,paintOpacity:n,resetPaintOpacity:s}=t;let{x:r,y:o,width:a,height:l,color:h}=t;return e instanceof Object&&(r=e.x,o=e.y),i instanceof Object&&(r=i.x,o=i.y,a=i.width,l=i.height),DKTools.Utils.isString(o)&&(o=this.getLineHeight()*parseFloat(o)),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),Number.isFinite(n)&&this.changePaintOpacity(n),r=r||0,o=o||0,a=a||this.standardDrawingWidth(),l=l||this.standardDrawingHeight(),h=h||"white",this.bitmap.fillRect(r,o,a,l,h),s&&this.resetPaintOpacity(),!0}findAnimation(t,e){return this._eventManager.findAnimation(t,e)}findEvent(t,e){return this._eventManager.findEvent(t,e)}finishEvents(t,e=!1){this._eventManager.finishEvents(t,e)}getAnimations(t){return this._eventManager.getAnimations(t)}getChildById(t){return _.find(this.children,{id:t})}getEventIndex(t){return this._eventManager.getEventIndex(t)}getEvents(t){return this._eventManager.getEvents(t)}getEventsContainer(t){return this._eventManager.getEventsContainer(t)}getEventsContainerByType(t){return this._eventManager.getEventsContainerByType(t)}getFontHeight(t){let e;return(t=t||this.getLineHeight())-(t-.7*(e=this.hasBitmap()?this.bitmap.fontSize:this._font.fontSize))/2}getLineHeight(){try{return Window_Base.prototype.lineHeight.call(this)}catch(t){return 36}}getLineRect(t){const e=this.getLineHeight();return new Rectangle(0,e*parseInt(t),this.realWidth,e)}getLines(){return this.realHeight/this.getLineHeight()}getMinWidth(){return 0}getMinHeight(){return 0}getMinSize(){return{width:this.getMinWidth(),height:this.getMinHeight()}}getRealCenter(){const t=this.getRealSize();return new Point(t.width/2,t.height/2)}getCenter(){const t=this.getSize();return new Point(t.width/2,t.height/2)}getRealSize(){return{width:this.realWidth,height:this.realHeight}}getSize(){return{width:this.width,height:this.height}}getTextHeight(t,e={}){return this.getTextLines(t,e)*this.getLineHeight()}getTextFontHeight(t,e={}){return this.getTextLines(t,e)*this.getFontHeight()}getTextHeightEx(t,e={}){return e instanceof Object&&e.wrap instanceof Object&&(t=this.textWrap(t,e.wrap)),this.calcTextHeight({text:t,index:0},!0)}getTextLines(t,e){return e instanceof Object&&(t=this.textWrap(t,e)),t.split("\n").length}getTextWidth(t){return this.hasBitmap()&&""!==t&&null!=t?this.bitmap.measureTextWidth(String(t)):0}getTextWidthEx(t,e={}){try{return this.drawTextEx(t,{...e,x:-Number.MAX_SAFE_INTEGER,y:-Number.MAX_SAFE_INTEGER})}catch(t){return 0}}getWindowskinTextColor(t){const e=96+t%8*12+6,i=144+12*Math.floor(t/8)+6;if(this.hasWindowskin())return this.windowskin.getPixel(e,i);return ImageManager.loadSystem(this.standardWindowskin()).getPixel(e,i)}gradientFillAll(t="black",e="white",i=!1){return this.gradientFillRect({color1:t,color2:e,vertical:i})}gradientFillRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{vertical:e,rect:i,paintOpacity:n,resetPaintOpacity:s}=t;let{color1:r,color2:o,x:a,y:l,width:h,height:u}=t;return i instanceof Object&&(a=i.x,l=i.y,h=i.width,u=i.height),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),a=a||0,l=l||0,h=h||this.standardDrawingWidth(),u=u||this.standardDrawingHeight(),r=r||"black",o=o||"white",Number.isFinite(n)&&this.changePaintOpacity(n),this.bitmap.gradientFillRect(a,l,h,u,r,o,e),s&&this.resetPaintOpacity(),!0}hasAnimation(t){return this._eventManager.hasAnimation(t)}hasAnimations(t){return this._eventManager.hasAnimations(t)}hasBitmap(){return!!this.bitmap}hasEvent(t){return this._eventManager.hasEvent(t)}hasEvents(t){return this._eventManager.hasEvents(t)}hasMask(){return!!this.mask}hasParent(){return!!this.parent}hasWindowskin(){return!!this.windowskin}hide(t=!1){this.setVisible(!1)&&this.updateHideEvents(),t||this.deactivate()}isActive(){let t=this;for(;t;){if(!t.visible)return!1;t=t.parent}return this.active}isBusy(){return!this.isReady()}isButton(){return this instanceof DKTools.Sprite.Button}isChild(t){return t?DKTools.Utils.Array.contains(this.children,t):this.hasParent()}isCursor(){return this instanceof DKTools.Sprite.Cursor}isEventsPaused(t){return this._eventManager.isEventsPaused(t)}isInside(t,e){return!1}isLayout(){return this instanceof DKTools.Layout}isMouseInside(){return this.isInside(TouchInput.mouseX,TouchInput.mouseY)}isOptionDisabled(t){return this._optionManager.isOptionDisabled(t)}isOptionEnabled(t){return this._optionManager.isOptionEnabled(t)}isOptionsDisabled(t){return this._optionManager.isOptionsDisabled.apply(this._optionManager,arguments)}isOptionsEnabled(t){return this._optionManager.isOptionsEnabled.apply(this._optionManager,arguments)}isOutside(t,e){return!this.isInside(t,e)}isParent(t){return!!t&&this.parent===t}isReady(){return this.hasBitmap()&&this.bitmap.isReady()}isSelectable(){return this instanceof DKTools.Sprite.Selectable||this instanceof DKTools.Window.Selectable}isSomeOptionEnabled(){return this._optionManager.isSomeOptionEnabled()}isSomeOptionsDisabled(t){return this._optionManager.isSomeOptionsDisabled.apply(this._optionManager,arguments)}isSomeOptionsEnabled(t){return this._optionManager.isSomeOptionsEnabled.apply(this._optionManager,arguments)}isSprite(){return this instanceof DKTools.Sprite}isStarted(){return this._started}isViewport(){return this instanceof DKTools.Viewport}isVisible(){return this.visible}isVisibleAndActive(){return this.isVisible()&&this.isActive()}isWindow(){return this instanceof DKTools.Window}iterateChildren(t){_.forEach(this.children,t)}iterateEventsContainer(t,e){this._eventManager.iterateEventsContainer(t,e)}makeFontBigger(){this.hasBitmap()&&this.bitmap.fontSize<=96&&(this.bitmap.fontSize+=12)}makeFontSmaller(){this.hasBitmap()&&this.bitmap.fontSize>=24&&(this.bitmap.fontSize-=12)}move(t,e){t instanceof Object&&(e=t.y),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e));const i=DKTools.Utils.Point.toPoint(t,e);this.position.copy(i)}moveWithAnchor(t,e){t instanceof Object&&(e=t.y),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e));const i=DKTools.Utils.Point.toPoint(t,e),n=this.getRealSize(),s=this.anchor;this.move(i.x+s.x*n.width,i.y+s.y*n.height)}obtainEscapeCode(t){return Window_Base.prototype.obtainEscapeCode.call(this,t)}obtainEscapeParam(t){return Window_Base.prototype.obtainEscapeParam.call(this,t)}partyMemberName(t){const e=t>=1?$gameParty.members()[t-1]:null;return e?e.name():""}pauseEvents(t,e){this._eventManager.pauseEvents(t,e)}processAll(){this.processMouse(),this.processWheel()}processCharacter(t){Window_Base.prototype.processCharacter.call(this,t)}processDrawIcon(t,e){this.drawIcon(t,{x:e.x+2,y:e.y+2}),e.x+=Window_Base._iconWidth+4}processEscapeCharacter(t,e){try{Window_Base.prototype.processEscapeCharacter.call(this,t,e)}catch(i){switch(t){case"C":this.changeTextColor(this.getWindowskinTextColor(this.obtainEscapeParam(e)));break;case"I":this.processDrawIcon(this.obtainEscapeParam(e),e);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller()}}}processMouse(){this.isOptionEnabled("process-mouse")&&this.isVisible()&&(this.isActive()||this.isOptionEnabled("process-mouse-ignore-active"))?this.isMouseInside()?(0===this._mouseEnterTime&&this.updateMouseEnterEvents(),this.updateMouseInsideEvents(),TouchInput.isMouseMoved()&&this.updateMouseMoveEvents(),this._mouseEnterTime++):(this._mouseEnterTime>0&&this.updateMouseLeaveEvents(),this.updateMouseOutsideEvents(),this._clearMouseEnterTime()):this._clearMouseEnterTime()}processNewLine(t){t.width?t.width<t.x&&(t.width=t.x):t.width=t.x,Window_Base.prototype.processNewLine.call(this,t)}processNewPage(t){Window_Base.prototype.processNewPage.call(this,t)}processNormalCharacter(t){const e=t.text[t.index++],i=this.getTextWidth(e);this.drawText(e,{align:"left",pos:t,width:2*i,height:t.height}),t.x+=i}processWheel(){if(this._wheelX=TouchInput.wheelX,this._wheelY=TouchInput.wheelY,0!==this._wheelX||0!==this._wheelY){let t;t=this.isMouseInside()?"inside":"outside",0!==this._wheelX&&this.updateWheelXEvents(t),0!==this._wheelY&&this.updateWheelYEvents(t)}}redrawAll(){}refreshAll(){this.updateAll(),this.canRedrawAll()&&this.redrawAll(),this.updateRefreshAllEvents()}removeAll(){this.updateRemoveAllEvents()}removeAllChildren(){this.updateRemoveAllChildrenEvents()}removeEvent(t){return this._eventManager.removeEvent(t)}removeFilter(t){this.filters&&t&&(DKTools.Utils.Array.remove(this.filters,t),0===this.filters.length&&(this.filters=null))}removeFromParent(){return!!this.hasParent()&&(this.parent.removeChild(this),!0)}removeMask(){this.mask=null}removeOptionChangeListener(t,e){this._optionManager.removeOptionChangeListener(t,e)}resumeEvents(t){this._eventManager.resumeEvents(t)}_setupAll(){this._setupOptions(),this._setupEvents(),this._setupAnimations()}_setupAnimations(){}_setupEvents(){}_setupOptions(){}standardActive(){return!0}standardDrawingHeight(){return this.hasBitmap()?this.bitmap.height:this.isSprite()?this._bitmapHeight:this.isWindow()?this.realHeight:null}standardDrawingWidth(){return this.hasBitmap()?this.bitmap.width:this.isSprite()?this._bitmapWidth:this.isWindow()?this.realWidth:null}standardPivot(){return new Point(0,0)}standardRotation(){return 0}standardScale(){return new Point(1,1)}standardSkew(){return new Point(0,0)}standardTint(){return 16777215}standardVisible(){return!0}standardWindowskin(){return"Window"}setupAll(t={}){t=t||{},this.setupId(t.id),this.setupActive(t.active),this.setupVisible(t.visible),this.setupScale(t.scale),this.setupPivot(t.pivot),this.setupSkew(t.skew),this.setupRotation(t.rotation),this.setupTint(t.tint)}setupActive(t){this.active=_.defaultTo(t,this.standardActive())}setupId(t){this._id=_.defaultTo(t,null)}setupPivot(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),n=Object.assign(this.standardPivot(),i);this.pivot.copy(n)}setupRotation(t){this.rotation=_.defaultTo(t,this.standardRotation())}setupScale(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),n=Object.assign(this.standardScale(),i);this.scale.copy(n)}setupSize(t,e){}setupSkew(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),n=Object.assign(this.standardSkew(),i);this.skew.copy(n)}setupTint(t){this.tint=_.defaultTo(t,this.standardTint())}setupVisible(t){this.visible=_.defaultTo(t,this.standardVisible())}setAll(t={},e=!1,i=!1){t=t||{};let n=0;return this.setId(t.id)&&n++,this.setActive(t.active)&&n++,this.setVisible(t.visible)&&n++,this.setScale(t.scale)&&n++,this.setPivot(t.pivot)&&n++,this.setSkew(t.skew)&&n++,this.setRotation(t.rotation)&&n++,this.setTint(t.tint)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setActive(t){if(this.active===t)return!1;const e=this.active;return this.setupActive(t),this.active!==e}setId(t){if(this._id===t)return!1;const e=this._id;return this.setupId(t),this._id!==e}setPivot(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.pivot,i))return!1;const n=DKTools.Utils.Point.clone(this.pivot);return this.setupPivot(i),!DKTools.Utils.Point.equals(this.pivot,n)}setRotation(t){if(this.rotation===t)return!1;const e=this.rotation;return this.setupRotation(t),this.rotation!==e}setScale(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.scale,i))return!1;const n=DKTools.Utils.Point.clone(this.scale);return this.setupScale(i),!DKTools.Utils.Point.equals(this.scale,n)}setSkew(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.skew,i))return!1;const n=DKTools.Utils.Point.clone(this.skew);return this.setupSkew(i),!DKTools.Utils.Point.equals(this.skew,n)}setTint(t){if(this.tint===t)return!1;const e=this.tint;return this.setupTint(t),this.tint!==e}setVisible(t){if(this.visible===t)return!1;const e=this.visible;return this.setupVisible(t),this.visible!==e}show(t=!1){this.setVisible(!0)&&this.updateShowEvents(),t&&this.activate()}start(t=!1){this._started=!0,this.removeAllChildren(),this.terminateAll(),this.removeAll(),this.checkAll(),this.createAll(),this.startAll(),this.addAllChildren(),this.refreshAll(),this.updateStartEvents(),t&&this.activate()}startAll(){this.updateStartAllEvents()}stopEvents(t,e=!1){this._eventManager.stopEvents(t,e)}strokeArc(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:n,lineWidth:s,anticlockwise:r,paintOpacity:o,resetPaintOpacity:a}=t;let{x:l,y:h,startAngle:u,endAngle:c}=t;return e instanceof Object&&(l=e.x,h=e.y),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),Number.isFinite(o)&&this.changePaintOpacity(o),l=l||0,h=h||0,u=u||0,c=_.defaultTo(c,2*Math.PI),DKTools.Utils.Bitmap.strokeArc(this.bitmap,l,h,i,u,c,n,s,r),a&&this.resetPaintOpacity(),!0}strokeRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,rect:i,lineWidth:n,paintOpacity:s,resetPaintOpacity:r}=t;let{x:o,y:a,width:l,height:h,color:u}=t;return e instanceof Object&&(o=e.x,a=pox.y),i instanceof Object&&(o=i.x,a=i.y,l=i.width,h=i.height),DKTools.Utils.isString(a)&&(a=this.getLineHeight()*parseFloat(a)),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),Number.isFinite(s)&&this.changePaintOpacity(s),o=o||0,a=a||0,l=l||this.standardDrawingWidth(),h=h||this.standardDrawingHeight(),u=u||"white",DKTools.Utils.Bitmap.strokeRect(this.bitmap,o,a,l,h,u,n),r&&this.resetPaintOpacity(),!0}switchOption(t){this._optionManager.switchOption(t)}switchOptions(t){this._optionManager.switchOptions.apply(this._optionManager,arguments)}terminate(){}terminateAll(){this.updateTerminateAllEvents()}textWrap(t,e={}){if(!this.hasBitmap()||""===t||null==t)return"";t=String(t),e=e||{};const i=t.split("\n"),n=e.maxWidth||this.bitmap.width,s=this.getTextWidth(" ");let r="",o=1;for(let t=0;t<i.length;t++){const a=i[t].split(" ");let l=n;for(let t=0;t<a.length;t++){const i=a[t],h=this.getTextWidth(i);if(e.breakWords&&h>n){const t=i.split("");for(let e=0;e<t.length;e++){const i=this.getTextWidth(t[e]);i>l?(r+="\n"+t[e],l=n-i):(0===e&&(r+=" "),r+=t[e],l-=i)}}else{const a=h+s;if(0===t||a>l){if(t>0){if(e.maxLines===o)return r;r+="\n",o++}r+=i,l=n-h}else l-=a,r+=" "+i}}t<i.length-1&&(r+="\n")}return r}update(){this.updateChildren(),this.processAll(),this.updateEvents()}updateAll(){this.updateOpacity(),this.updateUpdateAllEvents()}updateActivateEvents(){this.updateEventsContainer("activate")}updateAddAllChildrenEvents(){this.updateEventsContainer("add-all-children")}updateCheckAllEvents(){this.updateEventsContainer("check-all")}updateChild(t){t&&DKTools.Utils.isFunction(t.update)&&t.update()}updateChildren(){this.iterateChildren(this.updateChild)}updateCreateAllEvents(){this.updateEventsContainer("create-all")}updateDeactivateEvents(){this.updateEventsContainer("deactivate")}updateEvent(t){this._eventManager.updateEvent(t)}updateEvents(){this._eventManager.update(),this.updateReadyEvents(),this.updateUpdateEvents(),this.updateQueueEvents()}updateEventsContainer(t){this._eventManager.updateEventsContainer(t)}updateHideEvents(){this.updateEventsContainer("hide")}updateInputData(){SceneManager.updateInputData()}updateMouseEnterEvents(){this.updateEventsContainer("mouse-enter")}updateMouseInsideEvents(){this.updateEventsContainer("mouse-inside")}updateMouseLeaveEvents(){this.updateEventsContainer("mouse-leave")}updateMouseMoveEvents(){this.updateEventsContainer("mouse-move")}updateMouseOutsideEvents(){this.updateEventsContainer("mouse-outside")}updateOpacity(){}updateQueueEvents(){const t=this.getEventsContainerByType("queue")[0];this.updateEvent(t)}updateReadyEvents(){this.isReady()&&this.updateEventsContainer("ready")}updateRedrawAllEvents(){this.updateEventsContainer("redraw-all")}updateRefreshAllEvents(){this.updateEventsContainer("refresh-all")}updateRemoveAllChildrenEvents(){this.updateEventsContainer("remove-all-children")}updateRemoveAllEvents(){this.updateEventsContainer("remove-all")}updateShowEvents(){this.updateEventsContainer("show")}updateStartAllEvents(){this.updateEventsContainer("start-all")}updateStartEvents(){this.isStarted()&&this.updateEventsContainer("start")}updateTerminateAllEvents(){this.updateEventsContainer("terminate-all-children")}updateUpdateAllEvents(){this.updateEventsContainer("update-all")}updateUpdateEvents(){this.updateEventsContainer("update")}updateWheelXEvents(t){this.updateEventsContainer("wheel-X-"+t)}updateWheelYEvents(t){this.updateEventsContainer("wheel-Y-"+t)}},Object.defineProperties(DKTools.Base.prototype,{id:{get:function(){return this._id},configurable:!0},mouseX:{get:function(){return this.canvasToLocalX(TouchInput.mouseX)},configurable:!0},mouseY:{get:function(){return this.canvasToLocalY(TouchInput.mouseY)},configurable:!0},wheelX:{get:function(){return this._wheelX},configurable:!0},wheelY:{get:function(){return this._wheelY},configurable:!0},mouseEnterTime:{get:function(){return this._mouseEnterTime},configurable:!0}}),DKTools.Sprite.prototype=Object.create(Sprite.prototype),DKTools.Utils.mixin(DKTools.Sprite.prototype,DKTools.Base.prototype),DKTools.Sprite.prototype.constructor=DKTools.Sprite,Object.defineProperties(DKTools.Sprite.prototype,{windowskin:{get:function(){return this._windowskin},configurable:!0},frame:{get:function(){return this._frame},configurable:!0},realWidth:{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0},realHeight:{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0},width:{get:function(){return this.realWidth*this.scale.x},set:function(t){this.realWidth=Math.floor(t/this.scale.x)},configurable:!0},height:{get:function(){return this.realHeight*this.scale.y},set:function(t){this.realHeight=Math.floor(t/this.scale.y)},configurable:!0},align:{get:function(){return this._align},configurable:!0},font:{get:function(){return this._font},configurable:!0},textColor:{get:function(){return this._textColor},configurable:!0},paintOpacity:{get:function(){return this._paintOpacity},configurable:!0},fillColor:{get:function(){return this._fillColor},configurable:!0},opacity:{get:function(){return this._opacity},configurable:!0},graphicFolder:{get:function(){return this._graphicFolder},configurable:!0},graphicName:{get:function(){return this._graphicName},configurable:!0},texts:{get:function(){return this._texts},configurable:!0}}),DKTools.Sprite.prototype.initialize=function(t,e,i,n){Sprite.prototype.initialize.call(this),DKTools.Base.prototype.initialize.call(this,t,e,i,n),t instanceof DKTools.Sprite&&!t.isStarted()&&!t.hasFixedBitmap()?this.setupSize(t._getBitmapWidth(),t._getBitmapHeight()):t instanceof Bitmap&&this.setupBitmap(t),this.updateBitmap()},DKTools.Sprite.prototype.addText=function(t,e={},i=!1){null!=t&&""!==t&&(t=String(t),e=e||{},this._texts.push({text:t,options:e,id:e.id,type:e.type||"drawText"}),i&&this.refreshAll())},DKTools.Sprite.prototype.adjustTone=function(t){return!(!this.hasBitmap()||!t)&&(Bitmap.prototype.adjustTone.apply(this.bitmap,t),!0)},DKTools.Sprite.prototype.blur=function(){return!!this.hasBitmap()&&(this.bitmap.blur(),!0)},DKTools.Sprite.prototype._clearAll=function(){DKTools.Base.prototype._clearAll.call(this),this._clearTexts()},DKTools.Sprite.prototype._clearTexts=function(){this._texts=[]},DKTools.Sprite.prototype.canCloneFixedBitmap=function(){return!0},DKTools.Sprite.prototype.canRedrawAll=function(){return DKTools.Base.prototype.canRedrawAll.call(this)&&!this.hasGraphicName()&&!this.hasFixedBitmap()},DKTools.Sprite.prototype.changeFont=function(t){this.hasBitmap()&&this.updateFont(t)},DKTools.Sprite.prototype.changePaintOpacity=function(t){this.hasBitmap()&&this.updatePaintOpacity(t)},DKTools.Sprite.prototype.changeTextColor=function(t){this.hasBitmap()&&this.updateTextColor(t)},DKTools.Sprite.prototype.checkSize=function(){const t=this.getMinWidth(),e=this.getMinHeight();let i=0;return this._bitmapWidth<t&&(this.setupWidth(t),i++),this._bitmapHeight<e&&(this.setupHeight(e),i++),i},DKTools.Sprite.prototype.createAll=function(){DKTools.Base.prototype.createAll.call(this),this.createBitmap(),this.createMask()},DKTools.Sprite.prototype.createBitmap=function(){this.hasGraphicName()?this._loadGraphic():this.hasFixedBitmap()||(this.bitmap=new Bitmap(this._getBitmapWidth(),this._getBitmapHeight()))},DKTools.Sprite.prototype.createRectMask=function(){const t=new PIXI.Graphics;t.beginFill(),t.drawRect(this.x,this.y,this.bitmap.width,this.bitmap.height),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createCircleMask=function(){const t=new PIXI.Graphics,e=this.bitmap.width/2,i=this.x+e,n=this.y+e;t.beginFill(),t.drawCircle(i,n,e),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createEllipseMask=function(){const t=new PIXI.Graphics,e=this.bitmap.width/2,i=this.bitmap.height/2,n=this.x+e,s=this.y+i;t.beginFill(),t.drawEllipse(n,s,e,i),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createMask=function(t){switch(t){case"rect":this.createRectMask();break;case"circle":this.createCircleMask();break;case"ellipse":this.createEllipseMask()}},DKTools.Sprite.prototype.drawAll=function(){this.updateFill(),this.drawAllTexts(),this.updateDrawAllEvents()},DKTools.Sprite.prototype.drawAllTexts=function(){_.forEach(this._texts,t=>{this[t.type](t.text,t.options)})},DKTools.Sprite.prototype.drawText=function(t,e={}){if(!this.hasBitmap()||null==t||""===t)return!1;t=String(t),e=e||{};const{pos:i,rect:n,font:s,textColor:r,paintOpacity:o,resetFont:a,resetTextColor:l,resetPaintOpacity:h}=e;let{x:u,y:c,width:p,height:d,align:f}=e;return i instanceof Object&&(u=i.x,c=i.y),n instanceof Object&&(u=n.x,c=n.y,p=n.width,d=n.height),DKTools.Utils.isString(c)&&(c=this.getLineHeight()*parseFloat(c)),DKTools.Utils.isString(d)&&(d=this.getLineHeight()*parseFloat(d)),u=u||0,c=c||0,p=p||this.standardDrawingWidth(),d=d||this.getLineHeight(),f=f||this.align,s&&this.changeFont(s),r&&this.changeTextColor(r),Number.isFinite(o)&&this.changePaintOpacity(o),this.bitmap.drawText(t,u,c,p,d,f),a&&this.resetFont(),l&&this.resetTextColor(),h&&this.resetPaintOpacity(),!0},DKTools.Sprite.prototype.findText=function(t){return _.find(this._texts,{id:t})},DKTools.Sprite.prototype._getBitmapHeight=function(){return this._bitmapHeight},DKTools.Sprite.prototype._getBitmapWidth=function(){return this._bitmapWidth},DKTools.Sprite.prototype.getCurrentOpacity=function(){return 255*this.alpha},DKTools.Sprite.prototype.hasFillColor=function(){return!!this._fillColor},DKTools.Sprite.prototype.hasFixedBitmap=function(){return!!this._fixedBitmap},DKTools.Sprite.prototype.hasGraphicFolder=function(){return!!this._graphicFolder},DKTools.Sprite.prototype.hasGraphicName=function(){return!!this._graphicName},DKTools.Sprite.prototype.hasTexts=function(){return this._texts.length>0},DKTools.Sprite.prototype.isInside=function(t,e){const i=this.canvasToLocalX(t),n=this.canvasToLocalY(e),s=this.width,r=this.height,o=this.anchor;return new Rectangle(-s*o.x,-r*o.y,s,r).contains(i,n)},DKTools.Sprite.prototype.isResizable=function(){return!this.hasGraphicName()&&!this.hasFixedBitmap()},DKTools.Sprite.prototype._loadGraphic=function(){if(this.hasGraphicFolder()&&this.hasGraphicName()){const t=this._graphicFolder,e=this._graphicName,i=this._graphicLoadListener;this.loadBitmap(t,e,i),this.updateReadyEvents()}},DKTools.Sprite.prototype.loadAnimation=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/animations/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/animations/",t,e,i,n)},DKTools.Sprite.prototype.loadBattleback1=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/battlebacks1/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/battlebacks1/",t,e,i,n)},DKTools.Sprite.prototype.loadBattleback2=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/battlebacks2/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/battlebacks2/",t,e,i,n)},DKTools.Sprite.prototype.loadBitmap=function(t,e,i,n,s){if(t instanceof Object)return this.loadBitmap(t.folder,t.filename,t.listener,t.hue,t.smooth);const r=DKTools.Utils.Bitmap.load(t,e,null,n,s);return!!this.setBitmap(r)&&(DKTools.Utils.isFunction(i)&&this.hasBitmap()&&this.bitmap.addLoadListener(i),!0)},DKTools.Sprite.prototype.loadCharacter=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/characters/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/characters/",t,e,i,n)},DKTools.Sprite.prototype.loadEnemy=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/enemies/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/enemies/",t,e,i,n)},DKTools.Sprite.prototype.loadFace=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/faces/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/faces/",t,e,i,n)},DKTools.Sprite.prototype.loadParallax=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/parallaxes/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/parallaxes/",t,e,i,n)},DKTools.Sprite.prototype.loadPicture=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/pictures/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/pictures/",t,e,i,n)},DKTools.Sprite.prototype.loadSvActor=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/sv_actors/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/sv_actors/",t,e,i,n)},DKTools.Sprite.prototype.loadSvEnemy=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/sv_enemies/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/sv_enemies/",t,e,i,n)},DKTools.Sprite.prototype.loadSystem=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/system/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/system/",t,e,i,n)},DKTools.Sprite.prototype.loadTileset=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/tilesets/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/tilesets/",t,e,i,n)},DKTools.Sprite.prototype.loadTitle1=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/titles1/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/titles1/",t,e,i,n)},DKTools.Sprite.prototype.loadTitle2=function(t,e,i,n){return t instanceof Object?this.loadBitmap("img/titles2/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/titles2/",t,e,i,n)},DKTools.Sprite.prototype.loadWindowskin=function(t,e,i,n){return t instanceof Object?this.loadSystem(t.filename||this.standardWindowskin(),t.listener,t.hue,t.smooth):this.loadSystem(t||this.standardWindowskin(),e,i,n)},DKTools.Sprite.prototype.standardAlign=function(){return"center"},DKTools.Sprite.prototype.standardAnchor=function(){return new Point(0,0)},DKTools.Sprite.prototype.standardFillColor=function(){return null},DKTools.Sprite.prototype.standardFont=function(){return{fontFace:this.standardFontFace(),fontItalic:this.standardFontItalic(),fontSize:this.standardFontSize()}},DKTools.Sprite.prototype.standardFontFace=function(){return"GameFont"},DKTools.Sprite.prototype.standardFontItalic=function(){return!1},DKTools.Sprite.prototype.standardFontSize=function(){return 28},DKTools.Sprite.prototype.standardFrame=function(){return new Rectangle(0,0,this.realWidth,this.realHeight)},DKTools.Sprite.prototype.standardGraphicFolder=function(){return"img/system/"},DKTools.Sprite.prototype.standardGraphicName=function(){return""},DKTools.Sprite.prototype.standardOpacity=function(){return 255},DKTools.Sprite.prototype.standardPaintOpacity=function(){return 255},DKTools.Sprite.prototype.standardTextColor=function(){return"#ffffff"},DKTools.Sprite.prototype.standardMask=function(){return null},DKTools.Sprite.prototype.setupAll=function(t={}){t=t||{},DKTools.Base.prototype.setupAll.call(this,t),this.setupBitmap(t),this.setupFrame(t.frame),this.setupAnchor(t.anchor),this.setupAlign(t.align),this.setupFont(t.font),this.setupTextColor(t.textColor),this.setupPaintOpacity(t.paintOpacity),this.setupFillColor(t.fillColor),this.setupOpacity(t.opacity),this.setupGraphicFolder(t.graphicFolder),this.setupGraphicName(t.graphicName)},DKTools.Sprite.prototype.setupAlign=function(t){this._align=t||this.standardAlign()},DKTools.Sprite.prototype.setupAnchor=function(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),n=Object.assign(this.standardAnchor(),i);this.anchor.copy(n)},DKTools.Sprite.prototype.setupBitmap=function(t){let e=null;t instanceof DKTools.Sprite&&t.hasFixedBitmap()&&t.canCloneFixedBitmap()?e=DKTools.Utils.Bitmap.clone(t.bitmap):t instanceof Object&&(e=DKTools.Utils.Bitmap.load(t.bitmap||t)),e?(this.bitmap=e,this.bitmap.addLoadListener(this.setupSize.bind(this))):this.bitmap=null,this._fixedBitmap=!!this.bitmap},DKTools.Sprite.prototype.setupFillColor=function(t){this._fillColor=null!==t?_.defaultTo(t,this.standardFillColor()):null},DKTools.Sprite.prototype.setupFont=function(t){this._font=Object.assign(this.standardFont(),t)},DKTools.Sprite.prototype.setupFrame=function(t,e,i,n){const s=DKTools.Utils.Rectangle.tryToRectangle(t,e,i,n),r=Object.assign(this.standardFrame(),s);Sprite.prototype.setFrame.call(this,r.x,r.y,r.width,r.height)},DKTools.Sprite.prototype.setupGraphicFolder=function(t){this._graphicFolder=_.defaultTo(t,this.standardGraphicFolder())},DKTools.Sprite.prototype.setupGraphicLoadListener=function(t){this._graphicLoadListener=t||null},DKTools.Sprite.prototype.setupGraphicName=function(t){this._graphicName=null!==t?_.defaultTo(t,this.standardGraphicName()):null},DKTools.Sprite.prototype.setupHeight=function(t){DKTools.Utils.isString(t)&&(t=this.getLineHeight()*parseFloat(t)),this._bitmapHeight=this._checkHeight(t)},DKTools.Sprite.prototype.setupMask=function(t){this.mask=null!==t?_.defaultTo(t,this.standardMask()):null},DKTools.Sprite.prototype.setupOpacity=function(t){this._opacity=_.defaultTo(t,this.standardOpacity())},DKTools.Sprite.prototype.setupPaintOpacity=function(t){this._paintOpacity=_.defaultTo(t,this.standardPaintOpacity())},DKTools.Sprite.prototype.setupSize=function(t,e){if(t instanceof Object)return this.setupSize(t.width,t.height);this.setupWidth(t),this.setupHeight(e)},DKTools.Sprite.prototype.setupTextColor=function(t){this._textColor=t||this.standardTextColor()},DKTools.Sprite.prototype.setupWidth=function(t){this._bitmapWidth=this._checkWidth(t)},DKTools.Sprite.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let n=DKTools.Base.prototype.setAll.call(this,t,!0);return this.setAlign(t.align,!0)&&n++,this.setAnchor(t.anchor)&&n++,this.setFont(t.font,!0)&&n++,this.setTextColor(t.textColor,!0)&&n++,this.setPaintOpacity(t.paintOpacity,!0)&&n++,this.setFillColor(t.fillColor,!0)&&n++,this.setOpacity(t.opacity,!0)&&n++,this.setGraphicFolder(t.graphicFolder,!0)&&n++,this.setGraphicName(t.graphicName,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n},DKTools.Sprite.prototype.setAlign=function(t,e=!1){if(this._align===t)return!1;const i=this._align;return this.setupAlign(t),this._align!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setAnchor=function(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.anchor,i))return!1;const n=DKTools.Utils.Point.clone(this.anchor);return this.setupAnchor(i),!DKTools.Utils.Point.equals(this.anchor,n)},DKTools.Sprite.prototype.setBitmap=function(t){return this.bitmap!==t&&(this.setupBitmap(t),!0)},DKTools.Sprite.prototype.setFillColor=function(t,e=!1){if(this._fillColor===t)return!1;const i=this._fillColor;return this.setupFillColor(t),this._fillColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setFont=function(t,e=!1){if(_.isEqual(this._font,Object.assign(this.standardFont(),t)))return!1;const i={...this._font};return this.setupFont(t),!_.isEqual(this._font,i)&&(e||this.start(),!0)},DKTools.Sprite.prototype.setFrame=function(t,e,i,n){const s=DKTools.Utils.Rectangle.toRectangle(t,e,i,n);if(DKTools.Utils.Rectangle.equals(this._frame,s))return!1;const r=DKTools.Utils.Rectangle.clone(this._frame);return this.setupFrame(s),!DKTools.Utils.Rectangle.equals(this._frame,r)},DKTools.Sprite.prototype.setGraphicFolder=function(t,e=!1){if(this._graphicFolder===t)return!1;const i=this._graphicFolder;return this.setupGraphicFolder(t),this._graphicFolder!==i&&(e||this.start(),!0)},DKTools.Sprite.prototype.setGraphicName=function(t,e=!1){if(this._graphicName===t)return!1;const i=this._graphicName;return this.setupGraphicName(t),this._graphicName!==i&&(e||this.start(),!0)},DKTools.Sprite.prototype.setHeight=function(t,e=!1){return this.resize(this._getBitmapWidth(),t,e)},DKTools.Sprite.prototype.setMask=function(t){return this.mask!==t&&(this.setupMask(t),!0)},DKTools.Sprite.prototype.setOpacity=function(t,e=!1){if(this._opacity===t)return!1;const i=this._opacity;return this.setupOpacity(t),this._opacity!==i&&(e||this.updateOpacity(),!0)},DKTools.Sprite.prototype.setPaintOpacity=function(t,e=!1){if(this._paintOpacity===t)return!1;const i=this._paintOpacity;return this.setupPaintOpacity(t),this._paintOpacity!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setTextColor=function(t,e=!1){if(this._textColor===t)return!1;const i=this._textColor;return this.setupTextColor(t),this._textColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setWidth=function(t,e=!1){return this.resize(t,this._getBitmapHeight(),e)},DKTools.Sprite.prototype.redrawAll=function(){this.clear(),this.drawAll(),this.updateRedrawAllEvents()},DKTools.Sprite.prototype.removeBitmap=function(){this.hasBitmap()&&this.setBitmap(null)},DKTools.Sprite.prototype.removeFillColor=function(){this.hasFillColor()&&this.setFillColor(null)},DKTools.Sprite.prototype.removeGraphicName=function(){this.hasGraphicName()&&this.setGraphicName(null)},DKTools.Sprite.prototype.removeText=function(t,e=!1){const i=this.findText(t);return i?(DKTools.Utils.Array.remove(this._texts,i),e||this.refreshAll(),i):null},DKTools.Sprite.prototype.reserveAnimation=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/animations/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/animations/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveBattleback1=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/battlebacks1/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/battlebacks1/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveBattleback2=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/battlebacks2/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/battlebacks2/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveBitmap=function(t,e,i,n,s,r){if(t instanceof Object)return this.reserveBitmap(t.folder,t.filename,t.listener,t.hue,t.smooth,t.reservationId);const o=DKTools.Utils.Bitmap.reserve(t,e,null,n,s,r);return!!this.setBitmap(o)&&(DKTools.Utils.isFunction(i)&&this.hasBitmap()&&this.bitmap.addLoadListener(i),!0)},DKTools.Sprite.prototype.reserveCharacter=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/characters/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/characters/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveEnemy=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/enemies/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/enemies/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveFace=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/faces/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/faces/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveParallax=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/parallaxes/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/parallaxes/",t,e,i,n,s)},DKTools.Sprite.prototype.reservePicture=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/pictures/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/pictures/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveSvActor=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/sv_actors/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/sv_actors/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveSvEnemy=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/sv_enemies/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/sv_enemies/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveSystem=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/system/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/system/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveTileset=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/tilesets/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/tilesets/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveTitle1=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/titles1/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/titles1/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveTitle2=function(t,e,i,n,s){return t instanceof Object?this.reserveBitmap("img/titles2/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/titles2/",t,e,i,n,s)},DKTools.Sprite.prototype.reserveWindowskin=function(t,e,i,n,s){return t instanceof Object?this.reserveSystem(t.filename||this.standardWindowskin(),t.listener,t.hue,t.smooth,t.reservationId):this.reserveSystem(t||this.standardWindowskin(),e,i,n,s)},DKTools.Sprite.prototype.resetAll=function(){this.resetFont(),this.resetPaintOpacity(),this.resetTextColor()},DKTools.Sprite.prototype.resetFont=function(){this.changeFont(this.font)},DKTools.Sprite.prototype.resetPaintOpacity=function(){this.changePaintOpacity(this.paintOpacity)},DKTools.Sprite.prototype.resetTextColor=function(){this.changeTextColor(this.textColor)},DKTools.Sprite.prototype.resize=function(t,e,i=!1,n=!1){if(!this.isResizable())return!1;if(t=_.defaultTo(t,this.getMinWidth()),e=_.defaultTo(e,this.getMinHeight()),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),this._bitmapWidth===t&&this._bitmapHeight===e)return!1;const s=this._bitmapWidth,r=this._bitmapHeight;return this.setupSize(t,e),(this._bitmapWidth!==s||this._bitmapHeight!==r)&&(i||this.start(),n&&this.activate(),!0)},DKTools.Sprite.prototype.rotateHue=function(t){return!(!this.hasBitmap()||!t)&&(this.bitmap.rotateHue(t),!0)},DKTools.Sprite.prototype.updateAll=function(){DKTools.Base.prototype.updateAll.call(this),this.updateBitmap()},DKTools.Sprite.prototype.updateBitmap=function(){this.hasBitmap()&&(this.updateFont(),this.updatePaintOpacity(),this.updateTextColor())},DKTools.Sprite.prototype.updateDrawAllEvents=function(){this.updateEventsContainer("draw-all")},DKTools.Sprite.prototype.updateFill=function(){this.hasFillColor()&&this.fillAll(this.fillColor)},DKTools.Sprite.prototype.updateFont=function(t={}){t=t||{},this.bitmap.fontFace=t.fontFace||this.font.fontFace,this.bitmap.fontItalic=!!t.fontItalic,this.bitmap.fontSize=t.fontSize||this.font.fontSize},DKTools.Sprite.prototype.updatePaintOpacity=function(t){Number.isFinite(t)||(t=this.paintOpacity),this.bitmap.paintOpacity=t},DKTools.Sprite.prototype.updateTextColor=function(t){this.bitmap.textColor=t||this.textColor},DKTools.Sprite.prototype.updateOpacity=function(t){Number.isFinite(t)||(t=this.opacity),this.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},DKTools.Sprite.Button=class extends DKTools.Sprite{_clearAll(){DKTools.Sprite.prototype._clearAll.call(this),this._clearMousePressTime()}_clearMousePressTime(){this._mousePressTime=0}isPressed(){return this._mousePressTime>0&&!this.isLongPressed()}isLongPressed(){return this._mousePressTime>=this._longPressInterval}_setupEvents(){DKTools.Sprite.prototype._setupEvents.call(this),this._setupUpdateButtonStateEvent()}_setupOptions(){DKTools.Sprite.prototype._setupOptions.call(this),this._setupProcessMouseOption()}_setupUpdateButtonStateEvent(){this.addEvent({type:"update",onUpdate:this.updateButtonState.bind(this)})}_setupProcessMouseOption(){this.enableOption("process-mouse")}standardActive(){return!1}standardLongPressInterval(){return 18}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupLongPressInterval(t.longPressInterval)}setupLongPressInterval(t){this._longPressInterval=t||this.standardLongPressInterval()}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setLongPressInterval(t.longPressInterval)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setLongPressInterval(t){if(this._longPressInterval===t)return!1;const e=this._longPressInterval;return this.setupLongPressInterval(t),this._longPressInterval!==e}processAll(){DKTools.Sprite.prototype.processAll.call(this),this.processMousePress()}processMousePress(){if(this.isVisible()&&this.isMouseInside()&&(this.isActive()||this.isOptionEnabled("process-mouse-press-ignore-active")))if(TouchInput.isMousePressed()){let t;this._mousePressTime++,TouchInput.isLeftButtonPressed()?t="left":TouchInput.isMiddleButtonPressed()?t="middle":TouchInput.isRightButtonPressed()&&(t="right"),t&&(this.updateMouseDownEvents(t),this.isLongPressed()&&(this._mousePressTime===this._longPressInterval&&this.updateMouseLongPressStartedEvents(t),this.updateMouseLongPressEvents(t)))}else{let t;TouchInput.isLeftButtonReleased()?t="left":TouchInput.isMiddleButtonReleased()?t="middle":TouchInput.isRightButtonReleased()&&(t="right"),t&&(this.isLongPressed()?this.updateMouseLongPressFinishedEvents(t):this.isPressed()&&this.updateMouseClickEvents(t),this._mousePressTime>0&&this.updateMouseUpEvents(t)),this._clearMousePressTime()}else this._clearMousePressTime()}updateMouseDownEvents(t){this.updateEventsContainer("mouse-down-"+t)}updateMouseUpEvents(t){this.updateEventsContainer("mouse-up-"+t)}updateMouseClickEvents(t){this.updateEventsContainer("mouse-click-"+t)}updateMouseLongPressEvents(t){this.updateEventsContainer("mouse-long-press-"+t)}updateMouseLongPressStartedEvents(t){this.updateEventsContainer(`mouse-long-press-${t}-started`)}updateMouseLongPressFinishedEvents(t){this.updateEventsContainer(`mouse-long-press-${t}-finished`)}updateStateNormalEvents(){this.updateEventsContainer("state-normal")}updateStatePressedEvents(){this.updateEventsContainer("state-pressed")}updateButtonState(){this._mousePressTime>0?this.updateStatePressedEvents():this.updateStateNormalEvents()}},Object.defineProperties(DKTools.Sprite.Button.prototype,{longPressInterval:{get:function(){return this._longPressInterval},configurable:!0},mousePressTime:{get:function(){return this._mousePressTime},configurable:!0},pressX:{get:function(){return this.canvasToLocalX(TouchInput.x)},configurable:!0},pressY:{get:function(){return this.canvasToLocalY(TouchInput.y)},configurable:!0}}),DKTools.Sprite.Cursor=class extends DKTools.Sprite{_clearAll(){DKTools.Sprite.prototype._clearAll.call(this),this._clearAnimationCount()}_clearAnimationCount(){this._animationCount=0}_createAll(){DKTools.Sprite.prototype._createAll.call(this),this._createWindowskin()}_createWindowskin(){this._windowskin=ImageManager.loadSystem(this.standardWindowskin())}refreshAll(){DKTools.Sprite.prototype.refreshAll.call(this),this.refreshCursor()}refreshCursor(){const t=this._cursorRect.x,e=this._cursorRect.y,i=this._cursorRect.width,n=this._cursorRect.height,s=this.parent,r=Math.min(i,s.realWidth-t),o=Math.min(n,s.realHeight-e);if(this.move(t,e),i>0&&n>0){const t=this._windowskin,e=new Bitmap(r,o),s=96,a=48;e.blt(t,s+4,s+4,a-8,a-8,4,4,i-8,n-8),e.blt(t,s+4,s,a-8,4,4,0,i-8,4),e.blt(t,s+4,s+a-4,a-8,4,4,0+n-4,i-8,4),e.blt(t,s,s+4,4,a-8,0,4,4,n-8),e.blt(t,s+a-4,s+4,4,a-8,0+i-4,4,4,n-8),e.blt(t,s,s,4,4,0,0,4,4),e.blt(t,s+a-4,s,4,4,0+i-4,0,4,4),e.blt(t,s,s+a-4,4,4,0,0+n-4,4,4),e.blt(t,s+a-4,s+a-4,4,4,0+i-4,0+n-4,4,4),this.setupBitmap(e)}}standardBlinkSpeed(){return 8}standardCursorRect(){return new Rectangle(0,0,0,0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupBlinkSpeed(t.blinkSpeed),this.setupCursorRect(t.cursorRect)}setupBlinkSpeed(t){this._blinkSpeed=_.defaultTo(t,this.standardBlinkSpeed())}setupCursorRect(t,e,i,n){const s=DKTools.Utils.Rectangle.tryToRectangle(t,e,i,n);this._cursorRect=Object.assign(this.standardCursorRect(),s)}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setBlinkSpeed(t.blinkSpeed)&&n++,this.setCursorRect(t.cursorRect)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setBlinkSpeed(t){if(this._blinkSpeed===t)return!1;const e=this._blinkSpeed;return this.setupBlinkSpeed(t),this._blinkSpeed!==e}setCursorRect(t,e,i,n){const s=DKTools.Utils.Rectangle.toRectangle(t,e,i,n);if(DKTools.Utils.Rectangle.equals(this._cursorRect,s))return!1;const r=DKTools.Utils.Rectangle.clone(this._cursorRect);return this.setupCursorRect(s),!DKTools.Utils.Rectangle.equals(this._cursorRect,r)&&(this.refreshCursor(),!0)}processAll(){DKTools.Sprite.prototype.processAll.call(this),this.processCursorAnimation()}processCursorAnimation(){const t=this._animationCount%40;let e=this.parent.getCurrentOpacity();this.parent.isVisibleAndActive()&&(this._animationCount++,e-=t<20?t*this._blinkSpeed:(40-t)*this._blinkSpeed),this.setOpacity(e)}},Object.defineProperties(DKTools.Sprite.Cursor.prototype,{cursorRect:{get:function(){return this._cursorRect},configurable:!0},blinkSpeed:{get:function(){return this._blinkSpeed},configurable:!0}}),DKTools.Sprite.Arrow=class extends DKTools.Sprite.Button{static getRect(t){const e=24,i=12;let n,s,r,o;switch(t){case"up":n=132,s=24,r=e,o=i;break;case"down":n=132,s=60,r=e,o=i;break;case"left":n=120,s=36,r=i,o=e;break;case"right":n=156,s=36,r=i,o=e}return DKTools.Utils.Rectangle.tryToRectangle(n,s,r,o)}refreshAll(){DKTools.Sprite.Button.prototype.refreshAll.call(this),this.refreshArrow()}refreshArrow(){this.setFrame(DKTools.Sprite.Arrow.getRect(this._arrowType))}standardVisible(){return!1}standardGraphicName(){return this.standardWindowskin()}standardAnchor(){return new Point(.5,.5)}standardArrowType(){return null}setupAll(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupArrowType(t.arrowType)}setupArrowType(t){this._arrowType=t||this.standardArrowType()}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setArrowType(t.arrowType,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setArrowType(t,e=!1){if(this._arrowType===t)return!1;const i=this._arrowType;return this.setupArrowType(t),this._arrowType!==i&&(e||this.refreshAll(),!0)}},Object.defineProperties(DKTools.Sprite.Arrow.prototype,{arrowType:{get:function(){return this._arrowType},configurable:!0}}),DKTools.Sprite.Selectable=class extends DKTools.Sprite.Button{_addAllChildren(){DKTools.Sprite.Button.prototype._addAllChildren.call(this),this._addCursorSprite()}_addCursorSprite(){this.addChild(this._cursorSprite)}activate(){DKTools.Sprite.Button.prototype.activate.call(this),this.reselect()}addItem(t,e=!1){const i=this.insertItem(t,this.getMaxItems()-1,!0);return e||this.refreshAll(),i}addItems(t,e=!1){const i=_.map(t,t=>this.addItem(t,!0));return e||this.refreshAll(),i}_clearAll(){DKTools.Sprite.Button.prototype._clearAll.call(this),this._clearItems(),this._clearHandlers(),this._clearTopRow(),this._clearTopCol()}_clearItems(){this._items=[]}_clearHandlers(){this._handlers={}}_clearTopRow(){this._topRow=0}_clearTopCol(){this._topCol=0}_createAll(){DKTools.Sprite.Button.prototype._createAll.call(this),this._createCursorSprite()}_createCursorSprite(){this._cursorSprite=new DKTools.Sprite.Cursor}_checkItem(t){return void 0===t.enabled&&(t.enabled=!0),void 0===t.ext&&(t.ext=null),t.symbol&&DKTools.Utils.isFunction(t.handler)&&this.setHandler(t.symbol,t.handler),t}callHandler(t){this.isHandled(t)&&this._handlers[t](this._index,this)}callOkHandler(){const t=this.getCurrentItemSymbol();this.isHandled(t)?this.callHandler(t):this.isHandled("ok")?this.callHandler("ok"):this.activate()}callCancelHandler(){this.callHandler("cancel")}clearItem(t){this.clearRect(this.getItemRect(t))}cursorDown(t=!1){this.hasCursorDownHandler()&&this._cursorDownHandler(t,this)}cursorUp(t=!1){this.hasCursorUpHandler()&&this._cursorUpHandler(t,this)}cursorRight(t=!1){this.hasCursorRightHandler()&&this._cursorRightHandler(t,this)}cursorLeft(t=!1){this.hasCursorLeftHandler()&&this._cursorLeftHandler(t,this)}cursorPageDown(){this.hasCursorPageDownHandler()&&this._cursorPageDownHandler(this)}cursorPageUp(){this.hasCursorPageUpHandler()&&this._cursorPageUpHandler(this)}deactivate(t=!1){DKTools.Sprite.Button.prototype.deactivate.call(this),t&&this.deselect()}deselect(){this.selectItem(-1)}disableItem(t,e=!1){(this.getItem(t)||{}).enabled=!1,e||this.refreshAll()}drawAll(){DKTools.Sprite.Button.prototype.drawAll.call(this),this.drawAllItems()}drawAllItems(){const t=this.getMaxPageItems(),e=this.getMaxItems();let i=this.getTopIndex();for(let n=0;n<t&&i<e;n++,i++)this.drawItem(i)}drawItem(t){const e=this.getItem(t)||{};DKTools.Utils.isFunction(e.drawHandler)?e.drawHandler(t,this):this.hasDrawItemHandler()&&this._itemDrawHandler(t,this)}enableItem(t,e=!1){(this.getItem(t)||{}).enabled=!0,e||this.refreshAll()}findSymbol(t){return _.findIndex(this._items,{symbol:t})}findExt(t){return _.findIndex(this._items,{ext:t})}getItemName(t){const e=this.getItem(t)||{};return DKTools.Utils.isFunction(e.name)?e.name(t,this):e.name}getCurrentItemName(){return this.getItemName(this._index)}getItemRect(t){const e=(this.getItem(t)||{}).rect||this._itemRect;return DKTools.Utils.isFunction(e)?e(t,this):e}getCurrentItemRect(){return this.getItemRect(this._index)}getItemRectForText(t){const e=this.getItemRect(t);return e.x+=this._textPadding,e.width-=2*this._textPadding,e}getItemWidth(){return DKTools.Utils.isFunction(this._itemWidth)?this._itemWidth(this):this._itemWidth}getItemHeight(){return DKTools.Utils.isFunction(this._itemHeight)?this._itemHeight(this):DKTools.Utils.isString(this._itemHeight)?this.getLineHeight()*parseFloat(this._itemHeight):this._itemHeight}getItem(t){return this._items[t]||null}getItemIndex(t){return _.indexOf(this._items,t)}getItemFont(t){const e=(this.getItem(t)||{}).font||this._itemFont;return DKTools.Utils.isFunction(e)?e(t,this):e}getItemTextColor(t){const e=(this.getItem(t)||{}).textColor||this._itemTextColor;return DKTools.Utils.isFunction(e)?e(t,this):e}getItemPaintOpacity(t){const e=this.getItem(t)||{};return DKTools.Utils.isFunction(e.paintOpacity)?e.paintOpacity(t,this):DKTools.Utils.isNumber(e.paintOpacity)?e.paintOpacity:DKTools.Utils.isFunction(this._itemPaintOpacity)?this._itemPaintOpacity(t,this):this._itemPaintOpacity}getItemAlign(t){const e=(this.getItem(t)||{}).align||this._itemAlign;return DKTools.Utils.isFunction(e)?e(t,this):e}getItemFullInfo(t){const e=this.getItem(t);return{...e,index:t,item:e,name:this.getItemName(t),enabled:this.isItemEnabled(t),handled:this.isItemHandled(t),rect:this.getItemRect(t),rectForText:this.getItemRectForText(t),font:this.getItemFont(t),textColor:this.getItemTextColor(t),paintOpacity:this.getItemPaintOpacity(t),align:this.getItemAlign(t)}}getPrevIndex(t=!1){return this._index>0?this._index-1:t?this.getMaxItems()-1:-1}getNextIndex(t=!1){return this._index<this.getMaxItems()-1?this._index+1:t?0:-1}getPrevItem(t=!1){return this.getItem(this.getPrevIndex(t))}getNextItem(t=!1){return this.getItem(this.getNextIndex(t))}getCurrentItem(){return this.getItem(this._index)}getVisibleItems(){const t=this.getMaxPageItems(),e=this.getMaxItems(),i=[];let n=this.getTopIndex();for(let s=0;s<t&&n<e;s++,n++)i.push(this.getItem(n));return i}getItemSymbol(t){const e=this.getItem(t);return e?e.symbol:null}getItemExt(t){var e=this.getItem(t);return e?e.ext:null}getCurrentItemSymbol(){return this.getItemSymbol(this._index)}getCurrentItemExt(){return this.getItemExt(this._index)}getMaxItems(){return this._items.length}getMaxRows(){return this.isFixedHorizontal()?1:Math.max(1,Math.ceil(this.getMaxItems()/this.getMaxCols()))}getMaxCols(){return this._maxCols}getMaxTopRow(){return Math.max(0,this.getMaxRows()-this.getMaxPageRows())}getMaxTopCol(){return Math.max(0,this.getMaxItems()-this.getMaxPageCols())}getMaxPageRows(){const t=this._verticalSpacing,e=this.realHeight,i=this.getItemHeight(),n=this.getMaxRows();let s=0,r=0;for(;s<n;s++){if(s===n-1){if(r+i>e)break}else if(r+i+t>e)break;r+=i+t}return s}getMaxPageCols(){return this.getMaxCols()}getMaxPageItems(){return this.isHorizontal()?this.getMaxPageCols():this.getMaxPageRows()*this.getMaxPageCols()}getRow(t){return Math.floor(t/this.getMaxCols())}getCurrentRow(){return this.getRow(this._index)}getItemRow(t){return this.hasItem(t)?this.getRow(t):-1}getRowItems(t){const e=[];if(DKTools.Utils.Number.inRange(t,0,this.getMaxRows())){const i=this.getMaxPageItems(),n=this.getMaxItems();let s=t*this.getMaxCols();for(let r=0;r<i&&s<n&&this.getRow(s)===t;r++,s++)e.push(this.getItem(s))}return e}getCol(t){return Math.floor(t%this.getMaxCols())}getCurrentCol(){return this.isHorizontal()?this._index:this.getCol(this._index)}getItemCol(t){return this.hasItem(t)?this.getCol(t):-1}getColItems(t){const e=[];if(DKTools.Utils.Number.inRange(t,0,this.getMaxCols())){const i=this.getMaxItems();for(let n=0;n<i;n++)this.getCol(n)===t&&e.push(this.getItem(n))}return e}getTopIndex(){return this.isHorizontal()?this.getTopCol():this.getTopRow()*this.getMaxCols()}getTopRow(){return this._topRow}getTopCol(){return this._topCol}getBottomRow(){return Math.max(0,this.getTopRow()+this.getMaxPageRows()-1)}getBottomCol(){return Math.max(0,this.getTopCol()+this.getMaxPageCols()-1)}getBottomIndex(){return Math.min(this.getTopIndex()+this.getMaxPageItems(),this.getMaxItems())-1}hasItem(t){return!!this.getItem(t)}hasItems(){return this.getMaxItems()>0}hasSymbol(t){return _.includes(this._items,{symbol:t})}hasExt(t){return _.includes(this._items,{ext:t})}hasCursorDownHandler(){return!!this._cursorDownHandler}hasCursorUpHandler(){return!!this._cursorUpHandler}hasCursorRightHandler(){return!!this._cursorRightHandler}hasCursorLeftHandler(){return!!this._cursorLeftHandler}hasCursorPageDownHandler(){return!!this._cursorPageDownHandler}hasCursorPageUpHandler(){return!!this._cursorPageUpHandler}hasDrawItemHandler(){return!!this._itemDrawHandler}hideCursor(){this._cursorSprite.hide()}hitTest(t,e){if(this.isOutside(t,e))return-1;const i=this.scale,n=this.canvasToLocalX(t),s=this.canvasToLocalY(e),r=this.getMaxPageItems(),o=this.getMaxItems();let a=this.getTopIndex();for(let t=0;t<r&&a<o;t++,a++){const t=this.getItemRect(a);if(t.x*=i.x,t.y*=i.y,t.width*=i.x,t.height*=i.y,t.contains(n,s))return a}return-1}insertItem(t,e,i=!1){const n=this._checkItem(t);return DKTools.Utils.Array.insert(this._items,n,e),i||this.refreshAll(),n}insertItems(t,e,i=!1){e=e||0;const n=_.map(t,(t,i)=>this.insertItem(t,e+i,!0));return i||this.refreshAll(),n}isCursorFixed(){return this._cursorFixed}isCursorAll(){return this._cursorAll}isFixedHorizontal(){return this._fixedHorizontal}isHorizontal(){return this.isFixedHorizontal()||1===this.getMaxPageRows()}isVertical(){return!this.isHorizontal()}isCursorMovable(){return this.isVisibleAndActive()&&!this.isCursorFixed()&&!this.isCursorAll()&&this.hasItems()}isOkEnabled(){return!0}isCancelEnabled(){return this.isHandled("cancel")}isOkTriggered(){return Input.isRepeated("ok")}isCancelTriggered(){return Input.isRepeated("cancel")||TouchInput.isCancelled()}isCursorVisible(){if(!this._cursorSprite.isVisible())return!1;if(this.isHorizontal()){const t=this.getCurrentCol();return t>=this.getTopCol()&&t<=this.getBottomCol()}const t=this.getCurrentRow();return t>=this.getTopRow()&&t<=this.getBottomRow()}isItemEnabled(t){const e=(this.getItem(t)||{}).enabled;return DKTools.Utils.isFunction(e)?e(t,this):e}isCurrentItemEnabled(){return this.isItemEnabled(this._index)}isItemVisible(t){return DKTools.Utils.Number.inRange(t,this.getTopIndex(),this.getBottomIndex()+1)}isItemSelected(t){return this._index===t}isHandled(t){return!!this._handlers[t]}isItemHandled(t){const e=this.getItem(t)||{};return this.isHandled(e.symbol)||DKTools.Utils.isFunction(e.okHandler)}isCurrentItemHandled(){return this.isItemHandled(this._index)}_onTouch(t=!1){const e=this._index,i=TouchInput.x,n=TouchInput.y,s=this.hitTest(i,n);s>=0&&(this._index===s?t&&this.isOkEnabled()&&this.processOk():this.isCursorMovable()&&this.selectItem(s)),this._index!==e&&this.playCursorSound()}playOkSound(){SoundManager.playOk()}playCancelSound(){SoundManager.playCancel()}playCursorSound(){SoundManager.playCursor()}playBuzzerSound(){SoundManager.playBuzzer()}processAll(){DKTools.Sprite.Button.prototype.processAll.call(this),this.processCursorMove(),this.processHandling()}processCursorMove(){if(!this.isCursorMovable())return;const t=this._index;Input.isRepeated("down")&&this.cursorDown(Input.isTriggered("down")),Input.isRepeated("up")&&this.cursorUp(Input.isTriggered("up")),Input.isRepeated("right")&&this.cursorRight(Input.isTriggered("right")),Input.isRepeated("left")&&this.cursorLeft(Input.isTriggered("left")),Input.isTriggered("pagedown")&&this.cursorPageDown(),Input.isTriggered("pageup")&&this.cursorPageUp(),this._index!==t&&this.playCursorSound()}processHandling(){this.isVisibleAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()&&this.processCancel())}processMouseHover(){if(this.isOptionEnabled("process-mouse-hover")&&this.isCursorMovable()){const t=this._index,e=TouchInput.mouseX,i=TouchInput.mouseY,n=this.hitTest(e,i);n>=0&&n!==t&&this.selectItem(n,!0)}}processWheelScroll(){if(this.isOptionEnabled("process-wheel-scroll")&&this.isVisibleAndActive()){this._wheelY>0?this.isHorizontal()?this.scrollRight():this.scrollDown():this.isHorizontal()?this.scrollLeft():this.scrollUp()}}processOk(){if(this.isCurrentItemEnabled()){this.playOkSound(),this.updateInputData(),this.deactivate();const t=this.getCurrentItem()||{};DKTools.Utils.isFunction(t.okHandler)?t.okHandler(this._index,this):this.callOkHandler()}else this.playBuzzerSound()}processCancel(){this.playCancelSound(),this.updateInputData(),this.deactivate();const t=this.getCurrentItem();t&&DKTools.Utils.isFunction(t.cancelHandler)?t.cancelHandler(this._index,this):this.callCancelHandler()}redrawItem(t){this.isItemVisible(t)&&(this.clearItem(t),this.drawItem(t))}redrawCurrentItem(){this.redrawItem(this._index)}removeHandler(t){delete this._handlers[t]}removeItem(t,e=!1){const i=this.getItem(t);return i?(DKTools.Utils.Array.remove(this._items,i),e||this.refreshAll(),i):null}removeItems(t,e=!1){const i=_.map(t,t=>this.removeItem(t,!0));return e||this.refreshAll(),i}replaceItem(t,e,i=!1){const n=this._checkItem(t);e=e||0;const s=this._items[e];return this._items[e]=n,i||this.refreshAll(),s}reselect(){this.selectItem(this._index)}resetScroll(){0!==this._index&&this.selectItem(0)}_setupEvents(){DKTools.Sprite.Button.prototype._setupEvents.call(this),this._setupMouseClickEvent(),this._setupMouseLongPressEvent(),this._setupMouseHoverEvents(),this._setupWheelScrollEvents()}_setupMouseClickEvent(){this.addEvent({type:"mouse-click-left",onUpdate:this._onTouch.bind(this,!0)})}_setupMouseLongPressEvent(){this.addEvent({type:"mouse-long-press-left",onUpdate:this._onTouch.bind(this,!1)})}_setupMouseHoverEvents(){this.addEvent({type:"mouse-enter",onUpdate:this.processMouseHover.bind(this)}),this.addEvent({type:"mouse-move",onUpdate:this.processMouseHover.bind(this)})}_setupWheelScrollEvents(){this.addEvent({type:"wheel-Y-inside",onUpdate:this.processWheelScroll.bind(this)}),this.addEvent({type:"wheel-Y-outside",onUpdate:this.processWheelScroll.bind(this)})}standardIndex(){return 0}standardMaxCols(){return 1}standardCursorFixed(){return!1}standardCursorAll(){return!1}standardFixedHorizontal(){return!1}standardHorizontalSpacing(){return 0}standardVerticalSpacing(){return 0}standardTextPadding(){return 6}standardCursorDownHandler(){return t=>{if(this.isHorizontal())return;const e=this._index,i=this.getMaxItems(),n=this.getMaxCols();(e<i-n||t&&i===this.getMaxRows()*n)&&this.selectItem((e+n)%i)}}standardCursorUpHandler(){return t=>{if(this.isHorizontal())return;const e=this._index,i=this.getMaxItems(),n=this.getMaxCols();(e>=n||t&&i===this.getMaxRows()*n)&&this.selectItem((e-n+i)%i)}}standardCursorRightHandler(){return t=>{const e=this.getMaxItems();if(!(e<2))if(this.isVertical()){const i=this._index;this.getMaxCols()>=2&&(i<e-1||t)&&this.selectItem((i+1)%e)}else this.selectNextItem(t)}}standardCursorLeftHandler(){return t=>{const e=this.getMaxItems();if(!(e<2))if(this.isVertical()){const i=this._index;this.getMaxCols()>=2&&(i>0||t)&&this.selectItem((i-1+e)%e)}else this.selectPrevItem(t)}}standardCursorPageDownHandler(){return()=>{if(this.isHorizontal()){const t=this.getTopCol(),e=this.getMaxPageCols(),i=this.getMaxItems();t+e<i&&(this.setTopCol(t+e),this.selectItem(Math.min(this._index+this.getMaxPageItems(),i-1)))}else{const t=this.getTopRow(),e=this.getMaxPageRows();t+e<this.getMaxRows()&&(this.setTopRow(t+e),this.selectItem(Math.min(this._index+this.getMaxPageItems(),this.getMaxItems()-1)))}}}standardCursorPageUpHandler(){return()=>{if(this.isHorizontal()){const t=this.getTopCol();t>0&&(this.setTopCol(t-this.getMaxPageCols()),this.selectItem(Math.max(0,this._index-this.getMaxPageItems())))}else{const t=this.getTopRow();t>0&&(this.setTopRow(t-this.getMaxPageRows()),this.selectItem(Math.max(0,this._index-this.getMaxPageItems())))}}}standardItems(){return[]}standardItemDrawHandler(){return t=>{const e=this.getItemName(t),i=this.getItemFont(t),n=this.getItemTextColor(t),s=this.getItemPaintOpacity(t),r=this.getItemAlign(t),o=this.getItemRectForText(t);this.drawText(e,{font:i,textColor:n,paintOpacity:s,align:r,rect:o,resetFont:!0,resetTextColor:!0,resetPaintOpacity:!0})}}standardItemWidth(){return()=>Math.floor((this.realWidth+this._horizontalSpacing)/this.getMaxCols()-this._horizontalSpacing)}standardItemHeight(){return this.getLineHeight()}standardItemRect(){return t=>{const e=new Rectangle(0,0,this.getItemWidth(),this.getItemHeight()),i=this.getMaxCols();return this.isHorizontal()?(e.x=(t-this.getTopCol())*(e.width+this._horizontalSpacing),e.y=0):(e.x=t%i*(e.width+this._horizontalSpacing),e.y=(Math.floor(t/i)-this.getTopRow())*(e.height+this._verticalSpacing)),e}}standardItemFont(){return()=>this.font}standardItemTextColor(){return()=>this.textColor}standardItemPaintOpacity(){return t=>this.isItemEnabled(t)?this.standardEnabledItemPaintOpacity():this.standardDisabledItemPaintOpacity()}standardEnabledItemPaintOpacity(){return 255}standardDisabledItemPaintOpacity(){try{return Window_Base.prototype.translucentOpacity.call(this)}catch(t){return 160}}standardItemAlign(){return this.align}setupAll(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupIndex(t.index),this.setupMaxCols(t.maxCols),this.setupFixedHorizontal(t.fixedHorizontal),this.setupCursorFixed(t.cursorFixed),this.setupCursorAll(t.cursorAll),this.setupCursorDownHandler(t.cursorDownHandler),this.setupCursorUpHandler(t.cursorUpHandler),this.setupCursorRightHandler(t.cursorRightHandler),this.setupCursorLeftHandler(t.cursorLeftHandler),this.setupCursorPageDownHandler(t.cursorPageDownHandler),this.setupCursorPageUpHandler(t.cursorPageUpHandler),this.setupSpacing(t.horizontalSpacing,t.verticalSpacing),this.setupTextPadding(t.textPadding),this.setupItems(t.items),this.setupItemDrawHandler(t.drawItemHandler),this.setupItemWidth(t.itemWidth),this.setupItemHeight(t.itemHeight),this.setupItemRect(t.itemRect),this.setupItemFont(t.itemFont),this.setupItemTextColor(t.itemTextColor),this.setupItemPaintOpacity(t.itemPaintOpacity),this.setupItemAlign(t.itemAlign)}setupIndex(t){this._lastIndex=this._index,this._index=_.defaultTo(t,this.standardIndex())}setupMaxCols(t){this._maxCols=t||this.standardMaxCols()}setupFixedHorizontal(t){this._fixedHorizontal=_.defaultTo(t,this.standardFixedHorizontal())}setupCursorFixed(t){this._cursorFixed=_.defaultTo(t,this.standardCursorFixed())}setupCursorAll(t){this._cursorAll=_.defaultTo(t,this.standardCursorAll())}setupCursorDownHandler(t){this._cursorDownHandler=t||this.standardCursorDownHandler()}setupCursorUpHandler(t){this._cursorUpHandler=t||this.standardCursorUpHandler()}setupCursorRightHandler(t){this._cursorRightHandler=t||this.standardCursorRightHandler()}setupCursorLeftHandler(t){this._cursorLeftHandler=t||this.standardCursorLeftHandler()}setupCursorPageDownHandler(t){this._cursorPageDownHandler=t||this.standardCursorPageDownHandler()}setupCursorPageUpHandler(t){this._cursorPageUpHandler=t||this.standardCursorPageUpHandler()}setupHorizontalSpacing(t){this._horizontalSpacing=_.defaultTo(t,this.standardHorizontalSpacing())}setupVerticalSpacing(t){this._verticalSpacing=_.defaultTo(t,this.standardVerticalSpacing())}setupSpacing(t,e){this.setupHorizontalSpacing(t),this.setupVerticalSpacing(e)}setupTextPadding(t){this._textPadding=_.defaultTo(t,this.standardTextPadding())}setupItems(t){this._items=_.map(t||this.standardItems(),t=>this._checkItem(t))}setupItemDrawHandler(t){this._itemDrawHandler=t||this.standardItemDrawHandler()}setupItemWidth(t){this._itemWidth=t||this.standardItemWidth()}setupItemHeight(t){this._itemHeight=t||this.standardItemHeight()}setupItemRect(t){this._itemRect=t||this.standardItemRect()}setupItemFont(t){this._itemFont=t||this.standardItemFont()}setupItemTextColor(t){this._itemTextColor=t||this.standardItemTextColor()}setupItemPaintOpacity(t){this._itemPaintOpacity=t||this.standardItemPaintOpacity()}setupItemAlign(t){this._itemAlign=t||this.standardItemAlign()}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setIndex(t.index,!0)&&n++,this.setMaxCols(t.maxCols,!0)&&n++,this.setFixedHorizontal(t.fixedHorizontal,!0)&&n++,this.setCursorFixed(t.cursorFixed,!0)&&n++,this.setCursorAll(t.cursorAll,!0)&&n++,this.setCursorDownHandler(t.cursorDownHandler,!0)&&n++,this.setCursorUpHandler(t.cursorUpHandler,!0)&&n++,this.setCursorRightHandler(t.cursorRightHandler,!0)&&n++,this.setCursorLeftHandler(t.cursorLeftHandler,!0)&&n++,this.setCursorPageDownHandler(t.cursorPageDownHandler,!0)&&n++,this.setCursorPageUpHandler(t.cursorPageUpHandler,!0)&&n++,n+=this.setSpacing(t.horizontalSpacing,t.verticalSpacing,!0),this.setTextPadding(t.textPadding,!0)&&n++,this.setItems(t.items,!0)&&n++,this.setItemDrawHandler(t.drawItemHandler,!0)&&n++,this.setItemWidth(t.itemWidth,!0)&&n++,this.setItemHeight(t.itemHeight,!0)&&n++,this.setItemRect(t.itemRect,!0)&&n++,this.setItemFont(t.itemFont,!0)&&n++,this.setItemTextColor(t.itemTextColor,!0)&&n++,this.setItemPaintOpacity(t.itemPaintOpacity,!0)&&n++,this.setItemAlign(t.itemAlign,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setIndex(t,e=!1){return this._index!==t&&(this.setupIndex(t),this._index!==this._lastIndex&&(e||this.refreshAll(),!0))}setMaxCols(t,e=!1){if(this._maxCols===t)return!1;const i=this._maxCols;return this.setupMaxCols(t),this._maxCols!==i&&(e||this.refreshAll(),!0)}setFixedHorizontal(t,e=!1){if(this._fixedHorizontal===t)return!1;const i=this._fixedHorizontal;return this.setupFixedHorizontal(t),this._fixedHorizontal!==i&&(e||this.refreshAll(),!0)}setCursorFixed(t,e=!1){if(this._cursorFixed===t)return!1;const i=this._cursorFixed;return this.setupCursorFixed(t),this._cursorFixed!==i&&(e||this.refreshAll(),!0)}setCursorAll(t,e=!1){if(this._cursorAll===t)return!1;const i=this._cursorAll;return this.setupCursorAll(t),this._cursorAll!==i&&(e||this.refreshAll(),!0)}setCursorDownHandler(t,e=!1){if(this._cursorDownHandler===t)return!1;const i=this._cursorDownHandler;return this.setupCursorDownHandler(t),this._cursorDownHandler!==i&&(e||this.refreshAll(),!0)}setCursorUpHandler(t,e=!1){if(this._cursorUpHandler===t)return!1;const i=this._cursorUpHandler;return this.setupCursorUpHandler(t),this._cursorUpHandler!==i&&(e||this.refreshAll(),!0)}setCursorRightHandler(t,e=!1){if(this._cursorRightHandler===t)return!1;const i=this._cursorRightHandler;return this.setupCursorRightHandler(t),this._cursorRightHandler!==i&&(e||this.refreshAll(),!0)}setCursorLeftHandler(t,e=!1){if(this._cursorLeftHandler===t)return!1;const i=this._cursorLeftHandler;return this.setupCursorLeftHandler(t),this._cursorLeftHandler!==i&&(e||this.refreshAll(),!0)}setCursorPageDownHandler(t,e=!1){if(this._cursorPageDownHandler===t)return!1;const i=this._cursorPageDownHandler;return this.setupCursorPageDownHandler(t),this._cursorPageDownHandler!==i&&(e||this.refreshAll(),!0)}setCursorPageUpHandler(t,e=!1){if(this._cursorPageUpHandler===t)return!1;const i=this._cursorPageUpHandler;return this.setupCursorPageUpHandler(t),this._cursorPageUpHandler!==i&&(e||this.refreshAll(),!0)}setHorizontalSpacing(t,e=!1){if(this._horizontalSpacing===t)return!1;const i=this._horizontalSpacing;return this.setupHorizontalSpacing(t),this._horizontalSpacing!==i&&(e||this.refreshAll(),!0)}setVerticalSpacing(t,e=!1){if(this._verticalSpacing===t)return!1;const i=this._verticalSpacing;return this.setupVerticalSpacing(t),this._verticalSpacing!==i&&(e||this.refreshAll(),!0)}setSpacing(t,e,i=!1){let n=0;return this.setHorizontalSpacing(t,!0)&&n++,this.setVerticalSpacing(e,!0)&&n++,n>0&&!i&&this.refreshAll(),n}setTextPadding(t,e=!1){if(this._textPadding===t)return!1;const i=this._textPadding;return this.setupTextPadding(t),this._textPadding!==i&&(e||this.refreshAll(),!0)}setItems(t,e=!1){return this._items!=t&&(this.setupItems(t),e||this.refreshAll(),!0)}setItemDrawHandler(t,e=!1){if(this._itemDrawHandler===t)return!1;const i=this._itemDrawHandler;return this.setupItemDrawHandler(t),this._itemDrawHandler!==i&&(e||this.refreshAll(),!0)}setItemWidth(t,e=!1){if(this._itemWidth===t)return!1;const i=this._itemWidth;return this.setupItemWidth(t),this._itemWidth!==i&&(e||this.refreshAll(),!0)}setItemHeight(t,e=!1){if(this._itemHeight===t)return!1;const i=this._itemHeight;return this.setupItemHeight(t),this._itemHeight!==i&&(e||this.refreshAll(),!0)}setItemFont(t,e=!1){if(this._itemFont===t)return!1;const i=this._itemFont;return this.setupItemFont(t),this._itemFont!==i&&(e||this.refreshAll(),!0)}setItemTextColor(t,e=!1){if(this._itemTextColor===t)return!1;const i=this._itemTextColor;return this.setupItemTextColor(t),this._itemTextColor!==i&&(e||this.refreshAll(),!0)}setItemPaintOpacity(t,e=!1){if(this._itemPaintOpacity===t)return!1;const i=this._itemPaintOpacity;return this.setupItemPaintOpacity(t),this._itemPaintOpacity!==i&&(e||this.refreshAll(),!0)}setItemAlign(t,e=!1){if(this._itemAlign===t)return!1;const i=this._itemAlign;return this.setupItemAlign(t),this._itemAlign!==i&&(e||this.refreshAll(),!0)}setTopRow(t,e=!1){const i=DKTools.Utils.Number.clamp(t,0,this.getMaxTopRow());this._topRow!==i&&(this._topRow=i,e||this.refreshAll())}setTopCol(t,e=!1){const i=DKTools.Utils.Number.clamp(t,0,this.getMaxTopCol());this._topCol!==i&&(this._topCol=i,e||this.refreshAll())}setBottomRow(t,e=!1){this.setTopRow(t-(this.getMaxPageRows()-1),e)}setBottomCol(t,e=!1){this.setTopCol(t-(this.getMaxPageCols()-1),e)}setHandler(t,e){this._handlers[t]=e}setCursorRect(t,e,i,n){return this._cursorSprite.setCursorRect(t,e,i,n)}showCursor(){this._cursorSprite.show(!0)}selectItem(t,e=!1){const i=this.getItem(t);this.setupIndex(t),this.refreshAll(),e&&this.playCursorSound(),i&&DKTools.Utils.isFunction(i.selectHandler)&&i.selectHandler(t,this),this.updateSelectEvents()}selectSymbol(t){const e=Math.max(0,this.findSymbol(t));this.selectItem(e)}selectExt(t){const e=Math.max(0,this.findExt(t));this.selectItem(e)}selectPrevItem(t=!1,e=!1){const i=this.getPrevIndex(t);i>=0&&this.selectItem(i,e)}selectNextItem(t=!1,e=!1){const i=this.getNextIndex(t);i>=0&&this.selectItem(i,e)}selectLastItem(t=!1){this.selectItem(this.getMaxItems()-1,t)}scrollDown(){this.getTopRow()+1<this.getMaxRows()&&this.cursorDown()}scrollUp(){this.getCurrentRow()>0&&this.cursorUp()}scrollRight(){this.getTopCol()+1<this.getMaxItems()&&this.cursorRight()}scrollLeft(){this.getCurrentCol()>0&&this.cursorLeft()}updateAll(){DKTools.Sprite.Button.prototype.updateAll.call(this),this.updateCursor()}updateCursor(){if(this.isHorizontal()){const t=this.getCurrentCol();t<this.getTopCol()?this.setTopCol(t):t>this.getBottomCol()&&this.setBottomCol(t)}else{const t=this.getCurrentRow();t<this.getTopRow()?this.setTopRow(t):t>this.getBottomRow()&&this.setBottomRow(t)}if(this.isCursorAll()){const t=this.getMaxRows()*this.getItemHeight();this.setCursorRect(0,0,this.realWidth,t),this.resetScroll()}else if(this.isCursorVisible()||!this._cursorSprite.hasBitmap()){const t=this.getItemRect(this._index);this.setCursorRect(t)}else this.setCursorRect(Rectangle.emptyRectangle)}updateSelectEvents(){this.updateEventsContainer("select")}},Object.defineProperties(DKTools.Sprite.Selectable.prototype,{cursorSprite:{get:function(){return this._cursorSprite},configurable:!0},lastIndex:{get:function(){return this._lastIndex},configurable:!0},index:{get:function(){return this._index},configurable:!0},maxCols:{get:function(){return this._maxCols},configurable:!0},cursorFixed:{get:function(){return this._cursorFixed},configurable:!0},cursorAll:{get:function(){return this._cursorAll},configurable:!0},cursorDownHandler:{get:function(){return this._cursorDownHandler},configurable:!0},cursorUpHandler:{get:function(){return this._cursorUpHandler},configurable:!0},cursorRightHandler:{get:function(){return this._cursorRightHandler},configurable:!0},cursorLeftHandler:{get:function(){return this._cursorLeftHandler},configurable:!0},cursorPageDownHandler:{get:function(){return this._cursorPageDownHandler},configurable:!0},cursorPageUpHandler:{get:function(){return this._cursorPageUpHandler},configurable:!0},horizontalSpacing:{get:function(){return this._horizontalSpacing},configurable:!0},verticalSpacing:{get:function(){return this._verticalSpacing},configurable:!0},textPadding:{get:function(){return this._textPadding},configurable:!0},items:{get:function(){return this._items},configurable:!0},itemDrawHandler:{get:function(){return this._itemDrawHandler},configurable:!0},itemWidth:{get:function(){return this._itemWidth},configurable:!0},itemHeight:{get:function(){return this._itemHeight},configurable:!0},itemFont:{get:function(){return this._itemFont},configurable:!0},itemTextColor:{get:function(){return this._itemTextColor},configurable:!0},itemPaintOpacity:{get:function(){return this._itemPaintOpacity},configurable:!0},itemAlign:{get:function(){return this._itemAlign},configurable:!0}}),DKTools.Sprite.ProgressBar=class extends DKTools.Sprite{addValue(t){t&&this.setValue(this._value+t)}aimateFull(t){return this.animateValue(this._maxValue,t)}animateEmpty(t){return this.animateValue(0,t)}animateValue(t,e){return this.addEvent({type:"update",repeatTime:e,repeats:0,onUpdate:this._updateAnimateValue.bind(this,t)})}canCloneFixedBitmap(){return!1}_drawProgressGraphic(){this.hasDrawGraphicHandler()&&this._drawGraphicHandler(this)}_drawProgressText(){this.hasDrawTextHandler()&&this._drawTextHandler(this)}drawAll(){DKTools.Sprite.prototype.drawAll.call(this),this.drawProgress()}drawProgress(){this._drawProgressGraphic(),this._drawProgressText()}getNextValue(){return Math.min(this._value+this._valueStep,this._maxValue)}getPercents(){return Math.ceil(this._value/this._maxValue*100)}getPrevValue(){return Math.max(0,this._value-this._valueStep)}hasDrawGraphicHandler(){return!!this._drawGraphicHandler}hasDrawTextHandler(){return!!this._drawTextHandler}isEmpty(){return 0===this._value}isFull(){return this._value===this._maxValue}isHorizontal(){return this.width>this.height}isVertical(){return!this.isHorizontal()}makeEmpty(){this.setValue(0)}makeFull(){this.setValue(this._maxValue)}nextValue(){return this.setValue(this.getNextValue())}prevValue(){return this.setValue(this.getPrevValue())}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setValueStep(t.valueStep,!0)&&n++,this.setMaxValue(t.maxValue,!0)&&n++,this.setValue(t.value,!0)&&n++,this.setBackgroundColor(t.backgroundColor,!0)&&n++,this.setProgressColor(t.progressColor,!0)&&n++,this.setDrawGraphicHandler(t.drawGraphicHandler,!0)&&n++,this.setDrawTextHandler(t.drawTextHandler,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setBackgroundColor(t,e=!1){if(this._backgroundColor===t)return!1;const i=this._backgroundColor;return this.setupBackgroundColor(t),this._backgroundColor!==i&&(e||this.refreshAll(),!0)}setDrawGraphicHandler(t,e=!1){return this._drawGraphicHandler!==t&&(this.setupDrawGraphicHandler(t),e||this.refreshAll(),!0)}setDrawTextHandler(t,e=!1){return this._drawTextHandler!==t&&(this.setupDrawTextHandler(t),e||this.refreshAll(),!0)}setMaxValue(t,e=!1){if(this._maxValue===t)return!1;const i=this._maxValue;return this.setupMaxValue(t),this._maxValue!==i&&(e||this.refreshAll(),!0)}setProgressColor(t,e=!1){if(this._progressColor===t)return!1;const i=this._progressColor;return this.setupProgressColor(t),this._progressColor!==i&&(e||this.refreshAll(),!0)}setValue(t,e=!1){if(this._value===t)return!1;const i=this._value;return this.setupValue(t),this._value!==i&&(e||this.refreshAll(),this.updateValueEvents(),!0)}setValueStep(t,e=!1){if(this._valueStep===t)return!1;const i=this._valueStep;return this.setupValueStep(t),this._valueStep!==i&&(e||this.refreshAll(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupValueStep(t.valueStep),this.setupMaxValue(t.maxValue),this.setupValue(t.value),this.setupBackgroundColor(t.progressColor),this.setupProgressColor(t.progressColor),this.setupDrawGraphicHandler(t.drawGraphicHandler),this.setupDrawTextHandler(t.drawTextHandler)}setupBackgroundColor(t){this._backgroundColor=t||this.standardBackgroundColor()}setupDrawGraphicHandler(t){this._drawGraphicHandler=t||this.standardDrawGraphicHandler()}setupDrawTextHandler(t){this._drawTextHandler=t||this.standardDrawTextHandler()}setupMaxValue(t){this._maxValue=t||this.standardMaxValue()}setupProgressColor(t){this._progressColor=t||this.standardProgressColor()}setupValue(t){const e=this._maxValue,i=Math.max(0,Math.min(t,e));this._value=_.defaultTo(i,this.standardValue())}setupValueStep(t){this._valueStep=t||this.standardValueStep()}standardActive(){return!1}standardBackgroundColor(){return"grey"}standardDrawGraphicHandler(){return null}standardDrawTextHandler(){return null}standardMaxValue(){return 100}standardProgressColor(){return"#33ccff"}standardValue(){return 0}standardValueStep(){return 1}subValue(t){this.addValue(-t)}_updateAnimateValue(t,e){const i=e.remainingTime,n=(this._value*(i-1)+t)/i;this.setValue(n)}updateEmptyEvents(){this.isEmpty()&&this.updateEventsContainer("empty")}updateEvents(){DKTools.Sprite.prototype.updateEvents.call(this),this.updateEmptyEvents(),this.updateFullEvents()}updateFullEvents(){this.isFull()&&this.updateEventsContainer("full")}updateValueEvents(){this.updateEventsContainer("value")}},Object.defineProperties(DKTools.Sprite.ProgressBar.prototype,{valueStep:{get:function(){return this._valueStep},configurable:!0},maxValue:{get:function(){return this._maxValue},configurable:!0},value:{get:function(){return this._value},configurable:!0},backgroundColor:{get:function(){return this._backgroundColor},configurable:!0},progressColor:{get:function(){return this._progressColor},configurable:!0},drawGraphicHandler:{get:function(){return this._drawGraphicHandler},configurable:!0},drawTextHandler:{get:function(){return this._drawTextHandler},configurable:!0}}),DKTools.Sprite.ProgressBar.Rectangle=class extends DKTools.Sprite.ProgressBar{standardDrawGraphicHandler(){return()=>{let t;t=this.isHorizontal()?this.standardHorizontalDrawGraphicHandler():this.standardVerticalDrawGraphicHandler(),DKTools.Utils.isFunction(t)&&t(this)}}standardDrawTextHandler(){return()=>{const t=`${this.getPercents()}%`;this.drawText(t,{height:this.realHeight})}}standardHorizontalDrawGraphicHandler(){return()=>{this.fillAll(this._backgroundColor),this.isEmpty()||this.fillRect({color:this._progressColor,width:this._value*this.realWidth/this._maxValue})}}standardVerticalDrawGraphicHandler(){return()=>{if(this.fillAll(this._backgroundColor),!this.isEmpty()){const t=this.realHeight,e=this._value*t/this._maxValue;this.fillRect({color:this._progressColor,y:t-e,width:this.realWidth,height:e})}}}},DKTools.Sprite.ProgressBar.Circle=class extends DKTools.Sprite.ProgressBar{setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.ProgressBar.prototype.setAll.call(this,t,!0);return this.setLineWidth(t.lineWidth,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setLineWidth(t,e=!1){if(this._lineWidth===t)return!1;const i=this._lineWidth;return this.setupLineWidth(t),this._lineWidth!==i&&(e||this.refreshAll(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.ProgressBar.prototype.setupAll.call(this,t),this.setupLineWidth(t.lineWidth)}setupLineWidth(t){this._lineWidth=t||this.standardLineWidth()}standardDrawGraphicHandler(){return()=>{const t=this._lineWidth,e=(this.realWidth-t)/2,i=e+t/2,n=i;this.strokeArc({x:i,y:n,radius:e,color:this._backgroundColor,lineWidth:t}),this.strokeArc({x:i,y:n,radius:e,startAngle:-Math.PI/2,endAngle:-Math.PI/2+2*Math.PI*this._value/this._maxValue,color:this._progressColor,lineWidth:t})}}standardDrawTextHandler(){return()=>{const t=`${this.getPercents()}%`;this.drawText(t,{height:this.realHeight})}}standardLineWidth(){return 10}},Object.defineProperties(DKTools.Sprite.ProgressBar.Circle.prototype,{lineWidth:{get:function(){return this._lineWidth},configurable:!0}}),DKTools.Sprite.ProgressBar.SemiCircle=class extends DKTools.Sprite.ProgressBar.Circle{standardDrawGraphicHandler(){return()=>{const t=this._lineWidth,e=(this.realWidth-t)/2,i=e+t/2,n=this.realHeight;this.strokeArc({x:i,y:n,radius:e,startAngle:Math.PI,color:this._backgroundColor,lineWidth:t}),this.strokeArc({x:i,y:n,radius:e,startAngle:Math.PI,endAngle:-Math.PI+Math.PI*this._value/this._maxValue,color:this._progressColor,lineWidth:t})}}},DKTools.Sprite.CheckBox=class extends DKTools.Sprite.Button{check(){this.isChecked()||(this.switch(),this.updateCheckedEvents())}isChecked(){return this._checked}_refreshCheckedGraphic(){let t=null;DKTools.Utils.isString(this._checkedGraphic)?t={folder:this._graphicFolder,filename:this._checkedGraphic}:this._checkedGraphic instanceof Object&&(t=this._checkedGraphic),t&&this.loadBitmap(t)}_refreshGraphic(){this.isChecked()?this._refreshCheckedGraphic():this._refreshUncheckedGraphic()}_refreshUncheckedGraphic(){let t=null;DKTools.Utils.isString(this._uncheckedGraphic)?t={folder:this._graphicFolder,filename:this._uncheckedGraphic}:this._uncheckedGraphic instanceof Object&&(t=this._uncheckedGraphic),t&&this.loadBitmap(t)}refreshAll(){this._refreshGraphic(),DKTools.Sprite.Button.prototype.refreshAll.call(this)}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setChecked(t.checked,!0)&&n++,this.setCheckedGraphic(t.checkedGraphic,!0)&&n++,this.setUncheckedGraphic(t.uncheckedGraphic,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setChecked(t,e=!1){if(this._checked===t)return!1;const i=this._checked;return this.setupChecked(t),this._checked!==i&&(e||this.refreshAll(),!0)}setCheckedGraphic(t,e=!1){const i=this._checkedGraphic;if(i==t)return!1;if(i instanceof Bitmap)this.setupCheckedGraphic(t);else{if(!(DKTools.Utils.isString(i)||i instanceof Object))return!1;{const e=i;if(this.setupCheckedGraphic(t),_.isEqual(this._checkedGraphic,e))return!1}}return e||this.refreshAll(),!0}setUncheckedGraphic(t,e=!1){const i=this._uncheckedGraphic;if(i==t)return!1;if(i instanceof Bitmap)this.setupUncheckedGraphic(t);else{if(!(DKTools.Utils.isString(i)||i instanceof Object))return!1;{const e=i;if(this.setupUncheckedGraphic(t),_.isEqual(this._uncheckedGraphic,e))return!1}}return e||this.refreshAll(),!0}setupAll(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupChecked(t.checked),this.setupCheckedGraphic(t.checkedGraphic),this.setupUncheckedGraphic(t.uncheckedGraphic)}setupChecked(t){this._checked=_.defaultTo(t,this.standardChecked())}setupCheckedGraphic(t){this._checkedGraphic=t||this.standardCheckedGraphic()}setupUncheckedGraphic(t){this._uncheckedGraphic=t||this.standardUncheckedGraphic()}standardChecked(){return!1}standardCheckedGraphic(){return null}standardUncheckedGraphic(){return null}switch(){this.setChecked(!this.isChecked())}uncheck(){this.isChecked()&&(this.switch(),this.updateUncheckedEvents())}updateCheckedEvents(){this.updateEventsContainer("checked")}updateMouseClickEvents(t){this.switch(),DKTools.Sprite.Button.prototype.updateMouseClickEvents.call(this,t)}updateUncheckedEvents(){this.updateEventsContainer("unchecked")}},Object.defineProperties(DKTools.Sprite.CheckBox.prototype,{checked:{get:function(){return this._checked},configurable:!0},checkedGraphic:{get:function(){return this._checkedGraphic},configurable:!0},uncheckedGraphic:{get:function(){return this._uncheckedGraphic},configurable:!0}}),DKTools.Viewport=class extends DKTools.Sprite{canCloneFixedBitmap(){return!1}createAll(){DKTools.Sprite.prototype.createAll.call(this),this.createMask()}createMask(){DKTools.Sprite.prototype.createMask.call(this,this._maskShape)}setAll(t={},e=!1,i=!1){t=t||{};let n=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setMaskShape(t.maskShape,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setMaskShape(t,e=!1){if(this._maskShape===t)return!1;const i=this._maskShape;return this.setupShape(t),this._maskShape!==i&&(e||this.start(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupMaskShape(t.maskShape)}setupMaskShape(t){this._maskShape=t||this.standardMaskShape()}standardMaskShape(){return"rect"}},Object.defineProperties(DKTools.Viewport.prototype,{maskShape:{get:function(){return this._maskShape},configurable:!0}}),DKTools.Layout=class extends DKTools.Sprite{activateItems(t=!1){this.iterateItems(t=>{t.activate()},t)}addAllChildren(){DKTools.Sprite.prototype.addAllChildren.call(this),this.addAllItems()}addAllItems(){this.hasItems()&&this.addChild.apply(this,this._items)}addCol(){this.addCols(1)}addCols(t){this.setMaxCols(this.getMaxCols()+t)}addItem(t,e=!1){return t instanceof DKTools.Sprite?(this._items.push(t),e||this.start(),t):null}addItems(t,e=!1){const i=_.map(t,t=>this.addItem(t,!0));return i.length>0&&!e&&this.start(),i}alignCol(t){_.forEach(this.getItemsInCol(t),this.alignItem.bind(this))}alignItem(t){if(this.isReady()){const e=this.getItemRow(t),i=this.getItemCol(t),n=this.getRowHeight(e),s=this.getColWidth(i),r=this.getColX(i)+(s-t.width)/2,o=this.getRowY(e)+(n-t.height)/2;t.move(r,o)}else this.addOneTimeEvent({type:"ready",onSuccess:this.alignItem.bind(this,t)})}alignItems(){this.addOneTimeEvent({type:"ready",onSuccess:()=>{this.iterateItems(this.alignItem.bind(this))}})}alignRow(t){_.forEach(this.getItemsInRow(t),this.alignItem.bind(this))}_clearAll(){DKTools.Sprite.prototype._clearAll.call(this),this._clearItems()}_clearItems(){this._items=[]}canCloneFixedBitmap(){return!1}clearItems(t=!1){this.removeAllItems(),this._clearItems(),t||this.start()}deactivateItems(t=!1){this.iterateItems(t=>{t.deactivate()},t)}_getBitmapHeight(){let t=0;const e=this.getMaxRows();for(let i=1;i<=e;i++)t+=this.getRowHeight(i)+this._verticalSpacing;return t-this._verticalSpacing}_getBitmapWidth(){let t=0;const e=this.getMaxCols();for(let i=1;i<=e;i++)t+=this.getColWidth(i)+this._horizontalSpacing;return t-this._horizontalSpacing}getCell(t,e){const i=this.getMaxCols()*(t-1)+(e-1);return{item:this.getItem(i),x:this.getColX(e),y:this.getRowY(t),width:this.getColWidth(e),height:this.getRowHeight(t)}}getColWidth(t){return DKTools.Utils.isFunction(this._colWidth)?this._colWidth(t,this):this._colWidth}getColX(t){let e=0;for(let i=1;i<t;i++)e+=this.getColWidth(i)+this._horizontalSpacing;return e}getItem(t){return this.getItems()[t]}getItemCol(t){const e=this.getItemIndex(t);return e>=0?e%this.getMaxCols()+1:-1}getItemIndex(t){return _.indexOf(this.getItems(),t)}getItemRow(t){const e=this.getItemIndex(t);return e>=0?Math.floor(e/this.getMaxCols())+1:-1}getItems(){return this.isInverted()?_.reverse(_.clone(this._items)):this._items}getItemsInCol(t){const e=[],i=this.getMaxRows(),n=this.getMaxCols();if(t<1||t>n)return e;const s=t-1;for(let t=0;t<i;t++)e.push(this.getItem(s+n*t));return e}getItemsInRow(t){const e=[],i=this.getMaxCols();if(t<1||t>this.getMaxRows())return e;const n=i*(t-1);for(let t=0;t<i;t++)e.push(this.getItem(n+t));return e}getMaxCols(){return this._maxCols}getMaxItems(){return this._items.length}getMaxRows(){return Math.max(1,Math.ceil(this.getMaxItems()/this.getMaxCols()))}getRowHeight(t){return DKTools.Utils.isFunction(this._rowHeight)?this._rowHeight(t,this):this._rowHeight}getRowY(t){let e=0;for(let i=1;i<t;i++)e+=this.getRowHeight(i)+this._verticalSpacing;return e}hasItem(t){return this.getItemIndex(t)>=0}hasItems(){return!this.isEmpty()}hideItems(t=!1,e=!1){this.iterateItems(e=>{e.hide(t)},e)}insertItem(t,e,i=!1){return t instanceof DKTools.Sprite?(DKTools.Utils.Array.insert(this._items,t,e),i||this.start(),t):null}insertItems(t,e,i=!1){e=e||0;const n=_.map(t,(t,i)=>this.insertItem(t,e+i,!0));return n.length>0&&!i&&this.start(),n}invert(){this.setInverted(!this.isInverted())}isEmpty(){return 0===this.getMaxItems()}isHorizontal(){return 1===this.getMaxRows()}isInverted(){return this._inverted}isReady(){return this.isEmpty()||_.every(this._items,t=>t.isReady())}isVertical(){return 1===this.getMaxCols()}iterateItems(t,e=!1){_.forEach(this.getItems(),t),e&&this.start()}moveItem(t,e,i){const n=this.getItem(t);n&&n.move(e,i)}removeAllChildren(){DKTools.Sprite.prototype.removeAllChildren.call(this),this.removeAllItems()}removeAllItems(){this.hasItems()&&this.removeChild.apply(this,this._items)}removeCol(){this.removeCols(1)}removeCols(t){this.getMaxCols()-t>=1&&this.addCols(-t)}removeItem(t,e=!1){return Number.isFinite(t)&&(t=this.getItem(t)),this.hasItem(t)?(this.removeChild(t),DKTools.Utils.Array.remove(this._items,t),e||this.start(),t):null}removeItems(t,e=!1){const i=_.map(t,t=>this.removeItem(t,!0));return i.length>0&&!e&&this.start(),i}resizeItem(t,e,i,n=!1){Number.isFinite(t)&&(t=this.getItem(t)),this.hasItem(t)&&t.resize(e,i)&&(n||this.start())}resizeItems(t,e,i=!1){this.iterateItems(i=>{this.resizeItem(i,t,e,!0)},!i)}setAll(t,e=!1,i=!1){t=t||{};let n=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setMaxCols(t.maxCols,!0)&&n++,n+=this.setSpacing(t.horizontalSpacing,t.verticalSpacing,!0),this.setItems(t.items,!0)&&n++,this.setRowHeight(t.rowHeight,!0)&&n++,this.setColWidth(t.colWidth,!0)&&n++,this.setInverted(t.reversed,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n}setColWidth(t,e=!1){if(this._colWidth===t)return!1;const i=this._colWidth;return this.setupColWidth(t),this._colWidth!==i&&(e||this.start(),!0)}setHorizontalSpacing(t,e=!1){if(this._horizontalSpacing===t)return!1;const i=this._horizontalSpacing;return this.setupHorizontalSpacing(t),this._horizontalSpacing!==i&&(e||this.start(),!0)}setInverted(t,e=!1){if(this._inverted===t)return!1;const i=this._inverted;return this.setupInverted(t),this._inverted!==i&&(e||this.start(),!0)}setItems(t,e=!1){return this._items!=t&&(this.removeAllItems(),this.setupItems(t),e||this.start(),!0)}setMaxCols(t,e=!1){if(this._maxCols===t)return!1;const i=this._maxCols;return this.setupMaxCols(t),this._maxCols!==i&&(e||this.start(),!0)}setRowHeight(t,e=!1){if(this._rowHeight===t)return!1;const i=this._rowHeight;return this.setupRowHeight(t),this._rowHeight!==i&&(e||this.start(),!0)}setSpacing(t,e,i=!1){let n=0;return this.setHorizontalSpacing(t,!0)&&n++,this.setVerticalSpacing(e,!0)&&n++,n>0&&!i&&this.start(),n}setVerticalSpacing(t,e=!1){if(this._verticalSpacing===t)return!1;const i=this._verticalSpacing;return this.setupVerticalSpacing(t),this._verticalSpacing!==i&&(e||this.start(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupMaxCols(t.maxCols),this.setupSpacing(t.horizontalSpacing,t.verticalSpacing),this.setupItems(t.items),this.setupRowHeight(t.rowHeight),this.setupColWidth(t.colWidth),this.setupInverted(t.inverted)}setupColWidth(t){this._colWidth=t||this.standardColWidth()}setupHorizontalSpacing(t){this._horizontalSpacing=_.defaultTo(t,this.standardHorizontalSpacing())}setupInverted(t){this._inverted=_.defaultTo(t,this.standardInverted())}setupItems(t){this._items=_.clone(t||this.standardItems())}setupMaxCols(t){this._maxCols=_.defaultTo(t,this.standardMaxCols())}setupRowHeight(t){this._rowHeight=t||this.standardRowHeight()}setupSpacing(t,e){this.setupHorizontalSpacing(t),this.setupVerticalSpacing(e)}setupVerticalSpacing(t){this._verticalSpacing=_.defaultTo(t,this.standardVerticalSpacing())}showItems(t=!1,e=!1){this.iterateItems(e=>{e.show(t)},e)}standardActive(){return!1}standardColWidth(){return t=>{const e=this.getItemsInCol(t);return _.max(_.map(e,"width"))}}standardHorizontalSpacing(){return 12}standardInverted(){return!1}standardItems(){return[]}standardMaxCols(){return 1}standardRowHeight(){return t=>{const e=this.getItemsInRow(t);return _.max(_.map(e,"height"))}}standardVerticalSpacing(){return this.getLineHeight()/2}start(){this._started=!0,this.isReady()?DKTools.Sprite.prototype.start.call(this):this.addOneTimeEvent({type:"ready",onSuccess:this.start.bind(this)})}startItems(t=!1,e=!1){this.iterateItems(e=>{e.start(t)},!e)}updateAll(){DKTools.Sprite.prototype.updateAll.call(this),this.updateLayout()}updateLayout(){const t=this.getMaxItems(),e=this.getMaxRows(),i=this.getMaxCols();let n=0;for(let s=1;s<=e&&n<t;s++)for(let e=1;e<=i&&n<t;e++){const t=this.getColX(e),i=this.getRowY(s);this.moveItem(n++,t,i)}}},Object.defineProperties(DKTools.Layout.prototype,{maxCols:{get:function(){return this._maxCols},configurable:!0},items:{get:function(){return this._items},configurable:!0},rowHeight:{get:function(){return this._rowHeight},configurable:!0},colWidth:{get:function(){return this._colWidth},configurable:!0},horizontalSpacing:{get:function(){return this._horizontalSpacing},configurable:!0},verticalSpacing:{get:function(){return this._verticalSpacing},configurable:!0},inverted:{get:function(){return this._inverted},configurable:!0}}),DKTools.Window.prototype=Object.create(Window_Base.prototype),DKTools.Utils.mixin(DKTools.Window.prototype,DKTools.Base.prototype),DKTools.Window.prototype.constructor=DKTools.Window,Object.defineProperties(DKTools.Window.prototype,{realWidth:{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0},realHeight:{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0},width:{get:function(){return this.realWidth*this.scale.x},set:function(t){this._width=Math.floor(t/this.scale.x),this._refreshAllParts()},configurable:!0},height:{get:function(){return this.realHeight*this.scale.y},set:function(t){this._height=Math.floor(t/this.scale.y),this._refreshAllParts()},configurable:!0},origin:{get:function(){return this._origin},configurable:!0},windowOpacity:{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},configurable:!0},frameOpacity:{get:function(){return 255*this._windowFrameSprite.alpha},set:function(t){this._windowFrameSprite.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},configurable:!0},opacity:{get:function(){return this._opacity},configurable:!0},tone:{get:function(){return this._tone},configurable:!0},contentsSprite:{get:function(){return this._windowContentsSprite},configurable:!0},frameSprite:{get:function(){return this._windowFrameSprite},configurable:!0},backSprite:{get:function(){return this._windowBackSprite},configurable:!0},bitmap:{get:function(){return this.contents},set:function(t){this.contents=t},configurable:!0},arrows:{get:function(){return this._arrows},configurable:!0}}),DKTools.Window.prototype.initialize=function(t,e,i,n){PIXI.Container.call(this),DKTools.Base.prototype.initialize.call(this,t,e,i,n)},DKTools.Window.prototype._addAllChildren=function(){DKTools.Base.prototype._addAllChildren.call(this),this._addAllParts()},DKTools.Window.prototype._addAllParts=function(){this._addSpriteContainer(),this._addPauseSignSprite(),this._addArrows()},DKTools.Window.prototype._addSpriteContainer=function(){this.hasSpriteContainer()&&(this.hasBackSprite()&&this._windowSpriteContainer.addChild(this._windowBackSprite),this.hasFrameSprite()&&this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowSpriteContainer))},DKTools.Window.prototype._addContentsSprite=function(){this.hasContentsSprite()&&this.addChild(this._windowContentsSprite)},DKTools.Window.prototype._addPauseSignSprite=function(){this.hasPauseSignSprite()&&this.addChild(this._windowPauseSignSprite)},DKTools.Window.prototype._addArrows=function(){_.forEach(["up","down","left","right"],t=>{const e=this.findArrow(t);e&&this.addChild(e)})},DKTools.Window.prototype.activate=function(){DKTools.Base.prototype.activate.call(this),this.hasContentsSprite()&&this._windowContentsSprite.activate()},DKTools.Window.prototype.addAllChildren=function(){DKTools.Base.prototype.addAllChildren.call(this),this.addContentsSprite()},DKTools.Window.prototype.addContentsSprite=function(){this._addContentsSprite(),this._refreshContents()},DKTools.Window.prototype._clearAll=function(){DKTools.Base.prototype._clearAll.call(this),this._clearIsWindow(),this._clearOpenness(),this._clearPadding(),this._clearMargin(),this._clearColorTone(),this._clearOrigin(),this._clearArrows()},DKTools.Window.prototype._clearIsWindow=function(){this._isWindow=!0},DKTools.Window.prototype._clearOpenness=function(){this._openness=this.standardOpenness()},DKTools.Window.prototype._clearPadding=function(){this._padding=this.standardPadding()},DKTools.Window.prototype._clearMargin=function(){this._margin=this.standardMargin()},DKTools.Window.prototype._clearColorTone=function(){this._colorTone=this.standardTone()},DKTools.Window.prototype._clearOrigin=function(){this._origin=this.standardOrigin()},DKTools.Window.prototype._clearArrows=function(){this._arrows=[]},DKTools.Window.prototype._createAll=function(){DKTools.Base.prototype._createAll.call(this),this._createAllParts(),this._createWindowskin()},DKTools.Window.prototype._createAllParts=function(){this._createSpriteContainer(),this._createBackSprite(),this._createFrameSprite(),this._createPauseSignSprite(),this._createArrows()},DKTools.Window.prototype._createSpriteContainer=function(){this._windowSpriteContainer=new PIXI.Container},DKTools.Window.prototype._createBackSprite=function(){this.needsCreateBackSprite()&&(this._windowBackSprite=new Sprite,this._windowBackSprite.opacity=this.standardBackOpacity(),this._windowBackSprite.visible=this.standardBackVisible())},DKTools.Window.prototype._createFrameSprite=function(){this.needsCreateFrameSprite()&&(this._windowFrameSprite=new Sprite,this._windowFrameSprite.visible=this.standardFrameVisible())},DKTools.Window.prototype._createPauseSignSprite=function(){this.needsCreatePauseSignSprite()&&(this._windowPauseSignSprite=new Sprite)},DKTools.Window.prototype._createArrows=function(){this.needsCreateArrowsSprites()&&(this.needsCreateUpArrowSprite()&&this.createArrow("up","up",{onUpdate:this.onUpArrowUpdate.bind(this),onMouseClick:this.onUpArrowMouseClick.bind(this),onMouseLongPress:this.onUpArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateDownArrowSprite()&&this.createArrow("down","down",{onUpdate:this.onDownArrowUpdate.bind(this),onMouseClick:this.onDownArrowMouseClick.bind(this),onMouseLongPress:this.onDownArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateLeftArrowSprite()&&this.createArrow("left","left",{onUpdate:this.onLeftArrowUpdate.bind(this),onMouseClick:this.onLeftArrowMouseClick.bind(this),onMouseLongPress:this.onLeftArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateRightArrowSprite()&&this.createArrow("right","right",{onUpdate:this.onRightArrowUpdate.bind(this),onMouseClick:this.onRightArrowMouseClick.bind(this),onMouseLongPress:this.onRightArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}))},DKTools.Window.prototype._createWindowskin=function(){this.windowskin=DKTools.Utils.Bitmap.load({folder:"img/system",filename:this.standardWindowskin()})},DKTools.Window.prototype.canRedrawAll=function(){return this.hasContentsSprite()&&DKTools.Base.prototype.canRedrawAll.call(this)},DKTools.Window.prototype.changeFont=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changeFont(t)},DKTools.Window.prototype.changeTextColor=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changeTextColor(t)},DKTools.Window.prototype.changePaintOpacity=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changePaintOpacity(t)},DKTools.Window.prototype.checkSize=function(){const t=this.getMinWidth(),e=this.getMinHeight();let i=0;return this._width<t&&(this.setupWidth(t),i++),this._height<e&&(this.setupHeight(e),i++),i},DKTools.Window.prototype.createArrow=function(t,e,i={}){const n=new DKTools.Sprite.Arrow({...i,id:e,arrowType:t});return n.start(),n.addEvent({type:"update",onUpdate:t=>{this.isOpenAndVisible()?n.show():n.hide(),DKTools.Utils.isFunction(i.onUpdate)&&i.onUpdate(t)}}),DKTools.Utils.isFunction(i.onMouseDown)&&n.addEvent({type:"mouse-down-left",onUpdate:i.onMouseDown}),DKTools.Utils.isFunction(i.onMouseUp)&&n.addEvent({type:"mouse-up-left",onUpdate:i.onMouseUp}),DKTools.Utils.isFunction(i.onMouseClick)&&n.addEvent({type:"mouse-click-left",onUpdate:i.onMouseClick}),DKTools.Utils.isFunction(i.onMouseLongPress)&&n.addEvent({type:"mouse-long-press-left",onUpdate:i.onMouseLongPress}),DKTools.Utils.isFunction(i.onMouseLongPressStarted)&&n.addEvent({type:"mouse-long-press-left-started",onUpdate:i.onMouseLongPressStarted}),DKTools.Utils.isFunction(i.onMouseLongPressFinished)&&n.addEvent({type:"mouse-long-press-left-finished",onUpdate:i.onMouseLongPressFinished}),DKTools.Utils.isFunction(i.onStateNormal)&&n.addEvent({type:"state-normal",onUpdate:i.onStateNormal}),DKTools.Utils.isFunction(i.onStatePressed)&&n.addEvent({type:"state-pressed",onUpdate:i.onStatePressed}),this._arrows.push(n),this.addChild(n),n},DKTools.Window.prototype.deactivate=function(){DKTools.Base.prototype.deactivate.call(this),this.hasContentsSprite()&&this._windowContentsSprite.deactivate()},DKTools.Window.prototype.drawText=function(t,e){return!!this.hasContentsSprite()&&this._windowContentsSprite.drawText(t,e)},DKTools.Window.prototype.findArrow=function(t){return _.find(this._arrows,{id:t})},DKTools.Window.prototype.getMinWidth=function(){return 2*this.standardPadding()+DKTools.Base.prototype.getMinWidth.call(this)},DKTools.Window.prototype.getMinHeight=function(){return 2*this.standardPadding()+DKTools.Base.prototype.getMinHeight.call(this)},DKTools.Window.prototype.getContentsWidth=function(){return DKTools.Utils.isFunction(this._contentsWidth)?this._contentsWidth(this):this._contentsWidth},DKTools.Window.prototype.getContentsHeight=function(){return DKTools.Utils.isFunction(this._contentsHeight)?this._contentsHeight(this):this._contentsHeight},DKTools.Window.prototype.getContentsSize=function(){return{width:this.getContentsWidth(),height:this.getContentsHeight()}},DKTools.Window.prototype.getCurrentOpacity=function(){return this.windowOpacity},DKTools.Window.prototype.hasBitmap=function(){return!!this.hasContentsSprite()&&this._windowContentsSprite.hasBitmap()},DKTools.Window.prototype.hasSpriteContainer=function(){return!!this._windowSpriteContainer},DKTools.Window.prototype.hasBackSprite=function(){return!!this._windowBackSprite},DKTools.Window.prototype.hasFrameSprite=function(){return!!this._windowFrameSprite},DKTools.Window.prototype.hasContentsSprite=function(){return!!this._windowContentsSprite},DKTools.Window.prototype.hasArrow=function(t){return!!this.findArrow(t)},DKTools.Window.prototype.hasArrowSprites=function(){return this.hasUpArrowSprite()&&this.hasDownArrowSprite()&&this.hasLeftArrowSprite()&&this.hasRightArrowSprite()},DKTools.Window.prototype.hasUpArrowSprite=function(){return this.hasArrow("up")},DKTools.Window.prototype.hasDownArrowSprite=function(){return this.hasArrow("down")},DKTools.Window.prototype.hasLeftArrowSprite=function(){return this.hasArrow("left")},DKTools.Window.prototype.hasRightArrowSprite=function(){return this.hasArrow("right")},DKTools.Window.prototype.hasPauseSignSprite=function(){return!!this._windowPauseSignSprite},DKTools.Window.prototype.hasBackgroundDimmer=function(){return!!this._dimmerSprite},DKTools.Window.prototype.hideBack=function(){this.hasBackSprite()&&(this._windowBackSprite.visible=!1)},DKTools.Window.prototype.hideContents=function(){this.hasContentsSprite()&&this._windowContentsSprite.hide()},DKTools.Window.prototype.hideFrame=function(){this.hasFrameSprite()&&(this._windowFrameSprite.visible=!1)},DKTools.Window.prototype.isOpenAndVisible=function(){return this.isOpen()&&this.isVisible()},DKTools.Window.prototype.isOpenAndActive=function(){return this.isOpen()&&this.isActive()},DKTools.Window.prototype.isInside=function(t,e){const i=this.canvasToLocalX(t),n=this.canvasToLocalY(e);return new Rectangle(0,0,this.width,this.height).contains(i,n)},DKTools.Window.prototype.needsCreateBackSprite=function(){return!0},DKTools.Window.prototype.needsCreateFrameSprite=function(){return!0},DKTools.Window.prototype.needsCreateArrowsSprites=function(){return!1},DKTools.Window.prototype.needsCreateDownArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateUpArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateLeftArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateRightArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreatePauseSignSprite=function(){return!0},DKTools.Window.prototype.onUpArrowUpdate=function(t){},DKTools.Window.prototype.onDownArrowUpdate=function(t){},DKTools.Window.prototype.onLeftArrowUpdate=function(t){},DKTools.Window.prototype.onRightArrowUpdate=function(t){},DKTools.Window.prototype.onUpArrowMouseClick=function(t){},DKTools.Window.prototype.onDownArrowMouseClick=function(t){},DKTools.Window.prototype.onLeftArrowMouseClick=function(t){},DKTools.Window.prototype.onRightArrowMouseClick=function(t){},DKTools.Window.prototype.onUpArrowMouseLongPress=function(t){},DKTools.Window.prototype.onDownArrowMouseLongPress=function(t){},DKTools.Window.prototype.onLeftArrowMouseLongPress=function(t){},DKTools.Window.prototype.onRightArrowMouseLongPress=function(t){},DKTools.Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshContents(),this._refreshPauseSign(),this._refreshArrows()},DKTools.Window.prototype._refreshBack=function(){this.hasBackSprite()&&Window.prototype._refreshBack.call(this)},DKTools.Window.prototype._refreshFrame=function(){this.hasFrameSprite()&&Window.prototype._refreshFrame.call(this)},DKTools.Window.prototype._refreshContents=function(){if(this.hasContentsSprite()){let t=this._contentsPosition;DKTools.Utils.isFunction(t)&&(t=t(this)),this._windowContentsSprite.move(t)}},DKTools.Window.prototype._refreshPauseSign=function(){this.hasPauseSignSprite()&&Window.prototype._refreshPauseSign.call(this)},DKTools.Window.prototype._refreshArrows=function(){const t={up:this.standardUpArrowPosition(),down:this.standardDownArrowPosition(),left:this.standardLeftArrowPosition(),right:this.standardRightArrowPosition()};_.forEach(t,(t,e)=>{const i=this.findArrow(e);i&&i.move(t)})},DKTools.Window.prototype.redrawAll=function(){this.hasContentsSprite()&&this._windowContentsSprite.redrawAll()},DKTools.Window.prototype.refreshAll=function(){this._refreshAllParts(),DKTools.Base.prototype.refreshAll.call(this)},DKTools.Window.prototype.refreshArrows=function(){_.forEach(this._arrows,t=>{t.refreshAll()})},DKTools.Window.prototype.removeAllChildren=function(){DKTools.Base.prototype.removeAllChildren.call(this),this.removeContentsSprite()},DKTools.Window.prototype.removeContentsSprite=function(){this.hasContentsSprite()&&this.removeChild(this._windowContentsSprite)},DKTools.Window.prototype.removeArrow=function(t){const e=this.findArrow(t);e&&(DKTools.Utils.Array.remove(this._arrows,e),this.removeChild(e))},DKTools.Window.prototype.resetAll=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetAll()},DKTools.Window.prototype.resetFont=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetFont()},DKTools.Window.prototype.resetTextColor=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetTextColor()},DKTools.Window.prototype.resetPaintOpacity=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetPaintOpacity()},DKTools.Window.prototype.resize=function(t,e,i=!1,n=!1){if(t=_.defaultTo(t,this.getMinWidth()),e=_.defaultTo(e,this.getMinHeight()),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),this._width===t&&this._height===e)return!1;const s=this._width,r=this._height;return this.setupSize(t,e),(this._width!==s||this._height!==r)&&(i||this.start(),n&&this.activate(),!0)},DKTools.Window.prototype.standardOpenness=function(){return 255},DKTools.Window.prototype.standardOpennessSpeed=function(){return 16},DKTools.Window.prototype.standardMargin=function(){return 4},DKTools.Window.prototype.standardOrigin=function(){return new Point(0,0)},DKTools.Window.prototype.standardUpArrowPosition=function(){return new Point(this._width/2,12)},DKTools.Window.prototype.standardDownArrowPosition=function(){return new Point(this._width/2,this._height-12)},DKTools.Window.prototype.standardLeftArrowPosition=function(){return new Point(12,this._height/2)},DKTools.Window.prototype.standardRightArrowPosition=function(){return new Point(this._width-12,this._height/2)},DKTools.Window.prototype.standardArrowStateNormal=function(){return t=>{const e=t.target;e.setScale(1,1),e.setOpacity(255)}},DKTools.Window.prototype.standardArrowStatePressed=function(){return t=>{const e=t.target;e.setScale(.9,.9),e.setOpacity(160)}},DKTools.Window.prototype.standardContentsSprite=function(){return new DKTools.Sprite},DKTools.Window.prototype.standardChildX=function(){return this._padding},DKTools.Window.prototype.standardChildY=function(){return this._padding},DKTools.Window.prototype.standardChildPosition=function(){return()=>new Point(this.standardChildX(),this.standardChildY())},DKTools.Window.prototype.standardContentsPosition=function(){return this.standardChildPosition()},DKTools.Window.prototype.standardBackVisible=function(){return!0},DKTools.Window.prototype.standardFrameVisible=function(){return!0},DKTools.Window.prototype.standardContentsWidth=function(){return()=>this._width-2*this._padding},DKTools.Window.prototype.standardContentsHeight=function(){return()=>this._height-2*this._padding},DKTools.Window.prototype.standardWindowOpacity=function(){return 255},DKTools.Window.prototype.standardContentsOpacity=function(){return 255},DKTools.Window.prototype.standardFrameOpacity=function(){return 255},DKTools.Window.prototype.standardOpacity=function(){return{windowOpacity:this.standardWindowOpacity(),contentsOpacity:this.standardContentsOpacity(),frameOpacity:this.standardFrameOpacity(),backOpacity:this.standardBackOpacity()}},DKTools.Window.prototype.standardTone=function(){try{return _.clone($gameSystem.windowTone())}catch(t){return[0,0,0]}},DKTools.Window.prototype.setupAll=function(t={}){t=t||{},DKTools.Base.prototype.setupAll.call(this,t);let e=t.contentsSprite;t instanceof DKTools.Window&&e instanceof DKTools.Sprite&&(e=e.clone({blockStart:!0})),this.setupPadding(t.padding),this.setupMargin(t.margin),this.setupContentsWidth(t.contentsWidth),this.setupContentsHeight(t.contentsHeight),this.setupContentsSprite(e),this.setupContentsPosition(t.contentsPosition),this.setupOpacity(t.opacity),this.setupTone(t.tone)},DKTools.Window.prototype.setupWidth=function(t){this.realWidth=this._checkWidth(t)},DKTools.Window.prototype.setupHeight=function(t){DKTools.Utils.isString(t)&&(t=this.getLineHeight()*parseFloat(t)),this.realHeight=this._checkHeight(t)},DKTools.Window.prototype.setupSize=function(t,e){if(t instanceof Object)return this.setupSize(t.width,t.height);DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),t=this._checkWidth(t),e=this._checkHeight(e),Window.prototype.move.call(this,this.x,this.y,t,e)},DKTools.Window.prototype.setupPadding=function(t){this._padding=_.defaultTo(t,this.standardPadding())},DKTools.Window.prototype.setupMargin=function(t){this._margin=_.defaultTo(t,this.standardMargin())},DKTools.Window.prototype.setupContentsWidth=function(t){this._contentsWidth=t||this.standardContentsWidth()},DKTools.Window.prototype.setupContentsHeight=function(t){this._contentsHeight=t||this.standardContentsHeight()},DKTools.Window.prototype.setupContentsSprite=function(t){this._windowContentsSprite=t||this.standardContentsSprite()},DKTools.Window.prototype.setupContentsPosition=function(t,e){let i=t;DKTools.Utils.isFunction(t)||(i=DKTools.Utils.Point.tryToPoint(t,e)||this.standardContentsPosition()),this._contentsPosition=i},DKTools.Window.prototype.setupOpacity=function(t){this._opacity=Object.assign(this.standardOpacity(),t)},DKTools.Window.prototype.setupTone=function(t){this._tone=Object.assign(this.standardTone(),t)},DKTools.Window.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let n=DKTools.Base.prototype.setAll.call(this,t,!0);return this.setPadding(t.padding,!0)&&n++,this.setMargin(t.margin,!0)&&n++,this.setOpacity(t.opacity,!0)&&n++,this.setTone(t.tone,!0)&&n++,n>0&&(e||this.start(),i&&this.activate()),n},DKTools.Window.prototype.setWidth=function(t,e=!1,i=!1){return this.resize(t,this._height,e,i)},DKTools.Window.prototype.setHeight=function(t,e=!1,i=!1){return this.resize(this._width,t,e,i)},DKTools.Window.prototype.setPadding=function(t,e=!1){if(this._padding===t)return!1;const i=this._padding;return this.setupPadding(t),this._padding!==i&&(e||this.start(),!0)},DKTools.Window.prototype.setMargin=function(t,e=!1){if(this._margin===t)return!1;const i=this._margin;return this.setupMargin(padding),this._margin!==i&&(e||this.start(),!0)},DKTools.Window.prototype.setContentsSprite=function(t,e=!1,i=!1){return this._windowContentsSprite!=t&&(this.removeContentsSprite(),this.setupContentsSprite(t),this.addContentsSprite(),e||this.start(),i&&this.activate(),!0)},DKTools.Window.prototype.setContentsPosition=function(t,e){const i=DKTools.Utils.isFunction,n=i(this._contentsPosition),s=i(t);if(n||s){if(this._contentsPosition===t)return!1;this.setupContentsPosition(t,e)}else{const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this._contentsPosition,i))return!1;const n=DKTools.Utils.Point.clone(this._contentsPosition);if(this.setupContentsPosition(i),DKTools.Utils.Point.equals(this._contentsPosition,n))return!1}return this._refreshContents(),!0},DKTools.Window.prototype.setOpacity=function(t,e=!1){if(_.isEqual(this._opacity,Object.assign(this.standardOpacity(),t)))return!1;const i=_.clone(this._opacity);return this.setupOpacity(t),!_.isEqual(this._opacity,i)&&(e||this.updateOpacity(),!0)},DKTools.Window.prototype.setTone=function(t,e=!1){if(_.isEqual(this._tone,Object.assign(this.standardTone(),t)))return!1;const i=_.clone(this._tone);return this.setupTone(t),!_.isEqual(this._tone,i)&&(e||this.updateTone(),!0)},DKTools.Window.prototype.start=function(t=!1){if(this.hasContentsSprite()){const e=this._windowContentsSprite;e.resize(this.getContentsWidth(),this.getContentsHeight(),!0),e.start(t)}DKTools.Base.prototype.start.call(this,t)},DKTools.Window.prototype.showBack=function(){this.hasBackSprite()&&(this._windowBackSprite.visible=!0)},DKTools.Window.prototype.showContents=function(t=!1){this.hasContentsSprite()&&this._windowContentsSprite.show(t)},DKTools.Window.prototype.showFrame=function(){this.hasFrameSprite()&&(this._windowFrameSprite.visible=!0)},DKTools.Window.prototype._updateContents=function(){this.hasContentsSprite()&&Window.prototype._updateContents.call(this)},DKTools.Window.prototype._updatePauseSign=function(){this.hasPauseSignSprite()&&Window.prototype._updatePauseSign.call(this)},DKTools.Window.prototype.updateOpenEvents=function(){this.updateEventsContainer("open")},DKTools.Window.prototype.updateCloseEvents=function(){this.updateEventsContainer("close")},DKTools.Window.prototype.updateAll=function(){this.updateContents(),DKTools.Base.prototype.updateAll.call(this),this.updateTone()},DKTools.Window.prototype.updateContents=function(){this.hasContentsSprite()&&this._windowContentsSprite.updateAll()},DKTools.Window.prototype.updateTransform=function(){this._updateContents(),this._updatePauseSign(),PIXI.Container.prototype.updateTransform.call(this)},DKTools.Window.prototype.updateOpacity=function(t={}){t=t||{},this.hasSpriteContainer()&&(this.windowOpacity=_.defaultTo(t.windowOpacity,this.opacity.windowOpacity)),this.hasContentsSprite()&&(this.contentsOpacity=_.defaultTo(t.contentsOpacity,this.opacity.contentsOpacity)),this.hasFrameSprite()&&(this.frameOpacity=_.defaultTo(t.frameOpacity,this.opacity.frameOpacity)),this.hasBackSprite()&&(this.backOpacity=_.defaultTo(t.backOpacity,this.opacity.backOpacity))},DKTools.Window.prototype.updateTone=function(t){t=t||this.tone,this.hasBackSprite()&&Window.prototype.setTone.apply(this,t)},DKTools.Window.prototype.updateOpen=function(){this._opening&&(this.openness+=this.standardOpennessSpeed(),this.isOpen()&&(this._opening=!1,this.updateOpenEvents()))},DKTools.Window.prototype.updateClose=function(){this._closing&&(this.openness-=this.standardOpennessSpeed(),this.isClosed()&&(this._closing=!1,this.updateCloseEvents()))},DKTools.Window.prototype.update=function(){DKTools.Base.prototype.update.call(this),this.updateOpen(),this.updateClose(),this.updateBackgroundDimmer()},DKTools.Window.Selectable=class extends DKTools.Window{needsCreateArrowsSprites(){return!0}onUpArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isVertical()&&t.getTopRow()>0&&e.show(this.isVisibleAndActive()&&t.isActive())}}onDownArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;if(this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isVertical()){const i=t.getTopRow(),n=t.getMaxTopRow();n>0&&i<n&&e.show(this.isVisibleAndActive()&&t.isActive())}}}onLeftArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isHorizontal()&&t.getTopCol()>0&&e.show(this.isVisibleAndActive()&&t.isActive())}}onRightArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;if(this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isHorizontal()){const i=t.getTopCol(),n=t.getMaxTopCol();n>0&&i<n&&e.show(this.isVisibleAndActive()&&t.isActive())}}}onUpArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectPrevItem()}onDownArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectNextItem()}onLeftArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectPrevItem()}onRightArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectNextItem()}onUpArrowMouseLongPress(t){this.onUpArrowMouseClick(t)}onDownArrowMouseLongPress(t){this.onDownArrowMouseClick(t)}onLeftArrowMouseLongPress(t){this.onLeftArrowMouseClick(t)}onRightArrowMouseLongPress(t){this.onRightArrowMouseClick(t)}standardContentsSprite(){return new DKTools.Sprite.Selectable}},DKTools.Scene.prototype=Object.create(Scene_Base.prototype),DKTools.Scene.prototype.constructor=DKTools.Scene,DKTools.Scene.prototype.initialize=function(){this._clearAll(),this._createAll(),this._setupAll(),this._addAllChildren(),Scene_Base.prototype.initialize.call(this)},DKTools.Scene.prototype._clearAll=function(){},DKTools.Scene.prototype._createAll=function(){this._createOptionManager(),this._createEventManager()},DKTools.Scene.prototype._createOptionManager=function(){this._optionManager=new DKTools.OptionManager},DKTools.Scene.prototype._createEventManager=function(){this._eventManager=new DKTools.EventManager(this)},DKTools.Scene.prototype._setupAll=function(){this._setupOptions(),this._setupEvents(),this._setupAnimations()},DKTools.Scene.prototype._setupOptions=function(){},DKTools.Scene.prototype._setupEvents=function(){},DKTools.Scene.prototype._setupAnimations=function(){},DKTools.Scene.prototype._addAllChildren=function(){},DKTools.Scene.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.createAllSprites(),this.createWindowLayer(),this.createAllWindows(),this.createForeground()},DKTools.Scene.prototype.createBackground=function(){},DKTools.Scene.prototype.createAllSprites=function(){},DKTools.Scene.prototype.createAllWindows=function(){},DKTools.Scene.prototype.createForeground=function(){},DKTools.Scene.prototype.start=function(){Scene_Base.prototype.start.call(this),this.startAllSprites(),this.startAllWindows()},DKTools.Scene.prototype.startAllSprites=function(){},DKTools.Scene.prototype.startAllWindows=function(){},DKTools.Scene.prototype.removeWindow=function(t){this.hasWindowLayer()&&this.isChild(t)&&this._windowLayer.removeChild(t)},DKTools.Scene.prototype.hasWindowLayer=function(){return!!this._windowLayer},DKTools.Scene.prototype.isChild=function(t){return t instanceof Window&&this.hasWindowLayer()?DKTools.Utils.Array.contains(this._windowLayer.children,t):DKTools.Utils.Array.contains(this.children,t)},DKTools.Scene.prototype.stop=function(){Scene_Base.prototype.stop.call(this),this.stopAll()},DKTools.Scene.prototype.stopAll=function(){},DKTools.Scene.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),this.terminateAll()},DKTools.Scene.prototype.terminateAll=function(){},DKTools.Scene.prototype.clearOptions=function(){this._optionManager.clear()},DKTools.Scene.prototype.isOptionEnabled=function(t){return this._optionManager.isOptionEnabled(t)},DKTools.Scene.prototype.isOptionsEnabled=function(t){return this._optionManager.isOptionsEnabled(t)},DKTools.Scene.prototype.isSomeOptionsEnabled=function(t){return this._optionManager.isSomeOptionsEnabled(t)},DKTools.Scene.prototype.isOptionDisabled=function(t){return this._optionManager.isOptionDisabled(t)},DKTools.Scene.prototype.isOptionsDisabled=function(t){return this._optionManager.isOptionsDisabled(t)},DKTools.Scene.prototype.isSomeOptionsDisabled=function(t){return this._optionManager.isSomeOptionsDisabled(t)},DKTools.Scene.prototype.isSomeOptionEnabled=function(){return this._optionManager.isSomeOptionEnabled()},DKTools.Scene.prototype.addOptionChangeListener=function(t,e){this._optionManager.addOptionChangeListener(t,e)},DKTools.Scene.prototype.removeOptionChangeListener=function(t,e){this._optionManager.removeOptionChangeListener(t,e)},DKTools.Scene.prototype.enableOption=function(t){this._optionManager.enableOption(t)},DKTools.Scene.prototype.enableOptions=function(t){this._optionManager.enableOption(t)},DKTools.Scene.prototype.disableOption=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.disableOptions=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.switchOption=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.switchOptions=function(t){this._optionManager.switchOptions(t)},DKTools.Scene.prototype.clearEvents=function(t){this._eventManager.clearEvents(t)},DKTools.Scene.prototype.removeEvent=function(t){return this._eventManager.removeEvent(t)},DKTools.Scene.prototype.iterateEventsContainer=function(t,e){this._eventManager.iterateEventsContainer(t,e)},DKTools.Scene.prototype.isEventsPaused=function(t){return this._eventManager.isEventsPaused(t)},DKTools.Scene.prototype.pauseEvents=function(t,e){this._eventManager.pauseEvents(t,e)},DKTools.Scene.prototype.resumeEvents=function(t){this._eventManager.resumeEvents(t)},DKTools.Scene.prototype.finishEvents=function(t,e=!1){this._eventManager.finishEvents(t,e)},DKTools.Scene.prototype.stopEvents=function(t,e=!1){this._eventManager.stopEvents(t,e)},DKTools.Scene.prototype.updateEvents=function(){this._eventManager.update(),this.updateReadyEvents(),this.updateUpdateEvents(),this.updateQueueEvents()},DKTools.Scene.prototype.updateEvent=function(t){this._eventManager.updateEvent(t)},DKTools.Scene.prototype.updateEventsContainer=function(t){this._eventManager.updateEventsContainer(t)},DKTools.Scene.prototype.updateReadyEvents=function(){this.isReady()&&this.updateEventsContainer("ready")},DKTools.Scene.prototype.updateUpdateEvents=function(){this.updateEventsContainer("update")},DKTools.Scene.prototype.updateQueueEvents=function(){const t=this.getEventsContainerByType("queue")[0];this.updateEvent(t)},DKTools.Scene.prototype.getEventsContainerByType=function(t){return this._eventManager.getEventsContainerByType(t)},DKTools.Scene.prototype.getEventsContainer=function(t){return this._eventManager.getEventsContainer(t)},DKTools.Scene.prototype.getEventIndex=function(t){return this._eventManager.getEventIndex(t)},DKTools.Scene.prototype.getEvents=function(t){return this._eventManager.getEvents(t)},DKTools.Scene.prototype.getAnimations=function(t){return this._eventManager.getAnimations(t)},DKTools.Scene.prototype.hasEvent=function(t){return this._eventManager.hasEvent(t)},DKTools.Scene.prototype.hasEvents=function(t){return this._eventManager.hasEvents(t)},DKTools.Scene.prototype.hasAnimation=function(t){return this._eventManager.hasAnimation(t)},DKTools.Scene.prototype.hasAnimations=function(t){return this._eventManager.hasAnimations(t)},DKTools.Scene.prototype.addEvent=function(t){return this._eventManager.addEvent(t)},DKTools.Scene.prototype.addOneTimeEvent=function(t){return this._eventManager.addOneTimeEvent(t)},DKTools.Scene.prototype.addAnimation=function(t){this._eventManager.addAnimation(t)},DKTools.Scene.prototype.iterateChildren=function(t){_.forEach(this.children,t)},DKTools.Scene.prototype.update=function(){this.updateChildren(),this.updateFade(),this.updateEvents()},DKTools.Scene.prototype.updateChild=function(t){t&&DKTools.Utils.isFunction(t.update)&&t.update()},DKTools.Scene.prototype.updateChildren=function(){this.iterateChildren(this.updateChild)},DKTools.Scene.Preloader=class{constructor(){this.initialize.apply(this,arguments)}initialize(){this._queue=[],this._finished=!1,this._errors=0}add(t){t instanceof Bitmap?t=DKTools.Utils.Bitmap.reserveAsync(t):t instanceof WebAudio&&(t=DKTools.Utils.WebAudio.loadAsync(t)),t instanceof Promise&&this._queue.push(t)}addMany(t){_.forEach(t,t=>this.add(t))}finish(){this._queue=[],this._finished=!0}hasErrors(){return this._errors>0}isReady(){return this._finished}_onError(){this._errors++}start(){const t=_.map(this._queue,t=>t.catch(t=>{throw this._onError(),t}));Promise.all(t).then(()=>this.finish())}};const s=new DKTools.ParameterManager("DKTools");DKTools.PluginCommandManager.set("DKPluginsCheckUpdates",()=>{DKTools.Utils.openConsole(),DKTools.Utils._checkUpdates()});const r=window.onload;window.onload=function(){DKTools.Utils.initialize(),DKTools.IO.initialize(),r.call(this),DKTools.PluginManager.initialize()};const o=ImageCache.prototype.get;ImageCache.prototype.get=function(t){return o.call(this,t)||DKTools.PreloadManager.getCachedImageByKey(t)},ImageCache.prototype._truncateCache=function(){const t=this._items;let e=ImageCache.limit;Object.keys(t).map(e=>t[e]).filter(t=>!this._mustBeHeld(t)).sort((t,e)=>e.touch-t.touch).forEach(i=>{if(e>0&&!DKTools.PreloadManager.isImageCachedByKey(i.key)){const t=i.bitmap;e-=t.width*t.height}else delete t[i.key]})};const a=ImageCache.prototype._mustBeHeld;ImageCache.prototype._mustBeHeld=function(t){return!DKTools.PreloadManager.isImageCachedByKey(t.key)&&a.call(this,t)};const l=Graphics.printLoadingError;Graphics.printLoadingError=function(t){l.call(this,t),DKTools.Utils.logError(`Failed to load: ${t}`)};const h=Graphics.initialize;Graphics.initialize=function(t,e,i){h.call(this,t,e,i);const n=s.get("FPS Meter");if(DKTools.Utils.isTest()&&n.Enabled){const t=this._fpsMeter;t&&(this.showFps(),"FPS"===n.Mode?(t.showFps(),this._fpsMeterToggled=!1):(t.showDuration(),this._fpsMeterToggled=!0))}};const u=Graphics._createFPSMeter;Graphics._createFPSMeter=function(){const t=s.get("FPS Meter");if(t.Enabled){const e={toggleOn:null,graph:1,decimals:0,theme:t.Theme,history:t.History};this._fpsMeter=new FPSMeter(e),this._fpsMeter.hide()}else u.call(this)};const c=TouchInput.initialize;TouchInput.initialize=function(){c.call(this);const t=s.get("Cursor Graphic");if(t.Enabled){const e=t.Graphic;e&&(document.body.style.cursor=`url('img/system/${e}.png'), default`)}};const p=TouchInput.clear;TouchInput.clear=function(){p.call(this),this._mouseMoved=!1,this._leftButtonPressed=!1,this._middleButtonPressed=!1,this._rightButtonPressed=!1,this._leftButtonReleased=!1,this._middleButtonReleased=!1,this._rightButtonReleased=!1,this._mouseX=0,this._mouseY=0,this._events.mouseMoved=!1,this._events.leftButtonPressed=!1,this._events.middleButtonPressed=!1,this._events.rightButtonPressed=!1,this._events.leftButtonReleased=!1,this._events.middleButtonReleased=!1,this._events.rightButtonReleased=!1};const d=TouchInput.update;TouchInput.update=function(){this._mouseMoved=this._events.mouseMoved,this._leftButtonPressed=this._events.leftButtonPressed,this._middleButtonPressed=this._events.middleButtonPressed,this._rightButtonPressed=this._events.rightButtonPressed,this._leftButtonReleased=this._events.leftButtonReleased,this._middleButtonReleased=this._events.middleButtonReleased,this._rightButtonReleased=this._events.rightButtonReleased,this._events.mouseMoved=!1,this._events.leftButtonReleased=!1,this._events.middleButtonReleased=!1,this._events.rightButtonReleased=!1,d.call(this)},TouchInput.isMouseMoved=function(){return this._mouseMoved},TouchInput.isMousePressed=function(){return this.isLeftButtonPressed()||this.isMiddleButtonPressed()||this.isRightButtonPressed()},TouchInput.isMouseReleased=function(){return this.isLeftButtonReleased()||this.isMiddleButtonReleased()||this.isRightButtonReleased()},TouchInput.isLeftButtonPressed=function(){return this._leftButtonPressed},TouchInput.isLeftButtonReleased=function(){return this._leftButtonReleased},TouchInput.isMiddleButtonPressed=function(){return this._middleButtonPressed},TouchInput.isMiddleButtonReleased=function(){return this._middleButtonReleased},TouchInput.isRightButtonPressed=function(){return this._rightButtonPressed},TouchInput.isRightButtonReleased=function(){return this._rightButtonReleased};const f=TouchInput._onLeftButtonDown;TouchInput._onLeftButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);f.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.leftButtonPressed=!0)};const g=TouchInput._onMiddleButtonDown;TouchInput._onMiddleButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);g.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.middleButtonPressed=!0)};const m=TouchInput._onRightButtonDown;TouchInput._onRightButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);m.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.rightButtonPressed=!0)};const y=TouchInput._onMouseMove;TouchInput._onMouseMove=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);y.call(this,t),this._mouseX===e&&this._mouseY===i||(this._events.mouseMoved=!0,this._mouseX=e,this._mouseY=i)};const T=TouchInput._onMouseUp;TouchInput._onMouseUp=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);T.call(this,t),this._events.leftButtonPressed=!1,this._events.middleButtonPressed=!1,this._events.rightButtonPressed=!1,Graphics.isInsideCanvas(e,i)&&(0===t.button?this._events.leftButtonReleased=!0:1===t.button?this._events.middleButtonReleased=!0:2===t.button&&(this._events.rightButtonReleased=!0))},Object.defineProperties(TouchInput,{mouseX:{get:function(){return this._mouseX},configurable:!0},mouseY:{get:function(){return this._mouseY},configurable:!0}});const v=Tilemap.prototype.initialize;Tilemap.prototype.initialize=function(){v.call(this),this._tileWidth=Tilemap.TILE_WIDTH||this._tileWidth,this._tileHeight=Tilemap.TILE_HEIGHT||this._tileHeight};const w=WebAudio.prototype.addLoadListener;WebAudio.prototype.addLoadListener=function(t){this.isReady()?t(this):w.call(this,t)},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()(this)}};const D=DataManager.onLoad;DataManager.onLoad=function(t){D.call(this,t),t===$dataSystem&&DKTools.PreloadManager.initialize()};const S=AudioManager.createBuffer;AudioManager.createBuffer=function(t,e){const i=this.audioFileExt(),n=this._path+t+"/"+encodeURIComponent(e)+i;return DKTools.PreloadManager.isAudioCachedByPath(n)?DKTools.PreloadManager.getCachedAudioByPath(n):S.call(this,t,e)};const b=SceneManager.initialize;SceneManager.initialize=function(){b.call(this),DKTools.Utils._checkRPGMakerVersion()};const A=SceneManager.initGraphics;SceneManager.initGraphics=function(){const t=s.get("Screen Resolution"),e=t.Width,i=t.Height;t.Enabled?(this._boxWidth=e,this._screenWidth=e,this._boxHeight=i,this._screenHeight=i,A.call(this),DKTools.Utils.isNwjs()&&this.updateResolution()):A.call(this)},SceneManager.updateResolution=function(){const t=this._screenWidth-window.innerWidth,e=this._screenHeight-window.innerHeight;!Imported.ScreenResolution&&t>0&&e>0&&(window.moveBy(-1*t/2,-1*e/2),window.resizeBy(t,e))};const K=SceneManager.onKeyDown;SceneManager.onKeyDown=function(t){if(K.call(this,t),t.ctrlKey||t.altKey)return;const e=s.get("Quick Load","Key Code"),i=s.get("Screenshots","Key Code"),n=s.get("Grid","Key Code");switch(t.keyCode){case e:DKTools.Utils.__quickLoad();break;case i:s.get("Screenshots","Enabled")&&DKTools.Utils.makeScreenshot();break;case n:DKTools.Utils.__showGrid()}};const O=SceneManager.catchException;SceneManager.catchException=function(t){O.call(this,t),DKTools.Utils.logError(t),s.get("Debugging Console","Open On Error")&&DKTools.Utils.openConsole()};const C=SceneManager.onError;SceneManager.onError=function(t){C.call(this,t),DKTools.Utils.logError(t),s.get("Debugging Console","Open On Error")&&DKTools.Utils.openConsole()},SceneManager.changeScene=function(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),this._scene=this._nextScene,this._scene&&(this._scene.attachReservation(),this._scene.startPreloading(),this._sceneCreated=!1,this._sceneStarted=!1,this._nextScene=null,this._scene.isPreloaded()&&(this._scene.create(),this._sceneCreated=!0,this.onSceneCreate())),this._exiting&&this.terminate())},SceneManager.updateScene=function(){if(this._scene){if(!this._sceneCreated&&this._scene.isPreloaded()&&(this._scene.create(),this._sceneCreated=!0,this.onSceneCreate()),this._sceneCreated&&!this._sceneStarted)try{this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart())}catch(t){}this.isCurrentSceneStarted()&&this._scene.update()}},SceneManager.isCurrentScene=function(t){return this._scene instanceof t};const I=SceneManager.goto;SceneManager.goto=function(t){I.call(this,t),DKTools.Utils.__hideGrid()};const x=Scene_Base.prototype.initialize;Scene_Base.prototype.initialize=function(){x.call(this),this._preloader=new DKTools.Scene.Preloader},Scene_Base.prototype.isPreloaded=function(){return this._preloader.isReady()};const E=Scene_Base.prototype.isReady;Scene_Base.prototype.isReady=function(){return E.call(this)&&this.isPreloaded()},Scene_Base.prototype.setupPreloading=function(){},Scene_Base.prototype.startPreloading=function(){this.setupPreloading(),this._preloader.start()};const P=Scene_Boot.prototype.isReady;Scene_Boot.prototype.isReady=function(){return P.call(this)&&DKTools.PreloadManager.isReady()};const R=Scene_Boot.prototype.start;Scene_Boot.prototype.start=function(){const t=s.get("Quick Start");t.Enabled?(R.call(this),DataManager.isBattleTest()||DataManager.isEventTest()||!t["Skip Saves"]&&DataManager.isAnySavefileExists()||(Scene_Base.prototype.start.call(this),SoundManager.preloadImportantSounds(),this.checkPlayerLocation(),DataManager.setupNewGame(),this.updateDocumentTitle(),SceneManager.goto(window[t["Scene Name"]]))):R.call(this)};const M=Scene_Map.prototype.isReady;Scene_Map.prototype.isReady=function(){return!!this.isPreloaded()&&M.call(this)};const B=Game_Map.prototype.tileWidth;Game_Map.prototype.tileWidth=function(){return Tilemap.TILE_WIDTH||B.call(this)};const H=Game_Map.prototype.tileHeight;Game_Map.prototype.tileHeight=function(){return Tilemap.TILE_HEIGHT||H.call(this)};const F=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(t,e){F.call(this,t,e),DKTools.PluginCommandManager.process(this,t,e)}}).call(this,i(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=require("nw.gui")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("path")}]);