/*
Title: DKTools
Author: DK (Denis Kuznetsov)
Site: https://dk-plugins.ru
E-mail: kuznetsovdenis96@gmail.com
Version: 8.0.0
Release: 30.07.2019
First release: 13.01.2016
Supported languages: Russian, English
*/

/*ru
Название: DKTools
Автор: DK (Денис Кузнецов)
Сайт: https://dk-plugins.ru
E-mail: kuznetsovdenis96@gmail.com
Версия: 8.0.0
Релиз: 30.07.2019
Первый релиз: 13.01.2016
Поддерживаемые языки: Русский, Английский
*/

/*:
* @plugindesc v.8.0.0 Library for RPG Maker. Made with ♥ by DKPlugins
* @author DK (Denis Kuznetsov)
* @help

 ### Info about plugin ###
 Title: DKTools
 Author: DK (Denis Kuznetsov)
 Site: https://dk-plugins.ru
 Version: 8.0.0
 Release: 30.07.2019
 First release: 13.01.2016
 Supported languages: Russian, English
 Thank you for your support: https://dk-plugins.ru/donate

 ### DKTools on DKPlugins ###
 https://dk-plugins.ru/mv/dktools/

 ### DKTools on GitHub ###
 https://github.com/DKPlugins/DKTools

 ### Online documentation ###
 https://dk-plugins.ru/documentation/DKTools/index.html

 ### Requirements and dependencies ###
 Version of RPG Maker 1.6+

 ### Instructions ###

 ## Parameters ##

 ### 1 ### File system ###
 File system modes:
 Nwjs + Stamp - Advanced file system mode (all Platforms)
 Nwjs - standard file system mode (PC only)

 In the Nwjs + Stamp mode, each time you start a game test, the plugin scans
 project files and saves data to the file "data/stamp.json"

 Data can also be updated using the plugin command UpdateFileSystemStamp

 Q. Why do I need Nwjs + Stamp file system mode ?
 A. Browsers and old mobile devices do not provide the ability to check for specific files.
 in a particular directory, and also do not provide a list of files and directories.

 Q. Which mode should I choose ?
 A. Nwjs + Stamp, if your project is designed for all platforms (including browsers and mobile devices).

 ### 1.1 ### Ignored directories ###
 Only applicable for Nwjs + Stamp mode.
 Ignores specified (and nested) directories when scanning project files.

 ## Functions ##

 ### 1 ### Screenshots ###
 Templates for the filename of the screenshot:
 %year - Year
 %month - Month
 %day - Day
 %hours - Hours
 %minutes - Minutes
 %seconds - Seconds

 ### 2 ### Errors logging ###
 If the file size limit is exceeded, the old logs will be renamed
 according to the template: day.month.year_hours.minutes.seconds_filename.

 ### 3 ### Grid ###
 Available grid sizes: 64, 48, 32, 16.
 Switching the grid size is done by pressing the key responsible for the function.

 ### 3.1 ### Using the ruler ###
 Move the mouse while holding down the middle key.

 ### 3.2 ### Color of the ruler ###
 If the color of the ruler is not specified,
 random color will be selected automatically.

 ### Plugin commands ###
 1. Checks for plugins updates from DKPlugins
 DKPluginsCheckUpdates

 2. Update file system stamp
 UpdateFileSystemStamp

 ### Elements ###
 DKTools.Utils
 DKTools.Utils.Object
 DKTools.Utils.Number
 DKTools.Utils.String
 DKTools.Utils.Array
 DKTools.Utils.Point
 DKTools.Utils.Rectangle
 DKTools.Utils.WebAudio
 DKTools.Utils.Bitmap
 DKTools.Utils.Event
 DKTools.Utils.Random
 DKTools.IO
 DKTools.IO.Entity
 DKTools.IO.File
 DKTools.IO.Directory
 DKTools.IO.WebStorage
 DKTools.Network
 DKTools.ParameterManager
 DKTools.PluginManager
 DKTools.PluginCommandManager
 DKTools.PreloadManager
 DKTools.StartupManager
 DKTools.Audio
 DKTools.Event
 DKTools.Animation
 DKTools.Animation.Action
 DKTools.OptionManager
 DKTools.EventManager
 DKTools.Unit
 DKTools.Unit.Property
 DKTools.Unit.Properties
 DKTools.Unit.Function
 DKTools.Base
 DKTools.Sprite
 DKTools.Sprite.Button
 DKTools.Sprite.Cursor
 DKTools.Sprite.Arrow
 DKTools.Sprite.Selectable
 DKTools.Sprite.ProgressBar
 DKTools.Sprite.ProgressBar.Rectangle
 DKTools.Sprite.ProgressBar.Circle
 DKTools.Sprite.ProgressBar.SemiCircle
 DKTools.Sprite.CheckBox
 DKTools.Viewport
 DKTools.Layout
 DKTools.Window
 DKTools.Window.Selectable
 DKTools.Scene

 ### Licenses and terms of use ###

 DKTools uses a third-party library "lodash": https://lodash.com/license

 Recent information about the terms of use: https://dk-plugins.ru/terms-of-use

 You can:
 -Free to use the plugin for your commercial and non commercial projects.
 -Translate the plugin to other languages (inform if you do this)
 -Change the plugin code, but you must specify a link to the original plugin

 You can't:
 -Delete or change any information about the plugin (Title, authorship, contact information, version and release)

 * @param Parameters
 * @default ---------------------------------

 * @param File System
 * @parent Parameters
 * @desc File system parameters. Details in the help (1)
 * @type struct<FileSystem>
 * @default {"Mode":"0","Stamp":"---------------------------------","Ignored Directories":"[\"node_modules\"]"}

 * @param New Functions
 * @default ---------------------------------

 * @param Print Detailed Error
 * @parent New Functions
 * @desc Detailed error display
 * @type struct<PrintDetailedError>
 * @default {"Enabled":"false","Error Message":"Game has encountered a bug. Please report it.","Restart Message":"Press F5 to restart the game."}

 * @param Functions
 * @default ---------------------------------

 * @param Check Updates
 * @parent Functions
 * @desc Check updates
 * @type struct<CheckUpdates>
 * @default {"Enabled":"false","Show New Plugins":"false"}

 * @param Debugging Console
 * @parent Functions
 * @desc Debug console
 * @type struct<DebuggingConsole>
 * @default {"Enabled":"false","Open On Error":"false"}

 * @param FPS Meter
 * @parent Functions
 * @desc FPS Meter
 * @type struct<FPSMeter>
 * @default {"Enabled":"false","Mode":"FPS","Theme":"transparent","History":"20"}

 * @param Screen Resolution
 * @parent Functions
 * @desc Screen resolution
 * @type struct<ScreenResolution>
 * @default {"Enabled":"false","Width":"816","Height":"624"}

 * @param Quick Start
 * @parent Functions
 * @desc Quick start
 * @type struct<QuickStart>
 * @default {"Enabled":"false","Scene Name":"Scene_Map","Skip Saves":"false"}

 * @param Quick Load
 * @parent Functions
 * @desc Quick load
 * @type struct<QuickLoad>
 * @default {"Enabled":"false","Key Code":"117"}

 * @param Preload Manager
 * @parent Functions
 * @desc Preloading resources
 * @type struct<PreloadManager>
 * @default {"Enabled":"false","Debugging":"false","Images":"[]"}

 * @param Screenshots
 * @parent Functions
 * @desc Screenshots
 * @type struct<Screenshots>
 * @default {"Enabled":"false","Key Code":"44","Path":"screenshots/","Filename":"%year_%month_%day_%hours_%minutes_%seconds.png","Type":"png","Quality":"0.9"}

 * @param Errors Log
 * @parent Functions
 * @desc Errors logging
 * @type struct<ErrorsLog>
 * @default {"Enabled":"None","Filename":"errors_log.txt","File Size":"10"}

 * @param Tile Size
 * @parent Functions
 * @desc Tile size
 * @type struct<TileSize>
 * @default {"Enabled":"false","Size":"48"}

 * @param Grid
 * @parent Functions
 * @desc Displaying the grid on the screen. Details in the help (2)
 * @type struct<Grid>
 * @default {"Enabled":"false","Key Code":"118","Grid Color":"white","Grid Width":"1","Ruler Color":"","Ruler Width":"3"}

 * @param Image Cache Limit
 * @parent Functions
 * @desc Image cache limit
 * @type struct<ImageCacheLimit>
 * @default {"Enabled":"false","Limit":"10000000"}

 * @param Cursor Graphic
 * @parent Functions
 * @desc Cursor graphic
 * @type struct<CursorGraphic>
 * @default {"Enabled":"false","Graphic": ""}

*/

/*:ru
* @plugindesc v.8.0.0 Библиотека для RPG Maker. Сделано с ♥ от DKPlugins
* @author DK (Денис Кузнецов)
* @help

 ### Информация о плагине ###
 Название: DKTools
 Автор: DK (Денис Кузнецов)
 Сайт: https://dk-plugins.ru
 Версия: 8.0.0
 Релиз: 30.07.2019
 Первый релиз: 13.01.2016
 Поддерживаемые языки: Русский, Английский
 Спасибо за Вашу поддержку: https://dk-plugins.ru/donate

 ### DKTools на DKPlugins ###
 https://dk-plugins.ru/mv/dktools/

 ### DKTools на GitHub ###
 https://github.com/DKPlugins/DKTools

 ### Онлайн документация ###
 https://dk-plugins.ru/documentation/DKTools/index.html

 ### Требования и зависимости ###
 Версия мейкера 1.6+

 ### Инструкции ###

 ## Параметры ##

 ### 1 ### Файловая система ###
 Режимы работы файловой системы:
 Nwjs + Stamp - Расширенный режим работы файловой системы (все платформы)
 Nwjs - стандартный режим работы файловой системы (только PC)

 В режиме Nwjs + Stamp каждый раз при запуске теста игры плагин сканирует
 файлы проекта и сохраняет данные в файл "data/Stamp.json"

 Данные также могут быть обновлены с помощью команды плагина UpdateFileSystemStamp

 Q. Зачем нужен режим работы Nwjs + Stamp ?
 A. Браузеры и старые мобильные устройства не предоставляют возможность проверять наличие конкретных файлов
 в той или иной директории, а также не предоставляют список файлов и директорий.

 Q. Какой режим выбрать мне ?
 A. Nwjs + Stamp, если Ваш проект расчитан на все платформы (включая браузеры и мобильные устройства).

 ### 1.1 ### Игнорируемые директории ###
 Применяется только для режима Nwjs + Stamp.
 Игнорирует указанные (и вложенные) директории при сканировании файлов проекта.

 ## Функции ##

 ### 1 ### Скриншоты ###
 Шаблоны для названия файла скриншота:
 %year - Год
 %month - Месяц
 %day - День
 %hours - Часы
 %minutes - Минуты
 %seconds - Секунды

 ### 2 ### Логирование ошибок ###
 При превышении лимита размера файла старые логи будут переименованы
 по шаблону: day.month.year_hours.minutes.seconds_filename.

 ### 3 ### Сетка ###
 Доступные размеры сетки: 64, 48, 32, 16
 Переключение размера сетки происходит нажатием клавиши,
 отвечающей за работу функцию.

 ### 3.1 ### Использование линейки ###
 Перемещайте мышь, удерживая среднюю клавишу.

 ### 3.2 ### Цвет линейки ###
 Если не указан цвет линейки, то автоматически будет выбран случайный цвет.

 ### Команды плагина ###
 1. Проверить обновления плагинов от DKPlugins
 DKPluginsCheckUpdates

 2. Обновить штамп файловой системы
 UpdateFileSystemStamp

 ### Элементы ###
 DKTools.Utils
 DKTools.Utils.Object
 DKTools.Utils.Number
 DKTools.Utils.String
 DKTools.Utils.Array
 DKTools.Utils.Point
 DKTools.Utils.Rectangle
 DKTools.Utils.WebAudio
 DKTools.Utils.Bitmap
 DKTools.Utils.Event
 DKTools.Utils.Random
 DKTools.IO
 DKTools.IO.Entity
 DKTools.IO.File
 DKTools.IO.Directory
 DKTools.IO.WebStorage
 DKTools.Network
 DKTools.ParameterManager
 DKTools.PluginManager
 DKTools.PluginCommandManager
 DKTools.PreloadManager
 DKTools.StartupManager
 DKTools.Audio
 DKTools.Event
 DKTools.Animation
 DKTools.Animation.Action
 DKTools.OptionManager
 DKTools.EventManager
 DKTools.Unit
 DKTools.Unit.Property
 DKTools.Unit.Properties
 DKTools.Unit.Function
 DKTools.Base
 DKTools.Sprite
 DKTools.Sprite.Button
 DKTools.Sprite.Cursor
 DKTools.Sprite.Arrow
 DKTools.Sprite.Selectable
 DKTools.Sprite.ProgressBar
 DKTools.Sprite.ProgressBar.Rectangle
 DKTools.Sprite.ProgressBar.Circle
 DKTools.Sprite.ProgressBar.SemiCircle
 DKTools.Sprite.CheckBox
 DKTools.Viewport
 DKTools.Layout
 DKTools.Window
 DKTools.Window.Selectable
 DKTools.Scene

 ### Лицензии и правила использования плагина ###

 DKTools использует стороннюю библиотеку "lodash": https://lodash.com/license

 Актуальная информация о правилах использования: https://dk-plugins.ru/terms-of-use

 Вы можете:
 -Бесплатно использовать данный плагин в некоммерческих и коммерческих проектах
 -Переводить плагин на другие языки (сообщите мне, если Вы перевели плагин на другой язык)
 -Изменять код плагина, но Вы обязаны указать ссылку на оригинальный плагин

 Вы не можете:
 -Убирать или изменять любую информацию о плагине (Название, авторство, контактная информация, версия и дата релиза)

 * @param Parameters
 * @text Параметры
 * @default ---------------------------------

 * @param File System
 * @text Файловая система
 * @parent Parameters
 * @desc Параметры файловой системы. Подробности в справке (1)
 * @type struct<FileSystem>
 * @default {"Mode":"0","Stamp":"---------------------------------","Ignored Directories":"[\"node_modules\"]"}

 * @param New Functions
 * @text Новые функции
 * @default ---------------------------------

 * @param Print Detailed Error
 * @text Детальное отображение ошибок
 * @parent New Functions
 * @desc Детальное отображение ошибок
 * @type struct<PrintDetailedError>
 * @default {"Enabled":"false","Error Message":"В игре обнаружена ошибка. Пожалуйста, сообщите об этом.","Restart Message":"Нажмите F5, чтобы перезапустить игру."}

 * @param Functions
 * @text Функции
 * @default ---------------------------------

 * @param Check Updates
 * @text Проверка обновлений
 * @parent Functions
 * @desc Проверка обновлений
 * @type struct<CheckUpdates>
 * @default {"Enabled":"false","Show New Plugins":"false"}

 * @param Debugging Console
 * @text Отладочная консоль
 * @parent Functions
 * @desc Отладочная консоль
 * @type struct<DebuggingConsole>
 * @default {"Enabled":"false","Open On Error":"false"}

 * @param FPS Meter
 * @text Счетчик FPS
 * @parent Functions
 * @desc Счетчик FPS
 * @type struct<FPSMeter>
 * @default {"Enabled":"false","Mode":"FPS","Theme":"transparent","History":"20"}

 * @param Screen Resolution
 * @text Разрешение экрана
 * @parent Functions
 * @desc Настройки разрешения экрана
 * @type struct<ScreenResolution>
 * @default {"Enabled":"false","Width":"816","Height":"624"}

 * @param Quick Start
 * @text Быстрый старт
 * @parent Functions
 * @desc Быстрый старт
 * @type struct<QuickStart>
 * @default {"Enabled":"false","Scene Name":"Scene_Map","Skip Saves":"false"}

 * @param Quick Load
 * @text Быстрая загрузка
 * @parent Functions
 * @desc Быстрая загрузка игры
 * @type struct<QuickLoad>
 * @default {"Enabled":"false","Key Code":"117"}

 * @param Preload Manager
 * @text Предзагрузка ресурсов
 * @parent Functions
 * @desc Предварительная загрузка ресурсов
 * @type struct<PreloadManager>
 * @default {"Enabled":"false","Debugging":"false","Images":"[]"}

 * @param Screenshots
 * @text Скриншоты
 * @parent Functions
 * @desc Скриншоты
 * @type struct<Screenshots>
 * @default {"Enabled":"false","Key Code":"44","Path":"screenshots/","Filename":"%year_%month_%day_%hours_%minutes_%seconds.png","Type":"png","Quality":"0.9"}

 * @param Errors Log
 * @text Логирование ошибок
 * @parent Functions
 * @desc Логирование ошибок
 * @type struct<ErrorsLog>
 * @default {"Enabled":"None","Filename":"errors_log.txt","File Size":"10"}

 * @param Tile Size
 * @text Размер тайла
 * @parent Functions
 * @desc Размер тайла
 * @type struct<TileSize>
 * @default {"Enabled":"false","Size":"48"}

 * @param Grid
 * @text Сетка
 * @parent Functions
 * @desc Отображение сетки на экране. Подробности в справке (2)
 * @type struct<Grid>
 * @default {"Enabled":"false","Key Code":"118","Grid Color":"white","Grid Width":"1","Ruler Color":"","Ruler Width":"3"}

 * @param Image Cache Limit
 * @text Лимит кэша изображений
 * @parent Functions
 * @desc Лимит кэша изображений
 * @type struct<ImageCacheLimit>
 * @default {"Enabled":"false","Limit":"10000000"}

 * @param Cursor Graphic
 * @text Графика курсора
 * @parent Functions
 * @desc Графика курсора
 * @type struct<CursorGraphic>
 * @default {"Enabled":"false","Graphic": ""}

*/

/*~struct~FileSystem:

 * @param Mode
 * @desc File system mode. Details in the help (1)
 * @type select
 * @option Nwjs + Stamp
 * @value 0
 * @option Nwjs
 * @value 1
 * @default 0

 * @param Stamp
 * @default ---------------------------------

 * @param Ignored Directories
 * @parent Stamp
 * @desc Ignored directories. Details in the help (1.1)
 * @type string[]
 * @default ["node_modules"]

*/

/*~struct~FileSystem:ru

 * @param Mode
 * @text Режим работы файловой систмы
 * @desc Режим работы файловой системы. Подробности в справке (1)
 * @type select
 * @option Nwjs + Stamp
 * @value 0
 * @option Nwjs
 * @value 1
 * @default 0

 * @param Stamp
 * @text Штамп файловой системы
 * @default ---------------------------------

 * @param Ignored Directories
 * @text Игнорируемые директории
 * @parent Stamp
 * @desc Игнорируемые директории. Подробности в справке (1.1)
 * @type string[]
 * @default ["node_modules"]

*/

/*~struct~CheckUpdates:

 * @param Enabled
 * @desc Enable automatic update checking ? Information is displayed in the console during the game test
 * @type boolean
 * @default false

 * @param Show New Plugins
 * @text Show new plugins
 * @desc Show new plugins ? Information is displayed in the console during the game test
 * @type boolean
 * @default false

 */

/*~struct~CheckUpdates:ru

 * @param Enabled
 * @text Проверка обновлений
 * @desc Включить автоматическую проверку обновлений ? Информация выводится в консоль при тесте игры
 * @type boolean
 * @default false

 * @param Show New Plugins
 * @text Показать новые плагины
 * @desc Показывать новые плагины ? Информация выводится в консоль при тесте игры
 * @type boolean
 * @default false

 */

/*~struct~DebuggingConsole:

 * @param Enabled
 * @desc Open the debug console when the game test starts ?
 * @type boolean
 * @default false

 * @param Open On Error
 * @text Open on error
 * @desc Enable the debugging console when an error is received ?
 * @type boolean
 * @default false

 */

/*~struct~DebuggingConsole:ru

 * @param Enabled
 * @text Включено
 * @desc Открыть отладочную консоль при запуске теста игры ?
 * @type boolean
 * @default false

 * @param Open On Error
 * @text Открытие при ошибке
 * @desc Включить отладочную консоль при получении ошибки ?
 * @type boolean
 * @default false

 */

/*~struct~FPSMeter:

 * @param Enabled
 * @desc Show the FPS counter when the game test starts ?
 * @type boolean
 * @default false

 * @param Mode
 * @desc Mode
 * @type select
 * @option FPS
 * @option Duration
 * @default FPS

 * @param Theme
 * @desc Theme
 * @type select
 * @option transparent
 * @option dark
 * @option light
 * @default transparent

 * @param History
 * @desc Number of entries in history
 * @type number
 * @min 5
 * @max 100
 * @default 20

 */

/*~struct~FPSMeter:ru

 * @param Enabled
 * @text Включено
 * @desc Показать счетчик FPS при запуске теста игры ?
 * @type boolean
 * @default false

 * @param Mode
 * @text Режим
 * @desc Режим счетчика FPS
 * @type select
 * @option FPS
 * @option Duration
 * @default FPS

 * @param Theme
 * @text Тема
 * @desc Тема счетчика FPS
 * @type select
 * @option transparent
 * @option dark
 * @option light
 * @default transparent

 * @param History
 * @text История
 * @desc Количество записей в истории
 * @type number
 * @min 5
 * @max 100
 * @default 20

 */

/*~struct~ScreenResolution:

 * @param Enabled
 * @desc Enable the Screen Resolution function ?
 * @type boolean
 * @default false

 * @param Width
 * @desc Screen width
 * @type number
 * @min 0
 * @default 816

 * @param Height
 * @desc Screen height
 * @type number
 * @min 0
 * @default 624

 */

/*~struct~ScreenResolution:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения разрешения экрана ?
 * @type boolean
 * @default false

 * @param Width
 * @text Ширина экрана
 * @desc Ширина экрана
 * @type number
 * @min 0
 * @default 816

 * @param Height
 * @text Высота экрана
 * @desc Высота экрана
 * @type number
 * @min 0
 * @default 624

 */

/*~struct~QuickStart:

 * @param Enabled
 * @desc Enable the Quick Start function ?
 * @type boolean
 * @default false

 * @param Scene Name
 * @desc Name of scene which will be launched instead the title screen. Standard: Scene_Map
 * @default Scene_Map

 * @param Skip Saves
 * @desc Does it need skip the title screen if save files exists?
 * @type boolean
 * @default false

 */

/*~struct~QuickStart:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию быстрого старта ?
 * @type boolean
 * @default false

 * @param Scene Name
 * @text Название сцены
 * @desc Название сцены, которая запускается вместо титульного экрана. Стандартно: Scene_Map
 * @default Scene_Map

 * @param Skip Saves
 * @text Пропуск сохранений
 * @desc Пропускать титульный экран, если есть сохранения ?
 * @type boolean
 * @default false

 */

/*~struct~QuickLoad:

 * @param Enabled
 * @desc Enable the Quick Load function ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible for the quick loading. 117 - F6
 * @type number
 * @default 117

 * @param Savefile ID
 * @desc Savefile number for quick loading. Specify 0 to show the load scene
 * @type number
 * @default 0

 */

/*~struct~QuickLoad:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию быстрой загрузки ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за быструю загрузку. 117 - F6
 * @default 117

 * @param Savefile ID
 * @text Файл сохранения
 * @desc Номер файла сохранения для быстрой загрузки. Укажите 0, чтобы показывать экран загрузки
 * @type number
 * @default 0

 */

/*~struct~PreloadManager:

 * @param Enabled
 * @desc Enable resources preloading function ?
 * @type boolean
 * @default false

 * @param Debugging
 * @desc Display preload information in the console ?
 * @type boolean
 * @default false

 * @param Audio Files
 * @desc Preloading audio files
 * @type struct<PreloadManagerAudio>[]
 * @default []

 * @param Image Files
 * @desc Preloading image files
 * @type struct<PreloadManagerImage>[]
 * @default []

 */

/*~struct~PreloadManager:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию предзагрузки ресурсов ?
 * @type boolean
 * @default false

 * @param Debugging
 * @text Отладка
 * @desc Выводить информацию о предзагрузке в консоль ?
 * @type boolean
 * @default false

 * @param Audio Files
 * @text Звуки
 * @desc Предзагрузка звуков
 * @type struct<PreloadManagerAudio>[]
 * @default []

 * @param Image Files
 * @text Изображения
 * @desc Предзагрузка изображений
 * @type struct<PreloadManagerImage>[]
 * @default []

 */

/*~struct~PreloadManagerImage:

 * @param Path
 * @desc Path to file (with extension) or directory. For example, img/system/Window.png for file or img/system/ for directory

 * @param Hue
 * @desc Hue
 * @type number
 * @min 0
 * @max 360
 * @default 0

 * @param Caching
 * @desc Image caching
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerImage:ru

 * @param Path
 * @text Путь
 * @desc Путь к файлу (с расширением) или директории. Например, img/system/Window.png для файла или img/system/ для директории

 * @param Hue
 * @text Оттенок
 * @desc Оттенок
 * @type number
 * @min 0
 * @max 360
 * @default 0

 * @param Caching
 * @text Кэширование
 * @desc Кэширование изображений
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerAudio:

 * @param Path
 * @desc Path to file (with extension) or directory. For example, audio/bgm/Battle1.ogg for file or audio/bgm/ for directory

 * @param Caching
 * @desc Audio caching
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerAudio:ru

 * @param Path
 * @text Путь
 * @desc Путь к файлу (с расширением) или директории. Например, audio/bgm/Battle1.ogg для файла или audio/bgm/ для директории

 * @param Caching
 * @text Кэширование
 * @desc Кэширование звуков
 * @type boolean
 * @default false

 */

/*~struct~Screenshots:

 * @param Enabled
 * @desc Enable the Screenshots function ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible for saving the screenshot. 122 - F11
 * @type number
 * @default 122

 * @param Path
 * @text Path for saving screenshots
 * @desc Local path for saving screenshots
 * @default screenshots/

 * @param Filename
 * @desc The entire list of templates is given in the help (1)
 * @default %year_%month_%day_%hours_%minutes_%seconds.png

 * @param Type
 * @text Screenshot type
 * @desc Screenshot type
 * @type select
 * @option png
 * @option jpeg
 * @option webp
 * @default png

 * @param Quality
 * @text Screenshot quality
 * @desc Screenshot quality
 * @type select
 * @option 0%
 * @option 10%
 * @option 20%
 * @option 30%
 * @option 40%
 * @option 50%
 * @option 60%
 * @option 70%
 * @option 80%
 * @option 90%
 * @option 100%
 * @default 90%

 */

/*~struct~Screenshots:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию сохранения скриншота ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за сохранение скриншота. 122 - F11
 * @type number
 * @default 122

 * @param Path
 * @text Путь для сохранения скриншотов
 * @desc Локальный путь для сохранения скриншотов
 * @default screenshots/

 * @param Filename
 * @text Название файла скриншота
 * @desc Весь список шаблонов приведен в справке (1)
 * @default %year_%month_%day_%hours_%minutes_%seconds.png

 * @param Type
 * @text Тип скриншота
 * @desc Тип скриншота
 * @type select
 * @option png
 * @option jpeg
 * @option webp
 * @default png

 * @param Quality
 * @text Качество скриншота
 * @desc Качество скриншота
 * @type select
 * @option 0%
 * @value 0
 * @option 10%
 * @value 0.1
 * @option 20%
 * @value 0.2
 * @option 30%
 * @value 0.3
 * @option 40%
 * @value 0.4
 * @option 50%
 * @value 0.5
 * @option 60%
 * @value 0.6
 * @option 70%
 * @value 0.7
 * @option 80%
 * @value 0.8
 * @option 90%
 * @value 0.9
 * @option 100%
 * @value 1
 * @default 90%

 */

/*~struct~ErrorsLog:

 * @param Enabled
 * @desc Enable error logging ?
 * @type select
 * @option None
 * @option Only Test
 * @option Only Game
 * @option Always
 * @default None

 * @param Filename
 * @desc Filename
 * @default errors_log.txt

 * @param File Size
 * @desc Maximum file size in megabytes. Details in the help (2).
 * @default 10

 */

/*~struct~ErrorsLog:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию логирования ошибок ?
 * @type select
 * @option Никогда
 * @value None
 * @option Только тест
 * @value Only Test
 * @option Только игра
 * @value Only Game
 * @option Всегда
 * @value Always
 * @default None

 * @param Filename
 * @text Название файла
 * @desc Название файла
 * @default errors_log.txt

 * @param File Size
 * @text Размер файла
 * @desc Максимальный размер файла в мегабайтах. Подробности в справке (2).
 * @default 10

 */

/*~struct~TileSize:

 * @param Enabled
 * @desc Enable the function of resizing tiles ?
 * @type boolean
 * @default false

 * @param Size
 * @desc Tile size
 * @type number
 * @min 1
 * @default 48

 */

/*~struct~TileSize:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения размера тайла ?
 * @type boolean
 * @default false

 * @param Size
 * @text Размер тайла
 * @desc Размер тайла
 * @type number
 * @min 1
 * @default 48

 */

/*~struct~Grid:

 * @param Enabled
 * @desc Enable the function of displaying the grid ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible displaying the grid. 118 - F7
 * @type number
 * @default 118

 * @param Grid Color
 * @desc Grid line color in Web format
 * @default white

 * @param Grid Width
 * @desc Grid line width
 * @type number
 * @min 1
 * @default 1

 * @param Ruler Color
 * @desc Ruler color in Web format. Details in the help (3.2)
 * @default

 * @param Ruler Width
 * @desc Ruler width
 * @type number
 * @min 1
 * @default 3

 */

/*~struct~Grid:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию отображения сетки ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за отображение сетки. 118 - F7
 * @type number
 * @default 118

 * @param Grid Color
 * @text Цвет сетки
 * @desc Цвет сетки в Web формате
 * @default white

 * @param Grid Width
 * @text Ширина линии сетки
 * @desc Ширина линии сетки
 * @type number
 * @min 1
 * @default 1

 * @param Ruler Color
 * @text Цвет линейки
 * @desc Цвет линейки в Web формате. Подробности в справке (3.2)
 * @default

 * @param Ruler Width
 * @text Ширина линейки
 * @desc Ширина линейки
 * @type number
 * @min 1
 * @default 3

 */

/*~struct~ImageCacheLimit:

 * @param Enabled
 * @desc Enable the image cache limit function ?
 * @type boolean
 * @default false

 * @param Limit
 * @desc Image cache limit
 * @type number
 * @min 0
 * @default 10000000

*/

/*~struct~ImageCacheLimit:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения лимита кэша изображений ?
 * @type boolean
 * @default false

 * @param Limit
 * @text Лимит
 * @desc Лимит кэша изображений
 * @type number
 * @min 0
 * @default 10000000

*/

/*~struct~CursorGraphic:

 * @param Enabled
 * @desc Enable the function to change the cursor graphics ?
 * @type boolean
 * @default false

 * @param Graphic
 * @desc Cursor graphic
 * @type file
 * @dir img/system

*/

/*~struct~CursorGraphic:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения графики курсора ?
 * @type boolean
 * @default false

 * @param Graphic
 * @text Графика
 * @desc Графика курсора
 * @type file
 * @dir img/system

*/

/*~struct~PrintDetailedError:

 * @param Enabled
 * @desc Enable detailed error display ?
 * @type boolean
 * @default false

 * @param Error Message
 * @text Error message
 * @desc Error message
 * @default Game has encountered a bug. Please report it.

 * @param Restart Message
 * @text Game restart message
 * @desc Game restart message
 * @default Press F5 to restart the game.

*/

/*~struct~PrintDetailedError:ru

 * @param Enabled
 * @text Включено
 * @desc Включить детальное отображение ошибок ?
 * @type boolean
 * @default false

 * @param Error Message
 * @text Сообщение об ошибке
 * @desc Сообщение об ошибке
 * @default В игре обнаружена ошибка. Пожалуйста, сообщите об этом.

 * @param Restart Message
 * @text Сообщение о перезапуске игры
 * @desc Сообщение о перезапуске игры
 * @default Нажмите F5, чтобы перезапустить игру.

*/

!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";(function(t){var s;window.Imported=window.Imported||{},window.Imported.DKTools="8.0.0",function(){function n(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function r(t,e,i,s){for(var n=-1,r=null==t?0:t.length;++n<r;){var o=t[n];e(s,o,i(o),t)}return s}function o(t,e){for(var i=-1,s=null==t?0:t.length;++i<s&&!1!==e(t[i],i,t););return t}function a(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(!e(t[i],i,t))return!1;return!0}function l(t,e){for(var i=-1,s=null==t?0:t.length,n=0,r=[];++i<s;){var o=t[i];e(o,i,t)&&(r[n++]=o)}return r}function h(t,e){return!(null==t||!t.length)&&-1<y(t,e,0)}function u(t,e,i){for(var s=-1,n=null==t?0:t.length;++s<n;)if(i(e,t[s]))return!0;return!1}function c(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}function p(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}function d(t,e,i,s){var n=-1,r=null==t?0:t.length;for(s&&r&&(i=t[++n]);++n<r;)i=e(i,t[n],n,t);return i}function f(t,e,i,s){var n=null==t?0:t.length;for(s&&n&&(i=t[--n]);n--;)i=e(i,t[n],n,t);return i}function g(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}function _(t,e,i){var s;return i(t,function(t,i,n){if(e(t,i,n))return s=i,!1}),s}function m(t,e,i,s){var n=t.length;for(i+=s?1:-1;s?i--:++i<n;)if(e(t[i],i,t))return i;return-1}function y(t,e,i){if(e==e)t:{--i;for(var s=t.length;++i<s;)if(t[i]===e){t=i;break t}t=-1}else t=m(t,v,i);return t}function T(t,e,i,s){--i;for(var n=t.length;++i<n;)if(s(t[i],e))return i;return-1}function v(t){return t!=t}function w(t,e){var i=null==t?0:t.length;return i?K(t,e)/i:W}function D(t){return function(e){return null==e?L:e[t]}}function S(t){return function(e){return null==t?L:t[e]}}function b(t,e,i,s,n){return n(t,function(t,n,r){i=s?(s=!1,t):e(i,t,n,r)}),i}function K(t,e){for(var i,s=-1,n=t.length;++s<n;){var r=e(t[s]);r!==L&&(i=i===L?r:i+r)}return i}function A(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}function O(t){return function(e){return t(e)}}function C(t,e){return c(e,function(e){return t[e]})}function I(t,e){return t.has(e)}function x(t,e){for(var i=-1,s=t.length;++i<s&&-1<y(e,t[i],0););return i}function E(t,e){for(var i=t.length;i--&&-1<y(e,t[i],0););return i}function P(t){return"\\"+Rt[t]}function R(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}function M(t,e){return function(i){return t(e(i))}}function B(t,e){for(var i=-1,s=t.length,n=0,r=[];++i<s;){var o=t[i];o!==e&&"__lodash_placeholder__"!==o||(t[i]="__lodash_placeholder__",r[n++]=i)}return r}function F(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function H(t){if(Ct.test(t)){for(var e=At.lastIndex=0;At.test(t);)++e;t=e}else t=Yt(t);return t}function k(t){return Ct.test(t)?t.match(At)||[]:t.split("")}var L,U=1/0,W=NaN,j=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],N=/\b__p\+='';/g,z=/\b(__p\+=)''\+/g,V=/(__e\(.*?\)|\b__t\))\+'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,X=/[&<>"']/g,$=RegExp(G.source),q=RegExp(X.source),Y=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,Z=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,st=RegExp(it.source),nt=/^\s+|\s+$/g,rt=/^\s+/,ot=/\s+$/,at=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,lt=/\{\n\/\* \[wrapped with (.+)\] \*/,ht=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ct=/\\(\\)?/g,pt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,ft=/^[-+]0x[0-9a-f]+$/i,gt=/^0b[01]+$/i,_t=/^\[object .+?Constructor\]$/,mt=/^0o[0-7]+$/i,yt=/^(?:0|[1-9]\d*)$/,Tt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,Dt="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*",St="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+Dt,bt=RegExp("['’]","g"),Kt=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),At=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])"+Dt,"g"),Ot=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",St].join("|"),"g"),Ct=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),It=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,xt="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Et={};Et["[object Float32Array]"]=Et["[object Float64Array]"]=Et["[object Int8Array]"]=Et["[object Int16Array]"]=Et["[object Int32Array]"]=Et["[object Uint8Array]"]=Et["[object Uint8ClampedArray]"]=Et["[object Uint16Array]"]=Et["[object Uint32Array]"]=!0,Et["[object Arguments]"]=Et["[object Array]"]=Et["[object ArrayBuffer]"]=Et["[object Boolean]"]=Et["[object DataView]"]=Et["[object Date]"]=Et["[object Error]"]=Et["[object Function]"]=Et["[object Map]"]=Et["[object Number]"]=Et["[object Object]"]=Et["[object RegExp]"]=Et["[object Set]"]=Et["[object String]"]=Et["[object WeakMap]"]=!1;var Pt={};Pt["[object Arguments]"]=Pt["[object Array]"]=Pt["[object ArrayBuffer]"]=Pt["[object DataView]"]=Pt["[object Boolean]"]=Pt["[object Date]"]=Pt["[object Float32Array]"]=Pt["[object Float64Array]"]=Pt["[object Int8Array]"]=Pt["[object Int16Array]"]=Pt["[object Int32Array]"]=Pt["[object Map]"]=Pt["[object Number]"]=Pt["[object Object]"]=Pt["[object RegExp]"]=Pt["[object Set]"]=Pt["[object String]"]=Pt["[object Symbol]"]=Pt["[object Uint8Array]"]=Pt["[object Uint8ClampedArray]"]=Pt["[object Uint16Array]"]=Pt["[object Uint32Array]"]=!0,Pt["[object Error]"]=Pt["[object Function]"]=Pt["[object WeakMap]"]=!1;var Rt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mt=parseFloat,Bt=parseInt,Ft="object"==typeof global&&global&&global.Object===Object&&global,Ht="object"==typeof self&&self&&self.Object===Object&&self,kt=Ft||Ht||Function("return this")(),Lt=e&&!e.nodeType&&e,Ut=Lt&&"object"==typeof t&&t&&!t.nodeType&&t,Wt=Ut&&Ut.exports===Lt,jt=Wt&&Ft.process,Nt=function(){try{var t=Ut&&Ut.require&&Ut.require("util").types;return t||jt&&jt.binding&&jt.binding("util")}catch(t){}}(),zt=Nt&&Nt.isArrayBuffer,Vt=Nt&&Nt.isDate,Gt=Nt&&Nt.isMap,Xt=Nt&&Nt.isRegExp,$t=Nt&&Nt.isSet,qt=Nt&&Nt.isTypedArray,Yt=D("length"),Jt=S({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Zt=S({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Qt=S({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),te=function t(e){function i(t){if(js(t)&&!Eo(t)&&!(t instanceof Dt)){if(t instanceof S)return t;if(En.call(t,"__wrapped__"))return fs(t)}return new S(t)}function s(){}function S(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=L}function Dt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function St(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function At(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function Rt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}function Ft(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Rt;++e<i;)this.add(t[e])}function Ht(t){this.size=(this.__data__=new At(t)).size}function Lt(t,e){var i,s=Eo(t),n=!s&&xo(t),r=!s&&!n&&Ro(t),o=!s&&!n&&!r&&ko(t),a=(n=(s=s||n||r||o)?A(t.length,Kn):[]).length;for(i in t)!e&&!En.call(t,i)||s&&("length"==i||r&&("offset"==i||"parent"==i)||o&&("buffer"==i||"byteLength"==i||"byteOffset"==i)||ts(i,a))||n.push(i);return n}function Ut(t){var e=t.length;return e?t[We(0,e-1)]:L}function jt(t,e,i){(i===L||Ms(t[e],i))&&(i!==L||e in t)||se(t,e,i)}function Nt(t,e,i){var s=t[e];En.call(t,e)&&Ms(s,i)&&(i!==L||e in t)||se(t,e,i)}function Yt(t,e){for(var i=t.length;i--;)if(Ms(t[i][0],e))return i;return-1}function ee(t,e,i,s){return Ir(t,function(t,n,r){e(s,t,i(t),r)}),s}function ie(t,e){return t&&gi(e,sn(e),t)}function se(t,e,i){"__proto__"==e&&qn?qn(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function ne(t,e){for(var i=-1,s=e.length,n=yn(s),r=null==t;++i<s;)n[i]=r?L:tn(t,e[i]);return n}function re(t,e,i){return t==t&&(i!==L&&(t=t<=i?t:i),e!==L&&(t=t>=e?t:e)),t}function oe(t,e,i,s,n,r){var a,l=1&e,h=2&e,u=4&e;if(i&&(a=n?i(t,s,n,r):i(t)),a!==L)return a;if(!Ws(t))return t;if(s=Eo(t)){if(a=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&En.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!l)return fi(t,a)}else{var c=Ur(t),p="[object Function]"==c||"[object GeneratorFunction]"==c;if(Ro(t))return li(t,l);if("[object Object]"==c||"[object Arguments]"==c||p&&!n){if(a=h||p?{}:Zi(t),!l)return h?function(t,e){return gi(t,Lr(t),e)}(t,function(t,e){return t&&gi(e,nn(e),t)}(a,t)):function(t,e){return gi(t,kr(t),e)}(t,ie(a,t))}else{if(!Pt[c])return n?t:{};a=function(t,e,i){var s=t.constructor;switch(e){case"[object ArrayBuffer]":return hi(t);case"[object Boolean]":case"[object Date]":return new s(+t);case"[object DataView]":return e=i?hi(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ui(t,i);case"[object Map]":return new s;case"[object Number]":case"[object String]":return new s(t);case"[object RegExp]":return(e=new t.constructor(t.source,dt.exec(t))).lastIndex=t.lastIndex,e;case"[object Set]":return new s;case"[object Symbol]":return Ar?Sn(Ar.call(t)):{}}}(t,c,l)}}if(r||(r=new Ht),n=r.get(t))return n;if(r.set(t,a),Ho(t))return t.forEach(function(s){a.add(oe(s,e,i,s,t,r))}),a;if(Bo(t))return t.forEach(function(s,n){a.set(n,oe(s,e,i,n,t,r))}),a;h=u?h?zi:Ni:h?nn:sn;var d=s?L:h(t);return o(d||t,function(s,n){d&&(s=t[n=s]),Nt(a,n,oe(s,e,i,n,t,r))}),a}function ae(t,e,i){var s=i.length;if(null==t)return!s;for(t=Sn(t);s--;){var n=i[s],r=e[n],o=t[n];if(o===L&&!(n in t)||!r(o))return!1}return!0}function le(t,e,i){if("function"!=typeof t)throw new An("Expected a function");return Nr(function(){t.apply(L,i)},e)}function he(t,e,i,s){var n=-1,r=h,o=!0,a=t.length,l=[],p=e.length;if(!a)return l;i&&(e=c(e,O(i))),s?(r=u,o=!1):200<=e.length&&(r=I,o=!1,e=new Ft(e));t:for(;++n<a;){var d=t[n],f=null==i?d:i(d);d=s||0!==d?d:0;if(o&&f==f){for(var g=p;g--;)if(e[g]===f)continue t;l.push(d)}else r(e,f,s)||l.push(d)}return l}function ue(t,e){var i=!0;return Ir(t,function(t,s,n){return i=!!e(t,s,n)}),i}function ce(t,e,i){for(var s=-1,n=t.length;++s<n;){var r=t[s],o=e(r);if(null!=o&&(a===L?o==o&&!Gs(o):i(o,a)))var a=o,l=r}return l}function pe(t,e){var i=[];return Ir(t,function(t,s,n){e(t,s,n)&&i.push(t)}),i}function de(t,e,i,s,n){var r=-1,o=t.length;for(i||(i=Qi),n||(n=[]);++r<o;){var a=t[r];0<e&&i(a)?1<e?de(a,e-1,i,s,n):p(n,a):s||(n[n.length]=a)}return n}function fe(t,e){return t&&Er(t,e,sn)}function ge(t,e){return t&&Pr(t,e,sn)}function _e(t,e){return l(e,function(e){return ks(t[e])})}function me(t,e){for(var i=0,s=(e=oi(e,t)).length;null!=t&&i<s;)t=t[cs(e[i++])];return i&&i==s?t:L}function ye(t,e,i){return e=e(t),Eo(t)?e:p(e,i(t))}function Te(t){if(null==t)return t===L?"[object Undefined]":"[object Null]";if($n&&$n in Sn(t)){var e=En.call(t,$n),i=t[$n];try{t[$n]=L;var s=!0}catch(t){}var n=Mn.call(t);s&&(e?t[$n]=i:delete t[$n]),t=n}else t=Mn.call(t);return t}function ve(t,e){return t>e}function we(t,e){return null!=t&&En.call(t,e)}function De(t,e){return null!=t&&e in Sn(t)}function Se(t,e,i){for(var s=i?u:h,n=t[0].length,r=t.length,o=r,a=yn(r),l=1/0,p=[];o--;){var d=t[o];o&&e&&(d=c(d,O(e))),l=ar(d.length,l),a[o]=!i&&(e||120<=n&&120<=d.length)?new Ft(o&&d):L}d=t[0];var f=-1,g=a[0];t:for(;++f<n&&p.length<l;){var _=d[f],m=e?e(_):_;_=i||0!==_?_:0;if(g?!I(g,m):!s(p,m,i)){for(o=r;--o;){var y=a[o];if(y?!I(y,m):!s(t[o],m,i))continue t}g&&g.push(m),p.push(_)}}return p}function be(t,e,i){return null==(e=null==(t=2>(e=oi(e,t)).length?t:me(t,Ve(e,0,-1)))?t:t[cs(Ts(e))])?L:n(e,t,i)}function Ke(t){return js(t)&&"[object Arguments]"==Te(t)}function Ae(t,e,i,s,n){if(t===e)return!0;if(null==t||null==e||!js(t)&&!js(e))return t!=t&&e!=e;t:{var r=Eo(t),o=Eo(e),a=r?"[object Array]":Ur(t),l=o?"[object Array]":Ur(e),h="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);o="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l);if((l=a==l)&&Ro(t)){if(!Ro(e)){e=!1;break t}r=!0,h=!1}if(l&&!h)n||(n=new Ht),e=r||ko(t)?Wi(t,e,i,s,Ae,n):function(t,e,i,s,n,r,o){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!r(new Un(t),new Un(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Ms(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=R;case"[object Set]":if(a||(a=F),t.size!=e.size&&!(1&s))break;return(i=o.get(t))?i==e:(s|=2,o.set(t,e),e=Wi(a(t),a(e),s,n,r,o),o.delete(t),e);case"[object Symbol]":if(Ar)return Ar.call(t)==Ar.call(e)}return!1}(t,e,a,i,s,Ae,n);else{if(!(1&i)&&(r=h&&En.call(t,"__wrapped__"),a=o&&En.call(e,"__wrapped__"),r||a)){t=r?t.value():t,e=a?e.value():e,n||(n=new Ht),e=Ae(t,e,i,s,n);break t}if(l)e:if(n||(n=new Ht),r=1&i,a=Ni(t),o=a.length,l=Ni(e).length,o==l||r){for(h=o;h--;){var u=a[h];if(!(r?u in e:En.call(e,u))){e=!1;break e}}if((l=n.get(t))&&n.get(e))e=l==e;else{l=!0,n.set(t,e),n.set(e,t);for(var c=r;++h<o;){var p=t[u=a[h]],d=e[u];if(s)var f=r?s(d,p,u,e,t,n):s(p,d,u,t,e,n);if(f===L?p!==d&&!Ae(p,d,i,s,n):!f){l=!1;break}c||(c="constructor"==u)}l&&!c&&((i=t.constructor)!=(s=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof i&&i instanceof i&&"function"==typeof s&&s instanceof s)&&(l=!1)),n.delete(t),n.delete(e),e=l}}else e=!1;else e=!1}}return e}function Oe(t,e,i,s){var n=i.length,r=n,o=!s;if(null==t)return!r;for(t=Sn(t);n--;){var a=i[n];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++n<r;){var l=(a=i[n])[0],h=t[l],u=a[1];if(o&&a[2]){if(h===L&&!(l in t))return!1}else{if(a=new Ht,s)var c=s(h,u,l,t,e,a);if(c===L?!Ae(u,h,3,s,a):!c)return!1}}return!0}function Ce(t){return!(!Ws(t)||Rn&&Rn in t)&&(ks(t)?Hn:_t).test(ps(t))}function Ie(t){return"function"==typeof t?t:null==t?cn:"object"==typeof t?Eo(t)?Me(t[0],t[1]):Re(t):gn(t)}function xe(t){if(!ns(t))return rr(t);var e,i=[];for(e in Sn(t))En.call(t,e)&&"constructor"!=e&&i.push(e);return i}function Ee(t,e){return t<e}function Pe(t,e){var i=-1,s=Bs(t)?yn(t.length):[];return Ir(t,function(t,n,r){s[++i]=e(t,n,r)}),s}function Re(t){var e=qi(t);return 1==e.length&&e[0][2]?rs(e[0][0],e[0][1]):function(i){return i===t||Oe(i,t,e)}}function Me(t,e){return is(t)&&e==e&&!Ws(e)?rs(cs(t),e):function(i){var s=tn(i,t);return s===L&&s===e?en(i,t):Ae(e,s,3)}}function Be(t,e,i,s,n){t!==e&&Er(e,function(r,o){if(Ws(r)){n||(n=new Ht);var a=n,l=as(t,o),h=as(e,o);if(!(f=a.get(h))){var u=(f=s?s(l,h,o+"",t,e,a):L)===L;if(u){var c=Eo(h),p=!c&&Ro(h),d=!c&&!p&&ko(h),f=h;c||p||d?Eo(l)?f=l:Fs(l)?f=fi(l):p?(u=!1,f=li(h,!0)):d?(u=!1,f=ui(h,!0)):f=[]:zs(h)||xo(h)?(f=l,xo(l)?f=Zs(l):Ws(l)&&!ks(l)||(f=Zi(h))):u=!1}u&&(a.set(h,f),Be(f,h,i,s,a),a.delete(h))}jt(t,o,f)}else(a=s?s(as(t,o),r,o+"",t,e,n):L)===L&&(a=r),jt(t,o,a)},nn)}function Fe(t,e){var i=t.length;if(i)return ts(e+=0>e?i:0,i)?t[e]:L}function He(t,e,i){var s=-1;return e=c(e.length?e:[cn],O(Xi())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].c;return t}(t=Pe(t,function(t,i,n){return{a:c(e,function(e){return e(t)}),b:++s,c:t}}),function(t,e){var s;t:{s=-1;for(var n=t.a,r=e.a,o=n.length,a=i.length;++s<o;){var l=ci(n[s],r[s]);if(l){if(s>=a){s=l;break t}s=l*("desc"==i[s]?-1:1);break t}}s=t.b-e.b}return s})}function ke(t,e,i){for(var s=-1,n=e.length,r={};++s<n;){var o=e[s],a=me(t,o);i(a,o)&&ze(r,oi(o,t),a)}return r}function Le(t,e,i,s){var n=s?T:y,r=-1,o=e.length,a=t;for(t===e&&(e=fi(e)),i&&(a=c(t,O(i)));++r<o;){var l=0,h=e[r];for(h=i?i(h):h;-1<(l=n(a,h,l,s));)a!==t&&Vn.call(a,l,1),Vn.call(t,l,1)}return t}function Ue(t,e){for(var i=t?e.length:0,s=i-1;i--;){var n=e[i];if(i==s||n!==r){var r=n;ts(n)?Vn.call(t,n,1):Qe(t,n)}}return t}function We(t,e){return t+tr(ur()*(e-t+1))}function je(t,e){var i="";if(!t||1>e||9007199254740991<e)return i;do{e%2&&(i+=t),(e=tr(e/2))&&(t+=t)}while(e);return i}function Ne(t,e){return zr(os(t,e,cn),t+"")}function ze(t,e,i,s){if(!Ws(t))return t;for(var n=-1,r=(e=oi(e,t)).length,o=r-1,a=t;null!=a&&++n<r;){var l=cs(e[n]),h=i;if(n!=o){var u=a[l];(h=s?s(u,l,a):L)===L&&(h=Ws(u)?u:ts(e[n+1])?[]:{})}Nt(a,l,h),a=a[l]}return t}function Ve(t,e,i){var s=-1,n=t.length;for(0>e&&(e=-e>n?0:n+e),0>(i=i>n?n:i)&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0,i=yn(n);++s<n;)i[s]=t[s+e];return i}function Ge(t,e){var i;return Ir(t,function(t,s,n){return!(i=e(t,s,n))}),!!i}function Xe(t,e,i){var s=0,n=null==t?s:t.length;if("number"==typeof e&&e==e&&2147483647>=n){for(;s<n;){var r=s+n>>>1,o=t[r];null!==o&&!Gs(o)&&(i?o<=e:o<e)?s=r+1:n=r}return n}return $e(t,e,cn,i)}function $e(t,e,i,s){e=i(e);for(var n=0,r=null==t?0:t.length,o=e!=e,a=null===e,l=Gs(e),h=e===L;n<r;){var u=tr((n+r)/2),c=i(t[u]),p=c!==L,d=null===c,f=c==c,g=Gs(c);(o?s||f:h?f&&(s||p):a?f&&p&&(s||!d):l?f&&p&&!d&&(s||!g):!d&&!g&&(s?c<=e:c<e))?n=u+1:r=u}return ar(r,4294967294)}function qe(t,e){for(var i=-1,s=t.length,n=0,r=[];++i<s;){var o=t[i],a=e?e(o):o;if(!i||!Ms(a,l)){var l=a;r[n++]=0===o?0:o}}return r}function Ye(t){return"number"==typeof t?t:Gs(t)?W:+t}function Je(t){if("string"==typeof t)return t;if(Eo(t))return c(t,Je)+"";if(Gs(t))return Or?Or.call(t):"";var e=t+"";return"0"==e&&1/t==-U?"-0":e}function Ze(t,e,i){var s=-1,n=h,r=t.length,o=!0,a=[],l=a;if(i)o=!1,n=u;else if(200<=r){if(n=e?null:Fr(t))return F(n);o=!1,n=I,l=new Ft}else l=e?[]:a;t:for(;++s<r;){var c=t[s],p=e?e(c):c;c=i||0!==c?c:0;if(o&&p==p){for(var d=l.length;d--;)if(l[d]===p)continue t;e&&l.push(p),a.push(c)}else n(l,p,i)||(l!==a&&l.push(p),a.push(c))}return a}function Qe(t,e){return null==(t=2>(e=oi(e,t)).length?t:me(t,Ve(e,0,-1)))||delete t[cs(Ts(e))]}function ti(t,e,i,s){for(var n=t.length,r=s?n:-1;(s?r--:++r<n)&&e(t[r],r,t););return i?Ve(t,s?0:r,s?r+1:n):Ve(t,s?r+1:0,s?n:r)}function ei(t,e){var i=t;return i instanceof Dt&&(i=i.value()),d(e,function(t,e){return e.func.apply(e.thisArg,p([t],e.args))},i)}function ii(t,e,i){var s=t.length;if(2>s)return s?Ze(t[0]):[];for(var n=-1,r=yn(s);++n<s;)for(var o=t[n],a=-1;++a<s;)a!=n&&(r[n]=he(r[n]||o,t[a],e,i));return Ze(de(r,1),e,i)}function si(t,e,i){for(var s=-1,n=t.length,r=e.length,o={};++s<n;)i(o,t[s],s<r?e[s]:L);return o}function ni(t){return Fs(t)?t:[]}function ri(t){return"function"==typeof t?t:cn}function oi(t,e){return Eo(t)?t:is(t,e)?[t]:Vr(Qs(t))}function ai(t,e,i){var s=t.length;return i=i===L?s:i,!e&&i>=s?t:Ve(t,e,i)}function li(t,e){if(e)return t.slice();var i=t.length;i=Wn?Wn(i):new t.constructor(i);return t.copy(i),i}function hi(t){var e=new t.constructor(t.byteLength);return new Un(e).set(new Un(t)),e}function ui(t,e){return new t.constructor(e?hi(t.buffer):t.buffer,t.byteOffset,t.length)}function ci(t,e){if(t!==e){var i=t!==L,s=null===t,n=t==t,r=Gs(t),o=e!==L,a=null===e,l=e==e,h=Gs(e);if(!a&&!h&&!r&&t>e||r&&o&&l&&!a&&!h||s&&o&&l||!i&&l||!n)return 1;if(!s&&!r&&!h&&t<e||h&&i&&n&&!s&&!r||a&&i&&n||!o&&n||!l)return-1}return 0}function pi(t,e,i,s){var n=-1,r=t.length,o=i.length,a=-1,l=e.length,h=or(r-o,0),u=yn(l+h);for(s=!s;++a<l;)u[a]=e[a];for(;++n<o;)(s||n<r)&&(u[i[n]]=t[n]);for(;h--;)u[a++]=t[n++];return u}function di(t,e,i,s){var n=-1,r=t.length,o=-1,a=i.length,l=-1,h=e.length,u=or(r-a,0),c=yn(u+h);for(s=!s;++n<u;)c[n]=t[n];for(u=n;++l<h;)c[u+l]=e[l];for(;++o<a;)(s||n<r)&&(c[u+i[o]]=t[n++]);return c}function fi(t,e){var i=-1,s=t.length;for(e||(e=yn(s));++i<s;)e[i]=t[i];return e}function gi(t,e,i,s){var n=!i;i||(i={});for(var r=-1,o=e.length;++r<o;){var a=e[r],l=s?s(i[a],t[a],a,i,t):L;l===L&&(l=t[a]),n?se(i,a,l):Nt(i,a,l)}return i}function _i(t,e){return function(i,s){var n=Eo(i)?r:ee,o=e?e():{};return n(i,t,Xi(s,2),o)}}function mi(t){return Ne(function(e,i){var s=-1,n=i.length,r=1<n?i[n-1]:L,o=2<n?i[2]:L;r=3<t.length&&"function"==typeof r?(n--,r):L;for(o&&es(i[0],i[1],o)&&(r=3>n?L:r,n=1),e=Sn(e);++s<n;)(o=i[s])&&t(e,o,s,r);return e})}function yi(t,e){return function(i,s){if(null==i)return i;if(!Bs(i))return t(i,s);for(var n=i.length,r=e?n:-1,o=Sn(i);(e?r--:++r<n)&&!1!==s(o[r],r,o););return i}}function Ti(t){return function(e,i,s){for(var n=-1,r=Sn(e),o=(s=s(e)).length;o--;){var a=s[t?o:++n];if(!1===i(r[a],a,r))break}return e}}function vi(t){return function(e){e=Qs(e);var i=Ct.test(e)?k(e):L,s=i?i[0]:e.charAt(0);return e=i?ai(i,1).join(""):e.slice(1),s[t]()+e}}function wi(t){return function(e){return d(hn(ln(e).replace(bt,"")),t,"")}}function Di(t){return function(){switch((e=arguments).length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var e,i=Cr(t.prototype);return Ws(e=t.apply(i,e))?e:i}}function Si(t,e,i){var s=Di(t);return function r(){for(var o=arguments.length,a=yn(o),l=o,h=Gi(r);l--;)a[l]=arguments[l];return(o-=(l=3>o&&a[0]!==h&&a[o-1]!==h?[]:B(a,h)).length)<i?Mi(t,e,Ai,r.placeholder,L,a,l,L,L,i-o):n(this&&this!==kt&&this instanceof r?s:t,this,a)}}function bi(t){return function(e,i,s){var n=Sn(e);if(!Bs(e)){var r=Xi(i,3);e=sn(e),i=function(t){return r(n[t],t,n)}}return-1<(i=t(e,i,s))?n[r?e[i]:i]:L}}function Ki(t){return ji(function(e){var i=e.length,s=i,n=S.prototype.thru;for(t&&e.reverse();s--;){if("function"!=typeof(o=e[s]))throw new An("Expected a function");if(n&&!r&&"wrapper"==Vi(o))var r=new S([],!0)}for(s=r?s:i;++s<i;){var o,a="wrapper"==(n=Vi(o=e[s]))?Hr(o):L;r=a&&ss(a[0])&&424==a[1]&&!a[4].length&&1==a[9]?r[Vi(a[0])].apply(r,a[3]):1==o.length&&ss(o)?r[n]():r.thru(o)}return function(){var t=(n=arguments)[0];if(r&&1==n.length&&Eo(t))return r.plant(t).value();for(var s=0,n=i?e[s].apply(this,n):t;++s<i;)n=e[s].call(this,n);return n}})}function Ai(t,e,i,s,n,r,o,a,l,h){var u=128&e,c=1&e,p=2&e,d=24&e,f=512&e,g=p?L:Di(t);return function _(){for(var m=arguments.length,y=yn(m),T=m;T--;)y[T]=arguments[T];if(d){var v,w=Gi(_);for(T=y.length,v=0;T--;)y[T]===w&&++v}if(s&&(y=pi(y,s,n,d)),r&&(y=di(y,r,o,d)),m-=v,d&&m<h)return w=B(y,w),Mi(t,e,Ai,_.placeholder,i,y,w,a,l,h-m);if(w=c?i:this,T=p?w[t]:t,m=y.length,a){v=y.length;for(var D=ar(a.length,v),S=fi(y);D--;){var b=a[D];y[D]=ts(b,v)?S[b]:L}}else f&&1<m&&y.reverse();return u&&l<m&&(y.length=l),this&&this!==kt&&this instanceof _&&(T=g||Di(T)),T.apply(w,y)}}function Oi(t,e){return function(i,s){return function(t,e,i,s){return fe(t,function(t,n,r){e(s,i(t),n,r)}),s}(i,t,e(s),{})}}function Ci(t,e){return function(i,s){var n;if(i===L&&s===L)return e;if(i!==L&&(n=i),s!==L){if(n===L)return s;"string"==typeof i||"string"==typeof s?(i=Je(i),s=Je(s)):(i=Ye(i),s=Ye(s)),n=t(i,s)}return n}}function Ii(t){return ji(function(e){return e=c(e,O(Xi())),Ne(function(i){var s=this;return t(e,function(t){return n(t,s,i)})})})}function xi(t,e){var i=(e=e===L?" ":Je(e)).length;return 2>i?i?je(e,t):e:(i=je(e,Qn(t/H(e))),Ct.test(e)?ai(k(i),0,t).join(""):i.slice(0,t))}function Ei(t,e,i,s){var r=1&e,o=Di(t);return function e(){for(var a=-1,l=arguments.length,h=-1,u=s.length,c=yn(u+l),p=this&&this!==kt&&this instanceof e?o:t;++h<u;)c[h]=s[h];for(;l--;)c[h++]=arguments[++a];return n(p,r?i:this,c)}}function Pi(t){return function(e,i,s){s&&"number"!=typeof s&&es(e,i,s)&&(i=s=L),e=$s(e),i===L?(i=e,e=0):i=$s(i),s=s===L?e<i?1:-1:$s(s);var n=-1;i=or(Qn((i-e)/(s||1)),0);for(var r=yn(i);i--;)r[t?i:++n]=e,e+=s;return r}}function Ri(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Js(e),i=Js(i)),t(e,i)}}function Mi(t,e,i,s,n,r,o,a,l,h){var u=8&e,c=u?o:L;o=u?L:o;var p=u?r:L;return r=u?L:r,4&(e=(e|(u?32:64))&~(u?64:32))||(e&=-4),n=[t,e,n,p,c,r,o,a,l,h],i=i.apply(L,n),ss(t)&&jr(i,n),i.placeholder=s,ls(i,t,e)}function Bi(t){var e=Dn[t];return function(t,i){if(t=Js(t),i=null==i?0:ar(qs(i),292)){var s=(Qs(t)+"e").split("e");return+((s=(Qs(s=e(s[0]+"e"+(+s[1]+i)))+"e").split("e"))[0]+"e"+(+s[1]-i))}return e(t)}}function Fi(t){return function(e){var i=Ur(e);return"[object Map]"==i?R(e):"[object Set]"==i?function(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=[t,t]}),i}(e):function(t,e){return c(e,function(e){return[e,t[e]]})}(e,t(e))}}function Hi(t,e,i,s,n,r,o,a){var l=2&e;if(!l&&"function"!=typeof t)throw new An("Expected a function");var h=s?s.length:0;if(h||(e&=-97,s=n=L),o=o===L?o:or(qs(o),0),a=a===L?a:qs(a),h-=n?n.length:0,64&e){var u=s,c=n;s=n=L}var p=l?L:Hr(t);return r=[t,e,i,s,n,u,c,r,o,a],p&&(e=(i=r[1])|(t=p[1]),s=128==t&&8==i||128==t&&256==i&&r[7].length<=p[8]||384==t&&p[7].length<=p[8]&&8==i,131>e||s)&&(1&t&&(r[2]=p[2],e|=1&i?0:4),(i=p[3])&&(s=r[3],r[3]=s?pi(s,i,p[4]):i,r[4]=s?B(r[3],"__lodash_placeholder__"):p[4]),(i=p[5])&&(s=r[5],r[5]=s?di(s,i,p[6]):i,r[6]=s?B(r[5],"__lodash_placeholder__"):p[6]),(i=p[7])&&(r[7]=i),128&t&&(r[8]=null==r[8]?p[8]:ar(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=e),t=r[0],e=r[1],i=r[2],s=r[3],n=r[4],!(a=r[9]=r[9]===L?l?0:t.length:or(r[9]-h,0))&&24&e&&(e&=-25),l=e&&1!=e?8==e||16==e?Si(t,e,a):32!=e&&33!=e||n.length?Ai.apply(L,r):Ei(t,e,i,s):function(t,e,i){var s=1&e,n=Di(t);return function e(){return(this&&this!==kt&&this instanceof e?n:t).apply(s?i:this,arguments)}}(t,e,i),ls((p?Rr:jr)(l,r),t,e)}function ki(t,e,i,s){return t===L||Ms(t,Cn[i])&&!En.call(s,i)?e:t}function Li(t,e,i,s,n,r){return Ws(t)&&Ws(e)&&(r.set(e,t),Be(t,e,L,Li,r),r.delete(e)),t}function Ui(t){return zs(t)?L:t}function Wi(t,e,i,s,n,r){var o=1&i,a=t.length;if(a!=(l=e.length)&&!(o&&l>a))return!1;if((l=r.get(t))&&r.get(e))return l==e;var l=-1,h=!0,u=2&i?new Ft:L;for(r.set(t,e),r.set(e,t);++l<a;){var c=t[l],p=e[l];if(s)var d=o?s(p,c,l,e,t,r):s(c,p,l,t,e,r);if(d!==L){if(d)continue;h=!1;break}if(u){if(!g(e,function(t,e){if(!I(u,e)&&(c===t||n(c,t,i,s,r)))return u.push(e)})){h=!1;break}}else if(c!==p&&!n(c,p,i,s,r)){h=!1;break}}return r.delete(t),r.delete(e),h}function ji(t){return zr(os(t,L,ms),t+"")}function Ni(t){return ye(t,sn,kr)}function zi(t){return ye(t,nn,Lr)}function Vi(t){for(var e=t.name+"",i=Tr[e],s=En.call(Tr,e)?i.length:0;s--;){var n=i[s],r=n.func;if(null==r||r==t)return n.name}return e}function Gi(t){return(En.call(i,"placeholder")?i:t).placeholder}function Xi(){var t=(t=i.iteratee||pn)===pn?Ie:t;return arguments.length?t(arguments[0],arguments[1]):t}function $i(t,e){var i=t.__data__,s=typeof e;return("string"==s||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==e:null===e)?i["string"==typeof e?"string":"hash"]:i.map}function qi(t){for(var e=sn(t),i=e.length;i--;){var s=e[i],n=t[s];e[i]=[s,n,n==n&&!Ws(n)]}return e}function Yi(t,e){var i=null==t?L:t[e];return Ce(i)?i:L}function Ji(t,e,i){for(var s=-1,n=(e=oi(e,t)).length,r=!1;++s<n;){var o=cs(e[s]);if(!(r=null!=t&&i(t,o)))break;t=t[o]}return r||++s!=n?r:!!(n=null==t?0:t.length)&&Us(n)&&ts(o,n)&&(Eo(t)||xo(t))}function Zi(t){return"function"!=typeof t.constructor||ns(t)?{}:Cr(jn(t))}function Qi(t){return Eo(t)||xo(t)||!!(Gn&&t&&t[Gn])}function ts(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&yt.test(t))&&-1<t&&0==t%1&&t<e}function es(t,e,i){if(!Ws(i))return!1;var s=typeof e;return!!("number"==s?Bs(i)&&ts(e,i.length):"string"==s&&e in i)&&Ms(i[e],t)}function is(t,e){if(Eo(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Gs(t))||tt.test(t)||!Q.test(t)||null!=e&&t in Sn(e)}function ss(t){var e=Vi(t),s=i[e];return"function"==typeof s&&e in Dt.prototype&&(t===s||!!(e=Hr(s))&&t===e[0])}function ns(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Cn)}function rs(t,e){return function(i){return null!=i&&i[t]===e&&(e!==L||t in Sn(i))}}function os(t,e,i){return e=or(e===L?t.length-1:e,0),function(){for(var s=arguments,r=-1,o=or(s.length-e,0),a=yn(o);++r<o;)a[r]=s[e+r];for(r=-1,o=yn(e+1);++r<e;)o[r]=s[r];return o[e]=i(a),n(t,this,o)}}function as(t,e){if("__proto__"!=e)return t[e]}function ls(t,e,i){var s=e+"";e=zr;var n,r=ds;return(r=(i=r(n=(n=s.match(lt))?n[1].split(ht):[],i)).length)&&(i[n=r-1]=(1<r?"& ":"")+i[n],i=i.join(2<r?", ":" "),s=s.replace(at,"{\n/* [wrapped with "+i+"] */\n")),e(t,s)}function hs(t){var e=0,i=0;return function(){var s=lr(),n=16-(s-i);if(i=s,0<n){if(800<=++e)return arguments[0]}else e=0;return t.apply(L,arguments)}}function us(t,e){var i=-1,s=(n=t.length)-1;for(e=e===L?n:e;++i<e;){var n,r=t[n=We(i,s)];t[n]=t[i],t[i]=r}return t.length=e,t}function cs(t){if("string"==typeof t||Gs(t))return t;var e=t+"";return"0"==e&&1/t==-U?"-0":e}function ps(t){if(null!=t){try{return xn.call(t)}catch(t){}return t+""}return""}function ds(t,e){return o(j,function(i){var s="_."+i[0];e&i[1]&&!h(t,s)&&t.push(s)}),t.sort()}function fs(t){if(t instanceof Dt)return t.clone();var e=new S(t.__wrapped__,t.__chain__);return e.__actions__=fi(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function gs(t,e,i){var s=null==t?0:t.length;return s?(0>(i=null==i?0:qs(i))&&(i=or(s+i,0)),m(t,Xi(e,3),i)):-1}function _s(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=s-1;return i!==L&&(n=qs(i),n=0>i?or(s+n,0):ar(n,s-1)),m(t,Xi(e,3),n,!0)}function ms(t){return null!=t&&t.length?de(t,1):[]}function ys(t){return t&&t.length?t[0]:L}function Ts(t){var e=null==t?0:t.length;return e?t[e-1]:L}function vs(t,e){return t&&t.length&&e&&e.length?Le(t,e):t}function ws(t){return null==t?t:cr.call(t)}function Ds(t){if(!t||!t.length)return[];var e=0;return t=l(t,function(t){if(Fs(t))return e=or(t.length,e),!0}),A(e,function(e){return c(t,D(e))})}function Ss(t,e){if(!t||!t.length)return[];var i=Ds(t);return null==e?i:c(i,function(t){return n(e,L,t)})}function bs(t){return(t=i(t)).__chain__=!0,t}function Ks(t,e){return e(t)}function As(t,e){return(Eo(t)?o:Ir)(t,Xi(e,3))}function Os(t,e){return(Eo(t)?function(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}:xr)(t,Xi(e,3))}function Cs(t,e){return(Eo(t)?c:Pe)(t,Xi(e,3))}function Is(t,e,i){return e=i?L:e,e=t&&null==e?t.length:e,Hi(t,128,L,L,L,L,e)}function xs(t,e){var i;if("function"!=typeof e)throw new An("Expected a function");return t=qs(t),function(){return 0<--t&&(i=e.apply(this,arguments)),1>=t&&(e=L),i}}function Es(t,e,i){function s(e){var i=l,s=h;return l=h=L,f=e,c=t.apply(s,i)}function n(t){var i=t-d;return t-=f,d===L||i>=e||0>i||_&&t>=u}function r(){var t=To();if(n(t))return o(t);var i,s=Nr;i=t-f,t=e-(t-d),i=_?ar(t,u-i):t,p=s(r,i)}function o(t){return p=L,m&&l?s(t):(l=h=L,c)}function a(){var t=To(),i=n(t);if(l=arguments,h=this,d=t,i){if(p===L)return f=t=d,p=Nr(r,e),g?s(t):c;if(_)return p=Nr(r,e),s(d)}return p===L&&(p=Nr(r,e)),c}var l,h,u,c,p,d,f=0,g=!1,_=!1,m=!0;if("function"!=typeof t)throw new An("Expected a function");return e=Js(e)||0,Ws(i)&&(g=!!i.leading,u=(_="maxWait"in i)?or(Js(i.maxWait)||0,e):u,m="trailing"in i?!!i.trailing:m),a.cancel=function(){p!==L&&Br(p),f=0,l=d=h=p=L},a.flush=function(){return p===L?c:o(To())},a}function Ps(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new An("Expected a function");var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],r=i.cache;return r.has(n)?r.get(n):(s=t.apply(this,s),i.cache=r.set(n,s)||r,s)};return i.cache=new(Ps.Cache||Rt),i}function Rs(t){if("function"!=typeof t)throw new An("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Ms(t,e){return t===e||t!=t&&e!=e}function Bs(t){return null!=t&&Us(t.length)&&!ks(t)}function Fs(t){return js(t)&&Bs(t)}function Hs(t){if(!js(t))return!1;var e=Te(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!zs(t)}function ks(t){return!!Ws(t)&&("[object Function]"==(t=Te(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)}function Ls(t){return"number"==typeof t&&t==qs(t)}function Us(t){return"number"==typeof t&&-1<t&&0==t%1&&9007199254740991>=t}function Ws(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function js(t){return null!=t&&"object"==typeof t}function Ns(t){return"number"==typeof t||js(t)&&"[object Number]"==Te(t)}function zs(t){return!(!js(t)||"[object Object]"!=Te(t))&&(null===(t=jn(t))||"function"==typeof(t=En.call(t,"constructor")&&t.constructor)&&t instanceof t&&xn.call(t)==Bn)}function Vs(t){return"string"==typeof t||!Eo(t)&&js(t)&&"[object String]"==Te(t)}function Gs(t){return"symbol"==typeof t||js(t)&&"[object Symbol]"==Te(t)}function Xs(t){if(!t)return[];if(Bs(t))return Vs(t)?k(t):fi(t);if(Xn&&t[Xn]){t=t[Xn]();for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}return("[object Map]"==(e=Ur(t))?R:"[object Set]"==e?F:on)(t)}function $s(t){return t?(t=Js(t))===U||t===-U?1.7976931348623157e308*(0>t?-1:1):t==t?t:0:0===t?t:0}function qs(t){var e=(t=$s(t))%1;return t==t?e?t-e:t:0}function Ys(t){return t?re(qs(t),0,4294967295):0}function Js(t){if("number"==typeof t)return t;if(Gs(t))return W;if(Ws(t)&&(t=Ws(t="function"==typeof t.valueOf?t.valueOf():t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;t=t.replace(nt,"");var e=gt.test(t);return e||mt.test(t)?Bt(t.slice(2),e?2:8):ft.test(t)?W:+t}function Zs(t){return gi(t,nn(t))}function Qs(t){return null==t?"":Je(t)}function tn(t,e,i){return(t=null==t?L:me(t,e))===L?i:t}function en(t,e){return null!=t&&Ji(t,e,De)}function sn(t){return Bs(t)?Lt(t):xe(t)}function nn(t){if(Bs(t))t=Lt(t,!0);else if(Ws(t)){var e,i=ns(t),s=[];for(e in t)("constructor"!=e||!i&&En.call(t,e))&&s.push(e);t=s}else{if(e=[],null!=t)for(i in Sn(t))e.push(i);t=e}return t}function rn(t,e){if(null==t)return{};var i=c(zi(t),function(t){return[t]});return e=Xi(e),ke(t,i,function(t,i){return e(t,i[0])})}function on(t){return null==t?[]:C(t,sn(t))}function an(t){return ua(Qs(t).toLowerCase())}function ln(t){return(t=Qs(t))&&t.replace(Tt,Jt).replace(Kt,"")}function hn(t,e,i){return t=Qs(t),(e=i?L:e)===L?It.test(t)?t.match(Ot)||[]:t.match(ut)||[]:t.match(e)||[]}function un(t){return function(){return t}}function cn(t){return t}function pn(t){return Ie("function"==typeof t?t:oe(t,1))}function dn(t,e,i){var s=sn(e),n=_e(e,s);null!=i||Ws(e)&&(n.length||!s.length)||(i=e,e=t,t=this,n=_e(e,sn(e)));var r=!(Ws(i)&&"chain"in i&&!i.chain),a=ks(t);return o(n,function(i){var s=e[i];t[i]=s,a&&(t.prototype[i]=function(){var e=this.__chain__;if(r||e){var i=t(this.__wrapped__);return(i.__actions__=fi(this.__actions__)).push({func:s,args:arguments,thisArg:t}),i.__chain__=e,i}return s.apply(t,p([this.value()],arguments))})}),t}function fn(){}function gn(t){return is(t)?D(cs(t)):function(t){return function(e){return me(e,t)}}(t)}function _n(){return[]}function mn(){return!1}var yn=(e=null==e?kt:te.defaults(kt.Object(),e,te.pick(kt,xt))).Array,Tn=e.Date,vn=e.Error,wn=e.Function,Dn=e.Math,Sn=e.Object,bn=e.RegExp,Kn=e.String,An=e.TypeError,On=yn.prototype,Cn=Sn.prototype,In=e["__core-js_shared__"],xn=wn.prototype.toString,En=Cn.hasOwnProperty,Pn=0,Rn=function(){var t=/[^.]+$/.exec(In&&In.keys&&In.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Mn=Cn.toString,Bn=xn.call(Sn),Fn=kt._,Hn=bn("^"+xn.call(En).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kn=Wt?e.Buffer:L,Ln=e.Symbol,Un=e.Uint8Array,Wn=kn?kn.allocUnsafe:L,jn=M(Sn.getPrototypeOf,Sn),Nn=Sn.create,zn=Cn.propertyIsEnumerable,Vn=On.splice,Gn=Ln?Ln.isConcatSpreadable:L,Xn=Ln?Ln.iterator:L,$n=Ln?Ln.toStringTag:L,qn=function(){try{var t=Yi(Sn,"defineProperty");return t({},"",{}),t}catch(t){}}(),Yn=e.clearTimeout!==kt.clearTimeout&&e.clearTimeout,Jn=Tn&&Tn.now!==kt.Date.now&&Tn.now,Zn=e.setTimeout!==kt.setTimeout&&e.setTimeout,Qn=Dn.ceil,tr=Dn.floor,er=Sn.getOwnPropertySymbols,ir=kn?kn.isBuffer:L,sr=e.isFinite,nr=On.join,rr=M(Sn.keys,Sn),or=Dn.max,ar=Dn.min,lr=Tn.now,hr=e.parseInt,ur=Dn.random,cr=On.reverse,pr=Yi(e,"DataView"),dr=Yi(e,"Map"),fr=Yi(e,"Promise"),gr=Yi(e,"Set"),_r=Yi(e,"WeakMap"),mr=Yi(Sn,"create"),yr=_r&&new _r,Tr={},vr=ps(pr),wr=ps(dr),Dr=ps(fr),Sr=ps(gr),br=ps(_r),Kr=Ln?Ln.prototype:L,Ar=Kr?Kr.valueOf:L,Or=Kr?Kr.toString:L,Cr=function(){function t(){}return function(e){return Ws(e)?Nn?Nn(e):(t.prototype=e,e=new t,t.prototype=L,e):{}}}();i.templateSettings={escape:Y,evaluate:J,interpolate:Z,variable:"",imports:{_:i}},i.prototype=s.prototype,i.prototype.constructor=i,S.prototype=Cr(s.prototype),S.prototype.constructor=S,Dt.prototype=Cr(s.prototype),Dt.prototype.constructor=Dt,St.prototype.clear=function(){this.__data__=mr?mr(null):{},this.size=0},St.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},St.prototype.get=function(t){var e=this.__data__;return mr?"__lodash_hash_undefined__"===(t=e[t])?L:t:En.call(e,t)?e[t]:L},St.prototype.has=function(t){var e=this.__data__;return mr?e[t]!==L:En.call(e,t)},St.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=mr&&e===L?"__lodash_hash_undefined__":e,this},At.prototype.clear=function(){this.__data__=[],this.size=0},At.prototype.delete=function(t){var e=this.__data__;return!(0>(t=Yt(e,t))||(t==e.length-1?e.pop():Vn.call(e,t,1),--this.size,0))},At.prototype.get=function(t){var e=this.__data__;return 0>(t=Yt(e,t))?L:e[t][1]},At.prototype.has=function(t){return-1<Yt(this.__data__,t)},At.prototype.set=function(t,e){var i=this.__data__,s=Yt(i,t);return 0>s?(++this.size,i.push([t,e])):i[s][1]=e,this},Rt.prototype.clear=function(){this.size=0,this.__data__={hash:new St,map:new(dr||At),string:new St}},Rt.prototype.delete=function(t){return t=$i(this,t).delete(t),this.size-=t?1:0,t},Rt.prototype.get=function(t){return $i(this,t).get(t)},Rt.prototype.has=function(t){return $i(this,t).has(t)},Rt.prototype.set=function(t,e){var i=$i(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this},Ft.prototype.add=Ft.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ft.prototype.has=function(t){return this.__data__.has(t)},Ht.prototype.clear=function(){this.__data__=new At,this.size=0},Ht.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},Ht.prototype.get=function(t){return this.__data__.get(t)},Ht.prototype.has=function(t){return this.__data__.has(t)},Ht.prototype.set=function(t,e){var i=this.__data__;if(i instanceof At){var s=i.__data__;if(!dr||199>s.length)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new Rt(s)}return i.set(t,e),this.size=i.size,this};var Ir=yi(fe),xr=yi(ge,!0),Er=Ti(),Pr=Ti(!0),Rr=yr?function(t,e){return yr.set(t,e),t}:cn,Mr=qn?function(t,e){return qn(t,"toString",{configurable:!0,enumerable:!1,value:un(e),writable:!0})}:cn,Br=Yn||function(t){return kt.clearTimeout(t)},Fr=gr&&1/F(new gr([,-0]))[1]==U?function(t){return new gr(t)}:fn,Hr=yr?function(t){return yr.get(t)}:fn,kr=er?function(t){return null==t?[]:(t=Sn(t),l(er(t),function(e){return zn.call(t,e)}))}:_n,Lr=er?function(t){for(var e=[];t;)p(e,kr(t)),t=jn(t);return e}:_n,Ur=Te;(pr&&"[object DataView]"!=Ur(new pr(new ArrayBuffer(1)))||dr&&"[object Map]"!=Ur(new dr)||fr&&"[object Promise]"!=Ur(fr.resolve())||gr&&"[object Set]"!=Ur(new gr)||_r&&"[object WeakMap]"!=Ur(new _r))&&(Ur=function(t){var e=Te(t);if(t=(t="[object Object]"==e?t.constructor:L)?ps(t):"")switch(t){case vr:return"[object DataView]";case wr:return"[object Map]";case Dr:return"[object Promise]";case Sr:return"[object Set]";case br:return"[object WeakMap]"}return e});var Wr=In?ks:mn,jr=hs(Rr),Nr=Zn||function(t,e){return kt.setTimeout(t,e)},zr=hs(Mr),Vr=function(t){var e=(t=Ps(t,function(t){return 500===e.size&&e.clear(),t})).cache;return t}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(et,function(t,i,s,n){e.push(s?n.replace(ct,"$1"):i||t)}),e}),Gr=Ne(function(t,e){return Fs(t)?he(t,de(e,1,Fs,!0)):[]}),Xr=Ne(function(t,e){var i=Ts(e);return Fs(i)&&(i=L),Fs(t)?he(t,de(e,1,Fs,!0),Xi(i,2)):[]}),$r=Ne(function(t,e){var i=Ts(e);return Fs(i)&&(i=L),Fs(t)?he(t,de(e,1,Fs,!0),L,i):[]}),qr=Ne(function(t){var e=c(t,ni);return e.length&&e[0]===t[0]?Se(e):[]}),Yr=Ne(function(t){var e=Ts(t),i=c(t,ni);return e===Ts(i)?e=L:i.pop(),i.length&&i[0]===t[0]?Se(i,Xi(e,2)):[]}),Jr=Ne(function(t){var e=Ts(t),i=c(t,ni);return(e="function"==typeof e?e:L)&&i.pop(),i.length&&i[0]===t[0]?Se(i,L,e):[]}),Zr=Ne(vs),Qr=ji(function(t,e){var i=null==t?0:t.length,s=ne(t,e);return Ue(t,c(e,function(t){return ts(t,i)?+t:t}).sort(ci)),s}),to=Ne(function(t){return Ze(de(t,1,Fs,!0))}),eo=Ne(function(t){var e=Ts(t);return Fs(e)&&(e=L),Ze(de(t,1,Fs,!0),Xi(e,2))}),io=Ne(function(t){var e="function"==typeof(e=Ts(t))?e:L;return Ze(de(t,1,Fs,!0),L,e)}),so=Ne(function(t,e){return Fs(t)?he(t,e):[]}),no=Ne(function(t){return ii(l(t,Fs))}),ro=Ne(function(t){var e=Ts(t);return Fs(e)&&(e=L),ii(l(t,Fs),Xi(e,2))}),oo=Ne(function(t){var e="function"==typeof(e=Ts(t))?e:L;return ii(l(t,Fs),L,e)}),ao=Ne(Ds),lo=Ne(function(t){var e;return Ss(t,e="function"==typeof(e=1<(e=t.length)?t[e-1]:L)?(t.pop(),e):L)}),ho=ji(function(t){var e=t.length,i=e?t[0]:0,s=this.__wrapped__,n=function(e){return ne(e,t)};return!(1<e||this.__actions__.length)&&s instanceof Dt&&ts(i)?((s=s.slice(i,+i+(e?1:0))).__actions__.push({func:Ks,args:[n],thisArg:L}),new S(s,this.__chain__).thru(function(t){return e&&!t.length&&t.push(L),t})):this.thru(n)}),uo=_i(function(t,e,i){En.call(t,i)?++t[i]:se(t,i,1)}),co=bi(gs),po=bi(_s),fo=_i(function(t,e,i){En.call(t,i)?t[i].push(e):se(t,i,[e])}),go=Ne(function(t,e,i){var s=-1,r="function"==typeof e,o=Bs(t)?yn(t.length):[];return Ir(t,function(t){o[++s]=r?n(e,t,i):be(t,e,i)}),o}),_o=_i(function(t,e,i){se(t,i,e)}),mo=_i(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]}),yo=Ne(function(t,e){if(null==t)return[];var i=e.length;return 1<i&&es(t,e[0],e[1])?e=[]:2<i&&es(e[0],e[1],e[2])&&(e=[e[0]]),He(t,de(e,1),[])}),To=Jn||function(){return kt.Date.now()},vo=Ne(function(t,e,i){var s=1;if(i.length){var n=B(i,Gi(vo));s=32|s}return Hi(t,s,e,i,n)}),wo=Ne(function(t,e,i){var s=3;if(i.length){var n=B(i,Gi(wo));s=32|s}return Hi(e,s,t,i,n)}),Do=Ne(function(t,e){return le(t,1,e)}),So=Ne(function(t,e,i){return le(t,Js(e)||0,i)});Ps.Cache=Rt;var bo=Ne(function(t,e){var i=(e=1==e.length&&Eo(e[0])?c(e[0],O(Xi())):c(de(e,1),O(Xi()))).length;return Ne(function(s){for(var r=-1,o=ar(s.length,i);++r<o;)s[r]=e[r].call(this,s[r]);return n(t,this,s)})}),Ko=Ne(function(t,e){return Hi(t,32,L,e,B(e,Gi(Ko)))}),Ao=Ne(function(t,e){return Hi(t,64,L,e,B(e,Gi(Ao)))}),Oo=ji(function(t,e){return Hi(t,256,L,L,L,e)}),Co=Ri(ve),Io=Ri(function(t,e){return t>=e}),xo=Ke(function(){return arguments}())?Ke:function(t){return js(t)&&En.call(t,"callee")&&!zn.call(t,"callee")},Eo=yn.isArray,Po=zt?O(zt):function(t){return js(t)&&"[object ArrayBuffer]"==Te(t)},Ro=ir||mn,Mo=Vt?O(Vt):function(t){return js(t)&&"[object Date]"==Te(t)},Bo=Gt?O(Gt):function(t){return js(t)&&"[object Map]"==Ur(t)},Fo=Xt?O(Xt):function(t){return js(t)&&"[object RegExp]"==Te(t)},Ho=$t?O($t):function(t){return js(t)&&"[object Set]"==Ur(t)},ko=qt?O(qt):function(t){return js(t)&&Us(t.length)&&!!Et[Te(t)]},Lo=Ri(Ee),Uo=Ri(function(t,e){return t<=e}),Wo=mi(function(t,e){if(ns(e)||Bs(e))gi(e,sn(e),t);else for(var i in e)En.call(e,i)&&Nt(t,i,e[i])}),jo=mi(function(t,e){gi(e,nn(e),t)}),No=mi(function(t,e,i,s){gi(e,nn(e),t,s)}),zo=mi(function(t,e,i,s){gi(e,sn(e),t,s)}),Vo=ji(ne),Go=Ne(function(t,e){t=Sn(t);var i=-1,s=e.length;for((n=2<s?e[2]:L)&&es(e[0],e[1],n)&&(s=1);++i<s;)for(var n,r=nn(n=e[i]),o=-1,a=r.length;++o<a;){var l=r[o],h=t[l];(h===L||Ms(h,Cn[l])&&!En.call(t,l))&&(t[l]=n[l])}return t}),Xo=Ne(function(t){return t.push(L,Li),n(Zo,L,t)}),$o=Oi(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Mn.call(e)),t[e]=i},un(cn)),qo=Oi(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Mn.call(e)),En.call(t,e)?t[e].push(i):t[e]=[i]},Xi),Yo=Ne(be),Jo=mi(function(t,e,i){Be(t,e,i)}),Zo=mi(function(t,e,i,s){Be(t,e,i,s)}),Qo=ji(function(t,e){var i={};if(null==t)return i;var s=!1;e=c(e,function(e){return e=oi(e,t),s||(s=1<e.length),e}),gi(t,zi(t),i),s&&(i=oe(i,7,Ui));for(var n=e.length;n--;)Qe(i,e[n]);return i}),ta=ji(function(t,e){return null==t?{}:function(t,e){return ke(t,e,function(e,i){return en(t,i)})}(t,e)}),ea=Fi(sn),ia=Fi(nn),sa=wi(function(t,e,i){return e=e.toLowerCase(),t+(i?an(e):e)}),na=wi(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),ra=wi(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),oa=vi("toLowerCase"),aa=wi(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}),la=wi(function(t,e,i){return t+(i?" ":"")+ua(e)}),ha=wi(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),ua=vi("toUpperCase"),ca=Ne(function(t,e){try{return n(t,L,e)}catch(t){return Hs(t)?t:new vn(t)}}),pa=ji(function(t,e){return o(e,function(e){e=cs(e),se(t,e,vo(t[e],t))}),t}),da=Ki(),fa=Ki(!0),ga=Ne(function(t,e){return function(i){return be(i,t,e)}}),_a=Ne(function(t,e){return function(i){return be(t,i,e)}}),ma=Ii(c),ya=Ii(a),Ta=Ii(g),va=Pi(),wa=Pi(!0),Da=Ci(function(t,e){return t+e},0),Sa=Bi("ceil"),ba=Ci(function(t,e){return t/e},1),Ka=Bi("floor"),Aa=Ci(function(t,e){return t*e},1),Oa=Bi("round"),Ca=Ci(function(t,e){return t-e},0);return i.after=function(t,e){if("function"!=typeof e)throw new An("Expected a function");return t=qs(t),function(){if(1>--t)return e.apply(this,arguments)}},i.ary=Is,i.assign=Wo,i.assignIn=jo,i.assignInWith=No,i.assignWith=zo,i.at=Vo,i.before=xs,i.bind=vo,i.bindAll=pa,i.bindKey=wo,i.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Eo(t)?t:[t]},i.chain=bs,i.chunk=function(t,e,i){if(e=(i?es(t,e,i):e===L)?1:or(qs(e),0),!(i=null==t?0:t.length)||1>e)return[];for(var s=0,n=0,r=yn(Qn(i/e));s<i;)r[n++]=Ve(t,s,s+=e);return r},i.compact=function(t){for(var e=-1,i=null==t?0:t.length,s=0,n=[];++e<i;){var r=t[e];r&&(n[s++]=r)}return n},i.concat=function(){var t=arguments.length;if(!t)return[];for(var e=yn(t-1),i=arguments[0];t--;)e[t-1]=arguments[t];return p(Eo(i)?fi(i):[i],de(e,1))},i.cond=function(t){var e=null==t?0:t.length,i=Xi();return t=e?c(t,function(t){if("function"!=typeof t[1])throw new An("Expected a function");return[i(t[0]),t[1]]}):[],Ne(function(i){for(var s=-1;++s<e;){var r=t[s];if(n(r[0],this,i))return n(r[1],this,i)}})},i.conforms=function(t){return function(t){var e=sn(t);return function(i){return ae(i,t,e)}}(oe(t,1))},i.constant=un,i.countBy=uo,i.create=function(t,e){var i=Cr(t);return null==e?i:ie(i,e)},i.curry=function t(e,i,s){return(e=Hi(e,8,L,L,L,L,L,i=s?L:i)).placeholder=t.placeholder,e},i.curryRight=function t(e,i,s){return(e=Hi(e,16,L,L,L,L,L,i=s?L:i)).placeholder=t.placeholder,e},i.debounce=Es,i.defaults=Go,i.defaultsDeep=Xo,i.defer=Do,i.delay=So,i.difference=Gr,i.differenceBy=Xr,i.differenceWith=$r,i.drop=function(t,e,i){var s=null==t?0:t.length;return s?Ve(t,0>(e=i||e===L?1:qs(e))?0:e,s):[]},i.dropRight=function(t,e,i){var s=null==t?0:t.length;return s?Ve(t,0,0>(e=s-(e=i||e===L?1:qs(e)))?0:e):[]},i.dropRightWhile=function(t,e){return t&&t.length?ti(t,Xi(e,3),!0,!0):[]},i.dropWhile=function(t,e){return t&&t.length?ti(t,Xi(e,3),!0):[]},i.fill=function(t,e,i,s){var n=null==t?0:t.length;if(!n)return[];for(i&&"number"!=typeof i&&es(t,e,i)&&(i=0,s=n),n=t.length,0>(i=qs(i))&&(i=-i>n?0:n+i),0>(s=s===L||s>n?n:qs(s))&&(s+=n),s=i>s?0:Ys(s);i<s;)t[i++]=e;return t},i.filter=function(t,e){return(Eo(t)?l:pe)(t,Xi(e,3))},i.flatMap=function(t,e){return de(Cs(t,e),1)},i.flatMapDeep=function(t,e){return de(Cs(t,e),U)},i.flatMapDepth=function(t,e,i){return i=i===L?1:qs(i),de(Cs(t,e),i)},i.flatten=ms,i.flattenDeep=function(t){return null!=t&&t.length?de(t,U):[]},i.flattenDepth=function(t,e){return null!=t&&t.length?de(t,e=e===L?1:qs(e)):[]},i.flip=function(t){return Hi(t,512)},i.flow=da,i.flowRight=fa,i.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,s={};++e<i;){var n=t[e];s[n[0]]=n[1]}return s},i.functions=function(t){return null==t?[]:_e(t,sn(t))},i.functionsIn=function(t){return null==t?[]:_e(t,nn(t))},i.groupBy=fo,i.initial=function(t){return null!=t&&t.length?Ve(t,0,-1):[]},i.intersection=qr,i.intersectionBy=Yr,i.intersectionWith=Jr,i.invert=$o,i.invertBy=qo,i.invokeMap=go,i.iteratee=pn,i.keyBy=_o,i.keys=sn,i.keysIn=nn,i.map=Cs,i.mapKeys=function(t,e){var i={};return e=Xi(e,3),fe(t,function(t,s,n){se(i,e(t,s,n),t)}),i},i.mapValues=function(t,e){var i={};return e=Xi(e,3),fe(t,function(t,s,n){se(i,s,e(t,s,n))}),i},i.matches=function(t){return Re(oe(t,1))},i.matchesProperty=function(t,e){return Me(t,oe(e,1))},i.memoize=Ps,i.merge=Jo,i.mergeWith=Zo,i.method=ga,i.methodOf=_a,i.mixin=dn,i.negate=Rs,i.nthArg=function(t){return t=qs(t),Ne(function(e){return Fe(e,t)})},i.omit=Qo,i.omitBy=function(t,e){return rn(t,Rs(Xi(e)))},i.once=function(t){return xs(2,t)},i.orderBy=function(t,e,i,s){return null==t?[]:(Eo(e)||(e=null==e?[]:[e]),Eo(i=s?L:i)||(i=null==i?[]:[i]),He(t,e,i))},i.over=ma,i.overArgs=bo,i.overEvery=ya,i.overSome=Ta,i.partial=Ko,i.partialRight=Ao,i.partition=mo,i.pick=ta,i.pickBy=rn,i.property=gn,i.propertyOf=function(t){return function(e){return null==t?L:me(t,e)}},i.pull=Zr,i.pullAll=vs,i.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?Le(t,e,Xi(i,2)):t},i.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?Le(t,e,L,i):t},i.pullAt=Qr,i.range=va,i.rangeRight=wa,i.rearg=Oo,i.reject=function(t,e){return(Eo(t)?l:pe)(t,Rs(Xi(e,3)))},i.remove=function(t,e){var i=[];if(!t||!t.length)return i;var s=-1,n=[],r=t.length;for(e=Xi(e,3);++s<r;){var o=t[s];e(o,s,t)&&(i.push(o),n.push(s))}return Ue(t,n),i},i.rest=function(t,e){if("function"!=typeof t)throw new An("Expected a function");return Ne(t,e=e===L?e:qs(e))},i.reverse=ws,i.sampleSize=function(t,e,i){return e=(i?es(t,e,i):e===L)?1:qs(e),(Eo(t)?function(t,e){return us(fi(t),re(e,0,t.length))}:function(t,e){var i=on(t);return us(i,re(e,0,i.length))})(t,e)},i.set=function(t,e,i){return null==t?t:ze(t,e,i)},i.setWith=function(t,e,i,s){return s="function"==typeof s?s:L,null==t?t:ze(t,e,i,s)},i.shuffle=function(t){return(Eo(t)?function(t){return us(fi(t))}:function(t){return us(on(t))})(t)},i.slice=function(t,e,i){var s=null==t?0:t.length;return s?(i&&"number"!=typeof i&&es(t,e,i)?(e=0,i=s):(e=null==e?0:qs(e),i=i===L?s:qs(i)),Ve(t,e,i)):[]},i.sortBy=yo,i.sortedUniq=function(t){return t&&t.length?qe(t):[]},i.sortedUniqBy=function(t,e){return t&&t.length?qe(t,Xi(e,2)):[]},i.split=function(t,e,i){return i&&"number"!=typeof i&&es(t,e,i)&&(e=i=L),(i=i===L?4294967295:i>>>0)?(t=Qs(t))&&("string"==typeof e||null!=e&&!Fo(e))&&(!(e=Je(e))&&Ct.test(t))?ai(k(t),0,i):t.split(e,i):[]},i.spread=function(t,e){if("function"!=typeof t)throw new An("Expected a function");return e=null==e?0:or(qs(e),0),Ne(function(i){var s=i[e];return i=ai(i,0,e),s&&p(i,s),n(t,this,i)})},i.tail=function(t){var e=null==t?0:t.length;return e?Ve(t,1,e):[]},i.take=function(t,e,i){return t&&t.length?Ve(t,0,0>(e=i||e===L?1:qs(e))?0:e):[]},i.takeRight=function(t,e,i){var s=null==t?0:t.length;return s?Ve(t,0>(e=s-(e=i||e===L?1:qs(e)))?0:e,s):[]},i.takeRightWhile=function(t,e){return t&&t.length?ti(t,Xi(e,3),!1,!0):[]},i.takeWhile=function(t,e){return t&&t.length?ti(t,Xi(e,3)):[]},i.tap=function(t,e){return e(t),t},i.throttle=function(t,e,i){var s=!0,n=!0;if("function"!=typeof t)throw new An("Expected a function");return Ws(i)&&(s="leading"in i?!!i.leading:s,n="trailing"in i?!!i.trailing:n),Es(t,e,{leading:s,maxWait:e,trailing:n})},i.thru=Ks,i.toArray=Xs,i.toPairs=ea,i.toPairsIn=ia,i.toPath=function(t){return Eo(t)?c(t,cs):Gs(t)?[t]:fi(Vr(Qs(t)))},i.toPlainObject=Zs,i.transform=function(t,e,i){var s=Eo(t),n=s||Ro(t)||ko(t);if(e=Xi(e,4),null==i){var r=t&&t.constructor;i=n?s?new r:[]:Ws(t)&&ks(r)?Cr(jn(t)):{}}return(n?o:fe)(t,function(t,s,n){return e(i,t,s,n)}),i},i.unary=function(t){return Is(t,1)},i.union=to,i.unionBy=eo,i.unionWith=io,i.uniq=function(t){return t&&t.length?Ze(t):[]},i.uniqBy=function(t,e){return t&&t.length?Ze(t,Xi(e,2)):[]},i.uniqWith=function(t,e){return e="function"==typeof e?e:L,t&&t.length?Ze(t,L,e):[]},i.unset=function(t,e){return null==t||Qe(t,e)},i.unzip=Ds,i.unzipWith=Ss,i.update=function(t,e,i){return null!=t&&(t=ze(t,e,(i=ri(i))(me(t,e)),void 0)),t},i.updateWith=function(t,e,i,s){return s="function"==typeof s?s:L,null!=t&&(t=ze(t,e,(i=ri(i))(me(t,e)),s)),t},i.values=on,i.valuesIn=function(t){return null==t?[]:C(t,nn(t))},i.without=so,i.words=hn,i.wrap=function(t,e){return Ko(ri(e),t)},i.xor=no,i.xorBy=ro,i.xorWith=oo,i.zip=ao,i.zipObject=function(t,e){return si(t||[],e||[],Nt)},i.zipObjectDeep=function(t,e){return si(t||[],e||[],ze)},i.zipWith=lo,i.entries=ea,i.entriesIn=ia,i.extend=jo,i.extendWith=No,dn(i,i),i.add=Da,i.attempt=ca,i.camelCase=sa,i.capitalize=an,i.ceil=Sa,i.clamp=function(t,e,i){return i===L&&(i=e,e=L),i!==L&&(i=(i=Js(i))==i?i:0),e!==L&&(e=(e=Js(e))==e?e:0),re(Js(t),e,i)},i.clone=function(t){return oe(t,4)},i.cloneDeep=function(t){return oe(t,5)},i.cloneDeepWith=function(t,e){return oe(t,5,e="function"==typeof e?e:L)},i.cloneWith=function(t,e){return oe(t,4,e="function"==typeof e?e:L)},i.conformsTo=function(t,e){return null==e||ae(t,e,sn(e))},i.deburr=ln,i.defaultTo=function(t,e){return null==t||t!=t?e:t},i.divide=ba,i.endsWith=function(t,e,i){t=Qs(t),e=Je(e);var s=t.length;s=i=i===L?s:re(qs(i),0,s);return 0<=(i-=e.length)&&t.slice(i,s)==e},i.eq=Ms,i.escape=function(t){return(t=Qs(t))&&q.test(t)?t.replace(X,Zt):t},i.escapeRegExp=function(t){return(t=Qs(t))&&st.test(t)?t.replace(it,"\\$&"):t},i.every=function(t,e,i){var s=Eo(t)?a:ue;return i&&es(t,e,i)&&(e=L),s(t,Xi(e,3))},i.find=co,i.findIndex=gs,i.findKey=function(t,e){return _(t,Xi(e,3),fe)},i.findLast=po,i.findLastIndex=_s,i.findLastKey=function(t,e){return _(t,Xi(e,3),ge)},i.floor=Ka,i.forEach=As,i.forEachRight=Os,i.forIn=function(t,e){return null==t?t:Er(t,Xi(e,3),nn)},i.forInRight=function(t,e){return null==t?t:Pr(t,Xi(e,3),nn)},i.forOwn=function(t,e){return t&&fe(t,Xi(e,3))},i.forOwnRight=function(t,e){return t&&ge(t,Xi(e,3))},i.get=tn,i.gt=Co,i.gte=Io,i.has=function(t,e){return null!=t&&Ji(t,e,we)},i.hasIn=en,i.head=ys,i.identity=cn,i.includes=function(t,e,i,s){return t=Bs(t)?t:on(t),i=i&&!s?qs(i):0,s=t.length,0>i&&(i=or(s+i,0)),Vs(t)?i<=s&&-1<t.indexOf(e,i):!!s&&-1<y(t,e,i)},i.indexOf=function(t,e,i){var s=null==t?0:t.length;return s?(0>(i=null==i?0:qs(i))&&(i=or(s+i,0)),y(t,e,i)):-1},i.inRange=function(t,e,i){return e=$s(e),i===L?(i=e,e=0):i=$s(i),(t=Js(t))>=ar(e,i)&&t<or(e,i)},i.invoke=Yo,i.isArguments=xo,i.isArray=Eo,i.isArrayBuffer=Po,i.isArrayLike=Bs,i.isArrayLikeObject=Fs,i.isBoolean=function(t){return!0===t||!1===t||js(t)&&"[object Boolean]"==Te(t)},i.isBuffer=Ro,i.isDate=Mo,i.isElement=function(t){return js(t)&&1===t.nodeType&&!zs(t)},i.isEmpty=function(t){if(null==t)return!0;if(Bs(t)&&(Eo(t)||"string"==typeof t||"function"==typeof t.splice||Ro(t)||ko(t)||xo(t)))return!t.length;var e=Ur(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(ns(t))return!xe(t).length;for(var i in t)if(En.call(t,i))return!1;return!0},i.isEqual=function(t,e){return Ae(t,e)},i.isEqualWith=function(t,e,i){var s=(i="function"==typeof i?i:L)?i(t,e):L;return s===L?Ae(t,e,L,i):!!s},i.isError=Hs,i.isFinite=function(t){return"number"==typeof t&&sr(t)},i.isFunction=ks,i.isInteger=Ls,i.isLength=Us,i.isMap=Bo,i.isMatch=function(t,e){return t===e||Oe(t,e,qi(e))},i.isMatchWith=function(t,e,i){return i="function"==typeof i?i:L,Oe(t,e,qi(e),i)},i.isNaN=function(t){return Ns(t)&&t!=+t},i.isNative=function(t){if(Wr(t))throw new vn("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ce(t)},i.isNil=function(t){return null==t},i.isNull=function(t){return null===t},i.isNumber=Ns,i.isObject=Ws,i.isObjectLike=js,i.isPlainObject=zs,i.isRegExp=Fo,i.isSafeInteger=function(t){return Ls(t)&&-9007199254740991<=t&&9007199254740991>=t},i.isSet=Ho,i.isString=Vs,i.isSymbol=Gs,i.isTypedArray=ko,i.isUndefined=function(t){return t===L},i.isWeakMap=function(t){return js(t)&&"[object WeakMap]"==Ur(t)},i.isWeakSet=function(t){return js(t)&&"[object WeakSet]"==Te(t)},i.join=function(t,e){return null==t?"":nr.call(t,e)},i.kebabCase=na,i.last=Ts,i.lastIndexOf=function(t,e,i){var s=null==t?0:t.length;if(!s)return-1;var n=s;if(i!==L&&(n=0>(n=qs(i))?or(s+n,0):ar(n,s-1)),e==e)t:{for(i=n+1;i--;)if(t[i]===e){t=i;break t}t=i}else t=m(t,v,n,!0);return t},i.lowerCase=ra,i.lowerFirst=oa,i.lt=Lo,i.lte=Uo,i.max=function(t){return t&&t.length?ce(t,cn,ve):L},i.maxBy=function(t,e){return t&&t.length?ce(t,Xi(e,2),ve):L},i.mean=function(t){return w(t,cn)},i.meanBy=function(t,e){return w(t,Xi(e,2))},i.min=function(t){return t&&t.length?ce(t,cn,Ee):L},i.minBy=function(t,e){return t&&t.length?ce(t,Xi(e,2),Ee):L},i.stubArray=_n,i.stubFalse=mn,i.stubObject=function(){return{}},i.stubString=function(){return""},i.stubTrue=function(){return!0},i.multiply=Aa,i.nth=function(t,e){return t&&t.length?Fe(t,qs(e)):L},i.noConflict=function(){return kt._===this&&(kt._=Fn),this},i.noop=fn,i.now=To,i.pad=function(t,e,i){t=Qs(t);var s=(e=qs(e))?H(t):0;return!e||s>=e?t:xi(tr(e=(e-s)/2),i)+t+xi(Qn(e),i)},i.padEnd=function(t,e,i){t=Qs(t);var s=(e=qs(e))?H(t):0;return e&&s<e?t+xi(e-s,i):t},i.padStart=function(t,e,i){t=Qs(t);var s=(e=qs(e))?H(t):0;return e&&s<e?xi(e-s,i)+t:t},i.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),hr(Qs(t).replace(rt,""),e||0)},i.random=function(t,e,i){if(i&&"boolean"!=typeof i&&es(t,e,i)&&(e=i=L),i===L&&("boolean"==typeof e?(i=e,e=L):"boolean"==typeof t&&(i=t,t=L)),t===L&&e===L?(t=0,e=1):(t=$s(t),e===L?(e=t,t=0):e=$s(e)),t>e){var s=t;t=e,e=s}return i||t%1||e%1?(i=ur(),ar(t+i*(e-t+Mt("1e-"+((i+"").length-1))),e)):We(t,e)},i.reduce=function(t,e,i){var s=Eo(t)?d:b,n=3>arguments.length;return s(t,Xi(e,4),i,n,Ir)},i.reduceRight=function(t,e,i){var s=Eo(t)?f:b,n=3>arguments.length;return s(t,Xi(e,4),i,n,xr)},i.repeat=function(t,e,i){return e=(i?es(t,e,i):e===L)?1:qs(e),je(Qs(t),e)},i.replace=function(){var t=arguments,e=Qs(t[0]);return 3>t.length?e:e.replace(t[1],t[2])},i.result=function(t,e,i){var s=-1,n=(e=oi(e,t)).length;for(n||(n=1,t=L);++s<n;){var r=null==t?L:t[cs(e[s])];r===L&&(s=n,r=i),t=ks(r)?r.call(t):r}return t},i.round=Oa,i.runInContext=t,i.sample=function(t){return(Eo(t)?Ut:function(t){return Ut(on(t))})(t)},i.size=function(t){if(null==t)return 0;if(Bs(t))return Vs(t)?H(t):t.length;var e=Ur(t);return"[object Map]"==e||"[object Set]"==e?t.size:xe(t).length},i.snakeCase=aa,i.some=function(t,e,i){var s=Eo(t)?g:Ge;return i&&es(t,e,i)&&(e=L),s(t,Xi(e,3))},i.sortedIndex=function(t,e){return Xe(t,e)},i.sortedIndexBy=function(t,e,i){return $e(t,e,Xi(i,2))},i.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var s=Xe(t,e);if(s<i&&Ms(t[s],e))return s}return-1},i.sortedLastIndex=function(t,e){return Xe(t,e,!0)},i.sortedLastIndexBy=function(t,e,i){return $e(t,e,Xi(i,2),!0)},i.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=Xe(t,e,!0)-1;if(Ms(t[i],e))return i}return-1},i.startCase=la,i.startsWith=function(t,e,i){return t=Qs(t),i=null==i?0:re(qs(i),0,t.length),e=Je(e),t.slice(i,i+e.length)==e},i.subtract=Ca,i.sum=function(t){return t&&t.length?K(t,cn):0},i.sumBy=function(t,e){return t&&t.length?K(t,Xi(e,2)):0},i.template=function(t,e,s){var n=i.templateSettings;s&&es(t,e,s)&&(e=L),t=Qs(t),e=No({},e,n,ki);var r,o,a=sn(s=No({},e.imports,n.imports,ki)),l=C(s,a),h=0;s=e.interpolate||vt;var u="__p+='";s=bn((e.escape||vt).source+"|"+s.source+"|"+(s===Z?pt:vt).source+"|"+(e.evaluate||vt).source+"|$","g");var c="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";if(t.replace(s,function(e,i,s,n,a,l){return s||(s=n),u+=t.slice(h,l).replace(wt,P),i&&(r=!0,u+="'+__e("+i+")+'"),a&&(o=!0,u+="';"+a+";\n__p+='"),s&&(u+="'+((__t=("+s+"))==null?'':__t)+'"),h=l+e.length,e}),u+="';",(e=e.variable)||(u="with(obj){"+u+"}"),u=(o?u.replace(N,""):u).replace(z,"$1").replace(V,"$1;"),u="function("+(e||"obj")+"){"+(e?"":"obj||(obj={});")+"var __t,__p=''"+(r?",__e=_.escape":"")+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+u+"return __p}",(e=ca(function(){return wn(a,c+"return "+u).apply(L,l)})).source=u,Hs(e))throw e;return e},i.times=function(t,e){if(1>(t=qs(t))||9007199254740991<t)return[];var i=4294967295,s=ar(t,4294967295);for(t-=4294967295,s=A(s,e=Xi(e));++i<t;)e(i);return s},i.toFinite=$s,i.toInteger=qs,i.toLength=Ys,i.toLower=function(t){return Qs(t).toLowerCase()},i.toNumber=Js,i.toSafeInteger=function(t){return t?re(qs(t),-9007199254740991,9007199254740991):0===t?t:0},i.toString=Qs,i.toUpper=function(t){return Qs(t).toUpperCase()},i.trim=function(t,e,i){return(t=Qs(t))&&(i||e===L)?t.replace(nt,""):t&&(e=Je(e))?ai(t=k(t),e=x(t,i=k(e)),i=E(t,i)+1).join(""):t},i.trimEnd=function(t,e,i){return(t=Qs(t))&&(i||e===L)?t.replace(ot,""):t&&(e=Je(e))?ai(t=k(t),0,e=E(t,k(e))+1).join(""):t},i.trimStart=function(t,e,i){return(t=Qs(t))&&(i||e===L)?t.replace(rt,""):t&&(e=Je(e))?ai(t=k(t),e=x(t,k(e))).join(""):t},i.truncate=function(t,e){var i=30,s="...";if(Ws(e)){var n="separator"in e?e.separator:n;i="length"in e?qs(e.length):i,s="omission"in e?Je(e.omission):s}var r=(t=Qs(t)).length;if(Ct.test(t)){var o=k(t);r=o.length}if(i>=r)return t;if(1>(r=i-H(s)))return s;if(i=o?ai(o,0,r).join(""):t.slice(0,r),n===L)return i+s;if(o&&(r+=i.length-r),Fo(n)){if(t.slice(r).search(n)){var a=i;for(n.global||(n=bn(n.source,Qs(dt.exec(n))+"g")),n.lastIndex=0;o=n.exec(a);)var l=o.index;i=i.slice(0,l===L?r:l)}}else t.indexOf(Je(n),r)!=r&&(-1<(n=i.lastIndexOf(n))&&(i=i.slice(0,n)));return i+s},i.unescape=function(t){return(t=Qs(t))&&$.test(t)?t.replace(G,Qt):t},i.uniqueId=function(t){var e=++Pn;return Qs(t)+e},i.upperCase=ha,i.upperFirst=ua,i.each=As,i.eachRight=Os,i.first=ys,dn(i,function(){var t={};return fe(i,function(e,s){En.call(i.prototype,s)||(t[s]=e)}),t}(),{chain:!1}),i.VERSION="4.17.11",o("bind bindKey curry curryRight partial partialRight".split(" "),function(t){i[t].placeholder=i}),o(["drop","take"],function(t,e){Dt.prototype[t]=function(i){i=i===L?1:or(qs(i),0);var s=this.__filtered__&&!e?new Dt(this):this.clone();return s.__filtered__?s.__takeCount__=ar(i,s.__takeCount__):s.__views__.push({size:ar(i,4294967295),type:t+(0>s.__dir__?"Right":"")}),s},Dt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),o(["filter","map","takeWhile"],function(t,e){var i=e+1,s=1==i||3==i;Dt.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Xi(t,3),type:i}),e.__filtered__=e.__filtered__||s,e}}),o(["head","last"],function(t,e){var i="take"+(e?"Right":"");Dt.prototype[t]=function(){return this[i](1).value()[0]}}),o(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");Dt.prototype[t]=function(){return this.__filtered__?new Dt(this):this[i](1)}}),Dt.prototype.compact=function(){return this.filter(cn)},Dt.prototype.find=function(t){return this.filter(t).head()},Dt.prototype.findLast=function(t){return this.reverse().find(t)},Dt.prototype.invokeMap=Ne(function(t,e){return"function"==typeof t?new Dt(this):this.map(function(i){return be(i,t,e)})}),Dt.prototype.reject=function(t){return this.filter(Rs(Xi(t)))},Dt.prototype.slice=function(t,e){t=qs(t);var i=this;return i.__filtered__&&(0<t||0>e)?new Dt(i):(0>t?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==L&&(i=0>(e=qs(e))?i.dropRight(-e):i.take(e-t)),i)},Dt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Dt.prototype.toArray=function(){return this.take(4294967295)},fe(Dt.prototype,function(t,e){var s=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),r=i[n?"take"+("last"==e?"Right":""):e],o=n||/^find/.test(e);r&&(i.prototype[e]=function(){var e=this.__wrapped__,a=n?[1]:arguments,l=e instanceof Dt,h=a[0],u=l||Eo(e),c=function(t){return t=r.apply(i,p([t],a)),n&&d?t[0]:t};u&&s&&"function"==typeof h&&1!=h.length&&(l=u=!1);var d=this.__chain__,f=!!this.__actions__.length;h=o&&!d,l=l&&!f;return!o&&u?(e=l?e:new Dt(this),(e=t.apply(e,a)).__actions__.push({func:Ks,args:[c],thisArg:L}),new S(e,d)):h&&l?t.apply(this,a):(e=this.thru(c),h?n?e.value()[0]:e.value():e)})}),o("pop push shift sort splice unshift".split(" "),function(t){var e=On[t],s=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);i.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var i=this.value();return e.apply(Eo(i)?i:[],t)}return this[s](function(i){return e.apply(Eo(i)?i:[],t)})}}),fe(Dt.prototype,function(t,e){var s=i[e];if(s){var n=s.name+"";(Tr[n]||(Tr[n]=[])).push({name:e,func:s})}}),Tr[Ai(L,2).name]=[{name:"wrapper",func:L}],Dt.prototype.clone=function(){var t=new Dt(this.__wrapped__);return t.__actions__=fi(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=fi(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=fi(this.__views__),t},Dt.prototype.reverse=function(){if(this.__filtered__){var t=new Dt(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Dt.prototype.value=function(){var t,e=this.__wrapped__.value(),i=this.__dir__,s=Eo(e),n=0>i,r=s?e.length:0;t=0;for(var o=r,a=this.__views__,l=-1,h=a.length;++l<h;){var u=a[l],c=u.size;switch(u.type){case"drop":t+=c;break;case"dropRight":o-=c;break;case"take":o=ar(o,t+c);break;case"takeRight":t=or(t,o-c)}}if(o=(t={start:t,end:o}).start,t=(a=t.end)-o,o=n?a:o-1,l=(a=this.__iteratees__).length,h=0,u=ar(t,this.__takeCount__),!s||!n&&r==t&&u==t)return ei(e,this.__actions__);s=[];t:for(;t--&&h<u;){for(n=-1,r=e[o+=i];++n<l;){c=(p=a[n]).type;var p=(0,p.iteratee)(r);if(2==c)r=p;else if(!p){if(1==c)continue t;break t}}s[h++]=r}return s},i.prototype.at=ho,i.prototype.chain=function(){return bs(this)},i.prototype.commit=function(){return new S(this.value(),this.__chain__)},i.prototype.next=function(){this.__values__===L&&(this.__values__=Xs(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?L:this.__values__[this.__index__++]}},i.prototype.plant=function(t){for(var e,i=this;i instanceof s;){var n=fs(i);n.__index__=0,n.__values__=L,e?r.__wrapped__=n:e=n;var r=n;i=i.__wrapped__}return r.__wrapped__=t,e},i.prototype.reverse=function(){var t=this.__wrapped__;return t instanceof Dt?(this.__actions__.length&&(t=new Dt(this)),(t=t.reverse()).__actions__.push({func:Ks,args:[ws],thisArg:L}),new S(t,this.__chain__)):this.thru(ws)},i.prototype.toJSON=i.prototype.valueOf=i.prototype.value=function(){return ei(this.__wrapped__,this.__actions__)},i.prototype.first=i.prototype.head,Xn&&(i.prototype[Xn]=function(){return this}),i}();kt._=te,void 0===(s=function(){return te}.call(e,i,e,t))||(t.exports=s)}.call(this),window.DKTools={},Object.defineProperties(DKTools,{SITE:{value:"https://dk-plugins.ru"},VERSION:{value:Imported.DKTools}}),DKTools.Sprite=function(t,e,i,s){this.initialize.apply(this,arguments)},DKTools.Window=function(t,e,i,s){this.initialize.apply(this,arguments)},DKTools.Scene=function(){this.initialize.apply(this,arguments)},DKTools.Utils=class{constructor(){return DKTools.Utils}static initialize(){this._saidHello=!1,this._isNwjs=Utils.isNwjs(),this._isTest=!!Utils.isOptionValid("test"),this._isMobileDevice=Utils.isMobileDevice(),this._isMobileSafari=Utils.isMobileSafari(),this._isAndroidChrome=Utils.isAndroidChrome(),this._gridSize=64,this._sayHello(),this.__tileSize(),this.__imageCacheLimit(),n.get("Debugging Console","Enabled")&&this.openConsole(),n.get("Check Updates","Enabled")&&this._checkUpdates()}static async _checkUpdates(){if(!this.isNwjs()||!this.isTest())return;let t=[];try{const e=new FormData;e.append("version",DKTools.VERSION),t=await DKTools.Network.fetchJson(`${DKTools.SITE}/plugins.php`,{method:"POST",body:e})}catch(t){return void console.error("DKTools can not check updates")}const e=n.get("Check Updates","Show New Plugins");_.forEach(t,t=>{const i=t.version;if(DKTools.PluginManager.isRegistered(t.name)){if(i>DKTools.PluginManager.getVersion(t.name)){const e=[`Available a new version of ${t.name}: ${i} \n`,`Visit site: ${t.url} \n`,`Download: ${DKTools.SITE}/download/${t.name}.js`];console.log.apply(console,e)}}else if(e){const e=[`Try the new plugin: ${t.name} \n`,`Description: ${t.description} \n`,`Visit site: ${t.url} \n`,`Download: ${DKTools.SITE}/download/${t.name}.js`];console.log.apply(console,e)}})}static _getErrorLogData(){const t=SceneManager._scene,e={};if(t&&t.constructor.name&&(e.Scene=t.constructor.name,SceneManager.isCurrentScene(Scene_Map))){const t=$gameMap._interpreter;if(t){if(t._mapId>0&&(e["Map ID"]=t._mapId),t._eventId>0){e["Event ID"]=t._eventId;const i=$gameMap.event(t._eventId);i&&(e["Event Page"]=i._pageIndex+1)}if(t._list&&t._list.length>0){let i=t._list[t._index];i&&0===i.code&&t._index>0&&(i=t._list[t._index-1]),i&&i.code>0&&(e["Last Event Command"]=i.code)}t._params&&t._params.length>0&&(e.Params=JSON.stringify(t._params))}}return e}static __hideGrid(){this._gridSprite&&(SceneManager._scene.removeChild(this._gridSprite),this._gridSprite=null)}static __imageCacheLimit(){const t=n.get("Image Cache Limit");t.Enabled&&(ImageCache.limit=t.Limit)}static isAndroidChrome(){return this._isAndroidChrome}static isArrayLike(t){return!!Array.isArray(t)||"[object Arguments]"===String(t)}static isBoolean(t){return"boolean"==typeof t}static isFunction(t){return"function"==typeof t}static isMobileDevice(){return this._isMobileDevice}static isMobileSafari(){return this._isMobileSafari}static isNumber(t){return Number.isFinite(t)}static isNwjs(){return this._isNwjs}static isString(t){return!!t&&"string"==typeof t}static isTest(){return this._isTest}static async logError(t){if(!t||!this.isNwjs())return;const e=n.get("Errors Log"),i=DKTools.Utils.isTest(),s=e.Enabled;if("None"===s||"Only Game"===s&&i||"Only Test"===s&&!i)return;const r=DKTools.IO.fs,o=DKTools.IO.os;if(!r||!o)return;const a=1024*e["File Size"]*1024,l=e.Filename,h=new DKTools.IO.File(l),u=await h.getStatsAsync().then(t=>t.data);if(u&&u.size>a){const t=DKTools.IO.parsePath(l).name,e=new Date,i=String(e.getDate()).padZero(2),s=String(e.getMonth()+1).padZero(2),n=e.getFullYear(),r=String(e.getHours()).padZero(2),o=String(e.getMinutes()).padZero(2),a=String(e.getSeconds()).padZero(2);await h.renameAsync(`${i}.${s}.${n}_${r}.${o}.${a}_${t}`)}const c=await r.openSync(l,"a"),p=this._getErrorLogData();let d=`Date: ${(new Date).toString()}`+o.EOL;_.forEach(p,(t,e)=>{d+=e+": "+t+o.EOL}),t instanceof Object?(d+=`Name: ${t.name}`+o.EOL,d+=`Message: ${t.message}`+o.EOL,void 0!==t.filename&&(d+=`Filename: ${t.filename}`+o.EOL),void 0!==t.lineNumber&&(d+=`Line: ${t.lineNumber}`+o.EOL),void 0!==t.columnNumber&&(d+=`Column: ${t.columnNumber}`+o.EOL),d+=`Stack: ${t.stack}`+o.EOL+o.EOL):d+=`Error: ${t}`+o.EOL+o.EOL,await r.writeSync(c,d),await r.closeSync(c)}static makeScreenshot(){if(!this.isNwjs())return;const t=n.get("Screenshots"),e=t.Path,i=t.Type,s=t.Quality,r=SceneManager.snap().canvas.toDataURL("image/"+i,s),o=new RegExp(`^data:image/${i};base64,`),a=r.replace(o,""),l=new Date;let h=t.Filename;const u=(h=(h=(h=(h=(h=(h=h.replace(/%year/gi,l.getFullYear())).replace(/%month/gi,l.getMonth()+1)).replace(/%day/gi,l.getDate())).replace(/%hours/gi,l.getHours())).replace(/%minutes/gi,l.getMinutes())).replace(/%seconds/gi,l.getSeconds()))+"."+i,c=DKTools.IO.normalizePath(e+"/"+u);new DKTools.IO.File(c).save(a,{createDirectory:!0,options:"base64"}),console.log("The screenshot is saved with the name: "+u)}static mixin(t,e){Object.defineProperties(t,Object.getOwnPropertyDescriptors(e))}static openConsole(){if(this.isTest()&&this.isNwjs())try{const t=i(2).Window.get();t.showDevTools(null,()=>t.focus())}catch(t){this.logError(t),console.error("DKTools can not open the console")}}static __tileSize(){const t=n.get("Tile Size");t.Enabled&&(Tilemap.TILE_WIDTH=t.Size,Tilemap.TILE_HEIGHT=t.Size)}static throwError(t){setTimeout(()=>{throw t},0)}static __quickLoad(){if(!DKTools.Utils.isTest()||!n.get("Quick Load","Enabled"))return;const t=n.get("Quick Load","Savefile ID"),e=SceneManager._scene;t>0?DataManager.loadGame(t)&&(SoundManager.playLoad(),e instanceof Scene_Base&&e.fadeOutAll(),$gameSystem.versionId()!==$dataSystem.versionId&&($gamePlayer.reserveTransfer($gameMap.mapId(),$gamePlayer.x,$gamePlayer.y),$gamePlayer.requestMapReload()),SceneManager.goto(Scene_Map)):e instanceof Scene_Load||SceneManager.push(Scene_Load)}static _sayHello(){if(!this._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>=0){const t=[`%c %c %c DKTools.js ${DKTools.VERSION} %c  %c  ${DKTools.SITE}  %c \n`,"background: #279EE8; padding:5px 0;","background: #279EE8; padding:5px 0;","color: #4CCBF5; background: #030307; padding:5px 0;","background: #279EE8; padding:5px 0;","background: #BDE5F2; padding:5px 0;","background: #279EE8; padding:5px 0;"];console.log.apply(console,t)}else window.console&&console.log(`DKTools.js ${DKTools.VERSION} - ${DKTools.SITE}`);this._saidHello=!0}}static __showGrid(){if(!DKTools.Utils.isTest()||!n.get("Grid","Enabled"))return;if(this._gridSprite)return void(this._gridSize>=32?(this._gridSize-=16,this._gridSprite.refreshAll()):(this._gridSize=64,this.__hideGrid()));const t=n.get("Grid");let e=null;this._gridSprite=new DKTools.Sprite.Button(Graphics),this._gridSprite.addEvent({type:"draw-all",onUpdate:()=>{const i=Graphics.boxWidth,s=Graphics.boxHeight,n=this._gridSize,r=t["Grid Color"],o=t["Grid Width"];_.times(Math.ceil(i/n),t=>{this._gridSprite.drawLine({x1:n*t,y1:0,x2:n*t,y2:s,color:r,lineWidth:o})}),_.times(Math.ceil(s/n),t=>{this._gridSprite.drawLine({x1:0,y1:n*t,x2:i,y2:n*t,color:r,lineWidth:o})}),e&&this._gridSprite.drawLine({x1:e.x,y1:e.y,x2:TouchInput.mouseX,y2:TouchInput.mouseY,color:e.color,lineWidth:t["Ruler Width"]})}}),this._gridSprite.addEvent({type:"mouse-inside",onUpdate:()=>{const t=TouchInput.mouseX,e=TouchInput.mouseY,s=Graphics.boxWidth,n=Graphics.boxHeight;let r=t+8,o=e+8;r+i.width>s&&(r=t-i.width-8),o+i.height>n&&(o=e-i.height-8),i.move(r,o),i.refreshAll()}}),this._gridSprite.addEvent({type:"mouse-down-middle",onUpdate:()=>{e||(e={x:TouchInput.mouseX,y:TouchInput.mouseY,color:t["Ruler Color"]||DKTools.Utils.Random.getHexColor()}),this._gridSprite.refreshAll()}}),this._gridSprite.addEvent({type:"mouse-up-middle",onUpdate:()=>{e=null,this._gridSprite.refreshAll()}}),this._gridSprite.start(!0);const i=new DKTools.Sprite(0,0,220,"2");i.addEvent({type:"draw-all",onUpdate:()=>{if(e){const t={x:TouchInput.mouseX,y:TouchInput.mouseY},s=Math.floor(DKTools.Utils.Point.getDistance(e,t));i.drawText(`line: ${s} (${e.x}, ${e.y})`,{y:"0",align:"left"})}i.drawText(`x: ${TouchInput.mouseX}, y: ${TouchInput.mouseY}`,{y:"1",align:"left"})}}),i.start(),this._gridSprite.addChild(i),this._gridSprite.updateMouseInsideEvents(),SceneManager._scene.addChild(this._gridSprite)}},DKTools.Utils.Object=class{static toCamelCase(t){return _.forEach(_.keys(t),e=>{const i=_.camelCase(e);i!==e&&(t[i]=t[e],delete t[e])}),t}},DKTools.Utils.Number=class{static clamp(t,e,i){return _.clamp(t,e,i)}static inRange(t,e,i){return _.inRange(t,e,i)}},DKTools.Utils.String=class{static toBooleanArray(t){return _.map(this.toStringArray(t),Boolean)}static toNumberArray(t){return _.map(this.toStringArray(t),Number)}static toStringArray(t){return t.trim().replace(/\s*\,\s*/g,",").split(",")}},DKTools.Utils.Array=class{static avg(t){return this.sum(t)/t.length}static compact(t){return _.pull(t,"",null,void 0,Number.NaN)}static conjunction(t){return _.every(t,_.isEqual.bind(this,!0))}static contains(t,e){return _.includes(t,e)}static count(t,e){return _.size(t)-_.size(_.without(t,e))}static counts(t,e){return _.size(t)-_.size(_.difference(t,e))}static disjunction(t){return _.some(t,_.isEqual.bind(this,!0))}static insert(t,e,i=0){t.splice(i,0,e)}static isBitmapArray(t){return _.every(t,t=>t instanceof Bitmap)}static isBooleanArray(t){return _.every(t,t=>DKTools.Utils.isBoolean(t))}static isEmpty(t){return _.isEmpty(t)}static isNumberArray(t){return _.every(t,t=>DKTools.Utils.isNumber(t))}static isSpriteArray(t){return _.every(t,t=>t instanceof Sprite)}static isStringArray(t){return _.every(t,t=>DKTools.Utils.isString(t))}static isWindowArray(t){return _.every(t,t=>t instanceof Window)}static max(t){return Math.max.apply(Math,t)}static min(t){return Math.min.apply(Math,t)}static remove(t,e){return _.pull(t,e)}static sum(t){return _.reduce(t,(t,e)=>t+=e,0)}},DKTools.Utils.Point=class{static clone(t=0,e=0){return this.toPoint(t,e)}static equals(t,e=0,i=0){if(0===arguments.length)return!1;const s=this.toPoint(e,i);return(t=this.toPoint(t)).x===s.x&&t.y===s.y}static getDistance(t,e=0,i=0){const s=this.toPoint(e,i);return t=this.toPoint(t),Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}static toArray(t){return[t.x,t.y]}static toPoint(t=0,e=0){const i=this.tryToPoint(t,e);if(null!==i)return i;const s=t=>Number.isFinite(t)?t:0;let n;return t instanceof Object&&(n=t.x,e=t.y),n=s(n),e=s(e),new Point(n,e)}static tryToPoint(t,e){let i,s;return t instanceof Object?(i=t.x,s=t.y):(i=t,s=e),DKTools.Utils.Array.isNumberArray([i,s])?new Point(i,s):null}},DKTools.Utils.Rectangle=class{static clone(t=0,e=0,i=0,s=0){return this.toRectangle(t,e,i,s)}static equals(t,e=0,i=0,s=0,n=0){if(0===arguments.length)return!1;const r=this.toRectangle(e,i,s,n);return(t=this.toRectangle(t)).x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height}static isEmpty(t){return this.equals(t,Rectangle.emptyRectangle)}static toArray(t){return[t.x,t.y,t.width,t.height]}static toRectangle(t=0,e=0,i=0,s=0){const n=this.tryToRectangle(t,e,i,s);if(n)return n;const r=t=>Number.isFinite(t)?t:0;let o;return t instanceof Object&&(o=t.x,e=t.y,i=t.width,s=t.height),o=r(o),e=r(e),i=r(i),s=r(s),new Rectangle(o,e,i,s)}static tryToRectangle(t,e,i,s){let n,r,o,a;return t instanceof Object?(n=t.x,r=t.y,o=t.width,a=t.height):(n=t,r=e,o=i,a=s),DKTools.Utils.Array.isNumberArray([n,r,o,a])?new Rectangle(n,r,o,a):null}},DKTools.Utils.WebAudio=class{static load(t,e,i){if(!t)return null;if(t instanceof WebAudio)return t;if(DKTools.Utils.isArrayLike(t))return this.load.apply(this,t);if(t instanceof Object)return this.load(t.folder,t.filename,t.listener,t.hue,t.smooth);if(!DKTools.Utils.isString(t))return null;const s=AudioManager.createBuffer(t,e);return DKTools.Utils.isFunction(i)&&s.addLoadListener(i),s}static async loadAsync(t,e,i){return new Promise(s=>{const n=this.load(t,e,i);n?n.addLoadListener(()=>s(n)):s(n)})}static loadBuffers(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.load(t));const s=[];let n=0;const r=(r,o)=>{e&&(s[r]=o,n++,DKTools.Utils.isFunction(i)&&i(o,s,t),t.length===n&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof WebAudio?t.addLoadListener(t=>r(e,t)):r(e,t)})}static async loadBuffersAsync(t){const e=_.map(t,t=>this.loadAsync(t));return Promise.all(e)}},DKTools.Utils.Bitmap=class{static clone(t){if(!t||t.url)return t;const e=t.canvas,i=new Bitmap(e.width,e.height);return i.context.drawImage(e,0,0),i}static drawLine(t,e,i,s,n,r="white",o=1){const a=t.context;a.save(),a.strokeStyle=r,a.lineWidth=o,a.beginPath(),a.moveTo(e,i),a.lineTo(s,n),a.stroke(),a.restore(),t._setDirty()}static fillArc(t,e,i,s,n,r,o="white",a=!1){const l=t.context;l.save(),l.fillStyle=o,l.beginPath(),l.arc(e,i,s,n,r,a),l.fill(),l.restore(),t._setDirty()}static getBase64(t){return t&&t.canvas?t.canvas.toDataURL("image/png"):null}static load(t,e,i,s,n){if(!t)return null;if(t instanceof Bitmap)return t;if(DKTools.Utils.isArrayLike(t))return this.load.apply(this,t);if(t instanceof Object)return this.load(t.folder,t.filename,t.listener,t.hue,t.smooth);if(!DKTools.Utils.isString(t))return null;const r=DKTools.IO.normalizePath(t+"/",!0),o=ImageManager.loadBitmap(r,e,s,n);return DKTools.Utils.isFunction(i)&&o.addLoadListener(i),o}static async loadAsync(t,e,i,s,n){return new Promise(r=>{const o=this.load(t,e,i,s,n);o?o.addLoadListener(()=>r(o)):r(o)})}static loadBitmaps(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.load(t));const s=[];let n=0;const r=(r,o)=>{e&&(s[r]=o,n++,DKTools.Utils.isFunction(i)&&i(o,s,t),t.length===n&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof Bitmap?t.addLoadListener(t=>r(e,t)):r(e,t)})}static async loadBitmapsAsync(t){Array.isArray(t)||(t=[t]);const e=_.map(t,t=>this.loadAsync(t));return Promise.all(e)}static reserve(t,e,i,s,n,r){if(!t)return null;if(t instanceof Bitmap)return t;if(DKTools.Utils.isArrayLike(t))return this.reserve.apply(this,t);if(t instanceof Object)return this.reserve(t.folder,t.filename,t.listener,t.hue,t.smooth,t.reservationId);if(!DKTools.Utils.isString(t))return null;const o=DKTools.IO.normalizePath(t+"/",!0),a=ImageManager.reserveBitmap(o,e,s,n,r);return DKTools.Utils.isFunction(i)&&a.addLoadListener(i),a}static async reserveAsync(t,e,i,s,n,r){return new Promise(o=>{const a=this.reserve(t,e,i,s,n,r);a?a.addLoadListener(()=>o(a)):o(a)})}static reserveBitmaps(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.reserve(t));const s=[];let n=0;const r=(r,o)=>{e&&(s[r]=o,n++,DKTools.Utils.isFunction(i)&&i(o,s,t),t.length===n&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof Bitmap?t.addLoadListener(t=>r(e,t)):r(e,t)})}static async reserveBitmapsAsync(t){Array.isArray(t)||(t=[t]);const e=_.map(t,t=>this.reserveAsync(t));return Promise.all(e)}static strokeArc(t,e,i,s,n,r,o="white",a=1,l=!1){const h=t.context;h.save(),h.strokeStyle=o,h.lineWidth=a,h.beginPath(),h.arc(e,i,s,n,r,l),h.stroke(),h.restore(),t._setDirty()}static strokeRect(t,e,i,s,n,r="white",o=1){const a=t.context;a.save(),a.strokeStyle=r,a.lineWidth=o,a.strokeRect(e,i,s,n),a.restore(),t._setDirty()}},DKTools.Utils.Event=class{static getAllComments(t){return Number.isFinite(t)&&(t=$gameMap.event(t)),t?(t instanceof Game_Event&&(t=t.event()),_.reduce(t.pages,(t,e,i)=>(t[i+1]=_.reduce(e.list,(t,e)=>(108!==e.code&&408!==e.code||t.push(e.parameters[0]),t),[]),t),{})):[]}static getComments(t){return Number.isFinite(t)&&(t=$gameMap.event(t)),t&&t.page()?_.reduce(t.list(),(t,e)=>(108!==e.code&&408!==e.code||t.push(e.parameters[0]),t),[]):[]}},DKTools.Utils.Random=class{constructor(){return DKTools.Utils.Random}static getBoolean(){return this.getInt(1)%2==0}static getFloat(t=1){return _.random(0,t,!0)}static getHexColor(){return"#"+(16777215*Math.random()<<0).toString(16)}static getInt(t=1){return _.random(0,t)}static getRgbaColor(t=1){const e=this.getInt(255),i=this.getInt(255),s=this.getInt(255);return"rgba(%1, %2, %3, %4)".format(e,i,s,t)}},DKTools.IO=class{constructor(){return DKTools.IO}static initialize(){let t="";this.isLocalMode()&&(this._fs=i(3),this._os=i(4),this._path=i(5),t=this.joinPath(this._path.dirname(process.mainModule.filename),"/")),this._projectPath=t,this._mode=n.get("File System","Mode"),this._stamp={},this._loadStamp(),this._createStamp()}static absolutePathExists(t){if(this.isLocalMode())return this._fs.existsSync(t);if(this.mode===DKTools.IO.MODE_NWJS_STAMP&&t.startsWith(this._projectPath)){if(this.isFile(t))return!0;if(this.isDirectory(t))return!0}return!1}static _createStamp(){if(!DKTools.Utils.isTest()||!this.isLocalMode()||this.mode===DKTools.IO.MODE_NWJS)return;const t=n.get("File System","Ignored Directories").map(t=>new DKTools.IO.Directory(t)),e=DKTools.IO.getRootDirectory(),i=this._stamp;let s=null;const r=e=>{t.some(t=>t.getFullPath()===e.getFullPath())||e.getAllAsync().then(t=>t.data).then(t=>{t.forEach(t=>{t.getStatsAsync().then(t=>t.data).then(e=>{const n=t.getFullPath().substring(1).split("\\");t.isFile()?_.set(i,n,{__stats__:{...e,type:"file"}}):_.set(i,n,{__stats__:{...e,type:"directory"}}),s&&clearTimeout(s),s=setTimeout(()=>{new DKTools.IO.File("data/Stamp.json").saveJsonAsync(i,{compress:!0})})}),t.isDirectory()&&r(t)})})};r(e)}static getRootDirectory(){return new DKTools.IO.Directory}static getAbsolutePath(t){const e=this.joinPath(this._projectPath,t||"");return this.normalizePath(e)}static isLocalMode(){return DKTools.Utils.isNwjs()}static isFile(t){if(this.isLocalMode()){const e=this.getAbsolutePath(t);if(this.absolutePathExists(e))return this._fs.lstatSync(e).isFile()}else if(this.mode===DKTools.IO.MODE_NWJS_STAMP){const e=this.normalizePath(t).split("\\");if(_.last(e).includes("."))return"file"===_.get(this._stamp,e.concat("__stats__"),{}).type}return!1}static isDirectory(t){if(this.isLocalMode()){const e=this.getAbsolutePath(t);if(this.absolutePathExists(e))return this._fs.lstatSync(e).isDirectory()}else if(this.mode===DKTools.IO.MODE_NWJS_STAMP){const e=this.normalizePath(t).split("\\").filter(t=>!!t);if(!_.last(e).includes("."))return"directory"===_.get(this._stamp,e.concat("__stats__"),{}).type}return!1}static joinPath(){if(this.isLocalMode())return this._path.join(...arguments);const t=_.filter(arguments,t=>DKTools.Utils.isString(t));let e=t.join("\\");return/^[\\\/]{2}[^\\\/]/.test(t[0])||(e=e.replace(/^[\\\/]{2,}/,"\\")),this.normalizePath(e)}static _loadStamp(){if(this.isLocalMode()||this.mode===DKTools.IO.MODE_NWJS)return;new DKTools.IO.File("data/Stamp.json").loadJson({sync:!0,decompress:!0,onSuccess:t=>{this._stamp=t.data||this._stamp}})}static normalizePath(t,e=!1){if(this.isLocalMode()){const i=this._path.normalize(t);return e?i.replace(/\\/g,"/"):i}const i=this._statPath(t),s=i.isUnc,n=i.isAbsolute;let r=i.device,o=i.tail;const a=/[\\\/]$/.test(o),l=_.filter(o.split(/[\\\/]+/),t=>t&&"."!==t),h=[];for(const t of l)".."===t?h.length>0&&".."!==h[h.length-1]?h.pop():n||h.push(".."):h.push(t);(o=h.join("\\"))||n||(o="."),o&&a&&(o+="\\"),s&&(r="\\\\"+r.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\"));const u=r+(n?"\\":"")+o;return e?u.replace(/\\/g,"/"):u}static parsePath(t){if(this.isLocalMode())return this._path.parse(t);const e=this._splitPath(t);return{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}}static pathExists(t){return this.absolutePathExists(this.getAbsolutePath(t))}static _statPath(t){const e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=e[1]||"",s=!!i&&":"!==i[1];return{device:i,isUnc:s,isAbsolute:s||!!e[2],tail:e[3]}}static _splitPath(t){const e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=(e[1]||"")+(e[2]||""),s=e[3]||"",n=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/.exec(s);return[i,n[1],n[2],n[3]]}},Object.defineProperties(DKTools.IO,{fs:{get:function(){return this._fs},configurable:!0},os:{get:function(){return this._os},configurable:!0},path:{get:function(){return this._path},configurable:!0},sep:{get:function(){return this.isLocalMode()?this._path.sep:"/"},configurable:!0},projectPath:{get:function(){return this._projectPath},configurable:!0},mode:{get:function(){return this._mode},configurable:!0},stamp:{get:function(){return this._stamp},configurable:!0},OK:{value:0},EXPECT_CALLBACK:{value:1},ERROR_NOT_LOCAL_MODE:{value:2},ERROR_PATH_DOES_NOT_EXIST:{value:3},ERROR_CALLBACK_IS_NOT_AVAILABLE:{value:4},ERROR_DIRECTORY_ALREADY_EXISTS:{value:5},ERROR_DIRECTORY_IS_NOT_EMPTY:{value:6},ERROR_OVERWRITING_IS_NOT_AVAILABLE:{value:7},ERROR_OPTIONS_ARE_NOT_AVAILABLE:{value:8},ERROR_DECOMPRESSING_DATA:{value:9},ERROR_PARSING_DATA:{value:10},MODE_NWJS_STAMP:{value:0},MODE_NWJS:{value:1}}),DKTools.IO.Entity=class{constructor(){this.initialize.apply(this,arguments)}initialize(t=""){const e=DKTools.IO.parsePath(t);this._path=DKTools.IO.normalizePath(e.dir+"/"),this._name=e.name,this._initialExtension=e.ext,this._extension=e.ext}exists(){return DKTools.IO.absolutePathExists(this.getAbsolutePath())}getPath(){return this._path}getName(){return this._name}getExtension(){return this._extension}getFullPath(){return DKTools.IO.joinPath(this.getPath(),"/",this.getFullName())}getFullName(){return this._name+this._extension}getAbsolutePath(){return DKTools.IO.getAbsolutePath(this.getFullPath())}getStats(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode()&&DKTools.IO.mode===DKTools.IO.MODE_NWJS)return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};if(!DKTools.IO.isLocalMode()&&DKTools.IO.mode===DKTools.IO.MODE_NWJS_STAMP){const t=this.getFullPath().split("\\").filter(t=>!!t);return{data:_.get(DKTools.IO.stamp,t.concat("__stats__"),{}),status:DKTools.IO.OK}}const e=DKTools.IO.fs,i=this.getAbsolutePath();if(!t.sync)return e.stat(i,(e,i)=>{e?this.__processError(e,t.onError):t.onSuccess({data:i,status:DKTools.IO.OK},this)}),{data:null,status:DKTools.IO.EXPECT_CALLBACK};try{return{data:e.statSync(i),status:DKTools.IO.OK}}catch(e){this.__processError(e,t.onError)}}async getStatsAsync(){return new Promise((t,e)=>{const i=this.getStats({sync:!1,onSuccess:t,onError:e});i.status!==DKTools.IO.EXPECT_CALLBACK&&t(i)})}hasExtension(){return!!this._extension}isFile(){if(this instanceof DKTools.IO.File){if(DKTools.IO.isLocalMode()){if(Decrypter.hasEncryptedAudio&&this.isAudio()||Decrypter.hasEncryptedImages&&this.isImage()){const t=DKTools.IO.normalizePath(this.getPath()+"/"+Decrypter.extToEncryptExt(this.getFullName()));return DKTools.IO.isFile(t)}return DKTools.IO.isFile(this.getFullPath())}return!!this.hasExtension()}return!1}isDirectory(){return this instanceof DKTools.IO.Directory&&(DKTools.IO.isLocalMode()?DKTools.IO.isDirectory(this.getFullPath()):!this.hasExtension())}__processError(t,e){DKTools.Utils.isFunction(e)?e(t,this):DKTools.Utils.throwError(t)}rename(t,e={}){if(e=e||{},!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const i=DKTools.IO.fs,s=this.getAbsolutePath(),n=DKTools.IO.normalizePath(this._path+"/"+t+this._extension),r=DKTools.IO.getAbsolutePath(n);if(!e.overwrite&&DKTools.IO.absolutePathExists(r))return DKTools.IO.ERROR_OVERWRITING_IS_NOT_AVAILABLE;if(!e.sync)return i.rename(s,r,i=>{i?this.__processError(i,e.onError):(this._name=t,DKTools.Utils.isFunction(e.onSuccess)&&e.onSuccess(DKTools.IO.OK,this))}),DKTools.IO.EXPECT_CALLBACK;try{return i.renameSync(s,r),this._name=t,DKTools.IO.OK}catch(t){this.__processError(t,e.onError)}}async renameAsync(t,e={}){return new Promise((i,s)=>{const n=this.rename(t,{...e,sync:!1,onSuccess:i,onError:s});n!==DKTools.IO.EXPECT_CALLBACK&&i(n)})}},Object.defineProperties(DKTools.IO.Entity.prototype,{path:{get:function(){return this._path},configurable:!0},name:{get:function(){return this._name},configurable:!0},initialExtension:{get:function(){return this._initialExtension},configurable:!0},extension:{get:function(){return this._extension},configurable:!0}}),DKTools.IO.File=class extends DKTools.IO.Entity{initialize(t=""){DKTools.IO.Entity.prototype.initialize.call(this,t),this._detectExtension()}copy(t,e={}){if(!e)return DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE;if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const i=DKTools.IO.fs,s=this.getAbsolutePath(),n=new DKTools.IO.File(t).getDirectory();if(e.createDirectory&&!n.exists()){const t=e.createDirectory instanceof Object?e.createDirectory:null;n.create({sync:!0,options:t})!==DKTools.IO.OK&&this.__processError(new Error(`Failed to create directory: ${n.getFullPath()}`),e.onError)}if(!n.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;if(!e.sync)return i.copyFile(s,t,e.flags,t=>{t?this.__processError(t,e.onError):DKTools.Utils.isFunction(e.onSuccess)&&e.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.EXPECT_CALLBACK;try{return i.copyFileSync(s,t,e.flags),DKTools.IO.OK}catch(t){this.__processError(t,e.onError)}}async copyAsync(t,e={}){return new Promise((i,s)=>{const n=this.copy(t,{...e,sync:!1,onSuccess:i,onError:s});n!==DKTools.IO.EXPECT_CALLBACK&&i(n)})}_detectExtension(){let t=this._extension;this.isAudio()?t=AudioManager.audioFileExt():this.isImage()?t=".png":this.isVideo()&&(t=Graphics.canPlayVideoType("video/webm")&&!DKTools.Utils.isMobileDevice()?".webm":".mp4"),this._extension=t}exists(){if((DKTools.IO.isLocalMode()||DKTools.IO.mode===DKTools.IO.MODE_NWJS_STAMP)&&(Decrypter.hasEncryptedAudio&&this.isAudio()||Decrypter.hasEncryptedImages&&this.isImage())){const t=DKTools.IO.normalizePath(this.getPath()+"/"+Decrypter.extToEncryptExt(this.getFullName()));return DKTools.IO.pathExists(t)}return DKTools.IO.Entity.prototype.exists.call(this)}getDirectory(){return new DKTools.IO.Directory(this._path)}getDirectoryName(){return this.getDirectory().getName()}isAudio(){return".ogg"===this._extension||".m4a"===this._extension||".rpgmvo"===this._extension}isJson(){return".json"===this._extension}isTxt(){return".txt"===this._extension}isImage(){return".png"===this._extension||".rpgmvp"===this._extension||".webp"===this._extension}isScript(){return".js"===this._extension}isVideo(){return".webm"===this._extension||".mp4"===this._extension}isSave(){return".rpgsave"===this._extension}load(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const e=this.getAbsolutePath(),i=e=>{if(e){if(t.decompress)try{e=LZString.decompressFromBase64(e)}catch(t){return{data:null,status:DKTools.IO.ERROR_DECOMPRESSING_DATA,error:t}}if(t.parse)try{e=JSON.parse(e,t.parse.reviver)}catch(t){return{data:null,status:DKTools.IO.ERROR_PARSING_DATA,error:t}}}return{data:e,status:DKTools.IO.OK}};if(DKTools.IO.isLocalMode()){if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const s=DKTools.IO.fs,n=t.options||{encoding:"utf8"};if(t.sync)try{const r=s.readFileSync(e,n);return i(r)}catch(e){this.__processError(e,t.onError)}else s.readFile(e,n,(e,s)=>{e?this.__processError(e,t.onError):t.onSuccess(i(s),this)})}else{if(DKTools.IO.mode===DKTools.IO.MODE_NWJS_STAMP&&"Stamp.json"!==this.getFullName()&&!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const s=new XMLHttpRequest;s.open("GET",e,!t.sync),s.overrideMimeType(t.mimeType||"application/json"),s.onload=(()=>{4===s.readyState&&(200===s.status?t.onSuccess(i(s.responseText),this):this.__processError(s,t.onError))}),s.onerror=(()=>{this.__processError(s,t.onError)});try{s.send()}catch(t){}}return{data:null,status:DKTools.IO.EXPECT_CALLBACK}}async loadAsync(t={}){return new Promise((e,i)=>{const s=this.load({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}loadAudio(){return!this.isAudio()||DKTools.IO.isLocalMode()&&!this.exists()?null:DKTools.Utils.WebAudio.load(this.getDirectoryName(),this.getName())}async loadAudioAsync(){return DKTools.Utils.WebAudio.loadAsync(this.loadAudio())}loadJson(t){return t?(t.parse||(t.parse=!0),this.load(t)):{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE}}async loadJsonAsync(t={}){return new Promise((e,i)=>{const s=this.loadJson({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}loadBitmap(t,e,i){return t instanceof Object?this.loadBitmap(t.listener,t.hue,t.smooth):!this.isImage()||DKTools.IO.isLocalMode()&&!this.exists()?null:DKTools.Utils.Bitmap.load({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i})}async loadBitmapAsync(t,e,i){return DKTools.Utils.Bitmap.loadAsync(this.loadBitmap(t,e,i))}remove(t={}){if(t=t||{},!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const e=DKTools.IO.fs,i=this.getAbsolutePath();if(!t.sync)return e.unlink(i,e=>{e?this.__processError(e,t.onError):DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.EXPECT_CALLBACK;try{return e.unlinkSync(i),DKTools.IO.OK}catch(e){this.__processError(e,t.onError)}}async removeAsync(){return new Promise((t,e)=>{const i=this.remove({sync:!1,onSuccess:t,onError:e});i!==DKTools.IO.EXPECT_CALLBACK&&t(i)})}reserveBitmap(t,e,i,s){return t instanceof Object?this.reserveBitmap(t.listener,t.hue,t.smooth,t.reservationId):this.isImage()&&this.exists()?DKTools.Utils.Bitmap.reserve({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i,reservationId:s}):null}async reserveBitmapAsync(t,e,i,s){return t instanceof Object?this.reserveBitmapAsync(t.listener,t.hue,t.smooth,t.reservationId):this.isImage()&&this.exists()?DKTools.Utils.Bitmap.reserveAsync({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i,reservationId:s}):null}save(t,e={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;const i=DKTools.IO.fs,s=this.getAbsolutePath(),n=this.getDirectory();if((e=e||{}).createDirectory&&!n.exists()){const t=e.createDirectory instanceof Object?e.createDirectory:null;n.create({sync:!0,options:t})!==DKTools.IO.OK&&this.__processError(new Error(`Failed to create directory: ${n.getFullPath()}`),e.onError)}if(!n.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;if(e.stringify&&(t=JSON.stringify(t,e.stringify.replacer,e.stringify.space)),e.compress&&(t=LZString.compressToBase64(t)),!e.sync)return i.writeFile(s,t,e.options,t=>{t?this.__processError(t,e.onError):DKTools.Utils.isFunction(e.onSuccess)&&e.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.EXPECT_CALLBACK;try{return i.writeFileSync(s,t,e.options),DKTools.IO.OK}catch(t){this.__processError(t,e.onError)}}async saveAsync(t,e={}){return new Promise((i,s)=>{const n=this.save(t,{...e,sync:!1,onSuccess:i,onError:s});n!==DKTools.IO.EXPECT_CALLBACK&&i(n)})}saveJson(t,e={}){return(e=e||{}).stringify||(e.stringify={space:"\t"}),this.save(t,e)}async saveJsonAsync(t,e={}){return new Promise((i,s)=>{const n=this.saveJson(t,{...e,sync:!1,onSuccess:i,onError:s});n!==DKTools.IO.EXPECT_CALLBACK&&i(n)})}},DKTools.IO.Directory=class extends DKTools.IO.Entity{create(t){if(!t)return DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE;if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE;if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(this.exists())return DKTools.IO.ERROR_DIRECTORY_ALREADY_EXISTS;const e=DKTools.IO.fs,i=this.getAbsolutePath();if(!t.sync)return e.mkdir(i,t.options,e=>{e?this.__processError(e,t.onError):t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.EXPECT_CALLBACK;try{return e.mkdirSync(i,t.options),DKTools.IO.OK}catch(e){this.__processError(e,t.onError)}}async createAsync(t={}){return new Promise((e,i)=>{const s=this.create({...t,sync:!1,onSuccess:e,onError:i});s!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}createDirectory(t,e){const i=DKTools.IO.normalizePath(this.getFullPath()+"/"+t);return new DKTools.IO.Directory(i).create(e)}async createDirectoryAsync(t,e={}){const i=DKTools.IO.normalizePath(this.getFullPath()+"/"+t);return new DKTools.IO.Directory(i).createAsync(e)}findFiles(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=t.searchLimit||1,i=[];let s=1,n=0;const r=n=>{_.forEach(n,n=>{if(n.isFile()){const e=n.getFullName();t.template instanceof RegExp&&t.template.test(e)?i.push(n):t.template&&e!==t.template||i.push(n)}else s<e&&n.isDirectory()&&(s++,o(n))})},o=e=>{if(t.sync){const i=e.getAll({sync:!0,options:t.options}).data;r(i)}else e.getAll({sync:!1,options:t.options,onError:t.onError,onSuccess:e=>{n++,r(e.data),s===n&&t.onSuccess({data:i,status:DKTools.IO.OK})}})};return o(this),t.sync?{data:i,status:DKTools.IO.OK}:{data:null,status:DKTools.IO.EXPECT_CALLBACK}}async findFilesAsync(t={}){return new Promise((e,i)=>{const s=this.findFiles({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}findDirectories(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=t.searchLimit||1,i=[];let s=1,n=0;const r=n=>{_.forEach(n,n=>{const r=n.getFullName();t.template instanceof RegExp&&t.template.test(r)?i.push(n):t.template&&r!==t.template||i.push(n),s<e&&(s++,o(n))})},o=e=>{if(t.sync){const i=e.getDirectories({sync:!0,options:t.options}).data;r(i)}else e.getDirectories({sync:!1,options:t.options,onError:t.onError,onSuccess:e=>{n++,r(e.data),s===n&&t.onSuccess({data:i,status:DKTools.IO.OK})}})};return o(this),t.sync?{data:i,status:DKTools.IO.OK}:{data:null,status:DKTools.IO.EXPECT_CALLBACK}}async findDirectoriesAsync(t={}){return new Promise((e,i)=>{const s=this.findDirectories({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getAll(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode()&&DKTools.IO.mode===DKTools.IO.MODE_NWJS)return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=e=>{return t.template instanceof RegExp?e=_.filter(e,e=>t.template.test(e)):DKTools.Utils.isString(t.template)&&(e=_.filter(e,e=>e===t.template)),{data:_.reduce(e,(t,e)=>{const i=DKTools.IO.normalizePath(s+"/"+e);return DKTools.IO.isFile(i)?t.push(new DKTools.IO.File(i)):DKTools.IO.isDirectory(i)&&t.push(new DKTools.IO.Directory(i)),t},[]),status:DKTools.IO.OK}};if(!DKTools.IO.isLocalMode()&&DKTools.IO.mode===DKTools.IO.MODE_NWJS_STAMP){const i=this.getFullPath().split("\\"),s=_.get(DKTools.IO.stamp,i,{}),n=Object.keys(s);return t.sync?e(n):(t.onSuccess(e(n),this),{data:null,status:DKTools.IO.EXPECT_CALLBACK})}const i=DKTools.IO.fs,s=this.getFullPath(),n=this.getAbsolutePath();if(!t.sync)return i.readdir(n,t.options,(i,s)=>{i?this.__processError(i,t.onError):t.onSuccess(e(s),this)}),{data:null,status:DKTools.IO.EXPECT_CALLBACK};try{const s=i.readdirSync(n,t.options);return e(s)}catch(e){this.__processError(e,t.onError)}}async getAllAsync(t={}){return new Promise((e,i)=>{const s=this.getAll({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getFiles(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const e=t=>_.filter(t,t=>t.isFile());if(t.sync){const i=this.getAll(t);return i.status===DKTools.IO.OK?{...i,data:e(i.data)}:i}{const i=t.onSuccess;return t.onSuccess=((t,s)=>{t.status===DKTools.IO.OK?i({...t,data:e(t.data)},s):i(t,s)}),this.getAll(t)}}async getFilesAsync(t={}){return this.getAllAsync(t).then(t=>{if(t.status===DKTools.IO.OK){const e=_.filter(t.data,t=>t.isFile());return{...t,data:e}}return t})}getDirectories(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_ARE_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const e=t=>_.filter(t,t=>t.isDirectory());if(t.sync){const i=this.getAll(t);return i.status===DKTools.IO.OK?{...i,data:e(i.data)}:i}{const i=t.onSuccess;return t.onSuccess=((t,s)=>{t.status===DKTools.IO.OK?i({...t,data:e(t.data)},s):i(t,s)}),this.getAll(t)}}async getDirectoriesAsync(t={}){return this.getAllAsync(t).then(t=>{if(t.status===DKTools.IO.OK){const e=_.filter(t.data,t=>t.isDirectory());return{...t,data:e}}return t})}getAudioFiles(t){return this.getFiles({...t,template:/(.ogg|.rpgmvo)/})}async getAudioFilesAsync(t={}){return new Promise((e,i)=>{const s=this.getAudioFiles({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getJsonFiles(t){return this.getFiles({...t,template:/(.json)/})}async getJsonFilesAsync(t={}){return new Promise((e,i)=>{const s=this.getJsonFiles({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getTxtFiles(t){return this.getFiles({...t,template:/(.txt)/})}async getTxtFilesAsync(t={}){return new Promise((e,i)=>{const s=this.getTxtFiles({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getImageFiles(t){return this.getFiles({...t,template:/(.png|.webp|.rpgmvp)/})}async getImageFilesAsync(t={}){return new Promise((e,i)=>{const s=this.getImageFiles({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getVideoFiles(t){return this.getFiles({...t,template:/(.webm|.mp4)/})}async getVideoFilesAsync(t={}){return new Promise((e,i)=>{const s=this.getVideoFiles({...t,sync:!1,onSuccess:e,onError:i});s.status!==DKTools.IO.EXPECT_CALLBACK&&e(s)})}getRootDirectory(){return new DKTools.IO.Directory(this.getPath())}isEmpty(){const t=this.getAll({sync:!0}).data;return!t||0===t.length}loadAudioFiles(){const t=this.getAudioFiles({sync:!0});return t.status!==DKTools.IO.OK?[]:_.map(t.data,t=>t.loadAudio())}async loadAudioFilesAsync(){const t=await this.getAudioFilesAsync();if(t.status!==DKTools.IO.OK)return[];const e=_.map(t.data,t=>t.loadAudioAsync());return Promise.all(e)}loadBitmaps(t,e,i){const s=this.getImageFiles({sync:!0});return s.status!==DKTools.IO.OK?[]:_.map(s.data,s=>s.loadBitmap(t,e,i))}async loadBitmapsAsync(t,e,i){const s=await this.getImageFilesAsync();if(s.status!==DKTools.IO.OK)return[];const n=_.map(s.data,s=>s.loadBitmapAsync(t,e,i));return Promise.all(n)}remove(t={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;if(!this.isEmpty())return DKTools.IO.ERROR_DIRECTORY_IS_NOT_EMPTY;const e=DKTools.IO.fs,i=this.getAbsolutePath();if(!t.sync)return e.rmdir(i,e=>{e?this.__processError(e,t.onError):DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.EXPECT_CALLBACK;try{return e.rmdirSync(i),DKTools.IO.OK}catch(e){this.__processError(e,t.onError)}}async removeAync(){return new Promise((t,e)=>{const i=this.remove({sync:!1,onSuccess:t,onError:e});i!==DKTools.IO.EXPECT_CALLBACK&&t(i)})}reserveBitmaps(t,e,i,s){const n=this.getImageFiles({sync:!0});return n.status!==DKTools.IO.OK?[]:_.map(n.data,n=>n.reserveBitmap(t,e,i,s))}async reserveBitmapsAsync(t,e,i,s){const n=await this.getImageFilesAsync();if(n.status!==DKTools.IO.OK)return[];const r=_.map(n.data,n=>n.reserveBitmapAsync(t,e,i,s));return Promise.all(r)}},DKTools.IO.WebStorage=class{static exists(t){return localStorage.hasOwnProperty(t)}static load(t,e={}){if(!this.exists(t))return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};let i=localStorage.getItem(t);if(i){if(e.decompress)try{i=LZString.decompressFromBase64(i)}catch(t){return{data:null,status:DKTools.IO.ERROR_DECOMPRESSING_DATA,error:t}}if(e.parse)try{i=JSON.parse(i,e.parse.reviver)}catch(t){return{data:null,status:DKTools.IO.ERROR_PARSING_DATA,error:t}}}return{data:i,status:DKTools.IO.OK}}static remove(t){return this.exists(t)?(localStorage.removeItem(t),DKTools.IO.OK):DKTools.IO.ERROR_PATH_DOES_NOT_EXIST}static rename(t,e,i=!1){if(!this.exists(t))return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;if(!i&&this.exists(e))return DKTools.IO.ERROR_OVERWRITING_IS_NOT_AVAILABLE;const s=localStorage.getItem(t);return localStorage.setItem(e,s),localStorage.removeItem(t),DKTools.IO.OK}static save(t,e,i={}){return i=i||{},!_.defaultTo(i.overwrite,!0)&&this.exists(t)?DKTools.IO.ERROR_OVERWRITING_IS_NOT_AVAILABLE:(i.stringify&&(e=JSON.stringify(e,i.stringify.replacer,i.stringify.space)),i.compress&&(e=LZString.compressToBase64(e)),localStorage.setItem(t,e),DKTools.IO.OK)}},DKTools.Network=class{constructor(){return DKTools.Network}static async fetchFile(t,e={}){return fetch(t,e).then(t=>{if(t.ok)return this._toFile(t);throw t})}static async fetchJson(t,e={}){return e.headers||(e.headers={}),e.headers.Accept="application/json",fetch(t,e).then(t=>{if(t.ok)return this._toJson(t);throw t})}static async _toFile(t){return t.arrayBuffer().then(t=>t,()=>null)}static async _toJson(t){return t.json().then(t=>t,()=>null)}},DKTools.ParameterManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){this._pluginName=t,this._params={},this.initializeParams()}initializeParams(){_.forEach(PluginManager.parameters(this._pluginName),(t,e)=>{this._params[e]=DKTools.ParameterManager.parse(t)})}get(t,e,i){if(!DKTools.Utils.isString(t))return void console.error("Parameter name is not a string!",this._pluginName,t,e,i);let s=this._params[t];return void 0!==s?(e instanceof Object?s=_.find(s,e):void 0!==e&&(s=s[e]),s instanceof Object&&(i instanceof Object?(void 0!==i.key&&(s=s[i.key]),void 0!==i.index&&(s=s[i.index])):void 0!==i&&(s=s[i])),s):void 0}static parse(t){try{return DKTools.Utils.isNumber(t)||DKTools.Utils.isBoolean(t)?t:JSON.parse(t,(t,e)=>{if(Array.isArray(e))return _.map(e,t=>this.parse(t));try{return this.parse(e)}catch(t){return e}})}catch(e){return t}}},Object.defineProperties(DKTools.ParameterManager.prototype,{pluginName:{get:function(){return this._pluginName},configurable:!0},initialParams:{get:function(){return this._initialParams||(this._initialParams=PluginManager.parameters(this._pluginName)),this._initialParams},configurable:!0},params:{get:function(){return this._params},configurable:!0}}),DKTools.PluginManager=class{constructor(){return DKTools.PluginManager}static initialize(){this.registerPlugins(Imported),this._checkRequirements()}static _checkRequirements(){_.forEach(this._requirements,(t,e)=>{const i=_.max(t),s=this.getVersion(e);if(void 0===s){const t='Required to install the plugin "%1". Minimal version: %2'.format(e,i);throw new Error(t)}if(s<i){const t='Required to update the plugin "%1" to minimal version %2 (Installed: %3)'.format(e,i,s);throw new Error(t)}})}static getVersion(t){return this._plugins[t]}static isRegistered(t){return!!this._plugins[t]}static isRequired(t){return!!this._requirements[t]}static registerPlugin(t,e){!e||this.isRegistered(t)||DKTools.Utils.isBoolean(e)||(this._plugins[t]=e)}static registerPlugins(t){_.forEach(t,(t,e)=>{this.registerPlugin(e,t)})}static requirePlugin(t,e){this._requirements[t]||(this._requirements[t]=[]),this._requirements[t].push(e)}static requirePlugins(t){_.forEach(t,(t,e)=>{this.requirePlugin(e,t)})}},Object.defineProperties(DKTools.PluginManager,{_plugins:{value:{}},_requirements:{value:{}},plugins:{get:function(){return this._plugins},configurable:!0},requirements:{get:function(){return this._requirements},configurable:!0}}),DKTools.PluginCommandManager=class{constructor(){return DKTools.PluginCommandManager}static has(t){return!!this._pluginCommands[t.toLowerCase()]}static process(t,e,i){const s=this._pluginCommands[e.toLowerCase()];DKTools.Utils.isFunction(s)&&s.call(t,i)}static set(t,e){this._pluginCommands[t.toLowerCase()]=e}},Object.defineProperties(DKTools.PluginCommandManager,{_pluginCommands:{value:{}}}),DKTools.PreloadManager=class{constructor(){return DKTools.PreloadManager}static initialize(){this.clearCache();const t=n.get("Preload Manager");this._enabled=t.Enabled,this.isEnabled()&&(_.forEach(t["Audio Files"],t=>{this.preloadAudio({path:t.Path,caching:t.Caching})}),_.forEach(t["Image Files"],t=>{this.preloadImage({path:t.Path,hue:t.Hue,caching:t.Caching})}),this.start())}static clearCache(){this._cache={audio:{},image:{}}}static clearQueue(){this._queue={audio:[],image:[]}}static _finish(){this._finishTime=new Date,this.clearQueue(),this._log("Preloading complete! \nLoaded/Skipped/Total: "+this._loaded+"/"+this._skipped+"/"+this._total+"\nPreloading time: "+(this._finishTime-this._startTime)/1e3+" sec"),Graphics.endLoading()}static _generateAudioKey(t){return DKTools.IO.normalizePath(t,!0)}static _generateImageKey(t,e=0){return DKTools.IO.normalizePath(ImageManager._generateCacheKey(t,e||0),!0)}static getCachedAudioByKey(t){return this._cache.audio[t]}static getCachedAudioByPath(t){return this.getCachedAudioByKey(this._generateAudioKey(t))}static getCachedImageByKey(t){return this._cache.image[t]}static getCachedImageByPath(t){return this.getCachedImageByKey(this._generateImageKey(t))}static isAudioCachedByKey(t){return!!this._cache.audio[t]}static isAudioCachedByPath(t){return this.isAudioCachedByKey(this._generateAudioKey(t))}static isEnabled(){return this._enabled}static isFinished(){return!!this._finishTime}static isReady(){return!this.isEnabled()||this.isFinished()}static isImageCachedByKey(t){return!!this._cache.image[t]}static isImageCachedByPath(t,e){return this.isImageCachedByKey(this._generateImageKey(t,e))}static _log(t){this.isEnabled()&&DKTools.Utils.isTest()&&n.get("Preload Manager","Debugging")&&t&&console.log(t)}static _onFileLoad(t){this._loaded++,this._log(`Loaded ${t instanceof WebAudio?"audio":"image"}: ${t.url}`),Graphics.updateLoading()}static _preload(t,e){if(this.isEnabled()&&e instanceof Object&&DKTools.Utils.isString(e.path)){const i=new DKTools.IO.Directory(e.path);if(i.isDirectory()){if(!DKTools.IO.isLocalMode())throw new Error("Web browsers and mobile phones cannot load directories!");{const s={sync:!0};let n=[];"audio"===t?n=i.getAudioFiles(s).data:"image"===t&&(n=i.getImageFiles(s).data),_.forEach(n,i=>{const s=i.getFullPath();this._queue[t][s]||(this._queue[t][s]={...e,path:s})})}}else{const i=new DKTools.IO.File(e.path),s=i.getFullPath();i.isFile()?this._queue[t][s]||(this._queue[t][s]=e):console.error("This is not a file: "+s)}}}static _processLoadAudioFiles(){const t=[];return _.forEach(this._queue.audio,e=>{const i=new DKTools.IO.File(e.path),s=i.getFullPath();if(i.isFile())if(i.isAudio()){if(this.isAudioCachedByPath(s))return this._skipped++,void this._log("Audio already preloaded: "+s+". Skipped...");const n=i.loadAudio();n?(e.caching&&(this._cache.audio[this._generateAudioKey(n.url)]=n),t.push(n)):(this._skipped++,this._log("Cannot load an audio: "+s+". Skipped..."))}else this._skipped++,this._log("This is not an audio: "+s+". Skipped...");else this._skipped++,this._log("This is not a file: "+e.path+". Skipped...")}),_.map(t,t=>DKTools.Utils.WebAudio.loadAsync(t).then(()=>this._onFileLoad(t)))}static _processLoadImageFiles(){const t=[];return _.forEach(this._queue.image,e=>{const i=new DKTools.IO.File(e.path),s=i.getFullPath();if(i.isFile())if(i.isImage()){if(this.isImageCachedByPath(s,e.hue))return this._skipped++,void this._log("Image already preloaded: "+s+". Skipped...");const n=DKTools.Utils.Bitmap.reserve({folder:i.getPath(),filename:i.getName(),hue:e.hue});n?(e.caching&&(this._cache.image[this._generateImageKey(n.url,e.hue)]=n),t.push(n)):(this._skipped++,this._log("Cannot load an image: "+s+". Skipped..."))}else this._skipped++,this._log("This is not an image: "+s+". Skipped...");else this._skipped++,this._log("This is not a file: "+e.path+". Skipped...")}),_.map(t,t=>DKTools.Utils.Bitmap.loadAsync(t).then(()=>this._onFileLoad(t)))}static preloadAudio(t){this._preload("audio",t)}static preloadImage(t){this._preload("image",t)}static releaseAudioByKey(t){this._cache.audio[t]=void 0}static releaseAudioByPath(t){this.releaseAudioByKey(this._generateAudioKey(t))}static releaseImageByKey(t){this._cache.image[t]=void 0}static releaseImageByPath(t,e){this.releaseImageByKey(this._generateImageKey(t,e))}static start(){if(!this.isEnabled())return;if(this._loaded=0,this._skipped=0,this._total=_.size(this._queue.audio)+_.size(this._queue.image),this._startTime=new Date,this._finishTime=null,this._log("DKTools Preload Manager is running... \nTotal files to load: "+this._total),0===this._total)return void this._finish();const t=Promise.all(this._processLoadAudioFiles()),e=Promise.all(this._processLoadImageFiles());Promise.all([t,e]).then(()=>this._finish())}},Object.defineProperties(DKTools.PreloadManager,{_queue:{value:{audio:{},image:{}},writable:!0},_cache:{value:{audio:[],image:[]},writable:!0}}),DKTools.StartupManager=class{static async initialize(){this._isReady=!1,await this.checkErrors(),await this.initializeModules(),this._isReady=!0}static async initializeModules(){}static _checkRPGMakerVersion(){if(Utils.RPGMAKER_VERSION<"1.6.0")throw new Error("Required to update RPG Maker MV to minimal version 1.6.0 (Installed: %1)".format(Utils.RPGMAKER_VERSION))}static _checkWebStorage(){if(!DKTools.IO.isLocalMode()&&!window.hasOwnProperty("localStorage"))throw new Error("Your browser does not support localStorage API")}static async checkErrors(){await this._checkRPGMakerVersion(),await this._checkWebStorage()}static isReady(){return this._isReady}},DKTools.Audio=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this._id=t.id,this._type=t.type.toLowerCase(),this._name=t.name,this._volume=_.defaultTo(t.volume,this.standardVolume()),this._pitch=_.defaultTo(t.pitch,this.standardPitch()),this._pan=_.defaultTo(t.pan,this.standardPan()),this._loop=_.defaultTo(t.loop,this.standardLoop()),this._buffer=this._createBuffer(),this._pausePos=null}_createBuffer(){return AudioManager.createBuffer(this._type,this._name)}clone(){return new DKTools.Audio(this)}equals(t){return!!t&&(this._type===t.type&&this._name===t.name&&this._volume===t.volume&&this._pitch===t.pitch&&this._pan===t.pan&&this._loop===t.loop)}fadeIn(t=0){this._buffer.fadeIn(t)}fadeOut(t=0){this._buffer.fadeOut(t)}isPaused(){return!this.isPlaying()&&null!=this._pausePos}isPlaying(){return this._buffer.isPlaying()}pause(){this.isPlaying()&&(this._pausePos=this.seek(),this.stop())}play(t=0){this._buffer.play(this._loop,t),this._updateBufferParameters(),this._pausePos=null}resume(){this.isPaused()&&this.play(this._pausePos)}seek(){return this._buffer.seek()}standardLoop(){return"bgm"===this._type||"bgs"===this._type}standardPan(){return 0}standardPitch(){return 100}standardVolume(){return 90}stop(){this.isPlaying()&&this._buffer.stop()}_updateBufferParameters(){const t=this._buffer;let e=AudioManager[this._type+"Volume"];Number.isFinite(e)||(e=100),t.volume=e*this._volume/1e4,t.pitch=this._pitch/100,t.pan=this._pan/100}},Object.defineProperties(DKTools.Audio.prototype,{id:{get:function(){return this._id},configurable:!0},type:{get:function(){return this._type},configurable:!0},name:{get:function(){return this._name},configurable:!0},volume:{get:function(){return this._volume},set:function(t){this._volume!==t&&(this._volume=t,this._updateBufferParameters())},configurable:!0},pitch:{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this._updateBufferParameters())},configurable:!0},pan:{get:function(){return this._pan},set:function(t){this._pan!==t&&(this._pan=t,this._updateBufferParameters())},configurable:!0},loop:{get:function(){return this._loop},configurable:!0},buffer:{get:function(){return this._buffer},configurable:!0},pos:{get:function(){return this.seek()},set:function(t){this.play(t)},configurable:!0}}),DKTools.Event=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this._id=t.id,this._target=t.target,this._type=t.type,this._repeatTime=t.repeatTime||-1,this._repeats=_.defaultTo(t.repeats,-1),this._remainingPauseTime=t.remainingPauseTime||0,this._onStart=t.onStart,this._onUpdate=t.onUpdate,this._onPause=t.onPause,this._onReset=t.onReset,this._onRepeat=t.onRepeat,this._onSuccess=t.onSuccess,this._onFail=t.onFail,this._started=!1,this._resetRemainingTime(),this._resetRemainingRepeats()}addRemainingPauseTime(t=1){this._remainingPauseTime+=t}addRemainingRepeats(t=1){this._remainingRepeats+=t}addRemainingTime(t=1){this._remainingTime+=t}_callOnPauseHandler(){this._canCallOnPauseHandler()&&this._onPause(this)}_callOnRepeatHandler(){this._canCallOnRepeatHandler()&&this._onRepeat(this)}_callOnResetHandler(){this._canCallOnResetHandler()&&this._onReset(this)}_callOnStartHandler(){this._canCallOnStartHandler()&&this._onStart(this),this._started=!0}_callOnSuccessHandler(t=!1){(this._canCallOnSuccessHandler()||t)&&this._onSuccess(this)}_callOnUpdateHandler(){this._canCallOnUpdateHandler()&&this._onUpdate(this)}_callonFailHandler(){this._canCallonFailHandler()&&this._onFail(this)}_canCallOnPauseHandler(){return this.hasOnPauseHandler()&&this.isPaused()}_canCallOnRepeatHandler(){return this.hasOnRepeatHandler()}_canCallOnResetHandler(){return this.hasOnResetHandler()}_canCallOnStartHandler(){return this.hasOnStartHandler()&&!this.isStarted()}_canCallOnSuccessHandler(){return this.hasOnSuccessHandler()&&this.isFinished()}_canCallOnUpdateHandler(){return this.hasOnUpdateHandler()&&this.isUpdated()}_canCallonFailHandler(){return this.hasonFailHandler()}_clearRemainingRepeats(){this._remainingRepeats=0}_clearRemainingTime(){this._remainingTime=0}clone(){return new this.constructor(this)}finish(t=!1){this.isFinished()||t?this._callOnSuccessHandler(t):this._callonFailHandler(),this._clearRemainingTime(),this._clearRemainingRepeats()}getElapsedRepeats(){return this._repeats-this._remainingRepeats}getElapsedTime(){return this._repeatTime-this._remainingTime}hasManager(){return!!this._manager}hasOnPauseHandler(){return!!this._onPause}hasOnRepeatHandler(){return!!this._onRepeat}hasOnResetHandler(){return!!this._onReset}hasOnStartHandler(){return!!this._onStart}hasOnSuccessHandler(){return!!this._onSuccess}hasOnUpdateHandler(){return!!this._onUpdate}hasTarget(){return!!this._target}hasType(){return!!this._type}hasonFailHandler(){return!!this._onFail}isAnimation(){return this instanceof DKTools.Animation}isAnimationAction(){return this instanceof DKTools.Animation.Action}isFinished(){return 0===this._remainingTime&&0===this._remainingRepeats}isPaused(){return 0!==this._remainingPauseTime}isStarted(){return this._started}isUpdated(){return this.isStarted()&&!this.isPaused()&&!this.isFinished()}pause(t=-1){this._remainingPauseTime=t}_resetRemainingRepeats(){this._remainingRepeats=this._repeats}_resetRemainingTime(){this._remainingTime=this._repeatTime}remove(){return!this.hasTarget()||this._target.removeEvent(this)}repeat(){this._remainingRepeats>0&&this._remainingRepeats--,this._resetRemainingTime(),this._callOnRepeatHandler()}reset(){this._resetRemainingTime(),this._resetRemainingRepeats(),this._callOnResetHandler()}resume(){this._remainingPauseTime=0}setManager(t){this._manager=t}setOnPauseHandler(t){this._onPause=t}setOnRepeatHandler(t){this._onRepeat=t}setOnResetHandler(t){this._onReset=t}setOnStartHandler(t){this._onStart=t}setOnSuccessHandler(t){this._onSuccess=t}setOnUpdateHandler(t){this._onUpdate=t}setTarget(t){this._target=t}setonFailHandler(t){this._onFail=t}stop(t=!1){this.finish(t),this.reset()}_update(){this._callOnUpdateHandler(),this._updateRemainingRepeats()}_updatePause(){this._callOnPauseHandler(),this._updateRemainingPauseTime()}_updateRemainingPauseTime(){this._remainingPauseTime>0&&this._remainingPauseTime--}_updateRemainingRepeats(){this.isFinished()||(0===this._remainingTime?this.repeat():this._updateRemainingTime())}_updateRemainingTime(){this._remainingTime>0&&this._remainingTime--}update(){this.isPaused()?this._updatePause():(this._callOnStartHandler(),this._update(),this.isFinished()&&this.finish())}},Object.defineProperties(DKTools.Event.prototype,{id:{get:function(){return this._id},configurable:!0},target:{get:function(){return this._target},configurable:!0},manager:{get:function(){return this._manager},configurable:!0},type:{get:function(){return this._type},configurable:!0},repeatTime:{get:function(){return this._duration},configurable:!0},repeats:{get:function(){return this._repeats},configurable:!0},remainingTime:{get:function(){return this._remainingTime},set:function(t){this._remainingTime=t},configurable:!0},remainingRepeats:{get:function(){return this._remainingRepeats},set:function(t){this._remainingRepeats=t},configurable:!0},remainingPauseTime:{get:function(){return this._remainingPauseTime},set:function(t){this._remainingPauseTime=t},configurable:!0},onStart:{get:function(){return this._onStart},configurable:!0},onUpdate:{get:function(){return this._onUpdate},configurable:!0},onPause:{get:function(){return this._onPause},configurable:!0},onReset:{get:function(){return this._onReset},configurable:!0},onRepeat:{get:function(){return this._onRepeat},configurable:!0},onSuccess:{get:function(){return this._onSuccess},configurable:!0},onFail:{get:function(){return this._onFail},configurable:!0}}),DKTools.Animation=class extends DKTools.Event{initialize(t){this._actions=[],DKTools.Event.prototype.initialize.call(this,t)}addAction(t){t&&(Number.isFinite(t.startTime)||(t.startTime=0),Number.isFinite(t.endTime)||(t.endTime=this._repeatTime),t.setAnimation(this),this._actions.push(t))}addActions(t){_.forEach(t,this.addAction.bind(this))}_canUpdateAction(t){return _.inRange(this.getElapsedTime(),t.startTime,t.endTime)}hasAction(t){return DKTools.Utils.Array.contains(this._actions,t)}hasActions(){return!DKTools.Utils.Array.isEmpty(this._actions)}isActionFinished(t){return t.isStarted()&&!t.isPaused()&&this.getElapsedTime()>=t.endTime}isActionUpdated(t){return t.isStarted()&&!t.isPaused()&&this._canUpdateAction(t)}isFinished(){return DKTools.Event.prototype.isFinished.call(this)||!this.hasActions()}removeAction(t){this.hasAction(t)&&DKTools.Utils.Array.remove(this._actions,t)}repeat(){this.repeatActions(),DKTools.Event.prototype.repeat.call(this)}repeatActions(){_.forEach(this._actions,function(t){t.repeat()})}reset(){this.resetActions(),DKTools.Event.prototype.reset.call(this)}resetActions(){_.forEach(this._actions,function(t){t.reset()})}_update(){this._updateActions(),DKTools.Event.prototype._update.call(this)}_updateAction(t){this._canUpdateAction(t)?t.update():this.getElapsedTime()===t.endTime&&this.isActionFinished(t)&&t.finish()}_updateActions(){_.forEach(this._actions,this._updateAction.bind(this))}},Object.defineProperties(DKTools.Animation.prototype,{actions:{get:function(){return this._actions},configurable:!0}}),DKTools.Animation.Action=class extends DKTools.Event{static Anchor(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,s=e.anchor,n=(i.x-s.x)/t,r=(i.y-s.y)/t,o=s.x+n,a=s.y+r;e.setAnchor(o,a)}.bind(e)),e}static Close(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=-e.openness/t,s=e.openness+i;e.openness=s}.bind(e)),e}static Frame(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,s=e.frame,n=(i.x-s.x)/t,r=(i.y-s.y)/t,o=(i.width-s.width)/t,a=(i.height-s.height)/t,l=new Rectangle(s.x+n,s.y+r,s.width+o,s.height+a);e.setFrame(l)}.bind(e)),e}static Move(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data.x-e.x)/t,s=(this._data.y-e.y)/t,n=e.x+i,r=e.y+s;e.move(n,r)}.bind(e)),e}static OpacitySprite(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.opacity)/t,s=e.opacity+i;e.setOpacity(s)}.bind(e)),e}static OpacityWindow(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data.windowOpacity-e.windowOpacity)/t,s=(this._data.contentsOpacity-e.contentsOpacity)/t,n=(this._data.frameOpacity-e.frameOpacity)/t,r=(this._data.backOpacity-e.backOpacity)/t,o={windowOpacity:e.windowOpacity+i,contentsOpacity:e.contentsOpacity+s,frameOpacity:e.frameOpacity+n,backOpacity:e.backOpacity+r};e.setOpacity(o)}.bind(e)),e}static Open(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(255-e.openness)/t;e.openness=e.openness+i}.bind(e)),e}static Pivot(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,s=e.pivot,n=(i.x-s.x)/t,r=(i.y-s.y)/t,o=s.x+n,a=s.y+r;e.setPivot(o,a)}.bind(e)),e}static Rotation(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.rotation)/t,s=e.rotation+i;e.setRotation(s)}.bind(e)),e}static Scale(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,s=e.scale,n=(i.x-s.x)/t,r=(i.y-s.y)/t,o=s.x+n,a=s.y+r;e.setScale(o,a)}.bind(e)),e}static Skew(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,s=e.skew,n=(i.x-s.x)/t,r=(i.y-s.y)/t,o=s.x+n,a=s.y+r;e.setSkew(o,a)}.bind(e)),e}static Sound(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this._data;t.isPlaying()||t.play()}.bind(e)),e}static Tint(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.tint)/t,s=e.tint+i;e.setTint(s)}.bind(e)),e}static Tone(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=e.tone,s=(this._data[0]-i[0])/t,n=(this._data[1]-i[1])/t,r=(this._data[2]-i[2])/t,o=i[0]+s,a=i[1]+n,l=i[2]+r;e.setTone([o,a,l])}.bind(e)),e}initialize(t){t=t||{},this._animation=null,this._startTime=t.startTime,this._endTime=t.endTime,this._data=t.data,DKTools.Event.prototype.initialize.call(this,t)}getElapsedTime(){return this._animation.getElapsedTime()-this._startTime}getRemainingTime(){return this._endTime-this._animation.getElapsedTime()}isFinished(){return this._animation.isActionFinished(this)}isUpdated(){return this._animation.isActionUpdated(this)}remove(){this._animation.removeAction(this)}repeat(){this._callOnRepeatHandler()}reset(){this._callOnResetHandler()}setAnimation(t){this._animation=t}},Object.defineProperties(DKTools.Animation.Action.prototype,{animation:{get:function(){return this._animation},configurable:!0},startTime:{get:function(){return this._startTime},set:function(t){this._startTime=t},configurable:!0},endTime:{get:function(){return this._endTime},set:function(t){this._endTime=t},configurable:!0},data:{get:function(){return this._data},configurable:!0}}),DKTools.OptionManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(){this.clear()}addOptionChangeListener(t,e){this._optionChangeListeners[t]||(this._optionChangeListeners[t]=[]),this._optionChangeListeners[t].push(e)}clear(){this._options=[],this._optionChangeListeners={}}clone(t=!1){const e=new DKTools.OptionManager;return e.enableOptions(this._options),t&&_.forEach(this._optionChangeListeners,(t,i)=>{_.forEach(t,t=>{e.addOptionChangeListener(i,t)})}),e}disableOption(t){this.isOptionEnabled(t)&&(DKTools.Utils.Array.remove(this._options,t),this._onOptionChange(t,!1))}disableOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.disableOption.bind(this))}enableOption(t){this.isOptionDisabled(t)&&(this._options.push(t),this._onOptionChange(t,!0))}enableOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.enableOption.bind(this))}equals(t){return t instanceof DKTools.OptionManager&&_.isEqual(this._options,t.options)}isOptionDisabled(t){return!this.isOptionEnabled(t)}isOptionEnabled(t){return DKTools.Utils.Array.contains(this._options,t)}isOptionsDisabled(t){const e=arguments.length>1?arguments:t;return _.every(e,this.isOptionDisabled.bind(this))}isOptionsEnabled(t){const e=arguments.length>1?arguments:t;return _.every(e,this.isOptionEnabled.bind(this))}isSomeOptionEnabled(){return this._options.length>0}isSomeOptionsDisabled(t){const e=arguments.length>1?arguments:t;return _.some(e,this.isOptionDisabled.bind(this))}isSomeOptionsEnabled(t){const e=arguments.length>1?arguments:t;return _.some(e,this.isOptionEnabled.bind(this))}_onOptionChange(t,e){_.forEach(this._optionChangeListeners[t],i=>{i(t,e)})}removeOptionChangeListener(t,e){DKTools.Utils.Array.remove(this._optionChangeListeners[t],e)}switchOption(t){this.isOptionEnabled(t)?this.disableOption(t):this.enableOption(t)}switchOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.switchOption.bind(this))}},Object.defineProperties(DKTools.OptionManager,{options:{get:function(){return this._options},configurable:!0}}),DKTools.EventManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){this._target=t,this._events={}}addAnimation(t){return this.addEventToContainer(t)}addEvent(t){let e;return t instanceof DKTools.Event||t instanceof DKTools.Animation?e=t:t instanceof Object&&(e=new DKTools.Event(t)),this.addEventToContainer(e)}addEventToContainer(t){if(!t)return null;return t.hasTarget()||t.setTarget(this._target),t.setManager(this),this.getEventsContainer(t).push(t),t}addOneTimeEvent(t){return t.repeatTime=1,t.repeats=0,this.addEvent(t)}_checkEvent(t){return t&&!t.isFinished()}_checkEvents(){_.forEach(this._events,(t,e)=>{this._events[e]=this._checkEventsContainer(t)})}_checkEventsContainer(t){return _.filter(t,this._checkEvent.bind(this))}clearEvents(t){t?Array.isArray(t)?_.forEach(t,t=>{this._events[t]=[]}):this._events[t]=[]:this._events={}}createEventsContainer(t){return this._events[t]=[],this._events[t]}findAnimation(t,e){return _.find(this.getAnimations(e),{id:t})}findEvent(t,e){return _.find(this.getEvents(e),{id:t})}finishEvents(t,e=!1){this.iterateEventsContainer(t,t=>{t.finish(e)})}getAnimations(t){return _.filter(this.getEvents(t),t=>t instanceof DKTools.Animation)}getEventIndex(t){return this.getEventsContainer(t).indexOf(t)}getEvents(t){if(t)return this.getEventsContainerByType(t);let e=[];return _.forEach(this._events,t=>{e=e.concat(t)}),e}getEventsContainer(t){return this.getEventsContainerByType(t.type)}getEventsContainerByType(t){return this._events[t]||this.createEventsContainer(t)}hasAnimation(t){return t instanceof DKTools.Animation&&this.getEventIndex(t)>=0}hasAnimations(t){return!DKTools.Utils.Array.isEmpty(this.getAnimations(t))}hasEvent(t){return this.getEventIndex(t)>=0}hasEvents(t){return!DKTools.Utils.Array.isEmpty(this.getEvents(t))}isEventsPaused(t){const e=this.getEventsContainerByType(t);return _.every(e,t=>t.isPaused())}iterateEventsContainer(t,e){const i=this.getEventsContainerByType(t);_.forEach(i,e)}pauseEvents(t,e=-1){this.iterateEventsContainer(t,t=>{t.pause(e)})}removeEvent(t){const e=this.getEventIndex(t);if(e>=0){return this.getEventsContainer(t)[e]=null,!0}return!1}resumeEvents(t){this.iterateEventsContainer(t,t=>{t.resume()})}stopEvents(t,e=!1){this.iterateEventsContainer(t,t=>{t.stop(e)})}update(){this._checkEvents()}updateEvent(t){t&&t.update()}updateEventsContainer(t){this.iterateEventsContainer(t,this.updateEvent.bind(this))}},Object.defineProperties(DKTools.EventManager,{events:{get:function(){return this._events},configurable:!0}}),DKTools.Unit=class{constructor(t){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this.setSource(t.source),this.setPercents(t.percents),this.setGetValueHandler(t.getValueHandler)}add(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.add(e):this._source+=e,this):this}clone(){return new this.constructor(this)}div(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.div(e):this._source/=e,this):this}equals(t){return!!t&&(this===t||this._source===t.source&&this._percents===t.percents)}_getValueFromUnit(t){return t instanceof DKTools.Unit?t.getValue():t}getPercents(){if(Number.isFinite(this._percents))return this._percents;if(DKTools.Utils.isFunction(this._percents)){const t=this._percents(this);return Number.isFinite(t)?t:100}return 100}getValue(){let t;return(t=this.hasGetValueHandler()?this._getValueHandler(this):this.getValueBase())||0}getValueBase(){if(!this.hasSource())return Number.NaN;const t=this.getPercents()/100;return 0===t?0:this._source instanceof DKTools.Unit?this._source.getValue()*t:this._source*t}hasGetValueHandler(){return DKTools.Utils.isFunction(this._getValueHandler)}hasPercents(){return DKTools.Utils.isFunction(this._percents)||Number.isFinite(this._percents)}hasSource(){return this._source instanceof DKTools.Unit||Number.isFinite(this._source)}mul(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.mul(e):this._source*=e,this):this}setGetValueHandler(t){this._getValueHandler=t}setPercents(t=100){this._percents=t}setSource(t){this._source=t}sub(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.rem(e):this._source-=e,this):this}},Object.defineProperties(DKTools.Unit.prototype,{source:{get:function(){return this._source},configurable:!0},percents:{get:function(){return this._percents},configurable:!0},getValueHandler:{get:function(){return this._getValueHandler},configurable:!0}}),DKTools.Unit.Property=class extends DKTools.Unit{initialize(t){t=t||{},DKTools.Unit.prototype.initialize.call(this,t),this.setProperty(t.property)}add(t){if(!t)return this;const e=this._property,i=this._source[e];let s=this._getValueFromUnit(t);return s instanceof Object&&(s=s[e]),s?(i instanceof DKTools.Unit?i.add(s):this._source[e]+=s,this):this}div(t){if(!t)return this;const e=this._property,i=this._source[e];let s=this._getValueFromUnit(t);return s instanceof Object&&(s=s[e]),s?(i instanceof DKTools.Unit?i.div(s):this._source[e]/=s,this):this}equals(t){return!!t&&(this===t||_.isEqual(this._source,t.source)&&this._percents===t.percents&&this._property===t.property)}getValueBase(){if(!this.hasSource()||!this.hasProperty())return Number.NaN;return new DKTools.Unit({source:this._source[this._property],percents:this.getPercents()}).getValue()}hasProperty(){return!!this._property}hasSource(){return this._source instanceof Object}mul(t){if(!t)return this;const e=this._property,i=this._source[e];let s=this._getValueFromUnit(t);return s instanceof Object&&(s=s[e]),s?(i instanceof DKTools.Unit?i.mul(s):this._source[e]*=s,this):this}setProperty(t){this._property=t}sub(t){if(!t)return this;const e=this._property,i=this._source[e];let s=this._getValueFromUnit(t);return s instanceof Object&&(s=s[e]),s?(i instanceof DKTools.Unit?i.rem(s):this._source[e]-=s,this):this}},Object.defineProperties(DKTools.Unit.Property.prototype,{property:{get:function(){return this._property},configurable:!0}}),DKTools.Unit.Properties=class extends DKTools.Unit{initialize(t){t=t||{},DKTools.Unit.prototype.initialize.call(this,t),this.setProperties(t.properties)}add(t){if(!t)return this;const e=this._getProperties();return _.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].add(i):this._source[e]+=i)}),this}addProperty(t){Array.isArray(this._properties)&&this._properties.push(t)}div(t){if(!t)return this;const e=this._getProperties();return _.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].div(i):this._source[e]/=i)}),this}equals(t){return!!t&&(this===t||_.isEqual(this._source,t.source)&&_.isEqual(this._percents,t.percents)&&_.isEqual(this._properties,t.properties))}_getProperties(){let t=this._properties;return DKTools.Utils.isFunction(t)&&(t=t(this)),Array.isArray(t)?t:[]}getPercents(t){if(Number.isFinite(this._percents))return this._percents;if(DKTools.Utils.isFunction(this._percents)){const e=this._percents(t,this);return Number.isFinite(e)?e:100}if(this._percents instanceof Object){if(DKTools.Utils.isFunction(this._percents[t])){const e=this._percents[t](this);return Number.isFinite(e)?e:100}return Number.isFinite(this._percents[t])?this._percents[t]:100}return 100}getValue(t){return this.hasGetValueHandler()?this._getValueHandler(t,this):this.getValueBase(t)}getValueBase(t){const e=t=>{if(!this.hasSource())return Number.NaN;const e=this._source,i=this.getPercents(t);return 0===i?0:e[t]instanceof DKTools.Unit?e[t].getValue(t)*i/100:new DKTools.Unit.Property({source:e,percents:i,property:t}).getValue()};if(t)return e(t);const i=this._getProperties();return _.reduce(i,(t,i)=>(t[i]=e(i),t),{})}hasProperty(t){return this._getProperties().includes(t)}hasProperties(){return this._getProperties().length>0}hasSource(){return this._source instanceof Object}mul(t){if(!t)return this;const e=this._getProperties();return _.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].mul(i):this._source[e]*=i)}),this}removeProperty(t){Array.isArray(this._properties)&&DKTools.Utils.Array.remove(this._properties,t)}setProperties(t){this._properties=DKTools.Utils.isFunction(t)?t:_.clone(t)}sub(t){if(!t)return this;const e=this._getProperties();return _.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].rem(i):this._source[e]-=i)}),this}},Object.defineProperties(DKTools.Unit.Properties.prototype,{properties:{get:function(){return this._properties},configurable:!0}}),DKTools.Unit.Function=class extends DKTools.Unit{add(){return this}div(){return this}getValueBase(){if(!this.hasSource())return Number.NaN;const t=this.getPercents()/100;return 0===t?0:this._source(this)*t}hasSource(){return DKTools.Utils.isFunction(this._source)}mul(){return this}sub(){return this}},DKTools.Base=class{constructor(){throw new Error("This is an abstract class!")}initialize(t,e,i,s){let n;t instanceof Graphics?(i=Graphics.boxWidth,s=Graphics.boxHeight):t instanceof Object?(n=t.x,e=t.y,i=t.width,s=t.height):Number.isFinite(t)&&(n=t),this.move(n,e),this.setupSize(i,s),this._clearAll(),this._createAll(),this._setupAll(),this._addAllChildren(),this.setupAll(t)}_addAllChildren(){}activate(){this.setActive(!0)&&this.updateActivateEvents()}actorName(t){const e=t>=1?$gameActors.actor(t):null;return e?e.name():""}addAllChildren(){this.updateAddAllChildrenEvents()}addAnimation(t){this._eventManager.addAnimation(t)}addEvent(t){return this._eventManager.addEvent(t)}addOneTimeEvent(t){return this._eventManager.addOneTimeEvent(t)}addOptionChangeListener(t,e){this._optionManager.addOptionChangeListener(t,e)}addFilter(t){t&&(this.filters&&this.filters.length>0?this.filters.push(t):this.filters=[t])}_clearAll(){this._clearMouseEnterTime(),this._clearWheel()}_clearMouseEnterTime(){this._mouseEnterTime=0}_clearWheel(){this._clearWheelX(),this._clearWheelY()}_clearWheelX(){this._wheelX=0}_clearWheelY(){this._wheelY=0}_createAll(){this._createOptionManager(),this._createEventManager()}_createEventManager(){this._eventManager=new DKTools.EventManager(this)}_createOptionManager(){this._optionManager=new DKTools.OptionManager}_checkHeight(t){const e=this.getMinHeight();return t?Math.max(e,t):e}_checkWidth(t){const e=this.getMinWidth();return t?Math.max(e,t):e}calcTextHeight(t,e=!1){if(!this.hasBitmap()||!t)return 0;const i=this.bitmap.fontSize,s=t.text.slice(t.index).split("\n"),n=e?s.length:1;let r=0;for(let t=0;t<n;t++){const e=/\x1b[\{\}]/g;let i=this.bitmap.fontSize;for(;;){const n=e.exec(s[t]);if(!n)break;"{"===n[0]&&this.makeFontBigger(),"}"===n[0]&&this.makeFontSmaller(),i<this.bitmap.fontSize&&(i=this.bitmap.fontSize)}r+=i+8}return this.bitmap.fontSize=i,r}canRedrawAll(){return this.hasBitmap()}checkAll(){this.updateCheckAllEvents(),this.checkSize()}checkSize(){}clear(){return this.clearRect()}clearEvents(t){this._eventManager.clearEvents(t)}clearFilters(){this.filters=null}clearLine(t){return this.clearRect(this.getLineRect(t))}clearOptions(){this._optionManager.clear()}clearRect(t,e,i,s){if(!this.hasBitmap())return!1;let n=t;return t instanceof Object&&(n=t.x,e=t.y,i=t.width,s=t.height),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),DKTools.Utils.isString(s)&&(e=this.getLineHeight()*parseFloat(s)),n=n||0,e=e||0,i=i||this.standardDrawingWidth(),s=s||this.standardDrawingHeight(),this.bitmap.clearRect(n,e,i,s),!0}clone(t={}){t=t||{};const e=new this.constructor(this);return t.cloneTexts&&_.forEach(this._texts,t=>{e.addText(t.text,{...t.options})}),t.cloneOptions&&e.enableOptions(this._optionManager.options),t.blockStart||e.start(),t.activate&&e.activate(),e}convertEscapeCharacters(t){try{return Window_Base.prototype.convertEscapeCharacters.call(this,t)}catch(e){return t=(t=(t=(t=(t=(t=(t=t.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(){return this.actorName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(){return this.partyMemberName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)}}createAll(){this.updateCreateAllEvents()}deactivate(){this.setActive(!1)&&this.updateDeactivateEvents()}destroy(t={}){this._clearAll(),this.clearEvents(),this.hide()}disableOption(t){this._optionManager.disableOption(t)}disableOptions(t){this._optionManager.disableOptions.apply(this._optionManager,arguments)}drawAll(){}drawArrow(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=ImageManager.loadSystem(this.standardWindowskin()),s=DKTools.Sprite.Arrow.getRect(t);return this.drawBitmap(i,{...e,source:s})}drawBitmap(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=DKTools.Utils.Bitmap.load(t);if(!i||e.sync&&!i.isReady())return!1;let s=!0;return i.addLoadListener(()=>{const t=DKTools.Utils.isFunction,n=DKTools.Utils.isString,r=this.getLineHeight(),{paintOpacity:o,resetPaintOpacity:a}=e;let{source:l,destination:h}=e,u={};t(e.callback)&&(u=e.callback(i,this)),l=l||u.source||{},h=h||u.destination||{},t(l)&&(l=l(i,this)),t(h)&&(h=h(i,this));const c=_.defaultTo(l.x,0),p=_.defaultTo(l.width,i.width);let d=_.defaultTo(l.y,0),f=_.defaultTo(l.height,i.height);const g=_.defaultTo(h.x,0),m=_.defaultTo(h.width,p);let y=_.defaultTo(h.y,0),T=_.defaultTo(h.height,f);0!==p&&0!==f&&0!==m&&0!==T?(n(d)&&(d=r*parseFloat(d)),n(f)&&(f=r*parseFloat(f)),n(y)&&(y=r*parseFloat(y)),n(T)&&(T=r*parseFloat(T)),Number.isFinite(o)&&this.changePaintOpacity(o),this.bitmap.blt(i,c,d,p,f,g,y,m,T),a&&this.resetPaintOpacity()):s=!1}),s}async drawBitmapAsync(t,e={}){if(!t)return!1;const i=await DKTools.Utils.Bitmap.loadAsync(t);return this.drawBitmap(i,e)}drawCharacter(t,e,i={}){if(!this.hasBitmap()||null==t||null==e)return!1;i=i||{};const s=ImageManager.loadCharacter(t),n=ImageManager.isBigCharacter(t),r=s.width/(n?3:12),o=s.height/(n?4:8),a=(e%4*3+1)*r,l=4*Math.floor(e/4)*o,h=new Rectangle(a,l,r,o),u=i.pos;let{x:c,y:p}=i;return u instanceof Object&&(c=u.x,p=u.y),c=c||0,p=p||0,this.drawBitmap(s,{...i,source:h,destination:{x:c,y:p}})}drawCircle(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:s,paintOpacity:n,resetPaintOpacity:r}=t;let{x:o,y:a}=t;return 0!==i&&(e instanceof Object&&(o=e.x,a=e.y),DKTools.Utils.isString(a)&&(a=this.getLineHeight()*parseFloat(a)),Number.isFinite(n)&&this.changePaintOpacity(n),this.bitmap.drawCircle(o||0,a||0,i||1,s||"white"),r&&this.resetPaintOpacity(),!0)}drawFace(t,e,i={}){if(!this.hasBitmap()||null==t||null==e)return!1;i=i||{};const{pos:s,rect:n}=i;let{x:r,y:o,width:a,height:l}=i;s instanceof Object&&(r=s.x,o=s.y),n instanceof Object&&(r=n.x,o=n.y,a=n.width,l=n.height),a=a||Window_Base._faceWidth,l=l||Window_Base._faceHeight;const h=ImageManager.loadFace(t),u=Window_Base._faceWidth,c=Window_Base._faceHeight,p=Math.min(a,u),d=Math.min(l,c),f=e%4*u+(u-p)/2,g=Math.floor(e/4)*c+(c-d)/2,_=new Rectangle(f,g,p,d);return r=Math.floor((r||0)+Math.max(a-u,0)/2),o=Math.floor((o||0)+Math.max(l-c,0)/2),this.drawBitmap(h,{...i,source:_,destination:{x:r,y:o}})}drawGauge(t={}){if(!this.hasBitmap())return!1;const{pos:e,rect:i,reversed:s,gradient:n,paintOpacity:r,resetPaintOpacity:o}=t;let{x:a,y:l,width:h,height:u,type:c,rate:p,backgroundColor:d,color:f,color1:g,color2:m}=t;if(e instanceof Object&&(a=e.x,l=e.y),i instanceof Object&&(a=i.x,l=i.y,h=i.width,u=i.height),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),0===h||0===u)return!1;a=a||0,l=l||0,h=h||this.standardDrawingWidth(),u=u||this.standardDrawingHeight(),d=_.defaultTo(d,"black"),f=_.defaultTo(f,"white"),g=_.defaultTo(g,f),m=_.defaultTo(m,f),c=_.defaultTo(c,"horizontal"),p=_.defaultTo(p,1);const y={x:a,y:l,width:h,height:u};if("horizontal"===c)y.width*=p,s&&(y.x+=h-y.width);else{if("vertical"!==c)return!1;y.height*=p,s&&(y.y+=u-y.height)}return Number.isFinite(r)&&this.changePaintOpacity(r),this.fillRect({x:a,y:l,width:h,height:u,color:d}),this.gradientFillRect({rect:y,color1:g,color2:m,vertical:"vertical"===n}),o&&this.resetPaintOpacity(),!0}drawIcon(t,e={}){if(!this.hasBitmap()||null==t)return!1;const i=ImageManager.loadSystem("IconSet"),s=Window_Base._iconWidth,n=Window_Base._iconHeight,r=t%16*s,o=Math.floor(t/16)*n,a=new Rectangle(r,o,s,n),l=e.pos;let{x:h,y:u}=e;return l instanceof Object&&(h=l.x,u=l.y),this.drawBitmap(i,{...e,source:a,destination:{x:h,y:u}})}drawItemName(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=Window_Base._iconWidth+4,{pos:s,iconPos:n,paintOpacity:r,resetPaintOpacity:o}=e;let{x:a,y:l,iconX:h,iconY:u}=e;return s instanceof Object&&(a=s.x,l=s.y),n instanceof Object&&(h=n.x,u=n.y),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),a=a||0,l=l||0,h=_.defaultTo(h,a+2),u=_.defaultTo(u,l+2),Number.isFinite(r)&&this.changePaintOpacity(r),this.drawIcon(t.iconIndex,{x:h,y:u}),this.drawText(t.name,{x:a+i,y:l,width:(e.width||312)-i,height:e.height,align:"left",font:e.font,textColor:e.textColor,resetFont:e.resetFont,resetTextColor:e.resetTextColor}),o&&this.resetPaintOpacity(),!0}drawLine(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos1:e,pos2:i,color:s,lineWidth:n,paintOpacity:r,resetPaintOpacity:o}=t;let{x1:a,y1:l,x2:h,y2:u}=t;return 0!==n&&(e instanceof Object&&(a=e.x,l=e.y),i instanceof Object&&(h=i.x,u=i.y),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),Number.isFinite(r)&&this.changePaintOpacity(r),DKTools.Utils.Bitmap.drawLine(this.bitmap,a||0,l||0,h||0,u||0,s,n),o&&this.resetPaintOpacity(),!0)}drawPolygon(t){if(!this.hasBitmap())return!1;t=t||{};const{points:e,paintOpacity:i,resetPaintOpacity:s}=t;if(!Array.isArray(e)||0===e.length)return!1;Number.isFinite(i)&&this.changePaintOpacity(i);for(let i=0;i<e.length-1;i++){const s=e[i],n=e[i+1];this.drawLine({...t,pos1:s,pos2:n})}return s&&this.resetPaintOpacity(),!0}drawTextEx(t,e={}){if(!this.hasBitmap()||""===t||null==t)return 0;t=String(t),(e=e||{}).wrap instanceof Object&&(t=this.textWrap(t,e.wrap));const i=e.pos;let{x:s,y:n,index:r,left:o}=e;i instanceof Object&&(s=i.x,n=i.y),DKTools.Utils.isString(n)&&(n=this.getLineHeight()*parseFloat(n));const a={x:s=_.defaultTo(s,0),y:n=_.defaultTo(n,0),index:r=_.defaultTo(r,0),left:o=_.defaultTo(o,s)};for(a.text=this.convertEscapeCharacters(t),a.height=this.calcTextHeight(a,!1);a.index<a.text.length;)this.processCharacter(a);return a.width||a.x-s}drawWindowskinBack(t={}){if(!this.hasBitmap())return!1;t=t||{};const e=ImageManager.loadSystem(this.standardWindowskin());if(!e)return!1;const i=96,{pos:s,rect:n}=t;let{x:r,y:o,width:a,height:l,tone:h}=t;if(s instanceof Object&&(r=s.x,o=s.y),n instanceof Object&&(r=n.x,o=n.y,a=n.width,l=n.height),0===a||0===l)return!1;try{h=h||$gameSystem.windowTone()}catch(t){}r=r||0,o=o||0,a=a||this.standardDrawingWidth(),l=l||this.standardDrawingHeight(),h=h||[0,0,0];const u=new Bitmap(a,l);u.blt(e,0,0,i,i,0,0,a,l);for(let t=0;t<l;t+=i)for(let s=0;s<a;s+=i)u.blt(e,0,i,i,i,s,t,i,i);return u.adjustTone(...h),this.drawBitmap(u,{...t,source:{width:a,height:l},destination:{x:r,y:o}})}enableOption(t){this._optionManager.enableOption(t)}enableOptions(t){this._optionManager.enableOptions.apply(this._optionManager,arguments)}fillAll(t){return this.fillRect({color:t})}fillArc(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:s,lineWidth:n,anticlockwise:r,paintOpacity:o,resetPaintOpacity:a}=t;let{x:l,y:h,startAngle:u,endAngle:c}=t;return(!Number.isFinite(u)||!Number.isFinite(c)||u!==c)&&(e instanceof Object&&(l=e.x,h=e.y),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),l=l||0,h=h||0,u=u||0,c=_.defaultTo(c,2*Math.PI),Number.isFinite(o)&&this.changePaintOpacity(o),DKTools.Utils.Bitmap.fillArc(this.bitmap,l,h,i,u,c,s,r),a&&this.resetPaintOpacity(),!0)}fillRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,rect:i,paintOpacity:s,resetPaintOpacity:n}=t;let{x:r,y:o,width:a,height:l,color:h}=t;return e instanceof Object&&(r=e.x,o=e.y),i instanceof Object&&(r=i.x,o=i.y,a=i.width,l=i.height),DKTools.Utils.isString(o)&&(o=this.getLineHeight()*parseFloat(o)),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),0!==a&&0!==l&&(r=r||0,o=o||0,a=a||this.standardDrawingWidth(),l=l||this.standardDrawingHeight(),h=h||"white",Number.isFinite(s)&&this.changePaintOpacity(s),this.bitmap.fillRect(r,o,a,l,h),n&&this.resetPaintOpacity(),!0)}findAnimation(t,e){return this._eventManager.findAnimation(t,e)}findEvent(t,e){return this._eventManager.findEvent(t,e)}finishEvents(t,e=!1){this._eventManager.finishEvents(t,e)}getAnimations(t){return this._eventManager.getAnimations(t)}getChildById(t){return _.find(this.children,{id:t})}getEventIndex(t){return this._eventManager.getEventIndex(t)}getEvents(t){return this._eventManager.getEvents(t)}getEventsContainer(t){return this._eventManager.getEventsContainer(t)}getEventsContainerByType(t){return this._eventManager.getEventsContainerByType(t)}getFontHeight(t){let e;return(t=t||this.getLineHeight())-(t-.7*(e=this.hasBitmap()?this.bitmap.fontSize:this._font.fontSize))/2}getLineHeight(){try{return Window_Base.prototype.lineHeight.call(this)}catch(t){return 36}}getLineRect(t){const e=this.getLineHeight();return new Rectangle(0,e*parseInt(t),this.width,e)}getLines(){return this.height/this.getLineHeight()}getLocalPoint(t,e){const i=DKTools.Utils.Point.toPoint(t,e);return this.worldTransform.applyInverse(i)}getMinWidth(){return 0}getMinHeight(){return 0}getMinSize(){return{width:this.getMinWidth(),height:this.getMinHeight()}}getRealCenter(){const t=this.getRealSize();return new Point(t.width/2,t.height/2)}getCenter(){const t=this.getSize();return new Point(t.width/2,t.height/2)}getRealSize(){return{width:this.width,height:this.height}}getSize(){return{width:this.width,height:this.height}}getTextHeight(t,e={}){return this.getTextLines(t,e)*this.getLineHeight()}getTextFontHeight(t,e={}){return this.getTextLines(t,e)*this.getFontHeight()}getTextHeightEx(t,e={}){return e instanceof Object&&e.wrap instanceof Object&&(t=this.textWrap(t,e.wrap)),this.calcTextHeight({text:t,index:0},!0)}getTextLines(t,e){return e instanceof Object&&(t=this.textWrap(t,e)),t.split("\n").length}getTextWidth(t){return this.hasBitmap()&&""!==t&&null!=t?this.bitmap.measureTextWidth(String(t)):0}getTextWidthEx(t,e={}){try{return this.drawTextEx(t,{...e,x:-Number.MAX_SAFE_INTEGER,y:-Number.MAX_SAFE_INTEGER})}catch(t){return 0}}getWindowskinTextColor(t){const e=96+t%8*12+6,i=144+12*Math.floor(t/8)+6;if(this.hasWindowskin())return this.windowskin.getPixel(e,i);return ImageManager.loadSystem(this.standardWindowskin()).getPixel(e,i)}gradientFillAll(t="black",e="white",i=!1){return this.gradientFillRect({color1:t,color2:e,vertical:i})}gradientFillRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{vertical:e,rect:i,paintOpacity:s,resetPaintOpacity:n}=t;let{color1:r,color2:o,x:a,y:l,width:h,height:u}=t;return i instanceof Object&&(a=i.x,l=i.y,h=i.width,u=i.height),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),0!==h&&0!==u&&(a=a||0,l=l||0,h=h||this.standardDrawingWidth(),u=u||this.standardDrawingHeight(),r=r||"black",o=o||"white",Number.isFinite(s)&&this.changePaintOpacity(s),this.bitmap.gradientFillRect(a,l,h,u,r,o,e),n&&this.resetPaintOpacity(),!0)}hasAnimation(t){return this._eventManager.hasAnimation(t)}hasAnimations(t){return this._eventManager.hasAnimations(t)}hasBitmap(){return!!this.bitmap}hasEvent(t){return this._eventManager.hasEvent(t)}hasEvents(t){return this._eventManager.hasEvents(t)}hasMask(){return!!this.mask}hasParent(){return!!this.parent}hasWindowskin(){return!!this.windowskin}hide(t=!1){this.setVisible(!1)&&this.updateHideEvents(),t||this.deactivate()}isActive(){let t=this;for(;t;){if(!t.visible)return!1;t=t.parent}return this.active}isBusy(){return!this.isReady()}isButton(){return this instanceof DKTools.Sprite.Button}isChild(t){return t?DKTools.Utils.Array.contains(this.children,t):this.hasParent()}isCursor(){return this instanceof DKTools.Sprite.Cursor}isDestroyed(){return this._destroyed}isEventsPaused(t){return this._eventManager.isEventsPaused(t)}isInside(t,e){const i=this.getLocalPoint(t,e),s=new Rectangle(0,0,this.width,this.height),n=this.mask;if(n&&DKTools.Utils.isFunction(n.containsPoint)&&!n.containsPoint(i))return!1;if(!s.contains(i.x,i.y))return!1;const r=this.hitArea;return!r||r.contains(i.x,i.y)}isLayout(){return this instanceof DKTools.Layout}isMouseInside(){return this.isInside(TouchInput.mouseX,TouchInput.mouseY)}isOptionDisabled(t){return this._optionManager.isOptionDisabled(t)}isOptionEnabled(t){return this._optionManager.isOptionEnabled(t)}isOptionsDisabled(t){return this._optionManager.isOptionsDisabled.apply(this._optionManager,arguments)}isOptionsEnabled(t){return this._optionManager.isOptionsEnabled.apply(this._optionManager,arguments)}isOutside(t,e){return!this.isInside(t,e)}isParent(t){return!!t&&this.parent===t}isReady(){return this.hasBitmap()&&this.bitmap.isReady()}isSelectable(){return this instanceof DKTools.Sprite.Selectable||this instanceof DKTools.Window.Selectable}isSomeOptionEnabled(){return this._optionManager.isSomeOptionEnabled()}isSomeOptionsDisabled(t){return this._optionManager.isSomeOptionsDisabled.apply(this._optionManager,arguments)}isSomeOptionsEnabled(t){return this._optionManager.isSomeOptionsEnabled.apply(this._optionManager,arguments)}isSprite(){return this instanceof DKTools.Sprite}isStarted(){return this._started}isViewport(){return this instanceof DKTools.Viewport}isVisible(){return this.visible}isVisibleAndActive(){return this.isVisible()&&this.isActive()}isWindow(){return this instanceof DKTools.Window}iterateChildren(t){_.forEach(this.children,t)}iterateEventsContainer(t,e){this._eventManager.iterateEventsContainer(t,e)}makeFontBigger(){this.hasBitmap()&&this.bitmap.fontSize<=96&&(this.bitmap.fontSize+=12)}makeFontSmaller(){this.hasBitmap()&&this.bitmap.fontSize>=24&&(this.bitmap.fontSize-=12)}move(t,e){t instanceof Object&&(e=t.y),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e));const i=DKTools.Utils.Point.toPoint(t,e);this.position.copy(i)}obtainEscapeCode(t){return Window_Base.prototype.obtainEscapeCode.call(this,t)}obtainEscapeParam(t){return Window_Base.prototype.obtainEscapeParam.call(this,t)}partyMemberName(t){const e=t>=1?$gameParty.members()[t-1]:null;return e?e.name():""}pauseEvents(t,e){this._eventManager.pauseEvents(t,e)}processAll(){this.processMouse(),this.processWheel()}processCharacter(t){Window_Base.prototype.processCharacter.call(this,t)}processDrawIcon(t,e){this.drawIcon(t,{x:e.x+2,y:e.y+2}),e.x+=Window_Base._iconWidth+4}processEscapeCharacter(t,e){try{Window_Base.prototype.processEscapeCharacter.call(this,t,e)}catch(i){switch(t){case"C":this.changeTextColor(this.getWindowskinTextColor(this.obtainEscapeParam(e)));break;case"I":this.processDrawIcon(this.obtainEscapeParam(e),e);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller()}}}processMouse(){this.isOptionEnabled("process-mouse")&&this.isVisible()&&(this.isActive()||this.isOptionEnabled("process-mouse-ignore-active"))?this.isMouseInside()?(0===this._mouseEnterTime&&this.updateMouseEnterEvents(),this.updateMouseInsideEvents(),TouchInput.isMouseMoved()&&this.updateMouseMoveEvents(),this._mouseEnterTime++):(this._mouseEnterTime>0&&this.updateMouseLeaveEvents(),this.updateMouseOutsideEvents(),this._clearMouseEnterTime()):this._clearMouseEnterTime()}processNewLine(t){t.width?t.width<t.x&&(t.width=t.x):t.width=t.x,Window_Base.prototype.processNewLine.call(this,t)}processNewPage(t){Window_Base.prototype.processNewPage.call(this,t)}processNormalCharacter(t){const e=t.text[t.index++],i=this.getTextWidth(e);this.drawText(e,{align:"left",pos:t,width:2*i,height:t.height}),t.x+=i}processWheel(){if(this._wheelX=TouchInput.wheelX,this._wheelY=TouchInput.wheelY,0!==this._wheelX||0!==this._wheelY){let t;t=this.isMouseInside()?"inside":"outside",0!==this._wheelX&&this.updateWheelXEvents(t),0!==this._wheelY&&this.updateWheelYEvents(t)}}redrawAll(){}refreshAll(){this.updateAll(),this.canRedrawAll()&&this.redrawAll(),this.updateRefreshAllEvents()}removeAll(){this.updateRemoveAllEvents()}removeAllChildren(){this.updateRemoveAllChildrenEvents()}removeEvent(t){return this._eventManager.removeEvent(t)}removeFilter(t){this.filters&&t&&(DKTools.Utils.Array.remove(this.filters,t),0===this.filters.length&&(this.filters=null))}removeFromParent(){return!!this.hasParent()&&(this.parent.removeChild(this),!0)}removeMask(){this.mask=null}removeOptionChangeListener(t,e){this._optionManager.removeOptionChangeListener(t,e)}resumeEvents(t){this._eventManager.resumeEvents(t)}_setupAll(){this._setupOptions(),this._setupEvents(),this._setupAnimations()}_setupAnimations(){}_setupEvents(){}_setupOptions(){}standardActive(){return!0}standardDrawingWidth(){return this.hasBitmap()?this.bitmap.width:this.isSprite()?this._bitmapWidth:this.isWindow()?this.width:null}standardDrawingHeight(){return this.hasBitmap()?this.bitmap.height:this.isSprite()?this._bitmapHeight:this.isWindow()?this.height:null}standardPivot(){return new Point(0,0)}standardRotation(){return 0}standardScale(){return new Point(1,1)}standardSkew(){return new Point(0,0)}standardTint(){return 16777215}standardVisible(){return!0}standardWindowskin(){return"Window"}setupAll(t={}){t=t||{},this.setupId(t.id),this.setupActive(t.active),this.setupVisible(t.visible),this.setupScale(t.scale),this.setupPivot(t.pivot),this.setupSkew(t.skew),this.setupRotation(t.rotation),this.setupTint(t.tint)}setupActive(t){this.active=_.defaultTo(t,this.standardActive())}setupId(t){this._id=_.defaultTo(t,null)}setupPivot(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),s=Object.assign(this.standardPivot(),i);this.pivot.copy(s)}setupRotation(t){this.rotation=_.defaultTo(t,this.standardRotation())}setupScale(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),s=Object.assign(this.standardScale(),i);this.scale.copy(s)}setupSize(t,e){}setupSkew(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),s=Object.assign(this.standardSkew(),i);this.skew.copy(s)}setupTint(t){this.tint=_.defaultTo(t,this.standardTint())}setupVisible(t){this.visible=_.defaultTo(t,this.standardVisible())}setAll(t={},e=!1,i=!1){t=t||{};let s=0;return this.setId(t.id)&&s++,this.setActive(t.active)&&s++,this.setVisible(t.visible)&&s++,this.setScale(t.scale)&&s++,this.setPivot(t.pivot)&&s++,this.setSkew(t.skew)&&s++,this.setRotation(t.rotation)&&s++,this.setTint(t.tint)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setActive(t){if(this.active===t)return!1;const e=this.active;return this.setupActive(t),this.active!==e}setId(t){if(this._id===t)return!1;const e=this._id;return this.setupId(t),this._id!==e}setPivot(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.pivot,i))return!1;const s=DKTools.Utils.Point.clone(this.pivot);return this.setupPivot(i),!DKTools.Utils.Point.equals(this.pivot,s)}setRotation(t){if(this.rotation===t)return!1;const e=this.rotation;return this.setupRotation(t),this.rotation!==e}setScale(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.scale,i))return!1;const s=DKTools.Utils.Point.clone(this.scale);return this.setupScale(i),!DKTools.Utils.Point.equals(this.scale,s)}setSkew(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.skew,i))return!1;const s=DKTools.Utils.Point.clone(this.skew);return this.setupSkew(i),!DKTools.Utils.Point.equals(this.skew,s)}setTint(t){if(this.tint===t)return!1;const e=this.tint;return this.setupTint(t),this.tint!==e}setVisible(t){if(this.visible===t)return!1;const e=this.visible;return this.setupVisible(t),this.visible!==e}show(t=!1){this.setVisible(!0)&&this.updateShowEvents(),t&&this.activate()}start(t=!1){this._started=!0,this.removeAllChildren(),this.terminateAll(),this.removeAll(),this.checkAll(),this.createAll(),this.startAll(),this.addAllChildren(),this.refreshAll(),this.updateStartEvents(),t&&this.activate()}startAll(){this.updateStartAllEvents()}stopEvents(t,e=!1){this._eventManager.stopEvents(t,e)}strokeArc(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:s,lineWidth:n,anticlockwise:r,paintOpacity:o,resetPaintOpacity:a}=t;let{x:l,y:h,startAngle:u,endAngle:c}=t;return e instanceof Object&&(l=e.x,h=e.y),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),Number.isFinite(o)&&this.changePaintOpacity(o),l=l||0,h=h||0,u=u||0,c=_.defaultTo(c,2*Math.PI),DKTools.Utils.Bitmap.strokeArc(this.bitmap,l,h,i,u,c,s,n,r),a&&this.resetPaintOpacity(),!0}strokeRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,rect:i,lineWidth:s,paintOpacity:n,resetPaintOpacity:r}=t;let{x:o,y:a,width:l,height:h,color:u}=t;return e instanceof Object&&(o=e.x,a=pox.y),i instanceof Object&&(o=i.x,a=i.y,l=i.width,h=i.height),DKTools.Utils.isString(a)&&(a=this.getLineHeight()*parseFloat(a)),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),Number.isFinite(n)&&this.changePaintOpacity(n),o=o||0,a=a||0,l=l||this.standardDrawingWidth(),h=h||this.standardDrawingHeight(),u=u||"white",DKTools.Utils.Bitmap.strokeRect(this.bitmap,o,a,l,h,u,s),r&&this.resetPaintOpacity(),!0}switchOption(t){this._optionManager.switchOption(t)}switchOptions(t){this._optionManager.switchOptions.apply(this._optionManager,arguments)}terminate(){}terminateAll(){this.updateTerminateAllEvents()}textWrap(t,e={}){if(!this.hasBitmap()||""===t||null==t)return"";t=String(t),e=e||{};const i=t.split("\n"),s=e.maxWidth||this.bitmap.width,n=this.getTextWidth(" ");let r="",o=1;for(let t=0;t<i.length;t++){const a=i[t].split(" ");let l=s;for(let t=0;t<a.length;t++){const i=a[t],h=this.getTextWidth(i);if(e.breakWords&&h>s){const t=i.split("");for(let e=0;e<t.length;e++){const i=this.getTextWidth(t[e]);i>l?(r+="\n"+t[e],l=s-i):(0===e&&(r+=" "),r+=t[e],l-=i)}}else{const a=h+n;if(0===t||a>l){if(t>0){if(e.maxLines===o)return r;r+="\n",o++}r+=i,l=s-h}else l-=a,r+=" "+i}}t<i.length-1&&(r+="\n")}return r}update(){this.updateChildren(),this.processAll(),this.updateEvents()}updateAll(){this.updateOpacity(),this.updateUpdateAllEvents()}updateActivateEvents(){this.updateEventsContainer("activate")}updateAddAllChildrenEvents(){this.updateEventsContainer("add-all-children")}updateCheckAllEvents(){this.updateEventsContainer("check-all")}updateChild(t){t&&DKTools.Utils.isFunction(t.update)&&t.update()}updateChildren(){this.iterateChildren(this.updateChild)}updateCreateAllEvents(){this.updateEventsContainer("create-all")}updateDeactivateEvents(){this.updateEventsContainer("deactivate")}updateEvent(t){this._eventManager.updateEvent(t)}updateEvents(){this._eventManager.update(),this.updateReadyEvents(),this.updateUpdateEvents(),this.updateQueueEvents()}updateEventsContainer(t){this._eventManager.updateEventsContainer(t)}updateHideEvents(){this.updateEventsContainer("hide")}updateInputData(){SceneManager.updateInputData()}updateMouseEnterEvents(){this.updateEventsContainer("mouse-enter")}updateMouseInsideEvents(){this.updateEventsContainer("mouse-inside")}updateMouseLeaveEvents(){this.updateEventsContainer("mouse-leave")}updateMouseMoveEvents(){this.updateEventsContainer("mouse-move")}updateMouseOutsideEvents(){this.updateEventsContainer("mouse-outside")}updateOpacity(){}updateQueueEvents(){const t=this.getEventsContainerByType("queue")[0];this.updateEvent(t)}updateReadyEvents(){this.isReady()&&this.updateEventsContainer("ready")}updateRedrawAllEvents(){this.updateEventsContainer("redraw-all")}updateRefreshAllEvents(){this.updateEventsContainer("refresh-all")}updateRemoveAllChildrenEvents(){this.updateEventsContainer("remove-all-children")}updateRemoveAllEvents(){this.updateEventsContainer("remove-all")}updateShowEvents(){this.updateEventsContainer("show")}updateStartAllEvents(){this.updateEventsContainer("start-all")}updateStartEvents(){this.isStarted()&&this.updateEventsContainer("start")}updateTerminateAllEvents(){this.updateEventsContainer("terminate-all-children")}updateUpdateAllEvents(){this.updateEventsContainer("update-all")}updateUpdateEvents(){this.updateEventsContainer("update")}updateWheelXEvents(t){this.updateEventsContainer("wheel-X-"+t)}updateWheelYEvents(t){this.updateEventsContainer("wheel-Y-"+t)}},Object.defineProperties(DKTools.Base.prototype,{id:{get:function(){return this._id},configurable:!0},mouseX:{get:function(){return this.mouse.x},configurable:!0},mouseY:{get:function(){return this.mouse.y},configurable:!0},mouse:{get:function(){return this.getLocalPoint(TouchInput.mouseX,TouchInput.mouseY)},configurable:!0},wheelX:{get:function(){return this._wheelX},configurable:!0},wheelY:{get:function(){return this._wheelY},configurable:!0},mouseEnterTime:{get:function(){return this._mouseEnterTime},configurable:!0}}),DKTools.Sprite.prototype=Object.create(Sprite.prototype),DKTools.Utils.mixin(DKTools.Sprite.prototype,DKTools.Base.prototype),DKTools.Sprite.prototype.constructor=DKTools.Sprite,Object.defineProperties(DKTools.Sprite.prototype,{contents:{get:function(){return this.bitmap},set:function(t){this.bitmap=t},configurable:!0},windowskin:{get:function(){return this._windowskin},configurable:!0},frame:{get:function(){return this._frame},configurable:!0},realWidth:{get:function(){return this.width},set:function(t){this.width=t},configurable:!0},realHeight:{get:function(){return this.height},set:function(t){this.height=t},configurable:!0},width:{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0},height:{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0},mouse:{get:function(){return this.getLocalPoint(TouchInput.mouseX,TouchInput.mouseY)},configurable:!0},align:{get:function(){return this._align},configurable:!0},font:{get:function(){return this._font},configurable:!0},textColor:{get:function(){return this._textColor},configurable:!0},paintOpacity:{get:function(){return this._paintOpacity},configurable:!0},fillColor:{get:function(){return this._fillColor},configurable:!0},opacity:{get:function(){return this._opacity},configurable:!0},graphicFolder:{get:function(){return this._graphicFolder},configurable:!0},graphicName:{get:function(){return this._graphicName},configurable:!0},texts:{get:function(){return this._texts},configurable:!0}}),DKTools.Sprite.prototype.initialize=function(t,e,i,s){Sprite.prototype.initialize.call(this),DKTools.Base.prototype.initialize.call(this,t,e,i,s),t instanceof DKTools.Sprite&&!t.isStarted()&&!t.hasFixedBitmap()?this.setupSize(t._getBitmapWidth(),t._getBitmapHeight()):t instanceof Bitmap&&this.setupBitmap(t),this.updateBitmap()},DKTools.Sprite.prototype.addText=function(t,e={},i=!1){null!=t&&""!==t&&(t=String(t),e=e||{},this._texts.push({text:t,options:e,id:e.id,type:e.type||"drawText"}),i&&this.refreshAll())},DKTools.Sprite.prototype.adjustTone=function(t){return!(!this.hasBitmap()||!t)&&(Bitmap.prototype.adjustTone.apply(this.bitmap,t),!0)},DKTools.Sprite.prototype.blur=function(){return!!this.hasBitmap()&&(this.bitmap.blur(),!0)},DKTools.Sprite.prototype._clearAll=function(){DKTools.Base.prototype._clearAll.call(this),this._clearTexts()},DKTools.Sprite.prototype._clearTexts=function(){this._texts=[]},DKTools.Sprite.prototype.canCloneFixedBitmap=function(){return!0},DKTools.Sprite.prototype.canRedrawAll=function(){return DKTools.Base.prototype.canRedrawAll.call(this)&&!this.hasGraphicName()&&!this.hasFixedBitmap()},DKTools.Sprite.prototype.changeFont=function(t){this.hasBitmap()&&this.updateFont(t)},DKTools.Sprite.prototype.changePaintOpacity=function(t){this.hasBitmap()&&this.updatePaintOpacity(t)},DKTools.Sprite.prototype.changeTextColor=function(t){this.hasBitmap()&&this.updateTextColor(t)},DKTools.Sprite.prototype.checkSize=function(){const t=this.getMinWidth(),e=this.getMinHeight();let i=0;return this._bitmapWidth<t&&(this.setupWidth(t),i++),this._bitmapHeight<e&&(this.setupHeight(e),i++),i},DKTools.Sprite.prototype.createAll=function(){DKTools.Base.prototype.createAll.call(this),this.createBitmap(),this.createMask()},DKTools.Sprite.prototype.createBitmap=function(){this.hasGraphicName()?this._loadGraphic():this.hasFixedBitmap()||(this.bitmap=new Bitmap(this._getBitmapWidth(),this._getBitmapHeight()))},DKTools.Sprite.prototype.createRectMask=function(){const t=new PIXI.Graphics;t.beginFill(),t.drawRect(this.x,this.y,this.bitmap.width,this.bitmap.height),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createCircleMask=function(){const t=new PIXI.Graphics,e=this.bitmap.width/2,i=this.x+e,s=this.y+e;t.beginFill(),t.drawCircle(i,s,e),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createEllipseMask=function(){const t=new PIXI.Graphics,e=this.bitmap.width/2,i=this.bitmap.height/2,s=this.x+e,n=this.y+i;t.beginFill(),t.drawEllipse(s,n,e,i),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createMask=function(t){switch(t){case"rect":this.createRectMask();break;case"circle":this.createCircleMask();break;case"ellipse":this.createEllipseMask()}},DKTools.Sprite.prototype.destroy=function(t){DKTools.Base.prototype.destroy.call(this,t),Sprite.prototype.destroy.call(this,t)},DKTools.Sprite.prototype.drawAll=function(){this.updateFill(),this.drawAllTexts(),this.updateDrawAllEvents()},DKTools.Sprite.prototype.drawAllTexts=function(){_.forEach(this._texts,t=>{this[t.type](t.text,t.options)})},DKTools.Sprite.prototype.drawText=function(t,e={}){if(!this.hasBitmap()||null==t||""===t)return!1;t=String(t),e=e||{};const{pos:i,rect:s,font:n,textColor:r,paintOpacity:o,resetFont:a,resetTextColor:l,resetPaintOpacity:h}=e;let{x:u,y:c,width:p,height:d,align:f}=e;return i instanceof Object&&(u=i.x,c=i.y),s instanceof Object&&(u=s.x,c=s.y,p=s.width,d=s.height),DKTools.Utils.isString(c)&&(c=this.getLineHeight()*parseFloat(c)),DKTools.Utils.isString(d)&&(d=this.getLineHeight()*parseFloat(d)),0!==p&&0!==d&&(u=u||0,c=c||0,p=p||this.standardDrawingWidth(),d=d||this.getLineHeight(),f=f||this.align,n&&this.changeFont(n),r&&this.changeTextColor(r),Number.isFinite(o)&&this.changePaintOpacity(o),this.bitmap.drawText(t,u,c,p,d,f),a&&this.resetFont(),l&&this.resetTextColor(),h&&this.resetPaintOpacity(),!0)},DKTools.Sprite.prototype.findText=function(t){return _.find(this._texts,{id:t})},DKTools.Sprite.prototype._getBitmapHeight=function(){return this._bitmapHeight},DKTools.Sprite.prototype._getBitmapWidth=function(){return this._bitmapWidth},DKTools.Sprite.prototype.getCurrentOpacity=function(){return 255*this.alpha},DKTools.Sprite.prototype.getLocalPoint=function(t,e){const i=DKTools.Base.prototype.getLocalPoint.call(this,t,e),s=this.anchor;return i.x+=this.width*s.x,i.y+=this.height*s.y,i},DKTools.Sprite.prototype.hasFillColor=function(){return!!this._fillColor},DKTools.Sprite.prototype.hasFixedBitmap=function(){return!!this._fixedBitmap},DKTools.Sprite.prototype.hasGraphicFolder=function(){return!!this._graphicFolder},DKTools.Sprite.prototype.hasGraphicName=function(){return!!this._graphicName},DKTools.Sprite.prototype.hasTexts=function(){return this._texts.length>0},DKTools.Sprite.prototype.isResizable=function(){return!this.hasGraphicName()&&!this.hasFixedBitmap()},DKTools.Sprite.prototype._loadGraphic=function(){if(this.hasGraphicFolder()&&this.hasGraphicName()){const t=this._graphicFolder,e=this._graphicName,i=this._graphicLoadListener;this.loadBitmap(t,e,i),this.updateReadyEvents()}},DKTools.Sprite.prototype.loadAnimation=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/animations/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/animations/",t,e,i,s)},DKTools.Sprite.prototype.loadBattleback1=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/battlebacks1/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/battlebacks1/",t,e,i,s)},DKTools.Sprite.prototype.loadBattleback2=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/battlebacks2/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/battlebacks2/",t,e,i,s)},DKTools.Sprite.prototype.loadBitmap=function(t,e,i,s,n){if(t instanceof Object)return this.loadBitmap(t.folder,t.filename,t.listener,t.hue,t.smooth);const r=DKTools.Utils.Bitmap.load(t,e,null,s,n);return!!this.setBitmap(r)&&(DKTools.Utils.isFunction(i)&&this.hasBitmap()&&this.bitmap.addLoadListener(i),!0)},DKTools.Sprite.prototype.loadCharacter=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/characters/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/characters/",t,e,i,s)},DKTools.Sprite.prototype.loadEnemy=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/enemies/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/enemies/",t,e,i,s)},DKTools.Sprite.prototype.loadFace=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/faces/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/faces/",t,e,i,s)},DKTools.Sprite.prototype.loadParallax=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/parallaxes/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/parallaxes/",t,e,i,s)},DKTools.Sprite.prototype.loadPicture=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/pictures/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/pictures/",t,e,i,s)},DKTools.Sprite.prototype.loadSvActor=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/sv_actors/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/sv_actors/",t,e,i,s)},DKTools.Sprite.prototype.loadSvEnemy=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/sv_enemies/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/sv_enemies/",t,e,i,s)},DKTools.Sprite.prototype.loadSystem=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/system/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/system/",t,e,i,s)},DKTools.Sprite.prototype.loadTileset=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/tilesets/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/tilesets/",t,e,i,s)},DKTools.Sprite.prototype.loadTitle1=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/titles1/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/titles1/",t,e,i,s)},DKTools.Sprite.prototype.loadTitle2=function(t,e,i,s){return t instanceof Object?this.loadBitmap("img/titles2/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/titles2/",t,e,i,s)},DKTools.Sprite.prototype.loadWindowskin=function(t,e,i,s){return t instanceof Object?this.loadSystem(t.filename||this.standardWindowskin(),t.listener,t.hue,t.smooth):this.loadSystem(t||this.standardWindowskin(),e,i,s)},DKTools.Sprite.prototype.moveWithAnchor=function(t,e){t instanceof Object&&(e=t.y),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e));const i=DKTools.Utils.Point.toPoint(t,e),s=this.anchor;this.move(i.x+this.width*s.x,i.y+this.height*s.y)},DKTools.Sprite.prototype.standardAlign=function(){return"center"},DKTools.Sprite.prototype.standardAnchor=function(){return new Point(0,0)},DKTools.Sprite.prototype.standardFillColor=function(){return null},DKTools.Sprite.prototype.standardFont=function(){return{fontFace:this.standardFontFace(),fontItalic:this.standardFontItalic(),fontSize:this.standardFontSize()}},DKTools.Sprite.prototype.standardFontFace=function(){return"GameFont"},DKTools.Sprite.prototype.standardFontItalic=function(){return!1},DKTools.Sprite.prototype.standardFontSize=function(){return 28},DKTools.Sprite.prototype.standardFrame=function(){return new Rectangle(0,0,this.width,this.height)},DKTools.Sprite.prototype.standardGraphicFolder=function(){return"img/system/"},DKTools.Sprite.prototype.standardGraphicName=function(){return""},DKTools.Sprite.prototype.standardOpacity=function(){return 255},DKTools.Sprite.prototype.standardPaintOpacity=function(){return 255},DKTools.Sprite.prototype.standardTextColor=function(){return"#ffffff"},DKTools.Sprite.prototype.standardMask=function(){return null},DKTools.Sprite.prototype.setupAll=function(t={}){t=t||{},DKTools.Base.prototype.setupAll.call(this,t),this.setupBitmap(t),this.setupFrame(t.frame),this.setupAnchor(t.anchor),this.setupAlign(t.align),this.setupFont(t.font),this.setupTextColor(t.textColor),this.setupPaintOpacity(t.paintOpacity),this.setupFillColor(t.fillColor),this.setupOpacity(t.opacity),this.setupGraphicFolder(t.graphicFolder),this.setupGraphicName(t.graphicName)},DKTools.Sprite.prototype.setupAlign=function(t){this._align=t||this.standardAlign()},DKTools.Sprite.prototype.setupAnchor=function(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),s=Object.assign(this.standardAnchor(),i);this.anchor.copy(s)},DKTools.Sprite.prototype.setupBitmap=function(t){let e=null;t instanceof DKTools.Sprite&&t.hasFixedBitmap()&&t.canCloneFixedBitmap()?e=DKTools.Utils.Bitmap.clone(t.bitmap):t instanceof Object&&(e=DKTools.Utils.Bitmap.load(t.bitmap||t)),e?(this.bitmap=e,this.bitmap.addLoadListener(this.setupSize.bind(this))):this.bitmap=null,this._fixedBitmap=!!this.bitmap},DKTools.Sprite.prototype.setupFillColor=function(t){this._fillColor=null!==t?_.defaultTo(t,this.standardFillColor()):null},DKTools.Sprite.prototype.setupFont=function(t){this._font=Object.assign(this.standardFont(),t)},DKTools.Sprite.prototype.setupFrame=function(t,e,i,s){const n=DKTools.Utils.Rectangle.tryToRectangle(t,e,i,s),r=Object.assign(this.standardFrame(),n);Sprite.prototype.setFrame.call(this,r.x,r.y,r.width,r.height)},DKTools.Sprite.prototype.setupGraphicFolder=function(t){this._graphicFolder=_.defaultTo(t,this.standardGraphicFolder())},DKTools.Sprite.prototype.setupGraphicLoadListener=function(t){this._graphicLoadListener=t||null},DKTools.Sprite.prototype.setupGraphicName=function(t){this._graphicName=null!==t?_.defaultTo(t,this.standardGraphicName()):null},DKTools.Sprite.prototype.setupHeight=function(t){DKTools.Utils.isString(t)&&(t=this.getLineHeight()*parseFloat(t)),this._bitmapHeight=this._checkHeight(t)},DKTools.Sprite.prototype.setupMask=function(t){this.mask=null!==t?_.defaultTo(t,this.standardMask()):null},DKTools.Sprite.prototype.setupOpacity=function(t){this._opacity=_.defaultTo(t,this.standardOpacity())},DKTools.Sprite.prototype.setupPaintOpacity=function(t){this._paintOpacity=_.defaultTo(t,this.standardPaintOpacity())},DKTools.Sprite.prototype.setupSize=function(t,e){if(t instanceof Object)return this.setupSize(t.width,t.height);this.setupWidth(t),this.setupHeight(e)},DKTools.Sprite.prototype.setupTextColor=function(t){this._textColor=t||this.standardTextColor()},DKTools.Sprite.prototype.setupWidth=function(t){this._bitmapWidth=this._checkWidth(t)},DKTools.Sprite.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let s=DKTools.Base.prototype.setAll.call(this,t,!0);return this.setAlign(t.align,!0)&&s++,this.setAnchor(t.anchor)&&s++,this.setFont(t.font,!0)&&s++,this.setTextColor(t.textColor,!0)&&s++,this.setPaintOpacity(t.paintOpacity,!0)&&s++,this.setFillColor(t.fillColor,!0)&&s++,this.setOpacity(t.opacity,!0)&&s++,this.setGraphicFolder(t.graphicFolder,!0)&&s++,this.setGraphicName(t.graphicName,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s},DKTools.Sprite.prototype.setAlign=function(t,e=!1){if(this._align===t)return!1;const i=this._align;return this.setupAlign(t),this._align!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setAnchor=function(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.anchor,i))return!1;const s=DKTools.Utils.Point.clone(this.anchor);return this.setupAnchor(i),!DKTools.Utils.Point.equals(this.anchor,s)},DKTools.Sprite.prototype.setBitmap=function(t){return this.bitmap!==t&&(this.setupBitmap(t),!0)},DKTools.Sprite.prototype.setFillColor=function(t,e=!1){if(this._fillColor===t)return!1;const i=this._fillColor;return this.setupFillColor(t),this._fillColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setFont=function(t,e=!1){if(_.isEqual(this._font,Object.assign(this.standardFont(),t)))return!1;const i={...this._font};return this.setupFont(t),!_.isEqual(this._font,i)&&(e||this.start(),!0)},DKTools.Sprite.prototype.setFrame=function(t,e,i,s){const n=DKTools.Utils.Rectangle.toRectangle(t,e,i,s);if(DKTools.Utils.Rectangle.equals(this._frame,n))return!1;const r=DKTools.Utils.Rectangle.clone(this._frame);return this.setupFrame(n),!DKTools.Utils.Rectangle.equals(this._frame,r)},DKTools.Sprite.prototype.setGraphicFolder=function(t,e=!1){if(this._graphicFolder===t)return!1;const i=this._graphicFolder;return this.setupGraphicFolder(t),this._graphicFolder!==i&&(e||this.start(),!0)},DKTools.Sprite.prototype.setGraphicName=function(t,e=!1){if(this._graphicName===t)return!1;const i=this._graphicName;return this.setupGraphicName(t),this._graphicName!==i&&(e||this.start(),!0)},DKTools.Sprite.prototype.setHeight=function(t,e=!1){return this.resize(this._getBitmapWidth(),t,e)},DKTools.Sprite.prototype.setMask=function(t){return this.mask!==t&&(this.setupMask(t),!0)},DKTools.Sprite.prototype.setOpacity=function(t,e=!1){if(this._opacity===t)return!1;const i=this._opacity;return this.setupOpacity(t),this._opacity!==i&&(e||this.updateOpacity(),!0)},DKTools.Sprite.prototype.setPaintOpacity=function(t,e=!1){if(this._paintOpacity===t)return!1;const i=this._paintOpacity;return this.setupPaintOpacity(t),this._paintOpacity!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setTextColor=function(t,e=!1){if(this._textColor===t)return!1;const i=this._textColor;return this.setupTextColor(t),this._textColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setWidth=function(t,e=!1){return this.resize(t,this._getBitmapHeight(),e)},DKTools.Sprite.prototype.redrawAll=function(){this.clear(),this.drawAll(),this.updateRedrawAllEvents()},DKTools.Sprite.prototype.removeBitmap=function(){this.hasBitmap()&&this.setBitmap(null)},DKTools.Sprite.prototype.removeFillColor=function(){this.hasFillColor()&&this.setFillColor(null)},DKTools.Sprite.prototype.removeGraphicName=function(){this.hasGraphicName()&&this.setGraphicName(null)},DKTools.Sprite.prototype.removeText=function(t,e=!1){const i=this.findText(t);return i?(DKTools.Utils.Array.remove(this._texts,i),e||this.refreshAll(),i):null},DKTools.Sprite.prototype.reserveAnimation=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/animations/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/animations/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveBattleback1=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/battlebacks1/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/battlebacks1/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveBattleback2=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/battlebacks2/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/battlebacks2/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveBitmap=function(t,e,i,s,n,r){if(t instanceof Object)return this.reserveBitmap(t.folder,t.filename,t.listener,t.hue,t.smooth,t.reservationId);const o=DKTools.Utils.Bitmap.reserve(t,e,null,s,n,r);return!!this.setBitmap(o)&&(DKTools.Utils.isFunction(i)&&this.hasBitmap()&&this.bitmap.addLoadListener(i),!0)},DKTools.Sprite.prototype.reserveCharacter=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/characters/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/characters/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveEnemy=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/enemies/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/enemies/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveFace=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/faces/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/faces/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveParallax=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/parallaxes/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/parallaxes/",t,e,i,s,n)},DKTools.Sprite.prototype.reservePicture=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/pictures/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/pictures/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveSvActor=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/sv_actors/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/sv_actors/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveSvEnemy=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/sv_enemies/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/sv_enemies/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveSystem=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/system/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/system/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveTileset=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/tilesets/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/tilesets/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveTitle1=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/titles1/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/titles1/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveTitle2=function(t,e,i,s,n){return t instanceof Object?this.reserveBitmap("img/titles2/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/titles2/",t,e,i,s,n)},DKTools.Sprite.prototype.reserveWindowskin=function(t,e,i,s,n){return t instanceof Object?this.reserveSystem(t.filename||this.standardWindowskin(),t.listener,t.hue,t.smooth,t.reservationId):this.reserveSystem(t||this.standardWindowskin(),e,i,s,n)},DKTools.Sprite.prototype.resetAll=function(){this.resetFont(),this.resetPaintOpacity(),this.resetTextColor()},DKTools.Sprite.prototype.resetFont=function(){this.changeFont(this.font)},DKTools.Sprite.prototype.resetPaintOpacity=function(){this.changePaintOpacity(this.paintOpacity)},DKTools.Sprite.prototype.resetTextColor=function(){this.changeTextColor(this.textColor)},DKTools.Sprite.prototype.resize=function(t,e,i=!1,s=!1){if(!this.isResizable())return!1;if(t=_.defaultTo(t,this.getMinWidth()),e=_.defaultTo(e,this.getMinHeight()),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),this._bitmapWidth===t&&this._bitmapHeight===e)return!1;const n=this._bitmapWidth,r=this._bitmapHeight;return this.setupSize(t,e),(this._bitmapWidth!==n||this._bitmapHeight!==r)&&(i||this.start(),s&&this.activate(),!0)},DKTools.Sprite.prototype.rotateHue=function(t){return!(!this.hasBitmap()||!t)&&(this.bitmap.rotateHue(t),!0)},DKTools.Sprite.prototype.updateAll=function(){DKTools.Base.prototype.updateAll.call(this),this.updateBitmap()},DKTools.Sprite.prototype.updateBitmap=function(){this.hasBitmap()&&(this.updateFont(),this.updatePaintOpacity(),this.updateTextColor())},DKTools.Sprite.prototype.updateDrawAllEvents=function(){this.updateEventsContainer("draw-all")},DKTools.Sprite.prototype.updateFill=function(){this.hasFillColor()&&this.fillAll(this.fillColor)},DKTools.Sprite.prototype.updateFont=function(t={}){t=t||{},this.bitmap.fontFace=t.fontFace||this.font.fontFace,this.bitmap.fontItalic=!!t.fontItalic,this.bitmap.fontSize=t.fontSize||this.font.fontSize},DKTools.Sprite.prototype.updatePaintOpacity=function(t){Number.isFinite(t)||(t=this.paintOpacity),this.bitmap.paintOpacity=t},DKTools.Sprite.prototype.updateTextColor=function(t){this.bitmap.textColor=t||this.textColor},DKTools.Sprite.prototype.updateOpacity=function(t){Number.isFinite(t)||(t=this.opacity),this.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},DKTools.Sprite.Button=class extends DKTools.Sprite{_clearAll(){DKTools.Sprite.prototype._clearAll.call(this),this._clearMousePressTime()}_clearMousePressTime(){this._mousePressTime=0}isPressed(){return this._mousePressTime>0&&!this.isLongPressed()}isLongPressed(){return this._mousePressTime>=this._longPressInterval}_setupEvents(){DKTools.Sprite.prototype._setupEvents.call(this),this._setupUpdateButtonStateEvent()}_setupOptions(){DKTools.Sprite.prototype._setupOptions.call(this),this._setupProcessMouseOption()}_setupUpdateButtonStateEvent(){this.addEvent({type:"update",onUpdate:this.updateButtonState.bind(this)})}_setupProcessMouseOption(){this.enableOption("process-mouse")}standardActive(){return!1}standardLongPressInterval(){return 18}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupLongPressInterval(t.longPressInterval)}setupLongPressInterval(t){this._longPressInterval=t||this.standardLongPressInterval()}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setLongPressInterval(t.longPressInterval)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setLongPressInterval(t){if(this._longPressInterval===t)return!1;const e=this._longPressInterval;return this.setupLongPressInterval(t),this._longPressInterval!==e}processAll(){DKTools.Sprite.prototype.processAll.call(this),this.processMousePress()}processMousePress(){if(this.isVisible()&&this.isMouseInside()&&(this.isActive()||this.isOptionEnabled("process-mouse-press-ignore-active")))if(TouchInput.isMousePressed()){let t;this._mousePressTime++,TouchInput.isLeftButtonPressed()?t="left":TouchInput.isMiddleButtonPressed()?t="middle":TouchInput.isRightButtonPressed()&&(t="right"),t&&(this.updateMouseDownEvents(t),this.isLongPressed()&&(this._mousePressTime===this._longPressInterval&&this.updateMouseLongPressStartedEvents(t),this.updateMouseLongPressEvents(t)))}else{let t;TouchInput.isLeftButtonReleased()?t="left":TouchInput.isMiddleButtonReleased()?t="middle":TouchInput.isRightButtonReleased()&&(t="right"),t&&(this.isLongPressed()?this.updateMouseLongPressFinishedEvents(t):this.isPressed()&&this.updateMouseClickEvents(t),this._mousePressTime>0&&this.updateMouseUpEvents(t)),this._clearMousePressTime()}else this._clearMousePressTime()}updateMouseDownEvents(t){this.updateEventsContainer("mouse-down-"+t)}updateMouseUpEvents(t){this.updateEventsContainer("mouse-up-"+t)}updateMouseClickEvents(t){this.updateEventsContainer("mouse-click-"+t)}updateMouseLongPressEvents(t){this.updateEventsContainer("mouse-long-press-"+t)}updateMouseLongPressStartedEvents(t){this.updateEventsContainer(`mouse-long-press-${t}-started`)}updateMouseLongPressFinishedEvents(t){this.updateEventsContainer(`mouse-long-press-${t}-finished`)}updateStateNormalEvents(){this.updateEventsContainer("state-normal")}updateStatePressedEvents(){this.updateEventsContainer("state-pressed")}updateButtonState(){this._mousePressTime>0?this.updateStatePressedEvents():this.updateStateNormalEvents()}},Object.defineProperties(DKTools.Sprite.Button.prototype,{longPressInterval:{get:function(){return this._longPressInterval},configurable:!0},mousePressTime:{get:function(){return this._mousePressTime},configurable:!0}}),DKTools.Sprite.Cursor=class extends DKTools.Sprite{_clearAll(){DKTools.Sprite.prototype._clearAll.call(this),this._clearAnimationCount()}_clearAnimationCount(){this._animationCount=0}_createAll(){DKTools.Sprite.prototype._createAll.call(this),this._createWindowskin()}_createWindowskin(){this._windowskin=ImageManager.loadSystem(this.standardWindowskin())}refreshAll(){DKTools.Sprite.prototype.refreshAll.call(this),this.refreshCursor()}refreshCursor(){const t=this._cursorRect.x,e=this._cursorRect.y,i=this._cursorRect.width,s=this._cursorRect.height,n=this.parent,r=Math.min(i,n.width-t),o=Math.min(s,n.height-e);if(this.move(t,e),i>0&&s>0){const t=this._windowskin,e=new Bitmap(r,o),n=96,a=48;e.blt(t,n+4,n+4,a-8,a-8,4,4,i-8,s-8),e.blt(t,n+4,n,a-8,4,4,0,i-8,4),e.blt(t,n+4,n+a-4,a-8,4,4,0+s-4,i-8,4),e.blt(t,n,n+4,4,a-8,0,4,4,s-8),e.blt(t,n+a-4,n+4,4,a-8,0+i-4,4,4,s-8),e.blt(t,n,n,4,4,0,0,4,4),e.blt(t,n+a-4,n,4,4,0+i-4,0,4,4),e.blt(t,n,n+a-4,4,4,0,0+s-4,4,4),e.blt(t,n+a-4,n+a-4,4,4,0+i-4,0+s-4,4,4),this.setupBitmap(e)}}standardBlinkSpeed(){return 8}standardCursorRect(){return new Rectangle(0,0,0,0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupBlinkSpeed(t.blinkSpeed),this.setupCursorRect(t.cursorRect)}setupBlinkSpeed(t){this._blinkSpeed=_.defaultTo(t,this.standardBlinkSpeed())}setupCursorRect(t,e,i,s){const n=DKTools.Utils.Rectangle.tryToRectangle(t,e,i,s);this._cursorRect=Object.assign(this.standardCursorRect(),n)}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setBlinkSpeed(t.blinkSpeed)&&s++,this.setCursorRect(t.cursorRect)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setBlinkSpeed(t){if(this._blinkSpeed===t)return!1;const e=this._blinkSpeed;return this.setupBlinkSpeed(t),this._blinkSpeed!==e}setCursorRect(t,e,i,s){const n=DKTools.Utils.Rectangle.toRectangle(t,e,i,s);if(DKTools.Utils.Rectangle.equals(this._cursorRect,n))return!1;const r=DKTools.Utils.Rectangle.clone(this._cursorRect);return this.setupCursorRect(n),!DKTools.Utils.Rectangle.equals(this._cursorRect,r)&&(this.refreshCursor(),!0)}processAll(){DKTools.Sprite.prototype.processAll.call(this),this.processCursorAnimation()}processCursorAnimation(){const t=this._animationCount%40;let e=this.parent.getCurrentOpacity();this.parent.isVisibleAndActive()&&(this._animationCount++,e-=t<20?t*this._blinkSpeed:(40-t)*this._blinkSpeed),this.setOpacity(e)}},Object.defineProperties(DKTools.Sprite.Cursor.prototype,{cursorRect:{get:function(){return this._cursorRect},configurable:!0},blinkSpeed:{get:function(){return this._blinkSpeed},configurable:!0}}),DKTools.Sprite.Arrow=class extends DKTools.Sprite.Button{static getRect(t){const e=24,i=12;let s,n,r,o;switch(t){case"up":s=132,n=24,r=e,o=i;break;case"down":s=132,n=60,r=e,o=i;break;case"left":s=120,n=36,r=i,o=e;break;case"right":s=156,n=36,r=i,o=e}return DKTools.Utils.Rectangle.tryToRectangle(s,n,r,o)}refreshAll(){DKTools.Sprite.Button.prototype.refreshAll.call(this),this.refreshArrow()}refreshArrow(){this.setFrame(DKTools.Sprite.Arrow.getRect(this._arrowType))}standardVisible(){return!1}standardGraphicName(){return this.standardWindowskin()}standardAnchor(){return new Point(.5,.5)}standardArrowType(){return null}setupAll(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupArrowType(t.arrowType)}setupArrowType(t){this._arrowType=t||this.standardArrowType()}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setArrowType(t.arrowType,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setArrowType(t,e=!1){if(this._arrowType===t)return!1;const i=this._arrowType;return this.setupArrowType(t),this._arrowType!==i&&(e||this.refreshAll(),!0)}},Object.defineProperties(DKTools.Sprite.Arrow.prototype,{arrowType:{get:function(){return this._arrowType},configurable:!0}}),DKTools.Sprite.Selectable=class extends DKTools.Sprite.Button{_addAllChildren(){DKTools.Sprite.Button.prototype._addAllChildren.call(this),this._addCursorSprite()}_addCursorSprite(){this.addChild(this._cursorSprite)}activate(){DKTools.Sprite.Button.prototype.activate.call(this),this.reselect()}addItem(t,e=!1){const i=this.insertItem(t,this.getMaxItems()-1,!0);return e||this.refreshAll(),i}addItems(t,e=!1){const i=_.map(t,t=>this.addItem(t,!0));return e||this.refreshAll(),i}_clearAll(){DKTools.Sprite.Button.prototype._clearAll.call(this),this._clearItems(),this._clearHandlers(),this._clearTopRow(),this._clearTopCol()}_clearItems(){this._items=[]}_clearHandlers(){this._handlers={}}_clearTopRow(){this._topRow=0}_clearTopCol(){this._topCol=0}_createAll(){DKTools.Sprite.Button.prototype._createAll.call(this),this._createCursorSprite()}_createCursorSprite(){this._cursorSprite=new DKTools.Sprite.Cursor}_checkItem(t){return void 0===t.enabled&&(t.enabled=!0),void 0===t.ext&&(t.ext=null),t.symbol&&DKTools.Utils.isFunction(t.handler)&&this.setHandler(t.symbol,t.handler),t}callHandler(t){this.isHandled(t)&&this._handlers[t](this._index,this)}callOkHandler(){const t=this.getCurrentItemSymbol();this.isHandled(t)?this.callHandler(t):this.isHandled("ok")?this.callHandler("ok"):this.activate()}callCancelHandler(){this.callHandler("cancel")}clearItem(t){this.clearRect(this.getItemRect(t))}cursorDown(t=!1){this.hasCursorDownHandler()&&this._cursorDownHandler(t,this)}cursorUp(t=!1){this.hasCursorUpHandler()&&this._cursorUpHandler(t,this)}cursorRight(t=!1){this.hasCursorRightHandler()&&this._cursorRightHandler(t,this)}cursorLeft(t=!1){this.hasCursorLeftHandler()&&this._cursorLeftHandler(t,this)}cursorPageDown(){this.hasCursorPageDownHandler()&&this._cursorPageDownHandler(this)}cursorPageUp(){this.hasCursorPageUpHandler()&&this._cursorPageUpHandler(this)}deactivate(t=!1){DKTools.Sprite.Button.prototype.deactivate.call(this),t&&this.deselect()}deselect(){this.selectItem(-1)}disableItem(t,e=!1){(this.getItem(t)||{}).enabled=!1,e||this.refreshAll()}drawAll(){DKTools.Sprite.Button.prototype.drawAll.call(this),this.drawAllItems()}drawAllItems(){const t=this.getMaxPageItems(),e=this.getMaxItems();let i=this.getTopIndex();for(let s=0;s<t&&i<e;s++,i++)this.drawItem(i)}drawItem(t){const e=this.getItem(t)||{};DKTools.Utils.isFunction(e.drawHandler)?e.drawHandler(t,this):this.hasDrawItemHandler()&&this._itemDrawHandler(t,this)}enableItem(t,e=!1){(this.getItem(t)||{}).enabled=!0,e||this.refreshAll()}findSymbol(t){return _.findIndex(this._items,{symbol:t})}findExt(t){return _.findIndex(this._items,{ext:t})}getItemName(t){const e=this.getItem(t)||{};return DKTools.Utils.isFunction(e.name)?e.name(t,this):e.name}getCurrentItemName(){return this.getItemName(this._index)}getLastItemName(){return this.getItemName(this._lastIndex)}getItemRect(t){const e=(this.getItem(t)||{}).rect||this._itemRect;return DKTools.Utils.isFunction(e)?e(t,this):e}getCurrentItemRect(){return this.getItemRect(this._index)}getLastItemRect(){return this.getItemRect(this._lastIndex)}getItemRectForText(t){const e=this.getItemRect(t);return e.x+=this._textPadding,e.width-=2*this._textPadding,e}getCurrentItemRectForText(){return this.getItemRectForText(this._index)}getLastItemRectForText(){return this.getItemRectForText(this._lastIndex)}getItemWidth(){return DKTools.Utils.isFunction(this._itemWidth)?this._itemWidth(this):this._itemWidth}getItemHeight(){return DKTools.Utils.isFunction(this._itemHeight)?this._itemHeight(this):DKTools.Utils.isString(this._itemHeight)?this.getLineHeight()*parseFloat(this._itemHeight):this._itemHeight}getItem(t){return this._items[t]||null}getItemIndex(t){return _.indexOf(this._items,t)}getItemFont(t){const e=(this.getItem(t)||{}).font||this._itemFont;return DKTools.Utils.isFunction(e)?e(t,this):e}getItemTextColor(t){const e=(this.getItem(t)||{}).textColor||this._itemTextColor;return DKTools.Utils.isFunction(e)?e(t,this):e}getItemPaintOpacity(t){const e=this.getItem(t)||{};return DKTools.Utils.isFunction(e.paintOpacity)?e.paintOpacity(t,this):DKTools.Utils.isNumber(e.paintOpacity)?e.paintOpacity:DKTools.Utils.isFunction(this._itemPaintOpacity)?this._itemPaintOpacity(t,this):this._itemPaintOpacity}getItemAlign(t){const e=(this.getItem(t)||{}).align||this._itemAlign;return DKTools.Utils.isFunction(e)?e(t,this):e}getItemFullInfo(t){const e=this.getItem(t);return{...e,index:t,item:e,name:this.getItemName(t),enabled:this.isItemEnabled(t),handled:this.isItemHandled(t),selected:this.isItemSelected(t),rect:this.getItemRect(t),rectForText:this.getItemRectForText(t),font:this.getItemFont(t),textColor:this.getItemTextColor(t),paintOpacity:this.getItemPaintOpacity(t),align:this.getItemAlign(t)}}getCurrentItemFullInfo(){return this.getItemFullInfo(this._index)}getLastItemFullInfo(){return this.getItemFullInfo(this._lastIndex)}getPrevIndex(t=!1){return this._index>0?this._index-1:t?this.getMaxItems()-1:-1}getNextIndex(t=!1){return this._index<this.getMaxItems()-1?this._index+1:t?0:-1}getPrevItem(t=!1){return this.getItem(this.getPrevIndex(t))}getNextItem(t=!1){return this.getItem(this.getNextIndex(t))}getCurrentItem(){return this.getItem(this._index)}getLastItem(){return this.getItem(this._lastIndex)}getVisibleItems(){const t=this.getMaxPageItems(),e=this.getMaxItems(),i=[];let s=this.getTopIndex();for(let n=0;n<t&&s<e;n++,s++)i.push(this.getItem(s));return i}getItemSymbol(t){const e=this.getItem(t);return e?e.symbol:null}getItemExt(t){const e=this.getItem(t);return e?e.ext:null}getCurrentItemSymbol(){return this.getItemSymbol(this._index)}getLastItemSymbol(){return this.getItemSymbol(this._lastIndex)}getCurrentItemExt(){return this.getItemExt(this._index)}getLastItemExt(){return this.getItemExt(this._lastIndex)}getMaxItems(){return this._items.length}getMaxRows(){return this.isFixedHorizontal()?1:Math.max(1,Math.ceil(this.getMaxItems()/this.getMaxCols()))}getMaxCols(){return this._maxCols}getMaxTopRow(){return Math.max(0,this.getMaxRows()-this.getMaxPageRows())}getMaxTopCol(){return Math.max(0,this.getMaxItems()-this.getMaxPageCols())}getMaxPageRows(){const t=this._verticalSpacing,e=this.getItemHeight(),i=this.getMaxRows();let s=this.height,n=0;for(;n<i;n++){if(n===i-1){if(s-e<0)break}else if(s-e-t<0)break;s-=e+t}return n}getMaxPageCols(){return this.getMaxCols()}getMaxPageItems(){return this.isHorizontal()?this.getMaxPageCols():this.getMaxPageRows()*this.getMaxPageCols()}getRow(t){return Math.floor(t/this.getMaxCols())}getCurrentRow(){return this.getRow(this._index)}getItemRow(t){return this.hasItem(t)?this.getRow(t):-1}getRowItems(t){const e=[];if(DKTools.Utils.Number.inRange(t,0,this.getMaxRows())){const i=this.getMaxPageItems(),s=this.getMaxItems();let n=t*this.getMaxCols();for(let r=0;r<i&&n<s&&this.getRow(n)===t;r++,n++)e.push(this.getItem(n))}return e}getCol(t){return Math.floor(t%this.getMaxCols())}getCurrentCol(){return this.isHorizontal()?this._index:this.getCol(this._index)}getItemCol(t){return this.hasItem(t)?this.getCol(t):-1}getColItems(t){const e=[];if(DKTools.Utils.Number.inRange(t,0,this.getMaxCols())){const i=this.getMaxItems();for(let s=0;s<i;s++)this.getCol(s)===t&&e.push(this.getItem(s))}return e}getTopIndex(){return this.isHorizontal()?this.getTopCol():this.getTopRow()*this.getMaxCols()}getTopRow(){return this._topRow}getTopCol(){return this._topCol}getBottomRow(){return Math.max(0,this.getTopRow()+this.getMaxPageRows()-1)}getBottomCol(){return Math.max(0,this.getTopCol()+this.getMaxPageCols()-1)}getBottomIndex(){return Math.min(this.getTopIndex()+this.getMaxPageItems(),this.getMaxItems())-1}hasItem(t){return!!this.getItem(t)}hasItems(){return this.getMaxItems()>0}hasSymbol(t){return _.includes(this._items,{symbol:t})}hasExt(t){return _.includes(this._items,{ext:t})}hasCursorDownHandler(){return!!this._cursorDownHandler}hasCursorUpHandler(){return!!this._cursorUpHandler}hasCursorRightHandler(){return!!this._cursorRightHandler}hasCursorLeftHandler(){return!!this._cursorLeftHandler}hasCursorPageDownHandler(){return!!this._cursorPageDownHandler}hasCursorPageUpHandler(){return!!this._cursorPageUpHandler}hasDrawItemHandler(){return!!this._itemDrawHandler}hideCursor(){this._cursorSprite.hide()}hitTest(t,e){if(this.isOutside(t,e))return-1;const i=this.scale,s=this.getLocalPoint(t,e),n=this.getMaxPageItems(),r=this.getMaxItems();let o=this.getTopIndex();for(let t=0;t<n&&o<r;t++,o++){const t=this.getItemRect(o);if(t.x*=i.x,t.y*=i.y,t.width*=i.x,t.height*=i.y,t.contains(s.x,s.y))return o}return-1}insertItem(t,e,i=!1){const s=this._checkItem(t);return DKTools.Utils.Array.insert(this._items,s,e),i||this.refreshAll(),s}insertItems(t,e,i=!1){e=e||0;const s=_.map(t,(t,i)=>this.insertItem(t,e+i,!0));return i||this.refreshAll(),s}isCursorFixed(){return this._cursorFixed}isCursorAll(){return this._cursorAll}isFixedHorizontal(){return this._fixedHorizontal}isHorizontal(){return this.isFixedHorizontal()||1===this.getMaxPageRows()}isVertical(){return!this.isHorizontal()}isCursorMovable(){return this.isVisibleAndActive()&&!this.isCursorFixed()&&!this.isCursorAll()&&this.hasItems()}isOkEnabled(){return!0}isCancelEnabled(){return this.isHandled("cancel")}isOkTriggered(){return Input.isRepeated("ok")}isCancelTriggered(){return Input.isRepeated("cancel")||TouchInput.isCancelled()}isCursorVisible(){if(!this._cursorSprite.isVisible())return!1;if(this.isHorizontal()){const t=this.getCurrentCol();return t>=this.getTopCol()&&t<=this.getBottomCol()}const t=this.getCurrentRow();return t>=this.getTopRow()&&t<=this.getBottomRow()}isItemEnabled(t){const e=(this.getItem(t)||{}).enabled;return DKTools.Utils.isFunction(e)?e(t,this):e}isCurrentItemEnabled(){return this.isItemEnabled(this._index)}isItemVisible(t){return DKTools.Utils.Number.inRange(t,this.getTopIndex(),this.getBottomIndex()+1)}isItemSelected(t){return this._index===t}isHandled(t){return!!this._handlers[t]}isItemHandled(t){const e=this.getItem(t)||{};return this.isHandled(e.symbol)||DKTools.Utils.isFunction(e.okHandler)}isCurrentItemHandled(){return this.isItemHandled(this._index)}_onTouch(t=!1){const e=this._index,i=TouchInput.x,s=TouchInput.y,n=this.hitTest(i,s);n>=0&&(this._index===n?t&&this.isOkEnabled()&&this.processOk():this.isCursorMovable()&&this.selectItem(n)),this._index!==e&&this.playCursorSound()}playOkSound(){SoundManager.playOk()}playCancelSound(){SoundManager.playCancel()}playCursorSound(){SoundManager.playCursor()}playBuzzerSound(){SoundManager.playBuzzer()}processAll(){DKTools.Sprite.Button.prototype.processAll.call(this),this.processCursorMove(),this.processHandling()}processCursorMove(){if(!this.isCursorMovable())return;const t=this._index;Input.isRepeated("down")&&this.cursorDown(Input.isTriggered("down")),Input.isRepeated("up")&&this.cursorUp(Input.isTriggered("up")),Input.isRepeated("right")&&this.cursorRight(Input.isTriggered("right")),Input.isRepeated("left")&&this.cursorLeft(Input.isTriggered("left")),Input.isTriggered("pagedown")&&this.cursorPageDown(),Input.isTriggered("pageup")&&this.cursorPageUp(),this._index!==t&&this.playCursorSound()}processHandling(){this.isVisibleAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()&&this.processCancel())}processMouseHover(){if(this.isOptionEnabled("process-mouse-hover")&&this.isCursorMovable()&&TouchInput.date>Input.date){const t=this._index,e=TouchInput.mouseX,i=TouchInput.mouseY,s=this.hitTest(e,i);s>=0&&s!==t&&this.selectItem(s,!0)}}processWheelScroll(){if(this.isOptionEnabled("process-wheel-scroll")&&this.isVisibleAndActive()){this._wheelY>0?this.isHorizontal()?this.scrollRight():this.scrollDown():this.isHorizontal()?this.scrollLeft():this.scrollUp()}}processOk(){if(this.isCurrentItemEnabled()){this.playOkSound(),this.updateInputData(),this.deactivate();const t=this.getCurrentItem()||{};DKTools.Utils.isFunction(t.okHandler)?t.okHandler(this._index,this):this.callOkHandler()}else this.playBuzzerSound()}processCancel(){this.playCancelSound(),this.updateInputData(),this.deactivate();const t=this.getCurrentItem();t&&DKTools.Utils.isFunction(t.cancelHandler)?t.cancelHandler(this._index,this):this.callCancelHandler()}redrawItem(t){this.isItemVisible(t)&&(this.clearItem(t),this.drawItem(t))}redrawCurrentItem(){this.redrawItem(this._index)}removeHandler(t){delete this._handlers[t]}removeItem(t,e=!1){const i=this.getItem(t);return i?(DKTools.Utils.Array.remove(this._items,i),e||this.refreshAll(),i):null}removeItems(t,e=!1){const i=_.map(t,t=>this.removeItem(t,!0));return e||this.refreshAll(),i}replaceItem(t,e,i=!1){const s=this._checkItem(t);e=e||0;const n=this._items[e];return this._items[e]=s,i||this.refreshAll(),n}reselect(){this.selectItem(this._index)}resetScroll(){0!==this._index&&this.selectItem(0)}_setupEvents(){DKTools.Sprite.Button.prototype._setupEvents.call(this),this._setupMouseClickEvent(),this._setupMouseLongPressEvent(),this._setupMouseHoverEvents(),this._setupWheelScrollEvents()}_setupMouseClickEvent(){this.addEvent({type:"mouse-click-left",onUpdate:this._onTouch.bind(this,!0)})}_setupMouseLongPressEvent(){this.addEvent({type:"mouse-long-press-left",onUpdate:this._onTouch.bind(this,!1)})}_setupMouseHoverEvents(){this.addEvent({type:"mouse-enter",onUpdate:this.processMouseHover.bind(this)}),this.addEvent({type:"mouse-move",onUpdate:this.processMouseHover.bind(this)})}_setupWheelScrollEvents(){this.addEvent({type:"wheel-Y-inside",onUpdate:this.processWheelScroll.bind(this)}),this.addEvent({type:"wheel-Y-outside",onUpdate:this.processWheelScroll.bind(this)})}standardIndex(){return 0}standardMaxCols(){return 1}standardCursorFixed(){return!1}standardCursorAll(){return!1}standardFixedHorizontal(){return!1}standardHorizontalSpacing(){return 0}standardVerticalSpacing(){return 0}standardTextPadding(){return 6}standardCursorDownHandler(){return t=>{if(this.isHorizontal())return;const e=this._index,i=this.getMaxItems(),s=this.getMaxCols();(e<i-s||t&&i===this.getMaxRows()*s)&&this.selectItem((e+s)%i)}}standardCursorUpHandler(){return t=>{if(this.isHorizontal())return;const e=this._index,i=this.getMaxItems(),s=this.getMaxCols();(e>=s||t&&i===this.getMaxRows()*s)&&this.selectItem((e-s+i)%i)}}standardCursorRightHandler(){return t=>{const e=this.getMaxItems();if(!(e<2))if(this.isVertical()){const i=this._index;this.getMaxCols()>=2&&(i<e-1||t)&&this.selectItem((i+1)%e)}else this.selectNextItem(t)}}standardCursorLeftHandler(){return t=>{const e=this.getMaxItems();if(!(e<2))if(this.isVertical()){const i=this._index;this.getMaxCols()>=2&&(i>0||t)&&this.selectItem((i-1+e)%e)}else this.selectPrevItem(t)}}standardCursorPageDownHandler(){return()=>{if(this.isHorizontal()){const t=this.getTopCol(),e=this.getMaxPageCols(),i=this.getMaxItems();t+e<i&&(this.setTopCol(t+e),this.selectItem(Math.min(this._index+this.getMaxPageItems(),i-1)))}else{const t=this.getTopRow(),e=this.getMaxPageRows();t+e<this.getMaxRows()&&(this.setTopRow(t+e),this.selectItem(Math.min(this._index+this.getMaxPageItems(),this.getMaxItems()-1)))}}}standardCursorPageUpHandler(){return()=>{if(this.isHorizontal()){const t=this.getTopCol();t>0&&(this.setTopCol(t-this.getMaxPageCols()),this.selectItem(Math.max(0,this._index-this.getMaxPageItems())))}else{const t=this.getTopRow();t>0&&(this.setTopRow(t-this.getMaxPageRows()),this.selectItem(Math.max(0,this._index-this.getMaxPageItems())))}}}standardItems(){return[]}standardItemDrawHandler(){return t=>{const e=this.getItemName(t),i=this.getItemFont(t),s=this.getItemTextColor(t),n=this.getItemPaintOpacity(t),r=this.getItemAlign(t),o=this.getItemRectForText(t);this.drawText(e,{font:i,textColor:s,paintOpacity:n,align:r,rect:o,resetFont:!0,resetTextColor:!0,resetPaintOpacity:!0})}}standardItemWidth(){return()=>Math.floor((this.width+this._horizontalSpacing)/this.getMaxCols()-this._horizontalSpacing)}standardItemHeight(){return this.getLineHeight()}standardItemRect(){return t=>{const e=new Rectangle(0,0,this.getItemWidth(),this.getItemHeight()),i=this.getMaxCols();return this.isHorizontal()?(e.x=(t-this.getTopCol())*(e.width+this._horizontalSpacing),e.y=0):(e.x=t%i*(e.width+this._horizontalSpacing),e.y=(Math.floor(t/i)-this.getTopRow())*(e.height+this._verticalSpacing)),e}}standardItemFont(){return()=>this.font}standardItemTextColor(){return()=>this.textColor}standardItemPaintOpacity(){return t=>this.isItemEnabled(t)?this.standardEnabledItemPaintOpacity():this.standardDisabledItemPaintOpacity()}standardEnabledItemPaintOpacity(){return 255}standardDisabledItemPaintOpacity(){try{return Window_Base.prototype.translucentOpacity.call(this)}catch(t){return 160}}standardItemAlign(){return this.align}setupAll(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupIndex(t.index),this.setupMaxCols(t.maxCols),this.setupFixedHorizontal(t.fixedHorizontal),this.setupCursorFixed(t.cursorFixed),this.setupCursorAll(t.cursorAll),this.setupCursorDownHandler(t.cursorDownHandler),this.setupCursorUpHandler(t.cursorUpHandler),this.setupCursorRightHandler(t.cursorRightHandler),this.setupCursorLeftHandler(t.cursorLeftHandler),this.setupCursorPageDownHandler(t.cursorPageDownHandler),this.setupCursorPageUpHandler(t.cursorPageUpHandler),this.setupSpacing(t.horizontalSpacing,t.verticalSpacing),this.setupTextPadding(t.textPadding),this.setupItems(t.items),this.setupItemDrawHandler(t.drawItemHandler),this.setupItemWidth(t.itemWidth),this.setupItemHeight(t.itemHeight),this.setupItemRect(t.itemRect),this.setupItemFont(t.itemFont),this.setupItemTextColor(t.itemTextColor),this.setupItemPaintOpacity(t.itemPaintOpacity),this.setupItemAlign(t.itemAlign)}setupIndex(t){this._lastIndex=this._index,this._index=_.defaultTo(t,this.standardIndex())}setupMaxCols(t){this._maxCols=t||this.standardMaxCols()}setupFixedHorizontal(t){this._fixedHorizontal=_.defaultTo(t,this.standardFixedHorizontal())}setupCursorFixed(t){this._cursorFixed=_.defaultTo(t,this.standardCursorFixed())}setupCursorAll(t){this._cursorAll=_.defaultTo(t,this.standardCursorAll())}setupCursorDownHandler(t){this._cursorDownHandler=t||this.standardCursorDownHandler()}setupCursorUpHandler(t){this._cursorUpHandler=t||this.standardCursorUpHandler()}setupCursorRightHandler(t){this._cursorRightHandler=t||this.standardCursorRightHandler()}setupCursorLeftHandler(t){this._cursorLeftHandler=t||this.standardCursorLeftHandler()}setupCursorPageDownHandler(t){this._cursorPageDownHandler=t||this.standardCursorPageDownHandler()}setupCursorPageUpHandler(t){this._cursorPageUpHandler=t||this.standardCursorPageUpHandler()}setupHorizontalSpacing(t){this._horizontalSpacing=_.defaultTo(t,this.standardHorizontalSpacing())}setupVerticalSpacing(t){this._verticalSpacing=_.defaultTo(t,this.standardVerticalSpacing())}setupSpacing(t,e){this.setupHorizontalSpacing(t),this.setupVerticalSpacing(e)}setupTextPadding(t){this._textPadding=_.defaultTo(t,this.standardTextPadding())}setupItems(t){this._items=_.map(t||this.standardItems(),t=>this._checkItem(t))}setupItemDrawHandler(t){this._itemDrawHandler=t||this.standardItemDrawHandler()}setupItemWidth(t){this._itemWidth=t||this.standardItemWidth()}setupItemHeight(t){this._itemHeight=t||this.standardItemHeight()}setupItemRect(t){this._itemRect=t||this.standardItemRect()}setupItemFont(t){this._itemFont=t||this.standardItemFont()}setupItemTextColor(t){this._itemTextColor=t||this.standardItemTextColor()}setupItemPaintOpacity(t){this._itemPaintOpacity=t||this.standardItemPaintOpacity()}setupItemAlign(t){this._itemAlign=t||this.standardItemAlign()}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setIndex(t.index,!0)&&s++,this.setMaxCols(t.maxCols,!0)&&s++,this.setFixedHorizontal(t.fixedHorizontal,!0)&&s++,this.setCursorFixed(t.cursorFixed,!0)&&s++,this.setCursorAll(t.cursorAll,!0)&&s++,this.setCursorDownHandler(t.cursorDownHandler,!0)&&s++,this.setCursorUpHandler(t.cursorUpHandler,!0)&&s++,this.setCursorRightHandler(t.cursorRightHandler,!0)&&s++,this.setCursorLeftHandler(t.cursorLeftHandler,!0)&&s++,this.setCursorPageDownHandler(t.cursorPageDownHandler,!0)&&s++,this.setCursorPageUpHandler(t.cursorPageUpHandler,!0)&&s++,s+=this.setSpacing(t.horizontalSpacing,t.verticalSpacing,!0),this.setTextPadding(t.textPadding,!0)&&s++,this.setItems(t.items,!0)&&s++,this.setItemDrawHandler(t.drawItemHandler,!0)&&s++,this.setItemWidth(t.itemWidth,!0)&&s++,this.setItemHeight(t.itemHeight,!0)&&s++,this.setItemRect(t.itemRect,!0)&&s++,this.setItemFont(t.itemFont,!0)&&s++,this.setItemTextColor(t.itemTextColor,!0)&&s++,this.setItemPaintOpacity(t.itemPaintOpacity,!0)&&s++,this.setItemAlign(t.itemAlign,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setIndex(t,e=!1){return this._index!==t&&(this.setupIndex(t),this._index!==this._lastIndex&&(e||this.refreshAll(),!0))}setMaxCols(t,e=!1){if(this._maxCols===t)return!1;const i=this._maxCols;return this.setupMaxCols(t),this._maxCols!==i&&(e||this.refreshAll(),!0)}setFixedHorizontal(t,e=!1){if(this._fixedHorizontal===t)return!1;const i=this._fixedHorizontal;return this.setupFixedHorizontal(t),this._fixedHorizontal!==i&&(e||this.refreshAll(),!0)}setCursorFixed(t,e=!1){if(this._cursorFixed===t)return!1;const i=this._cursorFixed;return this.setupCursorFixed(t),this._cursorFixed!==i&&(e||this.refreshAll(),!0)}setCursorAll(t,e=!1){if(this._cursorAll===t)return!1;const i=this._cursorAll;return this.setupCursorAll(t),this._cursorAll!==i&&(e||this.refreshAll(),!0)}setCursorDownHandler(t,e=!1){if(this._cursorDownHandler===t)return!1;const i=this._cursorDownHandler;return this.setupCursorDownHandler(t),this._cursorDownHandler!==i&&(e||this.refreshAll(),!0)}setCursorUpHandler(t,e=!1){if(this._cursorUpHandler===t)return!1;const i=this._cursorUpHandler;return this.setupCursorUpHandler(t),this._cursorUpHandler!==i&&(e||this.refreshAll(),!0)}setCursorRightHandler(t,e=!1){if(this._cursorRightHandler===t)return!1;const i=this._cursorRightHandler;return this.setupCursorRightHandler(t),this._cursorRightHandler!==i&&(e||this.refreshAll(),!0)}setCursorLeftHandler(t,e=!1){if(this._cursorLeftHandler===t)return!1;const i=this._cursorLeftHandler;return this.setupCursorLeftHandler(t),this._cursorLeftHandler!==i&&(e||this.refreshAll(),!0)}setCursorPageDownHandler(t,e=!1){if(this._cursorPageDownHandler===t)return!1;const i=this._cursorPageDownHandler;return this.setupCursorPageDownHandler(t),this._cursorPageDownHandler!==i&&(e||this.refreshAll(),!0)}setCursorPageUpHandler(t,e=!1){if(this._cursorPageUpHandler===t)return!1;const i=this._cursorPageUpHandler;return this.setupCursorPageUpHandler(t),this._cursorPageUpHandler!==i&&(e||this.refreshAll(),!0)}setHorizontalSpacing(t,e=!1){if(this._horizontalSpacing===t)return!1;const i=this._horizontalSpacing;return this.setupHorizontalSpacing(t),this._horizontalSpacing!==i&&(e||this.refreshAll(),!0)}setVerticalSpacing(t,e=!1){if(this._verticalSpacing===t)return!1;const i=this._verticalSpacing;return this.setupVerticalSpacing(t),this._verticalSpacing!==i&&(e||this.refreshAll(),!0)}setSpacing(t,e,i=!1){let s=0;return this.setHorizontalSpacing(t,!0)&&s++,this.setVerticalSpacing(e,!0)&&s++,s>0&&!i&&this.refreshAll(),s}setTextPadding(t,e=!1){if(this._textPadding===t)return!1;const i=this._textPadding;return this.setupTextPadding(t),this._textPadding!==i&&(e||this.refreshAll(),!0)}setItems(t,e=!1){return this._items!=t&&(this.setupItems(t),e||this.refreshAll(),!0)}setItemDrawHandler(t,e=!1){if(this._itemDrawHandler===t)return!1;const i=this._itemDrawHandler;return this.setupItemDrawHandler(t),this._itemDrawHandler!==i&&(e||this.refreshAll(),!0)}setItemWidth(t,e=!1){if(this._itemWidth===t)return!1;const i=this._itemWidth;return this.setupItemWidth(t),this._itemWidth!==i&&(e||this.refreshAll(),!0)}setItemHeight(t,e=!1){if(this._itemHeight===t)return!1;const i=this._itemHeight;return this.setupItemHeight(t),this._itemHeight!==i&&(e||this.refreshAll(),!0)}setItemFont(t,e=!1){if(this._itemFont===t)return!1;const i=this._itemFont;return this.setupItemFont(t),this._itemFont!==i&&(e||this.refreshAll(),!0)}setItemTextColor(t,e=!1){if(this._itemTextColor===t)return!1;const i=this._itemTextColor;return this.setupItemTextColor(t),this._itemTextColor!==i&&(e||this.refreshAll(),!0)}setItemPaintOpacity(t,e=!1){if(this._itemPaintOpacity===t)return!1;const i=this._itemPaintOpacity;return this.setupItemPaintOpacity(t),this._itemPaintOpacity!==i&&(e||this.refreshAll(),!0)}setItemAlign(t,e=!1){if(this._itemAlign===t)return!1;const i=this._itemAlign;return this.setupItemAlign(t),this._itemAlign!==i&&(e||this.refreshAll(),!0)}setTopRow(t,e=!1){const i=DKTools.Utils.Number.clamp(t,0,this.getMaxTopRow());this._topRow!==i&&(this._topRow=i,e||this.refreshAll())}setTopCol(t,e=!1){const i=DKTools.Utils.Number.clamp(t,0,this.getMaxTopCol());this._topCol!==i&&(this._topCol=i,e||this.refreshAll())}setBottomRow(t,e=!1){this.setTopRow(t-(this.getMaxPageRows()-1),e)}setBottomCol(t,e=!1){this.setTopCol(t-(this.getMaxPageCols()-1),e)}setHandler(t,e){this._handlers[t]=e}setCursorRect(t,e,i,s){return this._cursorSprite.setCursorRect(t,e,i,s)}showCursor(){this._cursorSprite.show(!0)}selectItem(t,e=!1){const i=this.getItem(t);this.setupIndex(t),this.refreshAll(),e&&this.playCursorSound(),i&&DKTools.Utils.isFunction(i.selectHandler)&&i.selectHandler(t,this),this.updateSelectEvents()}selectSymbol(t){const e=Math.max(0,this.findSymbol(t));this.selectItem(e)}selectExt(t){const e=Math.max(0,this.findExt(t));this.selectItem(e)}selectPrevItem(t=!1,e=!1){const i=this.getPrevIndex(t);i>=0&&this.selectItem(i,e)}selectNextItem(t=!1,e=!1){const i=this.getNextIndex(t);i>=0&&this.selectItem(i,e)}selectLastItem(t=!1){this.selectItem(this.getMaxItems()-1,t)}scrollDown(){this.getTopRow()+1<this.getMaxRows()&&this.cursorDown()}scrollUp(){this.getCurrentRow()>0&&this.cursorUp()}scrollRight(){this.getTopCol()+1<this.getMaxItems()&&this.cursorRight()}scrollLeft(){this.getCurrentCol()>0&&this.cursorLeft()}updateAll(){DKTools.Sprite.Button.prototype.updateAll.call(this),this.updateCursor()}updateCursor(){if(this.isHorizontal()){const t=this.getCurrentCol();t<this.getTopCol()?this.setTopCol(t):t>this.getBottomCol()&&this.setBottomCol(t)}else{const t=this.getCurrentRow();t<this.getTopRow()?this.setTopRow(t):t>this.getBottomRow()&&this.setBottomRow(t)}if(this.isCursorAll()){const t=this.getMaxRows()*this.getItemHeight();this.setCursorRect(0,0,this.width,t),this.resetScroll()}else if(this.isCursorVisible()||!this._cursorSprite.hasBitmap()){const t=this.getItemRect(this._index);this.setCursorRect(t)}else this.setCursorRect(Rectangle.emptyRectangle)}updateSelectEvents(){this.updateEventsContainer("select")}},Object.defineProperties(DKTools.Sprite.Selectable.prototype,{cursorSprite:{get:function(){return this._cursorSprite},configurable:!0},lastIndex:{get:function(){return this._lastIndex},configurable:!0},index:{get:function(){return this._index},configurable:!0},maxCols:{get:function(){return this._maxCols},configurable:!0},cursorFixed:{get:function(){return this._cursorFixed},configurable:!0},cursorAll:{get:function(){return this._cursorAll},configurable:!0},cursorDownHandler:{get:function(){return this._cursorDownHandler},configurable:!0},cursorUpHandler:{get:function(){return this._cursorUpHandler},configurable:!0},cursorRightHandler:{get:function(){return this._cursorRightHandler},configurable:!0},cursorLeftHandler:{get:function(){return this._cursorLeftHandler},configurable:!0},cursorPageDownHandler:{get:function(){return this._cursorPageDownHandler},configurable:!0},cursorPageUpHandler:{get:function(){return this._cursorPageUpHandler},configurable:!0},horizontalSpacing:{get:function(){return this._horizontalSpacing},configurable:!0},verticalSpacing:{get:function(){return this._verticalSpacing},configurable:!0},textPadding:{get:function(){return this._textPadding},configurable:!0},items:{get:function(){return this._items},configurable:!0},itemDrawHandler:{get:function(){return this._itemDrawHandler},configurable:!0},itemWidth:{get:function(){return this._itemWidth},configurable:!0},itemHeight:{get:function(){return this._itemHeight},configurable:!0},itemFont:{get:function(){return this._itemFont},configurable:!0},itemTextColor:{get:function(){return this._itemTextColor},configurable:!0},itemPaintOpacity:{get:function(){return this._itemPaintOpacity},configurable:!0},itemAlign:{get:function(){return this._itemAlign},configurable:!0}}),DKTools.Sprite.ProgressBar=class extends DKTools.Sprite{addValue(t){t&&this.setValue(this._value+t)}aimateFull(t){return this.animateValue(this._maxValue,t)}animateEmpty(t){return this.animateValue(0,t)}animateValue(t,e){return this.addEvent({type:"update",repeatTime:e,repeats:0,onUpdate:this._updateAnimateValue.bind(this,t)})}canCloneFixedBitmap(){return!1}_drawProgressGraphic(){this.hasDrawGraphicHandler()&&this._drawGraphicHandler(this)}_drawProgressText(){this.hasDrawTextHandler()&&this._drawTextHandler(this)}drawAll(){DKTools.Sprite.prototype.drawAll.call(this),this.drawProgress()}drawProgress(){this._drawProgressGraphic(),this._drawProgressText()}getNextValue(){return Math.min(this._value+this._valueStep,this._maxValue)}getPercents(){return Math.ceil(this._value/this._maxValue*100)}getPrevValue(){return Math.max(0,this._value-this._valueStep)}hasDrawGraphicHandler(){return!!this._drawGraphicHandler}hasDrawTextHandler(){return!!this._drawTextHandler}isEmpty(){return 0===this._value}isFull(){return this._value===this._maxValue}isHorizontal(){return this.width>this.height}isVertical(){return!this.isHorizontal()}makeEmpty(){this.setValue(0)}makeFull(){this.setValue(this._maxValue)}nextValue(){return this.setValue(this.getNextValue())}prevValue(){return this.setValue(this.getPrevValue())}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setValueStep(t.valueStep,!0)&&s++,this.setMaxValue(t.maxValue,!0)&&s++,this.setValue(t.value,!0)&&s++,this.setBackgroundColor(t.backgroundColor,!0)&&s++,this.setProgressColor(t.progressColor,!0)&&s++,this.setDrawGraphicHandler(t.drawGraphicHandler,!0)&&s++,this.setDrawTextHandler(t.drawTextHandler,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setBackgroundColor(t,e=!1){if(this._backgroundColor===t)return!1;const i=this._backgroundColor;return this.setupBackgroundColor(t),this._backgroundColor!==i&&(e||this.refreshAll(),!0)}setDrawGraphicHandler(t,e=!1){return this._drawGraphicHandler!==t&&(this.setupDrawGraphicHandler(t),e||this.refreshAll(),!0)}setDrawTextHandler(t,e=!1){return this._drawTextHandler!==t&&(this.setupDrawTextHandler(t),e||this.refreshAll(),!0)}setMaxValue(t,e=!1){if(this._maxValue===t)return!1;const i=this._maxValue;return this.setupMaxValue(t),this._maxValue!==i&&(e||this.refreshAll(),!0)}setProgressColor(t,e=!1){if(this._progressColor===t)return!1;const i=this._progressColor;return this.setupProgressColor(t),this._progressColor!==i&&(e||this.refreshAll(),!0)}setValue(t,e=!1){if(this._value===t)return!1;const i=this._value;return this.setupValue(t),this._value!==i&&(e||this.refreshAll(),this.updateValueEvents(),!0)}setValueStep(t,e=!1){if(this._valueStep===t)return!1;const i=this._valueStep;return this.setupValueStep(t),this._valueStep!==i&&(e||this.refreshAll(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupValueStep(t.valueStep),this.setupMaxValue(t.maxValue),this.setupValue(t.value),this.setupBackgroundColor(t.progressColor),this.setupProgressColor(t.progressColor),this.setupDrawGraphicHandler(t.drawGraphicHandler),this.setupDrawTextHandler(t.drawTextHandler)}setupBackgroundColor(t){this._backgroundColor=t||this.standardBackgroundColor()}setupDrawGraphicHandler(t){this._drawGraphicHandler=t||this.standardDrawGraphicHandler()}setupDrawTextHandler(t){this._drawTextHandler=t||this.standardDrawTextHandler()}setupMaxValue(t){this._maxValue=t||this.standardMaxValue()}setupProgressColor(t){this._progressColor=t||this.standardProgressColor()}setupValue(t){const e=this._maxValue,i=Math.max(0,Math.min(t,e));this._value=_.defaultTo(i,this.standardValue())}setupValueStep(t){this._valueStep=t||this.standardValueStep()}standardActive(){return!1}standardBackgroundColor(){return"grey"}standardDrawGraphicHandler(){return null}standardDrawTextHandler(){return null}standardMaxValue(){return 100}standardProgressColor(){return"#33ccff"}standardValue(){return 0}standardValueStep(){return 1}subValue(t){this.addValue(-t)}_updateAnimateValue(t,e){const i=e.remainingTime,s=(this._value*(i-1)+t)/i;this.setValue(s)}updateEmptyEvents(){this.isEmpty()&&this.updateEventsContainer("empty")}updateEvents(){DKTools.Sprite.prototype.updateEvents.call(this),this.updateEmptyEvents(),this.updateFullEvents()}updateFullEvents(){this.isFull()&&this.updateEventsContainer("full")}updateValueEvents(){this.updateEventsContainer("value")}},Object.defineProperties(DKTools.Sprite.ProgressBar.prototype,{valueStep:{get:function(){return this._valueStep},configurable:!0},maxValue:{get:function(){return this._maxValue},configurable:!0},value:{get:function(){return this._value},configurable:!0},backgroundColor:{get:function(){return this._backgroundColor},configurable:!0},progressColor:{get:function(){return this._progressColor},configurable:!0},drawGraphicHandler:{get:function(){return this._drawGraphicHandler},configurable:!0},drawTextHandler:{get:function(){return this._drawTextHandler},configurable:!0}}),DKTools.Sprite.ProgressBar.Rectangle=class extends DKTools.Sprite.ProgressBar{standardDrawGraphicHandler(){return()=>{let t;t=this.isHorizontal()?this.standardHorizontalDrawGraphicHandler():this.standardVerticalDrawGraphicHandler(),DKTools.Utils.isFunction(t)&&t(this)}}standardDrawTextHandler(){return()=>{const t=`${this.getPercents()}%`;this.drawText(t,{height:this.height})}}standardHorizontalDrawGraphicHandler(){return()=>{this.drawGauge({backgroundColor:this._backgroundColor,color:this._progressColor,rate:this._value/this._maxValue})}}standardVerticalDrawGraphicHandler(){return()=>{this.drawGauge({backgroundColor:this._backgroundColor,color:this._progressColor,rate:this._value/this._maxValue,type:"vertical",reversed:!0})}}},DKTools.Sprite.ProgressBar.Circle=class extends DKTools.Sprite.ProgressBar{setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.ProgressBar.prototype.setAll.call(this,t,!0);return this.setLineWidth(t.lineWidth,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setLineWidth(t,e=!1){if(this._lineWidth===t)return!1;const i=this._lineWidth;return this.setupLineWidth(t),this._lineWidth!==i&&(e||this.refreshAll(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.ProgressBar.prototype.setupAll.call(this,t),this.setupLineWidth(t.lineWidth)}setupLineWidth(t){this._lineWidth=t||this.standardLineWidth()}standardDrawGraphicHandler(){return()=>{const t=this._lineWidth,e=(this.width-t)/2,i=e+t/2,s=i;this.strokeArc({x:i,y:s,radius:e,color:this._backgroundColor,lineWidth:t}),this.strokeArc({x:i,y:s,radius:e,startAngle:-Math.PI/2,endAngle:-Math.PI/2+2*Math.PI*this._value/this._maxValue,color:this._progressColor,lineWidth:t})}}standardDrawTextHandler(){return()=>{const t=`${this.getPercents()}%`;this.drawText(t,{height:this.height})}}standardLineWidth(){return 10}},Object.defineProperties(DKTools.Sprite.ProgressBar.Circle.prototype,{lineWidth:{get:function(){return this._lineWidth},configurable:!0}}),DKTools.Sprite.ProgressBar.SemiCircle=class extends DKTools.Sprite.ProgressBar.Circle{standardDrawGraphicHandler(){return()=>{const t=this._lineWidth,e=(this.width-t)/2,i=e+t/2,s=this.height;this.strokeArc({x:i,y:s,radius:e,startAngle:Math.PI,color:this._backgroundColor,lineWidth:t}),this.strokeArc({x:i,y:s,radius:e,startAngle:Math.PI,endAngle:-Math.PI+Math.PI*this._value/this._maxValue,color:this._progressColor,lineWidth:t})}}},DKTools.Sprite.CheckBox=class extends DKTools.Sprite.Button{check(){this.isChecked()||(this.switch(),this.updateCheckedEvents())}isChecked(){return this._checked}_refreshCheckedGraphic(){let t=null;DKTools.Utils.isString(this._checkedGraphic)?t={folder:this._graphicFolder,filename:this._checkedGraphic}:this._checkedGraphic instanceof Object&&(t=this._checkedGraphic),t&&this.loadBitmap(t)}_refreshGraphic(){this.isChecked()?this._refreshCheckedGraphic():this._refreshUncheckedGraphic()}_refreshUncheckedGraphic(){let t=null;DKTools.Utils.isString(this._uncheckedGraphic)?t={folder:this._graphicFolder,filename:this._uncheckedGraphic}:this._uncheckedGraphic instanceof Object&&(t=this._uncheckedGraphic),t&&this.loadBitmap(t)}refreshAll(){this._refreshGraphic(),DKTools.Sprite.Button.prototype.refreshAll.call(this)}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setChecked(t.checked,!0)&&s++,this.setCheckedGraphic(t.checkedGraphic,!0)&&s++,this.setUncheckedGraphic(t.uncheckedGraphic,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setChecked(t,e=!1){if(this._checked===t)return!1;const i=this._checked;return this.setupChecked(t),this._checked!==i&&(e||this.refreshAll(),!0)}setCheckedGraphic(t,e=!1){const i=this._checkedGraphic;if(i==t)return!1;if(i instanceof Bitmap)this.setupCheckedGraphic(t);else{if(!(DKTools.Utils.isString(i)||i instanceof Object))return!1;{const e=i;if(this.setupCheckedGraphic(t),_.isEqual(this._checkedGraphic,e))return!1}}return e||this.refreshAll(),!0}setUncheckedGraphic(t,e=!1){const i=this._uncheckedGraphic;if(i==t)return!1;if(i instanceof Bitmap)this.setupUncheckedGraphic(t);else{if(!(DKTools.Utils.isString(i)||i instanceof Object))return!1;{const e=i;if(this.setupUncheckedGraphic(t),_.isEqual(this._uncheckedGraphic,e))return!1}}return e||this.refreshAll(),!0}setupAll(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupChecked(t.checked),this.setupCheckedGraphic(t.checkedGraphic),this.setupUncheckedGraphic(t.uncheckedGraphic)}setupChecked(t){this._checked=_.defaultTo(t,this.standardChecked())}setupCheckedGraphic(t){this._checkedGraphic=t||this.standardCheckedGraphic()}setupUncheckedGraphic(t){this._uncheckedGraphic=t||this.standardUncheckedGraphic()}standardChecked(){return!1}standardCheckedGraphic(){return null}standardUncheckedGraphic(){return null}switch(){this.setChecked(!this.isChecked())}uncheck(){this.isChecked()&&(this.switch(),this.updateUncheckedEvents())}updateCheckedEvents(){this.updateEventsContainer("checked")}updateMouseClickEvents(t){this.switch(),DKTools.Sprite.Button.prototype.updateMouseClickEvents.call(this,t)}updateUncheckedEvents(){this.updateEventsContainer("unchecked")}},Object.defineProperties(DKTools.Sprite.CheckBox.prototype,{checked:{get:function(){return this._checked},configurable:!0},checkedGraphic:{get:function(){return this._checkedGraphic},configurable:!0},uncheckedGraphic:{get:function(){return this._uncheckedGraphic},configurable:!0}}),DKTools.Viewport=class extends DKTools.Sprite{canCloneFixedBitmap(){return!1}createAll(){DKTools.Sprite.prototype.createAll.call(this),this.createMask()}createMask(){DKTools.Sprite.prototype.createMask.call(this,this._maskShape)}setAll(t={},e=!1,i=!1){t=t||{};let s=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setMaskShape(t.maskShape,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setMaskShape(t,e=!1){if(this._maskShape===t)return!1;const i=this._maskShape;return this.setupShape(t),this._maskShape!==i&&(e||this.start(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupMaskShape(t.maskShape)}setupMaskShape(t){this._maskShape=t||this.standardMaskShape()}standardMaskShape(){return"rect"}},Object.defineProperties(DKTools.Viewport.prototype,{maskShape:{get:function(){return this._maskShape},configurable:!0}}),DKTools.Layout=class extends DKTools.Sprite{activateItems(t=!1){this.iterateItems(t=>{t.activate()},t)}addAllChildren(){DKTools.Sprite.prototype.addAllChildren.call(this),this.addAllItems()}addAllItems(){this.hasItems()&&this.addChild.apply(this,this._items)}addCol(){this.addCols(1)}addCols(t){this.setMaxCols(this.getMaxCols()+t)}addItem(t,e=!1){return t instanceof DKTools.Sprite?(this._items.push(t),e||this.start(),t):null}addItems(t,e=!1){const i=_.map(t,t=>this.addItem(t,!0));return i.length>0&&!e&&this.start(),i}alignCol(t){_.forEach(this.getItemsInCol(t),this.alignItem.bind(this))}alignItem(t){if(this.isReady()){const e=this.getItemRow(t),i=this.getItemCol(t),s=this.getRowHeight(e),n=this.getColWidth(i),r=this.getColX(i)+(n-t.width)/2,o=this.getRowY(e)+(s-t.height)/2;t.move(r,o)}else this.addOneTimeEvent({type:"ready",onSuccess:this.alignItem.bind(this,t)})}alignItems(){this.addOneTimeEvent({type:"ready",onSuccess:()=>{this.iterateItems(this.alignItem.bind(this))}})}alignRow(t){_.forEach(this.getItemsInRow(t),this.alignItem.bind(this))}_clearAll(){DKTools.Sprite.prototype._clearAll.call(this),this._clearItems()}_clearItems(){this._items=[]}canCloneFixedBitmap(){return!1}clearItems(t=!1){this.removeAllItems(),this._clearItems(),t||this.start()}deactivateItems(t=!1){this.iterateItems(t=>{t.deactivate()},t)}_getBitmapHeight(){let t=0;const e=this.getMaxRows();for(let i=1;i<=e;i++)t+=this.getRowHeight(i)+this._verticalSpacing;return t-this._verticalSpacing}_getBitmapWidth(){let t=0;const e=this.getMaxCols();for(let i=1;i<=e;i++)t+=this.getColWidth(i)+this._horizontalSpacing;return t-this._horizontalSpacing}getCell(t,e){const i=this.getMaxCols()*(t-1)+(e-1);return{item:this.getItem(i),x:this.getColX(e),y:this.getRowY(t),width:this.getColWidth(e),height:this.getRowHeight(t)}}getColWidth(t){return DKTools.Utils.isFunction(this._colWidth)?this._colWidth(t,this):this._colWidth}getColX(t){let e=0;for(let i=1;i<t;i++)e+=this.getColWidth(i)+this._horizontalSpacing;return e}getItem(t){return this.getItems()[t]}getItemCol(t){const e=this.getItemIndex(t);return e>=0?e%this.getMaxCols()+1:-1}getItemIndex(t){return _.indexOf(this.getItems(),t)}getItemRow(t){const e=this.getItemIndex(t);return e>=0?Math.floor(e/this.getMaxCols())+1:-1}getItems(){return this.isInverted()?_.reverse(_.clone(this._items)):this._items}getItemsInCol(t){const e=[],i=this.getMaxRows(),s=this.getMaxCols();if(t<1||t>s)return e;const n=t-1;for(let t=0;t<i;t++)e.push(this.getItem(n+s*t));return e}getItemsInRow(t){const e=[],i=this.getMaxCols();if(t<1||t>this.getMaxRows())return e;const s=i*(t-1);for(let t=0;t<i;t++)e.push(this.getItem(s+t));return e}getMaxCols(){return this._maxCols}getMaxItems(){return this._items.length}getMaxRows(){return Math.max(1,Math.ceil(this.getMaxItems()/this.getMaxCols()))}getRowHeight(t){return DKTools.Utils.isFunction(this._rowHeight)?this._rowHeight(t,this):this._rowHeight}getRowY(t){let e=0;for(let i=1;i<t;i++)e+=this.getRowHeight(i)+this._verticalSpacing;return e}hasItem(t){return this.getItemIndex(t)>=0}hasItems(){return!this.isEmpty()}hideItems(t=!1,e=!1){this.iterateItems(e=>{e.hide(t)},e)}insertItem(t,e,i=!1){return t instanceof DKTools.Sprite?(DKTools.Utils.Array.insert(this._items,t,e),i||this.start(),t):null}insertItems(t,e,i=!1){e=e||0;const s=_.map(t,(t,i)=>this.insertItem(t,e+i,!0));return s.length>0&&!i&&this.start(),s}invert(){this.setInverted(!this.isInverted())}isEmpty(){return 0===this.getMaxItems()}isHorizontal(){return 1===this.getMaxRows()}isInverted(){return this._inverted}isReady(){return this.isEmpty()||_.every(this._items,t=>t.isReady())}isVertical(){return 1===this.getMaxCols()}iterateItems(t,e=!1){_.forEach(this.getItems(),t),e&&this.start()}moveItem(t,e,i){const s=this.getItem(t);s&&s.move(e,i)}removeAllChildren(){DKTools.Sprite.prototype.removeAllChildren.call(this),this.removeAllItems()}removeAllItems(){this.hasItems()&&this.removeChild.apply(this,this._items)}removeCol(){this.removeCols(1)}removeCols(t){this.getMaxCols()-t>=1&&this.addCols(-t)}removeItem(t,e=!1){return Number.isFinite(t)&&(t=this.getItem(t)),this.hasItem(t)?(this.removeChild(t),DKTools.Utils.Array.remove(this._items,t),e||this.start(),t):null}removeItems(t,e=!1){const i=_.map(t,t=>this.removeItem(t,!0));return i.length>0&&!e&&this.start(),i}resizeItem(t,e,i,s=!1){Number.isFinite(t)&&(t=this.getItem(t)),this.hasItem(t)&&t.resize(e,i)&&(s||this.start())}resizeItems(t,e,i=!1){this.iterateItems(i=>{this.resizeItem(i,t,e,!0)},!i)}setAll(t,e=!1,i=!1){t=t||{};let s=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setMaxCols(t.maxCols,!0)&&s++,s+=this.setSpacing(t.horizontalSpacing,t.verticalSpacing,!0),this.setItems(t.items,!0)&&s++,this.setRowHeight(t.rowHeight,!0)&&s++,this.setColWidth(t.colWidth,!0)&&s++,this.setInverted(t.reversed,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s}setColWidth(t,e=!1){if(this._colWidth===t)return!1;const i=this._colWidth;return this.setupColWidth(t),this._colWidth!==i&&(e||this.start(),!0)}setHorizontalSpacing(t,e=!1){if(this._horizontalSpacing===t)return!1;const i=this._horizontalSpacing;return this.setupHorizontalSpacing(t),this._horizontalSpacing!==i&&(e||this.start(),!0)}setInverted(t,e=!1){if(this._inverted===t)return!1;const i=this._inverted;return this.setupInverted(t),this._inverted!==i&&(e||this.start(),!0)}setItems(t,e=!1){return this._items!=t&&(this.removeAllItems(),this.setupItems(t),e||this.start(),!0)}setMaxCols(t,e=!1){if(this._maxCols===t)return!1;const i=this._maxCols;return this.setupMaxCols(t),this._maxCols!==i&&(e||this.start(),!0)}setRowHeight(t,e=!1){if(this._rowHeight===t)return!1;const i=this._rowHeight;return this.setupRowHeight(t),this._rowHeight!==i&&(e||this.start(),!0)}setSpacing(t,e,i=!1){let s=0;return this.setHorizontalSpacing(t,!0)&&s++,this.setVerticalSpacing(e,!0)&&s++,s>0&&!i&&this.start(),s}setVerticalSpacing(t,e=!1){if(this._verticalSpacing===t)return!1;const i=this._verticalSpacing;return this.setupVerticalSpacing(t),this._verticalSpacing!==i&&(e||this.start(),!0)}setupAll(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupMaxCols(t.maxCols),this.setupSpacing(t.horizontalSpacing,t.verticalSpacing),this.setupItems(t.items),this.setupRowHeight(t.rowHeight),this.setupColWidth(t.colWidth),this.setupInverted(t.inverted)}setupColWidth(t){this._colWidth=t||this.standardColWidth()}setupHorizontalSpacing(t){this._horizontalSpacing=_.defaultTo(t,this.standardHorizontalSpacing())}setupInverted(t){this._inverted=_.defaultTo(t,this.standardInverted())}setupItems(t){this._items=_.clone(t||this.standardItems())}setupMaxCols(t){this._maxCols=_.defaultTo(t,this.standardMaxCols())}setupRowHeight(t){this._rowHeight=t||this.standardRowHeight()}setupSpacing(t,e){this.setupHorizontalSpacing(t),this.setupVerticalSpacing(e)}setupVerticalSpacing(t){this._verticalSpacing=_.defaultTo(t,this.standardVerticalSpacing())}showItems(t=!1,e=!1){this.iterateItems(e=>{e.show(t)},e)}standardActive(){return!1}standardColWidth(){return t=>{const e=this.getItemsInCol(t);return _.max(_.map(e,"width"))}}standardHorizontalSpacing(){return 12}standardInverted(){return!1}standardItems(){return[]}standardMaxCols(){return 1}standardRowHeight(){return t=>{const e=this.getItemsInRow(t);return _.max(_.map(e,"height"))}}standardVerticalSpacing(){return this.getLineHeight()/2}start(){this._started=!0,this.isReady()?DKTools.Sprite.prototype.start.call(this):this.addOneTimeEvent({type:"ready",onSuccess:this.start.bind(this)})}startItems(t=!1,e=!1){this.iterateItems(e=>{e.start(t)},!e)}updateAll(){DKTools.Sprite.prototype.updateAll.call(this),this.updateLayout()}updateLayout(){const t=this.getMaxItems(),e=this.getMaxRows(),i=this.getMaxCols();let s=0;for(let n=1;n<=e&&s<t;n++)for(let e=1;e<=i&&s<t;e++){const t=this.getColX(e),i=this.getRowY(n);this.moveItem(s++,t,i)}}},Object.defineProperties(DKTools.Layout.prototype,{maxCols:{get:function(){return this._maxCols},configurable:!0},items:{get:function(){return this._items},configurable:!0},rowHeight:{get:function(){return this._rowHeight},configurable:!0},colWidth:{get:function(){return this._colWidth},configurable:!0},horizontalSpacing:{get:function(){return this._horizontalSpacing},configurable:!0},verticalSpacing:{get:function(){return this._verticalSpacing},configurable:!0},inverted:{get:function(){return this._inverted},configurable:!0}}),DKTools.Window.prototype=Object.create(Window_Base.prototype),DKTools.Utils.mixin(DKTools.Window.prototype,DKTools.Base.prototype),DKTools.Window.prototype.constructor=DKTools.Window,Object.defineProperties(DKTools.Window.prototype,{realWidth:{get:function(){return this.width},set:function(t){this.width=t},configurable:!0},realHeight:{get:function(){return this.height},set:function(t){this.height=t},configurable:!0},width:{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0},height:{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0},origin:{get:function(){return this._origin},configurable:!0},windowOpacity:{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},configurable:!0},frameOpacity:{get:function(){return 255*this._windowFrameSprite.alpha},set:function(t){this._windowFrameSprite.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},configurable:!0},opacity:{get:function(){return this._opacity},configurable:!0},tone:{get:function(){return this._tone},configurable:!0},contentsSprite:{get:function(){return this._windowContentsSprite},configurable:!0},frameSprite:{get:function(){return this._windowFrameSprite},configurable:!0},backSprite:{get:function(){return this._windowBackSprite},configurable:!0},bitmap:{get:function(){return this.contents},set:function(t){this.contents=t},configurable:!0},arrows:{get:function(){return this._arrows},configurable:!0}}),DKTools.Window.prototype.initialize=function(t,e,i,s){PIXI.Container.call(this),DKTools.Base.prototype.initialize.call(this,t,e,i,s)},DKTools.Window.prototype._addAllChildren=function(){DKTools.Base.prototype._addAllChildren.call(this),this._addAllParts()},DKTools.Window.prototype._addAllParts=function(){this._addSpriteContainer(),this._addPauseSignSprite(),this._addArrows()},DKTools.Window.prototype._addSpriteContainer=function(){this.hasSpriteContainer()&&(this.hasBackSprite()&&this._windowSpriteContainer.addChild(this._windowBackSprite),this.hasFrameSprite()&&this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowSpriteContainer))},DKTools.Window.prototype._addContentsSprite=function(){this.hasContentsSprite()&&this.addChild(this._windowContentsSprite)},DKTools.Window.prototype._addPauseSignSprite=function(){this.hasPauseSignSprite()&&this.addChild(this._windowPauseSignSprite)},DKTools.Window.prototype._addArrows=function(){_.forEach(["up","down","left","right"],t=>{const e=this.findArrow(t);e&&this.addChild(e)})},DKTools.Window.prototype.activate=function(){DKTools.Base.prototype.activate.call(this),this.hasContentsSprite()&&this._windowContentsSprite.activate()},DKTools.Window.prototype.addAllChildren=function(){DKTools.Base.prototype.addAllChildren.call(this),this.addContentsSprite()},DKTools.Window.prototype.addContentsSprite=function(){this._addContentsSprite(),this._refreshContents()},DKTools.Window.prototype._clearAll=function(){DKTools.Base.prototype._clearAll.call(this),this._clearIsWindow(),this._clearOpenness(),this._clearPadding(),this._clearMargin(),this._clearColorTone(),this._clearOrigin(),this._clearArrows()},DKTools.Window.prototype._clearIsWindow=function(){this._isWindow=!0},DKTools.Window.prototype._clearOpenness=function(){this._openness=this.standardOpenness()},DKTools.Window.prototype._clearPadding=function(){this._padding=this.standardPadding()},DKTools.Window.prototype._clearMargin=function(){this._margin=this.standardMargin()},DKTools.Window.prototype._clearColorTone=function(){this._colorTone=this.standardTone()},DKTools.Window.prototype._clearOrigin=function(){this._origin=this.standardOrigin()},DKTools.Window.prototype._clearArrows=function(){this._arrows=[]},DKTools.Window.prototype._createAll=function(){DKTools.Base.prototype._createAll.call(this),this._createAllParts(),this._createWindowskin()},DKTools.Window.prototype._createAllParts=function(){this._createSpriteContainer(),this._createBackSprite(),this._createFrameSprite(),this._createPauseSignSprite(),this._createArrows()},DKTools.Window.prototype._createSpriteContainer=function(){this._windowSpriteContainer=new PIXI.Container},DKTools.Window.prototype._createBackSprite=function(){this.needsCreateBackSprite()&&(this._windowBackSprite=new Sprite,this._windowBackSprite.opacity=this.standardBackOpacity(),this._windowBackSprite.visible=this.standardBackVisible())},DKTools.Window.prototype._createFrameSprite=function(){this.needsCreateFrameSprite()&&(this._windowFrameSprite=new Sprite,this._windowFrameSprite.visible=this.standardFrameVisible())},DKTools.Window.prototype._createPauseSignSprite=function(){this.needsCreatePauseSignSprite()&&(this._windowPauseSignSprite=new Sprite)},DKTools.Window.prototype._createArrows=function(){this.needsCreateArrowsSprites()&&(this.needsCreateUpArrowSprite()&&this.createArrow("up","up",{onUpdate:this.onUpArrowUpdate.bind(this),onMouseClick:this.onUpArrowMouseClick.bind(this),onMouseLongPress:this.onUpArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateDownArrowSprite()&&this.createArrow("down","down",{onUpdate:this.onDownArrowUpdate.bind(this),onMouseClick:this.onDownArrowMouseClick.bind(this),onMouseLongPress:this.onDownArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateLeftArrowSprite()&&this.createArrow("left","left",{onUpdate:this.onLeftArrowUpdate.bind(this),onMouseClick:this.onLeftArrowMouseClick.bind(this),onMouseLongPress:this.onLeftArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateRightArrowSprite()&&this.createArrow("right","right",{onUpdate:this.onRightArrowUpdate.bind(this),onMouseClick:this.onRightArrowMouseClick.bind(this),onMouseLongPress:this.onRightArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}))},DKTools.Window.prototype._createWindowskin=function(){this.windowskin=DKTools.Utils.Bitmap.load({folder:"img/system",filename:this.standardWindowskin()})},DKTools.Window.prototype.canRedrawAll=function(){return this.hasContentsSprite()&&DKTools.Base.prototype.canRedrawAll.call(this)},DKTools.Window.prototype.changeFont=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changeFont(t)},DKTools.Window.prototype.changeTextColor=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changeTextColor(t)},DKTools.Window.prototype.changePaintOpacity=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changePaintOpacity(t)},DKTools.Window.prototype.checkSize=function(){const t=this.getMinWidth(),e=this.getMinHeight();let i=0;return this._width<t&&(this.setupWidth(t),i++),this._height<e&&(this.setupHeight(e),i++),i},DKTools.Window.prototype.createArrow=function(t,e,i={}){const s=new DKTools.Sprite.Arrow({...i,id:e,arrowType:t});return s.start(),s.addEvent({type:"update",onUpdate:t=>{this.isOpenAndVisible()?s.show():s.hide(),DKTools.Utils.isFunction(i.onUpdate)&&i.onUpdate(t)}}),DKTools.Utils.isFunction(i.onMouseDown)&&s.addEvent({type:"mouse-down-left",onUpdate:i.onMouseDown}),DKTools.Utils.isFunction(i.onMouseUp)&&s.addEvent({type:"mouse-up-left",onUpdate:i.onMouseUp}),DKTools.Utils.isFunction(i.onMouseClick)&&s.addEvent({type:"mouse-click-left",onUpdate:i.onMouseClick}),DKTools.Utils.isFunction(i.onMouseLongPress)&&s.addEvent({type:"mouse-long-press-left",onUpdate:i.onMouseLongPress}),DKTools.Utils.isFunction(i.onMouseLongPressStarted)&&s.addEvent({type:"mouse-long-press-left-started",onUpdate:i.onMouseLongPressStarted}),DKTools.Utils.isFunction(i.onMouseLongPressFinished)&&s.addEvent({type:"mouse-long-press-left-finished",onUpdate:i.onMouseLongPressFinished}),DKTools.Utils.isFunction(i.onStateNormal)&&s.addEvent({type:"state-normal",onUpdate:i.onStateNormal}),DKTools.Utils.isFunction(i.onStatePressed)&&s.addEvent({type:"state-pressed",onUpdate:i.onStatePressed}),this._arrows.push(s),this.addChild(s),s},DKTools.Window.prototype.deactivate=function(){DKTools.Base.prototype.deactivate.call(this),this.hasContentsSprite()&&this._windowContentsSprite.deactivate()},DKTools.Window.prototype.destroy=function(t){DKTools.Base.prototype.destroy.call(this,t),Window_Base.prototype.destroy.call(this,t)},DKTools.Window.prototype.drawText=function(t,e){return!!this.hasContentsSprite()&&this._windowContentsSprite.drawText(t,e)},DKTools.Window.prototype.findArrow=function(t){return _.find(this._arrows,{id:t})},DKTools.Window.prototype.getMinWidth=function(){return 2*this.standardPadding()+DKTools.Base.prototype.getMinWidth.call(this)},DKTools.Window.prototype.getMinHeight=function(){return 2*this.standardPadding()+DKTools.Base.prototype.getMinHeight.call(this)},DKTools.Window.prototype.getContentsWidth=function(){return DKTools.Utils.isFunction(this._contentsWidth)?this._contentsWidth(this):this._contentsWidth},DKTools.Window.prototype.getContentsHeight=function(){return DKTools.Utils.isFunction(this._contentsHeight)?this._contentsHeight(this):this._contentsHeight},DKTools.Window.prototype.getContentsSize=function(){return{width:this.getContentsWidth(),height:this.getContentsHeight()}},DKTools.Window.prototype.getCurrentOpacity=function(){return this.windowOpacity},DKTools.Window.prototype.hasBitmap=function(){return!!this.hasContentsSprite()&&this._windowContentsSprite.hasBitmap()},DKTools.Window.prototype.hasSpriteContainer=function(){return!!this._windowSpriteContainer},DKTools.Window.prototype.hasBackSprite=function(){return!!this._windowBackSprite},DKTools.Window.prototype.hasFrameSprite=function(){return!!this._windowFrameSprite},DKTools.Window.prototype.hasContentsSprite=function(){return!!this._windowContentsSprite},DKTools.Window.prototype.hasArrow=function(t){return!!this.findArrow(t)},DKTools.Window.prototype.hasArrowSprites=function(){return this.hasUpArrowSprite()&&this.hasDownArrowSprite()&&this.hasLeftArrowSprite()&&this.hasRightArrowSprite()},DKTools.Window.prototype.hasUpArrowSprite=function(){return this.hasArrow("up")},DKTools.Window.prototype.hasDownArrowSprite=function(){return this.hasArrow("down")},DKTools.Window.prototype.hasLeftArrowSprite=function(){return this.hasArrow("left")},DKTools.Window.prototype.hasRightArrowSprite=function(){return this.hasArrow("right")},DKTools.Window.prototype.hasPauseSignSprite=function(){return!!this._windowPauseSignSprite},DKTools.Window.prototype.hasBackgroundDimmer=function(){return!!this._dimmerSprite},DKTools.Window.prototype.hideBack=function(){this.hasBackSprite()&&(this._windowBackSprite.visible=!1)},DKTools.Window.prototype.hideContents=function(){this.hasContentsSprite()&&this._windowContentsSprite.hide()},DKTools.Window.prototype.hideFrame=function(){this.hasFrameSprite()&&(this._windowFrameSprite.visible=!1)},DKTools.Window.prototype.isOpenAndVisible=function(){return this.isOpen()&&this.isVisible()},DKTools.Window.prototype.isOpenAndActive=function(){return this.isOpen()&&this.isActive()},DKTools.Window.prototype.needsCreateBackSprite=function(){return!0},DKTools.Window.prototype.needsCreateFrameSprite=function(){return!0},DKTools.Window.prototype.needsCreateArrowsSprites=function(){return!1},DKTools.Window.prototype.needsCreateDownArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateUpArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateLeftArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateRightArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreatePauseSignSprite=function(){return!0},DKTools.Window.prototype.onUpArrowUpdate=function(t){},DKTools.Window.prototype.onDownArrowUpdate=function(t){},DKTools.Window.prototype.onLeftArrowUpdate=function(t){},DKTools.Window.prototype.onRightArrowUpdate=function(t){},DKTools.Window.prototype.onUpArrowMouseClick=function(t){},DKTools.Window.prototype.onDownArrowMouseClick=function(t){},DKTools.Window.prototype.onLeftArrowMouseClick=function(t){},DKTools.Window.prototype.onRightArrowMouseClick=function(t){},DKTools.Window.prototype.onUpArrowMouseLongPress=function(t){},DKTools.Window.prototype.onDownArrowMouseLongPress=function(t){},DKTools.Window.prototype.onLeftArrowMouseLongPress=function(t){},DKTools.Window.prototype.onRightArrowMouseLongPress=function(t){},DKTools.Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshContents(),this._refreshPauseSign(),this._refreshArrows()},DKTools.Window.prototype._refreshBack=function(){this.hasBackSprite()&&Window.prototype._refreshBack.call(this)},DKTools.Window.prototype._refreshFrame=function(){this.hasFrameSprite()&&Window.prototype._refreshFrame.call(this)},DKTools.Window.prototype._refreshContents=function(){if(this.hasContentsSprite()){let t=this._contentsPosition;DKTools.Utils.isFunction(t)&&(t=t(this)),this._windowContentsSprite.move(t)}},DKTools.Window.prototype._refreshPauseSign=function(){this.hasPauseSignSprite()&&Window.prototype._refreshPauseSign.call(this)},DKTools.Window.prototype._refreshArrows=function(){const t={up:this.standardUpArrowPosition(),down:this.standardDownArrowPosition(),left:this.standardLeftArrowPosition(),right:this.standardRightArrowPosition()};_.forEach(t,(t,e)=>{const i=this.findArrow(e);i&&i.move(t)})},DKTools.Window.prototype.redrawAll=function(){this.hasContentsSprite()&&this._windowContentsSprite.redrawAll()},DKTools.Window.prototype.refreshAll=function(){this._refreshAllParts(),DKTools.Base.prototype.refreshAll.call(this)},DKTools.Window.prototype.refreshArrows=function(){_.forEach(this._arrows,t=>{t.refreshAll()})},DKTools.Window.prototype.removeAllChildren=function(){DKTools.Base.prototype.removeAllChildren.call(this),this.removeContentsSprite()},DKTools.Window.prototype.removeContentsSprite=function(){this.hasContentsSprite()&&this.removeChild(this._windowContentsSprite)},DKTools.Window.prototype.removeArrow=function(t){const e=this.findArrow(t);e&&(DKTools.Utils.Array.remove(this._arrows,e),this.removeChild(e))},DKTools.Window.prototype.resetAll=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetAll()},DKTools.Window.prototype.resetFont=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetFont()},DKTools.Window.prototype.resetTextColor=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetTextColor()},DKTools.Window.prototype.resetPaintOpacity=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetPaintOpacity()},DKTools.Window.prototype.resize=function(t,e,i=!1,s=!1){if(t=_.defaultTo(t,this.getMinWidth()),e=_.defaultTo(e,this.getMinHeight()),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),this._width===t&&this._height===e)return!1;const n=this._width,r=this._height;return this.setupSize(t,e),(this._width!==n||this._height!==r)&&(i||this.start(),s&&this.activate(),!0)},DKTools.Window.prototype.standardOpenness=function(){return 255},DKTools.Window.prototype.standardOpennessSpeed=function(){return 16},DKTools.Window.prototype.standardMargin=function(){return 4},DKTools.Window.prototype.standardOrigin=function(){return new Point(0,0)},DKTools.Window.prototype.standardUpArrowPosition=function(){return new Point(this._width/2,12)},DKTools.Window.prototype.standardDownArrowPosition=function(){return new Point(this._width/2,this._height-12)},DKTools.Window.prototype.standardLeftArrowPosition=function(){return new Point(12,this._height/2)},DKTools.Window.prototype.standardRightArrowPosition=function(){return new Point(this._width-12,this._height/2)},DKTools.Window.prototype.standardArrowStateNormal=function(){return t=>{const e=t.target;e.setScale(1,1),e.setOpacity(255)}},DKTools.Window.prototype.standardArrowStatePressed=function(){return t=>{const e=t.target;e.setScale(.9,.9),e.setOpacity(160)}},DKTools.Window.prototype.standardContentsSprite=function(){return new DKTools.Sprite},DKTools.Window.prototype.standardChildX=function(){return this._padding},DKTools.Window.prototype.standardChildY=function(){return this._padding},DKTools.Window.prototype.standardChildPosition=function(){return()=>new Point(this.standardChildX(),this.standardChildY())},DKTools.Window.prototype.standardContentsPosition=function(){return this.standardChildPosition()},DKTools.Window.prototype.standardBackVisible=function(){return!0},DKTools.Window.prototype.standardFrameVisible=function(){return!0},DKTools.Window.prototype.standardContentsWidth=function(){return()=>this._width-2*this._padding},DKTools.Window.prototype.standardContentsHeight=function(){return()=>this._height-2*this._padding},DKTools.Window.prototype.standardWindowOpacity=function(){return 255},DKTools.Window.prototype.standardContentsOpacity=function(){return 255},DKTools.Window.prototype.standardFrameOpacity=function(){return 255},DKTools.Window.prototype.standardOpacity=function(){return{windowOpacity:this.standardWindowOpacity(),contentsOpacity:this.standardContentsOpacity(),frameOpacity:this.standardFrameOpacity(),backOpacity:this.standardBackOpacity()}},DKTools.Window.prototype.standardTone=function(){try{return _.clone($gameSystem.windowTone())}catch(t){return[0,0,0]}},DKTools.Window.prototype.setupAll=function(t={}){t=t||{},DKTools.Base.prototype.setupAll.call(this,t);let e=t.contentsSprite;t instanceof DKTools.Window&&e instanceof DKTools.Sprite&&(e=e.clone({blockStart:!0})),this.setupPadding(t.padding),this.setupMargin(t.margin),this.setupContentsWidth(t.contentsWidth),this.setupContentsHeight(t.contentsHeight),this.setupContentsSprite(e),this.setupContentsPosition(t.contentsPosition),this.setupOpacity(t.opacity),this.setupTone(t.tone)},DKTools.Window.prototype.setupWidth=function(t){this.width=this._checkWidth(t)},DKTools.Window.prototype.setupHeight=function(t){DKTools.Utils.isString(t)&&(t=this.getLineHeight()*parseFloat(t)),this.height=this._checkHeight(t)},DKTools.Window.prototype.setupSize=function(t,e){if(t instanceof Object)return this.setupSize(t.width,t.height);DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),t=this._checkWidth(t),e=this._checkHeight(e),Window.prototype.move.call(this,this.x,this.y,t,e)},DKTools.Window.prototype.setupPadding=function(t){this._padding=_.defaultTo(t,this.standardPadding())},DKTools.Window.prototype.setupMargin=function(t){this._margin=_.defaultTo(t,this.standardMargin())},DKTools.Window.prototype.setupContentsWidth=function(t){this._contentsWidth=t||this.standardContentsWidth()},DKTools.Window.prototype.setupContentsHeight=function(t){this._contentsHeight=t||this.standardContentsHeight()},DKTools.Window.prototype.setupContentsSprite=function(t){this._windowContentsSprite=t||this.standardContentsSprite()},DKTools.Window.prototype.setupContentsPosition=function(t,e){let i=t;DKTools.Utils.isFunction(t)||(i=DKTools.Utils.Point.tryToPoint(t,e)||this.standardContentsPosition()),this._contentsPosition=i},DKTools.Window.prototype.setupOpacity=function(t){this._opacity=Object.assign(this.standardOpacity(),t)},DKTools.Window.prototype.setupTone=function(t){this._tone=Object.assign(this.standardTone(),t)},DKTools.Window.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let s=DKTools.Base.prototype.setAll.call(this,t,!0);return this.setPadding(t.padding,!0)&&s++,this.setMargin(t.margin,!0)&&s++,this.setOpacity(t.opacity,!0)&&s++,this.setTone(t.tone,!0)&&s++,s>0&&(e||this.start(),i&&this.activate()),s},DKTools.Window.prototype.setWidth=function(t,e=!1,i=!1){return this.resize(t,this._height,e,i)},DKTools.Window.prototype.setHeight=function(t,e=!1,i=!1){return this.resize(this._width,t,e,i)},DKTools.Window.prototype.setPadding=function(t,e=!1){if(this._padding===t)return!1;const i=this._padding;return this.setupPadding(t),this._padding!==i&&(e||this.start(),!0)},DKTools.Window.prototype.setMargin=function(t,e=!1){if(this._margin===t)return!1;const i=this._margin;return this.setupMargin(padding),this._margin!==i&&(e||this.start(),!0)},DKTools.Window.prototype.setContentsSprite=function(t,e=!1,i=!1){return this._windowContentsSprite!=t&&(this.removeContentsSprite(),this.setupContentsSprite(t),this.addContentsSprite(),e||this.start(),i&&this.activate(),!0)},DKTools.Window.prototype.setContentsPosition=function(t,e){const i=DKTools.Utils.isFunction,s=i(this._contentsPosition),n=i(t);if(s||n){if(this._contentsPosition===t)return!1;this.setupContentsPosition(t,e)}else{const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this._contentsPosition,i))return!1;const s=DKTools.Utils.Point.clone(this._contentsPosition);if(this.setupContentsPosition(i),DKTools.Utils.Point.equals(this._contentsPosition,s))return!1}return this._refreshContents(),!0},DKTools.Window.prototype.setOpacity=function(t,e=!1){if(_.isEqual(this._opacity,Object.assign(this.standardOpacity(),t)))return!1;const i=_.clone(this._opacity);return this.setupOpacity(t),!_.isEqual(this._opacity,i)&&(e||this.updateOpacity(),!0)},DKTools.Window.prototype.setTone=function(t,e=!1){if(_.isEqual(this._tone,Object.assign(this.standardTone(),t)))return!1;const i=_.clone(this._tone);return this.setupTone(t),!_.isEqual(this._tone,i)&&(e||this.updateTone(),!0)},DKTools.Window.prototype.start=function(t=!1){if(this.hasContentsSprite()){const e=this._windowContentsSprite;e.resize(this.getContentsWidth(),this.getContentsHeight(),!0),e.start(t)}DKTools.Base.prototype.start.call(this,t)},DKTools.Window.prototype.showBack=function(){this.hasBackSprite()&&(this._windowBackSprite.visible=!0)},DKTools.Window.prototype.showContents=function(t=!1){this.hasContentsSprite()&&this._windowContentsSprite.show(t)},DKTools.Window.prototype.showFrame=function(){this.hasFrameSprite()&&(this._windowFrameSprite.visible=!0)},DKTools.Window.prototype._updateContents=function(){this.hasContentsSprite()&&Window.prototype._updateContents.call(this)},DKTools.Window.prototype._updatePauseSign=function(){this.hasPauseSignSprite()&&Window.prototype._updatePauseSign.call(this)},DKTools.Window.prototype.updateOpenEvents=function(){this.updateEventsContainer("open")},DKTools.Window.prototype.updateCloseEvents=function(){this.updateEventsContainer("close")},DKTools.Window.prototype.updateAll=function(){this.updateContents(),DKTools.Base.prototype.updateAll.call(this),this.updateTone()},DKTools.Window.prototype.updateContents=function(){this.hasContentsSprite()&&this._windowContentsSprite.updateAll()},DKTools.Window.prototype.updateTransform=function(){this._updateContents(),this._updatePauseSign(),PIXI.Container.prototype.updateTransform.call(this)},DKTools.Window.prototype.updateOpacity=function(t={}){t=t||{},this.hasSpriteContainer()&&(this.windowOpacity=_.defaultTo(t.windowOpacity,this.opacity.windowOpacity)),this.hasContentsSprite()&&(this.contentsOpacity=_.defaultTo(t.contentsOpacity,this.opacity.contentsOpacity)),this.hasFrameSprite()&&(this.frameOpacity=_.defaultTo(t.frameOpacity,this.opacity.frameOpacity)),this.hasBackSprite()&&(this.backOpacity=_.defaultTo(t.backOpacity,this.opacity.backOpacity))},DKTools.Window.prototype.updateTone=function(t){t=t||this.tone,this.hasBackSprite()&&Window.prototype.setTone.apply(this,t)},DKTools.Window.prototype.updateOpen=function(){this._opening&&(this.openness+=this.standardOpennessSpeed(),this.isOpen()&&(this._opening=!1,this.updateOpenEvents()))},DKTools.Window.prototype.updateClose=function(){this._closing&&(this.openness-=this.standardOpennessSpeed(),this.isClosed()&&(this._closing=!1,this.updateCloseEvents()))},DKTools.Window.prototype.update=function(){DKTools.Base.prototype.update.call(this),this.updateOpen(),this.updateClose(),this.updateBackgroundDimmer()},DKTools.Window.Selectable=class extends DKTools.Window{needsCreateArrowsSprites(){return!0}onUpArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isVertical()&&t.getTopRow()>0&&e.show(this.isVisibleAndActive()&&t.isActive())}}onDownArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;if(this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isVertical()){const i=t.getTopRow(),s=t.getMaxTopRow();s>0&&i<s&&e.show(this.isVisibleAndActive()&&t.isActive())}}}onLeftArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isHorizontal()&&t.getTopCol()>0&&e.show(this.isVisibleAndActive()&&t.isActive())}}onRightArrowUpdate(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;if(this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isHorizontal()){const i=t.getTopCol(),s=t.getMaxTopCol();s>0&&i<s&&e.show(this.isVisibleAndActive()&&t.isActive())}}}onUpArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectPrevItem()}onDownArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectNextItem()}onLeftArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectPrevItem()}onRightArrowMouseClick(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectNextItem()}onUpArrowMouseLongPress(t){this.onUpArrowMouseClick(t)}onDownArrowMouseLongPress(t){this.onDownArrowMouseClick(t)}onLeftArrowMouseLongPress(t){this.onLeftArrowMouseClick(t)}onRightArrowMouseLongPress(t){this.onRightArrowMouseClick(t)}standardContentsSprite(){return new DKTools.Sprite.Selectable}},DKTools.Scene.prototype=Object.create(Scene_Base.prototype),DKTools.Scene.prototype.constructor=DKTools.Scene,DKTools.Scene.prototype.initialize=function(){this._clearAll(),this._createAll(),this._setupAll(),this._addAllChildren(),Scene_Base.prototype.initialize.call(this)},DKTools.Scene.prototype._addAllChildren=function(){},DKTools.Scene.prototype.addOptionChangeListener=function(t,e){this._optionManager.addOptionChangeListener(t,e)},DKTools.Scene.prototype.addEvent=function(t){return this._eventManager.addEvent(t)},DKTools.Scene.prototype.addOneTimeEvent=function(t){return this._eventManager.addOneTimeEvent(t)},DKTools.Scene.prototype.addAnimation=function(t){this._eventManager.addAnimation(t)},DKTools.Scene.prototype._clearAll=function(){},DKTools.Scene.prototype._createAll=function(){this._createOptionManager(),this._createEventManager()},DKTools.Scene.prototype._createOptionManager=function(){this._optionManager=new DKTools.OptionManager},DKTools.Scene.prototype._createEventManager=function(){this._eventManager=new DKTools.EventManager(this)},DKTools.Scene.prototype.clearOptions=function(){this._optionManager.clear()},DKTools.Scene.prototype.clearEvents=function(t){this._eventManager.clearEvents(t)},DKTools.Scene.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.createAllSprites(),this.createWindowLayer(),this.createAllWindows(),this.createForeground()},DKTools.Scene.prototype.createBackground=function(){},DKTools.Scene.prototype.createAllSprites=function(){},DKTools.Scene.prototype.createAllWindows=function(){},DKTools.Scene.prototype.createForeground=function(){},DKTools.Scene.prototype.destroy=function(t){this._clearAll(),this.clearEvents(),this.deactivate(),Stage.prototype.destroy.call(this,t)},DKTools.Scene.prototype.disableOption=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.disableOptions=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.enableOption=function(t){this._optionManager.enableOption(t)},DKTools.Scene.prototype.enableOptions=function(t){this._optionManager.enableOption(t)},DKTools.Scene.prototype.finishEvents=function(t,e=!1){this._eventManager.finishEvents(t,e)},DKTools.Scene.prototype.getEventsContainerByType=function(t){return this._eventManager.getEventsContainerByType(t)},DKTools.Scene.prototype.getEventsContainer=function(t){return this._eventManager.getEventsContainer(t)},DKTools.Scene.prototype.getEventIndex=function(t){return this._eventManager.getEventIndex(t)},DKTools.Scene.prototype.getEvents=function(t){return this._eventManager.getEvents(t)},DKTools.Scene.prototype.getAnimations=function(t){return this._eventManager.getAnimations(t)},DKTools.Scene.prototype.hasWindowLayer=function(){return!!this._windowLayer},DKTools.Scene.prototype.hasEvent=function(t){return this._eventManager.hasEvent(t)},DKTools.Scene.prototype.hasEvents=function(t){return this._eventManager.hasEvents(t)},DKTools.Scene.prototype.hasAnimation=function(t){return this._eventManager.hasAnimation(t)},DKTools.Scene.prototype.hasAnimations=function(t){return this._eventManager.hasAnimations(t)},DKTools.Scene.prototype.iterateChildren=function(t){_.forEach(this.children,t)},DKTools.Scene.prototype.isChild=function(t){return t instanceof Window&&this.hasWindowLayer()?DKTools.Utils.Array.contains(this._windowLayer.children,t):DKTools.Utils.Array.contains(this.children,t)},DKTools.Scene.prototype.isDestroyed=function(){return this._destroyed},DKTools.Scene.prototype.isOptionEnabled=function(t){return this._optionManager.isOptionEnabled(t)},DKTools.Scene.prototype.isOptionsEnabled=function(t){return this._optionManager.isOptionsEnabled(t)},DKTools.Scene.prototype.isSomeOptionsEnabled=function(t){return this._optionManager.isSomeOptionsEnabled(t)},DKTools.Scene.prototype.isOptionDisabled=function(t){return this._optionManager.isOptionDisabled(t)},DKTools.Scene.prototype.isOptionsDisabled=function(t){return this._optionManager.isOptionsDisabled(t)},DKTools.Scene.prototype.isSomeOptionsDisabled=function(t){return this._optionManager.isSomeOptionsDisabled(t)},DKTools.Scene.prototype.isSomeOptionEnabled=function(){return this._optionManager.isSomeOptionEnabled()},DKTools.Scene.prototype.iterateEventsContainer=function(t,e){this._eventManager.iterateEventsContainer(t,e)},DKTools.Scene.prototype.isEventsPaused=function(t){return this._eventManager.isEventsPaused(t)},DKTools.Scene.prototype.pauseEvents=function(t,e){this._eventManager.pauseEvents(t,e)},DKTools.Scene.prototype.removeOptionChangeListener=function(t,e){this._optionManager.removeOptionChangeListener(t,e)},DKTools.Scene.prototype.removeEvent=function(t){return this._eventManager.removeEvent(t)},DKTools.Scene.prototype.resumeEvents=function(t){this._eventManager.resumeEvents(t)},DKTools.Scene.prototype.removeWindow=function(t){this.hasWindowLayer()&&this.isChild(t)&&this._windowLayer.removeChild(t)},DKTools.Scene.prototype._setupAll=function(){this._setupOptions(),this._setupEvents(),this._setupAnimations()},DKTools.Scene.prototype._setupOptions=function(){},DKTools.Scene.prototype._setupEvents=function(){},DKTools.Scene.prototype._setupAnimations=function(){},DKTools.Scene.prototype.start=function(){Scene_Base.prototype.start.call(this),this.startAllSprites(),this.startAllWindows()},DKTools.Scene.prototype.startAllSprites=function(){},DKTools.Scene.prototype.startAllWindows=function(){},DKTools.Scene.prototype.stop=function(){Scene_Base.prototype.stop.call(this),this.stopAll()},DKTools.Scene.prototype.stopAll=function(){},DKTools.Scene.prototype.stopEvents=function(t,e=!1){this._eventManager.stopEvents(t,e)},DKTools.Scene.prototype.switchOption=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.switchOptions=function(t){this._optionManager.switchOptions(t)},DKTools.Scene.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),this.terminateAll()},DKTools.Scene.prototype.terminateAll=function(){},DKTools.Scene.prototype.update=function(){this.updateChildren(),this.updateFade(),this.updateEvents()},DKTools.Scene.prototype.updateChild=function(t){t&&DKTools.Utils.isFunction(t.update)&&t.update()},DKTools.Scene.prototype.updateChildren=function(){this.iterateChildren(this.updateChild)},DKTools.Scene.prototype.updateEvents=function(){this._eventManager.update(),this.updateReadyEvents(),this.updateUpdateEvents(),this.updateQueueEvents()},DKTools.Scene.prototype.updateEvent=function(t){this._eventManager.updateEvent(t)},DKTools.Scene.prototype.updateEventsContainer=function(t){this._eventManager.updateEventsContainer(t)},DKTools.Scene.prototype.updateReadyEvents=function(){this.isReady()&&this.updateEventsContainer("ready")},DKTools.Scene.prototype.updateUpdateEvents=function(){this.updateEventsContainer("update")},DKTools.Scene.prototype.updateQueueEvents=function(){const t=this.getEventsContainerByType("queue")[0];this.updateEvent(t)},DKTools.Scene.Preloader=class{constructor(){this.initialize.apply(this,arguments)}initialize(){this._queue=[],this._finished=!1,this._errors=0}add(t){t instanceof Bitmap?t=DKTools.Utils.Bitmap.reserveAsync(t):t instanceof WebAudio&&(t=DKTools.Utils.WebAudio.loadAsync(t)),t instanceof Promise&&this._queue.push(t)}addMany(t){_.forEach(t,t=>this.add(t))}finish(){this._queue=[],this._finished=!0}hasErrors(){return this._errors>0}isReady(){return this._finished}_onError(){this._errors++}start(){const t=_.map(this._queue,t=>t.catch(t=>{throw this._onError(),t}));Promise.all(t).then(()=>this.finish())}};const n=new DKTools.ParameterManager("DKTools");DKTools.PluginCommandManager.set("DKPluginsCheckUpdates",()=>{DKTools.Utils.openConsole(),DKTools.Utils._checkUpdates()}),DKTools.PluginCommandManager.set("UpdateFileSystemStamp",()=>{DKTools.IO._createStamp()});const r=window.onload;window.onload=function(){DKTools.Utils.initialize(),DKTools.IO.initialize(),r.call(this),DKTools.PluginManager.initialize()};const o=ImageCache.prototype.get;ImageCache.prototype.get=function(t){return o.call(this,t)||DKTools.PreloadManager.getCachedImageByKey(t)},ImageCache.prototype._truncateCache=function(){const t=this._items;let e=ImageCache.limit;Object.keys(t).map(e=>t[e]).filter(t=>!this._mustBeHeld(t)).sort((t,e)=>e.touch-t.touch).forEach(i=>{if(e>0&&!DKTools.PreloadManager.isImageCachedByKey(i.key)){const t=i.bitmap;e-=t.width*t.height}else delete t[i.key]})};const a=ImageCache.prototype._mustBeHeld;ImageCache.prototype._mustBeHeld=function(t){return!DKTools.PreloadManager.isImageCachedByKey(t.key)&&a.call(this,t)};const l=Graphics.printLoadingError;Graphics.printLoadingError=function(t){l.call(this,t),DKTools.Utils.logError(`Failed to load: ${t}`)};const h=Graphics.initialize;Graphics.initialize=function(t,e,i){h.call(this,t,e,i);const s=n.get("FPS Meter");if(DKTools.Utils.isTest()&&s.Enabled){const t=this._fpsMeter;t&&(this.showFps(),"FPS"===s.Mode?(t.showFps(),this._fpsMeterToggled=!1):(t.showDuration(),this._fpsMeterToggled=!0))}};const u=Graphics._createFPSMeter;Graphics._createFPSMeter=function(){const t=n.get("FPS Meter");t.Enabled?(this._fpsMeter=new FPSMeter({theme:t.Theme,history:t.History,toggleOn:null,graph:1,decimals:0}),this._fpsMeter.hide()):u.call(this)},Graphics.printDetailedError=function(t){if(!this._errorPrinter)return;const e=t.stack.split(/(?:\r\n|\r|\n)/).map(t=>t.replace(/[\(](.*[\/])/,"("));this._errorPrinter.innerHTML=this._makeDetailedErrorHtml(t.name,t.message,e),this._applyCanvasFilter(),this._clearUpperCanvas()},Graphics._getErrorReferenceInfo=function(){const t=SceneManager._scene,e={};if(t&&t.constructor.name&&(e.Scene=t.constructor.name,SceneManager.isCurrentScene(Scene_Map))){const t=$gameMap._interpreter;if(t){if(t._mapId>0&&(e["Map ID"]=t._mapId),t._eventId>0){e["Event ID"]=t._eventId;const i=$gameMap.event(t._eventId);i&&(e["Event Page"]=i._pageIndex+1)}if(t._list&&t._list.length>0){let i=t._list[t._index];i&&0===i.code&&t._index>0&&(i=t._list[t._index-1]),i&&i.code>0&&(e["Last Event Command"]=i.code)}t._params&&t._params.length>0&&(e.Params=JSON.stringify(t._params))}}return e},Graphics._getErrorMessageForErrorPrint=function(){return n.get("Print Detailed Error","Error Message")},Graphics._getRestartMessageForErrorPrint=function(){return n.get("Print Detailed Error","Restart Message")},Graphics._makeDetailedErrorHtml=function(t,e,i){const s=this._getErrorMessageForErrorPrint(),n=this._getRestartMessageForErrorPrint(),r=this._getErrorReferenceInfo();let o="";return s&&(o='<font color="yellow"><b>'+s+"<br></b></font><br>"),Object.keys(r).length>0&&(o+='<font color="yellow"><b>Reference Information</b></font><br>',_.forEach(r,(t,e)=>{o+='<font color="white">'+e+": "+t+"</font><br>"}),o+="<br>"),o+='<font color="yellow"><b>'+e+"</b></font><br>",_.forEach(i,t=>{o+='<font color="white">'+t+"</font><br>"}),n&&(o+='<br><font color="yellow"><b>'+n+"</b></font><br><br>"),o};const c=Graphics._updateErrorPrinter;Graphics._updateErrorPrinter=function(){c.call(this),this._errorPrinter&&n.get("Print Detailed Error","Enabled")&&(this._errorPrinter.style.textAlign="left",this._errorPrinter.height=.8*this._height,this._centerElement(this._errorPrinter))};const p=TouchInput.initialize;TouchInput.initialize=function(){p.call(this);const t=n.get("Cursor Graphic");if(t.Enabled){const e=t.Graphic;e&&(document.body.style.cursor=`url('img/system/${e}.png'), default`)}};const d=TouchInput.clear;TouchInput.clear=function(){d.call(this),this._mouseMoved=!1,this._leftButtonPressed=!1,this._middleButtonPressed=!1,this._rightButtonPressed=!1,this._leftButtonReleased=!1,this._middleButtonReleased=!1,this._rightButtonReleased=!1,this._mouseX=0,this._mouseY=0,this._events.mouseMoved=!1,this._events.leftButtonPressed=!1,this._events.middleButtonPressed=!1,this._events.rightButtonPressed=!1,this._events.leftButtonReleased=!1,this._events.middleButtonReleased=!1,this._events.rightButtonReleased=!1};const f=TouchInput.update;TouchInput.update=function(){this._mouseMoved=this._events.mouseMoved,this._leftButtonPressed=this._events.leftButtonPressed,this._middleButtonPressed=this._events.middleButtonPressed,this._rightButtonPressed=this._events.rightButtonPressed,this._leftButtonReleased=this._events.leftButtonReleased,this._middleButtonReleased=this._events.middleButtonReleased,this._rightButtonReleased=this._events.rightButtonReleased,this._events.mouseMoved=!1,this._events.leftButtonReleased=!1,this._events.middleButtonReleased=!1,this._events.rightButtonReleased=!1,f.call(this)},TouchInput.isMouseMoved=function(){return this._mouseMoved},TouchInput.isMousePressed=function(){return this.isLeftButtonPressed()||this.isMiddleButtonPressed()||this.isRightButtonPressed()},TouchInput.isMouseReleased=function(){return this.isLeftButtonReleased()||this.isMiddleButtonReleased()||this.isRightButtonReleased()},TouchInput.isLeftButtonPressed=function(){return this._leftButtonPressed},TouchInput.isLeftButtonReleased=function(){return this._leftButtonReleased},TouchInput.isMiddleButtonPressed=function(){return this._middleButtonPressed},TouchInput.isMiddleButtonReleased=function(){return this._middleButtonReleased},TouchInput.isRightButtonPressed=function(){return this._rightButtonPressed},TouchInput.isRightButtonReleased=function(){return this._rightButtonReleased};const g=TouchInput._onLeftButtonDown;TouchInput._onLeftButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);g.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.leftButtonPressed=!0)};const m=TouchInput._onMiddleButtonDown;TouchInput._onMiddleButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);m.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.middleButtonPressed=!0)};const y=TouchInput._onRightButtonDown;TouchInput._onRightButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);y.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.rightButtonPressed=!0)};const T=TouchInput._onMouseMove;TouchInput._onMouseMove=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);T.call(this,t),this._mouseX===e&&this._mouseY===i||(this._events.mouseMoved=!0,this._date=Date.now(),this._mouseX=e,this._mouseY=i)};const v=TouchInput._onMouseUp;TouchInput._onMouseUp=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);v.call(this,t),this._events.leftButtonPressed=!1,this._events.middleButtonPressed=!1,this._events.rightButtonPressed=!1,Graphics.isInsideCanvas(e,i)&&(0===t.button?this._events.leftButtonReleased=!0:1===t.button?this._events.middleButtonReleased=!0:2===t.button&&(this._events.rightButtonReleased=!0))},Object.defineProperties(TouchInput,{mouseX:{get:function(){return this._mouseX},configurable:!0},mouseY:{get:function(){return this._mouseY},configurable:!0}});const w=Tilemap.prototype.initialize;Tilemap.prototype.initialize=function(){w.call(this),this._tileWidth=Tilemap.TILE_WIDTH||this._tileWidth,this._tileHeight=Tilemap.TILE_HEIGHT||this._tileHeight};const D=WebAudio.prototype.addLoadListener;WebAudio.prototype.addLoadListener=function(t){this.isReady()?t(this):D.call(this,t)},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()(this)}};const S=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){return!!S.call(this)&&(this.__isDatabaseLoaded||(this.__isDatabaseLoaded=!0,this.onDatabaseLoad()),!0)},DataManager.onDatabaseLoad=function(){DKTools.PreloadManager.initialize()};const b=AudioManager.createBuffer;AudioManager.createBuffer=function(t,e){const i=this.audioFileExt(),s=this._path+t+"/"+encodeURIComponent(e)+i;return DKTools.PreloadManager.isAudioCachedByPath(s)?DKTools.PreloadManager.getCachedAudioByPath(s):b.call(this,t,e)};const K=SceneManager.initialize;SceneManager.initialize=async function(){await K.call(this),await DKTools.StartupManager.initialize()};const A=SceneManager.initGraphics;SceneManager.initGraphics=function(){const t=n.get("Screen Resolution");if(t.Enabled){const e=t.Width,i=t.Height;this._boxWidth=e,this._screenWidth=e,this._boxHeight=i,this._screenHeight=i,A.call(this),DKTools.Utils.isNwjs()&&this.updateResolution()}else A.call(this)},SceneManager.updateResolution=function(){const t=this._screenWidth-window.innerWidth,e=this._screenHeight-window.innerHeight;t>0&&e>0&&(window.moveBy(-1*t/2,-1*e/2),window.resizeBy(t,e))};const O=SceneManager.onKeyDown;SceneManager.onKeyDown=function(t){if(O.call(this,t),t.ctrlKey||t.altKey)return;const e=n.get("Quick Load","Key Code"),i=n.get("Screenshots","Key Code"),s=n.get("Grid","Key Code");switch(t.keyCode){case e:DKTools.Utils.__quickLoad();break;case i:n.get("Screenshots","Enabled")&&DKTools.Utils.makeScreenshot();break;case s:DKTools.Utils.__showGrid()}};const C=SceneManager.catchException;SceneManager.catchException=function(t){C.call(this,t),t instanceof Error&&n.get("Print Detailed Error","Enabled")&&Graphics.printDetailedError(t),DKTools.Utils.logError(t),n.get("Debugging Console","Open On Error")&&DKTools.Utils.openConsole()};const I=SceneManager.onError;SceneManager.onError=function(t){I.call(this,t),DKTools.Utils.logError(t),n.get("Debugging Console","Open On Error")&&DKTools.Utils.openConsole()},SceneManager.changeScene=function(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),this._scene=this._nextScene,this._scene&&(this._scene.attachReservation(),this._scene.startPreloading(),this._sceneCreated=!1,this._sceneStarted=!1,this._nextScene=null,this._scene.isPreloaded()&&(this._scene.create(),this._sceneCreated=!0,this.onSceneCreate())),this._exiting&&this.terminate())},SceneManager.updateScene=function(){if(this._scene){if(!this._sceneCreated&&this._scene.isPreloaded()&&(this._scene.create(),this._sceneCreated=!0,this.onSceneCreate()),this._sceneCreated&&!this._sceneStarted)try{this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart())}catch(t){console.error(t),DKTools.Utils.logError(t),this._scene.start(),this._sceneStarted=!0,this.onSceneStart()}this.isCurrentSceneStarted()&&this._scene.update()}},SceneManager.isCurrentScene=function(t){return!!this._scene&&this._scene.constructor===t};const x=SceneManager.goto;SceneManager.goto=function(t){x.call(this,t),DKTools.Utils.__hideGrid()};const E=Scene_Base.prototype.initialize;Scene_Base.prototype.initialize=function(){E.call(this),this._preloader=new DKTools.Scene.Preloader},Scene_Base.prototype.activate=function(){this._active=!0},Scene_Base.prototype.deactivate=function(){this._active=!1},Scene_Base.prototype.isPreloaded=function(){return this._preloader.isReady()};const P=Scene_Base.prototype.isReady;Scene_Base.prototype.isReady=function(){return P.call(this)&&this.isPreloaded()},Scene_Base.prototype.setupPreloading=function(){},Scene_Base.prototype.startPreloading=function(){this.setupPreloading(),this._preloader.start()};const R=Scene_Base.prototype.terminate;Scene_Base.prototype.terminate=function(){R.call(this),this._preloader.finish()};const M=Scene_Boot.prototype.isReady;Scene_Boot.prototype.isReady=function(){return M.call(this)&&DKTools.StartupManager.isReady()&&DKTools.PreloadManager.isReady()};const B=Scene_Boot.prototype.start;Scene_Boot.prototype.start=function(){const t=n.get("Quick Start");t.Enabled?(B.call(this),DataManager.isBattleTest()||DataManager.isEventTest()||!t["Skip Saves"]&&DataManager.isAnySavefileExists()||(Scene_Base.prototype.start.call(this),SoundManager.preloadImportantSounds(),this.checkPlayerLocation(),DataManager.setupNewGame(),this.updateDocumentTitle(),SceneManager.goto(window[t["Scene Name"]]))):B.call(this)};const F=Scene_Map.prototype.isReady;Scene_Map.prototype.isReady=function(){return!!this.isPreloaded()&&F.call(this)};const H=Game_Map.prototype.tileWidth;Game_Map.prototype.tileWidth=function(){return Tilemap.TILE_WIDTH||H.call(this)};const k=Game_Map.prototype.tileHeight;Game_Map.prototype.tileHeight=function(){return Tilemap.TILE_HEIGHT||k.call(this)};const L=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(t,e){L.call(this,t,e),DKTools.PluginCommandManager.process(this,t,e)}}).call(this,i(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=require("nw.gui")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("path")}]);