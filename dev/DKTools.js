/*
Title: DKTools
Author: DK (Denis Kuznetsov)
Site: https://dk-plugins.ru
E-mail: kuznetsovdenis96@gmail.com
Version: 6.1.0
Release: 01.11.2018
First release: 13.01.2016
Supported languages: Russian, English
*/

/*ru
Название: DKTools
Автор: DK (Денис Кузнецов)
Сайт: https://dk-plugins.ru
E-mail: kuznetsovdenis96@gmail.com
Версия: 6.1.0
Релиз: 01.11.2018
Первый релиз: 13.01.2016
Поддерживаемые языки: Русский, Английский
*/

/*:
* @plugindesc v.6.1.0 Library for RPG Maker. Made with ♥ by DKPlugins
* @author DK (Denis Kuznetsov)
* @help

 ### Info about plugin ###
 Title: DKTools
 Author: DK (Denis Kuznetsov)
 Site: https://dk-plugins.ru
 Version: 6.1.0
 Release: 01.11.2018
 First release: 13.01.2016
 Supported languages: Russian, English
 Thank you for your support: https://dk-plugins.ru/donate

 ### DKTools on DKPlugins ###
 https://dk-plugins.ru/mv/dktools/

 ### DKTools on GitHub ###
 https://github.com/DKPlugins/DKTools

 ### Online documentation ###
 https://dk-plugins.ru/documentation/DKTools/index.html

 ### Requirements and dependencies ###
 Version of RPG Maker 1.6+

 ### Instructions ###

 ### 1 ### Templates for the filename of the screenshot ###
 %year - Year
 %month - Month
 %day - Day
 %hours - Hours
 %minutes - Minutes
 %seconds - Seconds

 ### 2 ### Grid ###
 Available grid sizes: 64, 48, 32, 16

 ### 2.1 ### Using the ruler ###
 Move the mouse while holding down the middle key

 ### 2.2 ### Color of the ruler ###
 If the color of the ruler is not specified, random color will be selected automatically

 ### Plugin commands ###
 1. Checks for plugins updates from DKPlugins
 DKPluginsCheckUpdates

 ### Elements ###
 DKTools.Utils
 DKTools.Utils.Object
 DKTools.Utils.Number
 DKTools.Utils.String
 DKTools.Utils.Array
 DKTools.Utils.Point
 DKTools.Utils.Rectangle
 DKTools.Utils.WebAudio
 DKTools.Utils.Bitmap
 DKTools.Utils.Event
 DKTools.Utils.Random
 DKTools.IO
 DKTools.IO.Entity
 DKTools.IO.File
 DKTools.IO.Directory
 DKTools.IO.WebStorage
 DKTools.Network
 DKTools.ParameterManager
 DKTools.PluginManager
 DKTools.PluginCommandManager
 DKTools.PreloadManager
 DKTools.Audio
 DKTools.Event
 DKTools.Animation
 DKTools.Animation.Action
 DKTools.OptionManager
 DKTools.EventManager
 DKTools.Unit
 DKTools.Unit.Property
 DKTools.Unit.Properties
 DKTools.Unit.Function
 DKTools.Base
 DKTools.Sprite
 DKTools.Sprite.Button
 DKTools.Sprite.Cursor
 DKTools.Sprite.Arrow
 DKTools.Sprite.Selectable
 DKTools.Sprite.ProgressBar
 DKTools.Sprite.ProgressBar.Rectangle
 DKTools.Sprite.ProgressBar.Circle
 DKTools.Sprite.ProgressBar.SemiCircle
 DKTools.Sprite.CheckBox
 DKTools.Viewport
 DKTools.Layout
 DKTools.Window
 DKTools.Window.Selectable
 DKTools.Scene

 ### Licenses and terms of use ###

 DKTools uses a third-party library "lodash": https://lodash.com/license

 Recent information about the terms of use: https://dk-plugins.ru/terms-of-use

 You can:
 -Free to use the plugin for your commercial and non commercial projects.
 -Translate the plugin to other languages (inform if you do this)
 -Change the plugin code, but you must specify a link to the original plugin

 You can't:
 -Delete or change any information about the plugin (Title, authorship, contact information, version and release)

 * @param Functions
 * @default ---------------------------------

 * @param Check Updates
 * @parent Functions
 * @desc Check updates
 * @type struct<CheckUpdates>
 * @default {"Enabled":"false","Show New Plugins":"false"}

 * @param Debugging Console
 * @parent Functions
 * @desc Debug console
 * @type struct<DebuggingConsole>
 * @default {"Enabled":"false","Open On Error":"false"}

 * @param FPS Meter
 * @parent Functions
 * @desc FPS Meter
 * @type struct<FPSMeter>
 * @default {"Enabled":"false","Mode":"FPS","Theme":"transparent","History":"20"}

 * @param Screen Resolution
 * @parent Functions
 * @desc Screen resolution
 * @type struct<ScreenResolution>
 * @default {"Enabled":"false","Width":"816","Height":"624"}

 * @param Quick Start
 * @parent Functions
 * @desc Quick start
 * @type struct<QuickStart>
 * @default {"Enabled":"false","Scene Name":"Scene_Map","Skip Saves":"false"}

 * @param Quick Load
 * @parent Functions
 * @desc Quick load
 * @type struct<QuickLoad>
 * @default {"Enabled":"false","Key Code":"117"}

 * @param Preload Manager
 * @parent Functions
 * @desc Preloading resources
 * @type struct<PreloadManager>
 * @default {"Enabled":"false","Debugging":"false","Images":"[]"}

 * @param Screenshots
 * @parent Functions
 * @desc Screenshots
 * @type struct<Screenshots>
 * @default {"Enabled":"false","Key Code":"44","Path":"screenshots/","Filename":"%year_%month_%day_%hours_%minutes_%seconds.png","Type":"png","Quality":"0.9"}

 * @param Errors Log
 * @parent Functions
 * @desc Errors logging
 * @type struct<ErrorsLog>
 * @default {"Enabled":"None","Filename":"errors_log.txt","File Size":"10"}

 * @param Tile Size
 * @parent Functions
 * @desc Tile size
 * @type struct<TileSize>
 * @default {"Enabled":"false","Size":"48"}

 * @param Grid
 * @parent Functions
 * @desc Displaying the grid on the screen. Details in the help (2)
 * @type struct<Grid>
 * @default {"Enabled":"false","Key Code":"118","Grid Color":"white","Grid Width":"1","Ruler Color":"","Ruler Width":"3"}

*/

/*:ru
* @plugindesc v.6.1.0 Библиотека для RPG Maker. Сделано с ♥ от DKPlugins
* @author DK (Денис Кузнецов)
* @help

 ### Информация о плагине ###
 Название: DKTools
 Автор: DK (Денис Кузнецов)
 Сайт: https://dk-plugins.ru
 Версия: 6.1.0
 Релиз: 01.11.2018
 Первый релиз: 13.01.2016
 Поддерживаемые языки: Русский, Английский
 Спасибо за Вашу поддержку: https://dk-plugins.ru/donate

 ### DKTools на DKPlugins ###
 https://dk-plugins.ru/mv/dktools/

 ### DKTools на GitHub ###
 https://github.com/DKPlugins/DKTools

 ### Онлайн документация ###
 https://dk-plugins.ru/documentation/DKTools/index.html

 ### Требования и зависимости ###
 Версия мейкера 1.6+

 ### Инструкции ###

 ### 1 ### Шаблоны для названия файла скриншота ###
 %year - Год
 %month - Месяц
 %day - День
 %hours - Часы
 %minutes - Минуты
 %seconds - Секунды

 ### 2 ### Сетка ###
 Доступные размеры сетки: 64, 48, 32, 16

 ### 2.1 ### Использование линейки ###
 Перемещайте мышь, удерживая среднюю клавишу

 ### 2.2 ### Цвет линейки ###
 Если не указан цвет линейки, то автоматически будет выбран случайный цвет

 ### Команды плагина ###
 1. Проверить обновления плагинов от DKPlugins
 DKPluginsCheckUpdates

 ### Элементы ###
 DKTools.Utils
 DKTools.Utils.Object
 DKTools.Utils.Number
 DKTools.Utils.String
 DKTools.Utils.Array
 DKTools.Utils.Point
 DKTools.Utils.Rectangle
 DKTools.Utils.WebAudio
 DKTools.Utils.Bitmap
 DKTools.Utils.Event
 DKTools.Utils.Random
 DKTools.IO
 DKTools.IO.Entity
 DKTools.IO.File
 DKTools.IO.Directory
 DKTools.IO.WebStorage
 DKTools.Network
 DKTools.ParameterManager
 DKTools.PluginManager
 DKTools.PluginCommandManager
 DKTools.PreloadManager
 DKTools.Audio
 DKTools.Event
 DKTools.Animation
 DKTools.Animation.Action
 DKTools.OptionManager
 DKTools.EventManager
 DKTools.Unit
 DKTools.Unit.Property
 DKTools.Unit.Properties
 DKTools.Unit.Function
 DKTools.Base
 DKTools.Sprite
 DKTools.Sprite.Button
 DKTools.Sprite.Cursor
 DKTools.Sprite.Arrow
 DKTools.Sprite.Selectable
 DKTools.Sprite.ProgressBar
 DKTools.Sprite.ProgressBar.Rectangle
 DKTools.Sprite.ProgressBar.Circle
 DKTools.Sprite.ProgressBar.SemiCircle
 DKTools.Sprite.CheckBox
 DKTools.Viewport
 DKTools.Layout
 DKTools.Window
 DKTools.Window.Selectable
 DKTools.Scene

 ### Лицензии и правила использования плагина ###

 DKTools использует стороннюю библиотеку "lodash": https://lodash.com/license

 Актуальная информация о правилах использования: https://dk-plugins.ru/terms-of-use

 Вы можете:
 -Бесплатно использовать данный плагин в некоммерческих и коммерческих проектах
 -Переводить плагин на другие языки (сообщите мне, если Вы перевели плагин на другой язык)
 -Изменять код плагина, но Вы обязаны указать ссылку на оригинальный плагин

 Вы не можете:
 -Убирать или изменять любую информацию о плагине (Название, авторство, контактная информация, версия и дата релиза)

 * @param Functions
 * @text Функции
 * @default ---------------------------------

 * @param Check Updates
 * @text Проверка обновлений
 * @parent Functions
 * @desc Проверка обновлений
 * @type struct<CheckUpdates>
 * @default {"Enabled":"false","Show New Plugins":"false"}

 * @param Debugging Console
 * @text Отладочная консоль
 * @parent Functions
 * @desc Отладочная консоль
 * @type struct<DebuggingConsole>
 * @default {"Enabled":"false","Open On Error":"false"}

 * @param FPS Meter
 * @text Счетчик FPS
 * @parent Functions
 * @desc Счетчик FPS
 * @type struct<FPSMeter>
 * @default {"Enabled":"false","Mode":"FPS","Theme":"transparent","History":"20"}

 * @param Screen Resolution
 * @text Разрешение экрана
 * @parent Functions
 * @desc Настройки разрешения экрана
 * @type struct<ScreenResolution>
 * @default {"Enabled":"false","Width":"816","Height":"624"}

 * @param Quick Start
 * @text Быстрый старт
 * @parent Functions
 * @desc Быстрый старт
 * @type struct<QuickStart>
 * @default {"Enabled":"false","Scene Name":"Scene_Map","Skip Saves":"false"}

 * @param Quick Load
 * @text Быстрая загрузка
 * @parent Functions
 * @desc Быстрая загрузка игры
 * @type struct<QuickLoad>
 * @default {"Enabled":"false","Key Code":"117"}

 * @param Preload Manager
 * @text Предзагрузка ресурсов
 * @parent Functions
 * @desc Предварительная загрузка ресурсов
 * @type struct<PreloadManager>
 * @default {"Enabled":"false","Debugging":"false","Images":"[]"}

 * @param Screenshots
 * @text Скриншоты
 * @parent Functions
 * @desc Скриншоты
 * @type struct<Screenshots>
 * @default {"Enabled":"false","Key Code":"44","Path":"screenshots/","Filename":"%year_%month_%day_%hours_%minutes_%seconds.png","Type":"png","Quality":"0.9"}

 * @param Errors Log
 * @text Логирование ошибок
 * @parent Functions
 * @desc Логирование ошибок
 * @type struct<ErrorsLog>
 * @default {"Enabled":"None","Filename":"errors_log.txt","File Size":"10"}

 * @param Tile Size
 * @text Размер тайла
 * @parent Functions
 * @desc Размер тайла
 * @type struct<TileSize>
 * @default {"Enabled":"false","Size":"48"}

 * @param Grid
 * @text Сетка
 * @parent Functions
 * @desc Отображение сетки на экране. Подробности в справке (2)
 * @type struct<Grid>
 * @default {"Enabled":"false","Key Code":"118","Grid Color":"white","Grid Width":"1","Ruler Color":"","Ruler Width":"3"}

*/

/*~struct~CheckUpdates:

 * @param Enabled
 * @desc Enable automatic update checking ? Information is displayed in the console during the game test
 * @type boolean
 * @default false

 * @param Show New Plugins
 * @text Show new plugins
 * @desc Show new plugins ? Information is displayed in the console during the game test
 * @type boolean
 * @default false

 */

/*~struct~CheckUpdates:ru

 * @param Enabled
 * @text Проверка обновлений
 * @desc Включить автоматическую проверку обновлений ? Информация выводится в консоль при тесте игры
 * @type boolean
 * @default false

 * @param Show New Plugins
 * @text Показать новые плагины
 * @desc Показывать новые плагины ? Информация выводится в консоль при тесте игры
 * @type boolean
 * @default false

 */

/*~struct~DebuggingConsole:

 * @param Enabled
 * @desc Open the debug console when the game test starts ?
 * @type boolean
 * @default false

 * @param Open On Error
 * @text Open on error
 * @desc Enable the debugging console when an error is received ?
 * @type boolean
 * @default false

 */

/*~struct~DebuggingConsole:ru

 * @param Enabled
 * @text Включено
 * @desc Открыть отладочную консоль при запуске теста игры ?
 * @type boolean
 * @default false

 * @param Open On Error
 * @text Открытие при ошибке
 * @desc Включить отладочную консоль при получении ошибки ?
 * @type boolean
 * @default false

 */

/*~struct~FPSMeter:

 * @param Enabled
 * @desc Show the FPS counter when the game test starts ?
 * @type boolean
 * @default false

 * @param Mode
 * @desc
 * @type select
 * @option FPS
 * @option Duration
 * @default FPS

 * @param Theme
 * @desc
 * @type select
 * @option transparent
 * @option dark
 * @option light
 * @default transparent

 * @param History
 * @desc
 * @type number
 * @min 5
 * @max 100
 * @default 20

 */

/*~struct~FPSMeter:ru

 * @param Enabled
 * @text Включено
 * @desc Показать счетчик FPS при запуске теста игры ?
 * @type boolean
 * @default false

 * @param Mode
 * @text Режим
 * @desc Режим счетчика FPS
 * @type select
 * @option FPS
 * @option Duration
 * @default FPS

 * @param Theme
 * @text Тема
 * @desc Тема счетчика FPS
 * @type select
 * @option transparent
 * @option dark
 * @option light
 * @default transparent

 * @param History
 * @text История
 * @desc
 * @type number
 * @min 5
 * @max 100
 * @default 20

 */

/*~struct~ScreenResolution:

 * @param Enabled
 * @desc Enable the Screen Resolution function ?
 * @type boolean
 * @default false

 * @param Width
 * @desc Screen width
 * @type number
 * @min 0
 * @default 816

 * @param Height
 * @desc Screen height
 * @type number
 * @min 0
 * @default 624

 */

/*~struct~ScreenResolution:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения разрешения экрана ?
 * @type boolean
 * @default false

 * @param Width
 * @text Ширина экрана
 * @desc Ширина экрана
 * @type number
 * @min 0
 * @default 816

 * @param Height
 * @text Высота экрана
 * @desc Высота экрана
 * @type number
 * @min 0
 * @default 624

 */

/*~struct~QuickStart:

 * @param Enabled
 * @desc Enable the Quick Start function ?
 * @type boolean
 * @default false

 * @param Scene Name
 * @desc Name of scene which will be launched instead the title screen. Standard: Scene_Map
 * @default Scene_Map

 * @param Skip Saves
 * @desc Does it need skip the title screen if save files exists?
 * @type boolean
 * @default false

 */

/*~struct~QuickStart:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию быстрого старта ?
 * @type boolean
 * @default false

 * @param Scene Name
 * @text Название сцены
 * @desc Название сцены, которая запускается вместо титульного экрана. Стандартно: Scene_Map
 * @default Scene_Map

 * @param Skip Saves
 * @text Пропуск сохранений
 * @desc Пропускать титульный экран, если есть сохранения ?
 * @type boolean
 * @default false

 */

/*~struct~QuickLoad:

 * @param Enabled
 * @desc Enable the Quick Load function ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible for the quick loading. 117 - F6
 * @type number
 * @default 117

 * @param Savefile ID
 * @desc Savefile number for quick loading. Specify 0 to show the load scene
 * @type number
 * @default 0

 */

/*~struct~QuickLoad:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию быстрой загрузки ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за быструю загрузку. 117 - F6
 * @default 117

 * @param Savefile ID
 * @text Файл сохранения
 * @desc Номер файла сохранения для быстрой загрузки. Укажите 0, чтобы показывать экран загрузки
 * @type number
 * @default 0

 */

/*~struct~PreloadManager:

 * @param Enabled
 * @desc Enable the images preloading function ?
 * @type boolean
 * @default false

 * @param Debugging
 * @desc Display preload information in the console ?
 * @type boolean
 * @default false

 * @param Audio Files
 * @desc Preloading audio files
 * @type struct<PreloadManagerAudio>[]
 * @default []

 * @param Image Files
 * @desc Preloading image files
 * @type struct<PreloadManagerImage>[]
 * @default []

 */

/*~struct~PreloadManager:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию предзагрузки изображений ?
 * @type boolean
 * @default false

 * @param Debugging
 * @text Отладка
 * @desc Выводить информацию о предзагрузке в консоль ?
 * @type boolean
 * @default false

 * @param Audio Files
 * @text Звуки
 * @desc Предзагрузка звуков
 * @type struct<PreloadManagerAudio>[]
 * @default []

 * @param Image Files
 * @text Изображения
 * @desc Предзагрузка изображений
 * @type struct<PreloadManagerImage>[]
 * @default []

 */

/*~struct~PreloadManagerImage:

 * @param Path
 * @desc Path to file (with extension) or directory. For example, img/system/Window.png for file or img/system/ for directory

 * @param Hue
 * @desc Hue
 * @type number
 * @min 0
 * @max 360
 * @default 0

 * @param Caching
 * @desc Image caching
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerImage:ru

 * @param Path
 * @text Путь
 * @desc Путь к файлу (с расширением) или директории. Например, img/system/Window.png для файла или img/system/ для директории

 * @param Hue
 * @text Оттенок
 * @desc Оттенок
 * @type number
 * @min 0
 * @max 360
 * @default 0

 * @param Caching
 * @text Кэширование
 * @desc Кэширование изображений
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerAudio:

 * @param Path
 * @desc Path to file (with extension) or directory. For example, audio/bgm/Battle1.ogg for file or audio/bgm/ for directory

 * @param Caching
 * @desc Audio caching
 * @type boolean
 * @default false

 */

/*~struct~PreloadManagerAudio:ru

 * @param Path
 * @text Путь
 * @desc Путь к файлу (с расширением) или директории. Например, audio/bgm/Battle1.ogg для файла или audio/bgm/ для директории

 * @param Caching
 * @text Кэширование
 * @desc Кэширование звуков
 * @type boolean
 * @default false

 */

/*~struct~Screenshots:

 * @param Enabled
 * @desc Enable the Screenshots function ?
 * @type boolean
 * @default false

 * @param Key Code
 * @desc The key code that is responsible for saving the screenshot. 122 - F11
 * @type number
 * @default 122

 * @param Path
 * @text Path for saving screenshots
 * @desc Local path for saving screenshots
 * @default screenshots/

 * @param Filename
 * @desc The entire list of templates is given in the help (1)
 * @default %year_%month_%day_%hours_%minutes_%seconds.png

 * @param Type
 * @text Screenshot type
 * @desc Screenshot type
 * @type select
 * @option png
 * @option jpeg
 * @option webp
 * @default png

 * @param Quality
 * @text Screenshot quality
 * @desc Screenshot quality
 * @type select
 * @option 0%
 * @option 10%
 * @option 20%
 * @option 30%
 * @option 40%
 * @option 50%
 * @option 60%
 * @option 70%
 * @option 80%
 * @option 90%
 * @option 100%
 * @default 90%

 */

/*~struct~Screenshots:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию сохранения скриншота ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за сохранение скриншота. 122 - F11
 * @type number
 * @default 122

 * @param Path
 * @text Путь для сохранения скриншотов
 * @desc Локальный путь для сохранения скриншотов
 * @default screenshots/

 * @param Filename
 * @text Название файла скриншота
 * @desc Весь список шаблонов приведен в справке (1)
 * @default %year_%month_%day_%hours_%minutes_%seconds.png

 * @param Type
 * @text Тип скриншота
 * @desc Тип скриншота
 * @type select
 * @option png
 * @option jpeg
 * @option webp
 * @default png

 * @param Quality
 * @text Качество скриншота
 * @desc Качество скриншота
 * @type select
 * @option 0%
 * @value 0
 * @option 10%
 * @value 0.1
 * @option 20%
 * @value 0.2
 * @option 30%
 * @value 0.3
 * @option 40%
 * @value 0.4
 * @option 50%
 * @value 0.5
 * @option 60%
 * @value 0.6
 * @option 70%
 * @value 0.7
 * @option 80%
 * @value 0.8
 * @option 90%
 * @value 0.9
 * @option 100%
 * @value 1
 * @default 90%

 */

/*~struct~ErrorsLog:

 * @param Enabled
 * @desc Enable error logging ?
 * @type select
 * @option None
 * @option Only Test
 * @option Only Game
 * @option Always
 * @default None

 * @param Filename
 * @desc Filename
 * @default errors_log.txt

 * @param File Size
 * @desc Maximum file size in megabytes. If this value is exceeded, the old logs will be deleted.
 * @default 10

 */

/*~struct~ErrorsLog:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию логирования ошибок ?
 * @type select
 * @option Никогда
 * @value None
 * @option Только тест
 * @value Only Test
 * @option Только игра
 * @value Only Game
 * @option Всегда
 * @value Always
 * @default None

 * @param Filename
 * @text Название файла
 * @desc Название файла
 * @default errors_log.txt

 * @param File Size
 * @text Размер файла
 * @desc Максимальный размер файла в мегабайтах. При превышении этого значения старые логи будут удалены.
 * @default 10

 */

/*~struct~TileSize:

 * @param Enabled
 * @desc Enable the function of resizing tiles ?
 * @type boolean
 * @default false

 * @param Size
 * @desc Tile size
 * @type number
 * @min 1
 * @default 48

 */

/*~struct~TileSize:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию изменения размера тайла ?
 * @type boolean
 * @default false

 * @param Size
 * @text Размер тайла
 * @desc Размер тайла
 * @type number
 * @min 1
 * @default 48

 */

/*~struct~Grid:

 * @param Enabled
 * @type boolean
 * @desc Enable the function of displaying the grid ?
 * @default false

 * @param Key Code
 * @desc The key code that is responsible displaying the grid. 118 - F7
 * @type number
 * @default 118

 * @param Grid Color
 * @desc Grid line color in Web format
 * @default white

 * @param Grid Width
 * @desc Grid line width
 * @type number
 * @min 1
 * @default 1

 * @param Ruler Color
 * @desc Ruler color in Web format. Details in the help (2.2)
 * @default

 * @param Ruler Width
 * @desc Ruler width
 * @type number
 * @min 1
 * @default 3

 */

/*~struct~Grid:ru

 * @param Enabled
 * @text Включено
 * @desc Включить функцию отображения сетки ?
 * @type boolean
 * @default false

 * @param Key Code
 * @text Код клавиши
 * @desc Код клавиши, которая отвечает за отображение сетки. 118 - F7
 * @type number
 * @default 118

 * @param Grid Color
 * @text Цвет сетки
 * @desc Цвет сетки в Web формате
 * @default white

 * @param Grid Width
 * @text Ширина линии сетки
 * @desc Ширина линии сетки
 * @type number
 * @min 1
 * @default 1

 * @param Ruler Color
 * @text Цвет линейки
 * @desc Цвет линейки в Web формате. Подробности в справке (2.2)
 * @default

 * @param Ruler Width
 * @text Ширина линейки
 * @desc Ширина линейки
 * @type number
 * @min 1
 * @default 3

 */

!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";(function(t){var o;window.Imported=window.Imported||{},window.Imported.DKTools="6.1.0",function(){function n(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function s(t,e,i,o){for(var n=-1,s=null==t?0:t.length;++n<s;){var r=t[n];e(o,r,i(r),t)}return o}function r(t,e){for(var i=-1,o=null==t?0:t.length;++i<o&&!1!==e(t[i],i,t););return t}function a(t,e){for(var i=-1,o=null==t?0:t.length;++i<o;)if(!e(t[i],i,t))return!1;return!0}function l(t,e){for(var i=-1,o=null==t?0:t.length,n=0,s=[];++i<o;){var r=t[i];e(r,i,t)&&(s[n++]=r)}return s}function u(t,e){return!(null==t||!t.length)&&-1<m(t,e,0)}function c(t,e,i){for(var o=-1,n=null==t?0:t.length;++o<n;)if(i(e,t[o]))return!0;return!1}function h(t,e){for(var i=-1,o=null==t?0:t.length,n=Array(o);++i<o;)n[i]=e(t[i],i,t);return n}function p(t,e){for(var i=-1,o=e.length,n=t.length;++i<o;)t[n+i]=e[i];return t}function d(t,e,i,o){var n=-1,s=null==t?0:t.length;for(o&&s&&(i=t[++n]);++n<s;)i=e(i,t[n],n,t);return i}function f(t,e,i,o){var n=null==t?0:t.length;for(o&&n&&(i=t[--n]);n--;)i=e(i,t[n],n,t);return i}function g(t,e){for(var i=-1,o=null==t?0:t.length;++i<o;)if(e(t[i],i,t))return!0;return!1}function _(t,e,i){var o;return i(t,function(t,i,n){if(e(t,i,n))return o=i,!1}),o}function y(t,e,i,o){var n=t.length;for(i+=o?1:-1;o?i--:++i<n;)if(e(t[i],i,t))return i;return-1}function m(t,e,i){if(e==e)t:{--i;for(var o=t.length;++i<o;)if(t[i]===e){t=i;break t}t=-1}else t=y(t,S,i);return t}function T(t,e,i,o){--i;for(var n=t.length;++i<n;)if(o(t[i],e))return i;return-1}function S(t){return t!=t}function D(t,e){var i=null==t?0:t.length;return i?v(t,e)/i:U}function K(t){return function(e){return null==e?W:e[t]}}function w(t){return function(e){return null==t?W:t[e]}}function b(t,e,i,o,n){return n(t,function(t,n,s){i=o?(o=!1,t):e(i,t,n,s)}),i}function v(t,e){for(var i,o=-1,n=t.length;++o<n;){var s=e(t[o]);s!==W&&(i=i===W?s:i+s)}return i}function A(t,e){for(var i=-1,o=Array(t);++i<t;)o[i]=e(i);return o}function C(t){return function(e){return t(e)}}function O(t,e){return h(e,function(e){return t[e]})}function x(t,e){return t.has(e)}function I(t,e){for(var i=-1,o=t.length;++i<o&&-1<m(e,t[i],0););return i}function P(t,e){for(var i=t.length;i--&&-1<m(e,t[i],0););return i}function E(t){return"\\"+Rt[t]}function R(t){var e=-1,i=Array(t.size);return t.forEach(function(t,o){i[++e]=[o,t]}),i}function B(t,e){return function(i){return t(e(i))}}function M(t,e){for(var i=-1,o=t.length,n=0,s=[];++i<o;){var r=t[i];r!==e&&"__lodash_placeholder__"!==r||(t[i]="__lodash_placeholder__",s[n++]=i)}return s}function H(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function k(t){if(Ot.test(t)){for(var e=At.lastIndex=0;At.test(t);)++e;t=e}else t=Xt(t);return t}function F(t){return Ot.test(t)?t.match(At)||[]:t.split("")}var W,L=1/0,U=NaN,j=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],N=/\b__p\+='';/g,z=/\b(__p\+=)''\+/g,V=/(__e\(.*?\)|\b__t\))\+'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,Y=/[&<>"']/g,q=RegExp(G.source),$=RegExp(Y.source),X=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,Z=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tt=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,ot=RegExp(it.source),nt=/^\s+|\s+$/g,st=/^\s+/,rt=/\s+$/,at=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,lt=/\{\n\/\* \[wrapped with (.+)\] \*/,ut=/,? & /,ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ht=/\\(\\)?/g,pt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dt=/\w*$/,ft=/^[-+]0x[0-9a-f]+$/i,gt=/^0b[01]+$/i,_t=/^\[object .+?Constructor\]$/,yt=/^0o[0-7]+$/i,mt=/^(?:0|[1-9]\d*)$/,Tt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,St=/($^)/,Dt=/['\n\r\u2028\u2029\\]/g,Kt="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*",wt="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+Kt,bt=RegExp("['’]","g"),vt=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),At=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])"+Kt,"g"),Ct=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['’](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['’](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",wt].join("|"),"g"),Ot=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),xt=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,It="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Pt={};Pt["[object Float32Array]"]=Pt["[object Float64Array]"]=Pt["[object Int8Array]"]=Pt["[object Int16Array]"]=Pt["[object Int32Array]"]=Pt["[object Uint8Array]"]=Pt["[object Uint8ClampedArray]"]=Pt["[object Uint16Array]"]=Pt["[object Uint32Array]"]=!0,Pt["[object Arguments]"]=Pt["[object Array]"]=Pt["[object ArrayBuffer]"]=Pt["[object Boolean]"]=Pt["[object DataView]"]=Pt["[object Date]"]=Pt["[object Error]"]=Pt["[object Function]"]=Pt["[object Map]"]=Pt["[object Number]"]=Pt["[object Object]"]=Pt["[object RegExp]"]=Pt["[object Set]"]=Pt["[object String]"]=Pt["[object WeakMap]"]=!1;var Et={};Et["[object Arguments]"]=Et["[object Array]"]=Et["[object ArrayBuffer]"]=Et["[object DataView]"]=Et["[object Boolean]"]=Et["[object Date]"]=Et["[object Float32Array]"]=Et["[object Float64Array]"]=Et["[object Int8Array]"]=Et["[object Int16Array]"]=Et["[object Int32Array]"]=Et["[object Map]"]=Et["[object Number]"]=Et["[object Object]"]=Et["[object RegExp]"]=Et["[object Set]"]=Et["[object String]"]=Et["[object Symbol]"]=Et["[object Uint8Array]"]=Et["[object Uint8ClampedArray]"]=Et["[object Uint16Array]"]=Et["[object Uint32Array]"]=!0,Et["[object Error]"]=Et["[object Function]"]=Et["[object WeakMap]"]=!1;var Rt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Bt=parseFloat,Mt=parseInt,Ht="object"==typeof global&&global&&global.Object===Object&&global,kt="object"==typeof self&&self&&self.Object===Object&&self,Ft=Ht||kt||Function("return this")(),Wt="object"==typeof e&&e&&!e.nodeType&&e,Lt=Wt&&"object"==typeof t&&t&&!t.nodeType&&t,Ut=Lt&&Lt.exports===Wt,jt=Ut&&Ht.process,Nt=function(){try{var t=Lt&&Lt.f&&Lt.f("util").types;return t||jt&&jt.binding&&jt.binding("util")}catch(t){}}(),zt=Nt&&Nt.isArrayBuffer,Vt=Nt&&Nt.isDate,Gt=Nt&&Nt.isMap,Yt=Nt&&Nt.isRegExp,qt=Nt&&Nt.isSet,$t=Nt&&Nt.isTypedArray,Xt=K("length"),Jt=w({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Zt=w({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Qt=w({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),te=function t(e){function i(t){if(jo(t)&&!Ir(t)&&!(t instanceof Kt)){if(t instanceof w)return t;if(Pn.call(t,"__wrapped__"))return fo(t)}return new w(t)}function o(){}function w(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=W}function Kt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function wt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var o=t[e];this.set(o[0],o[1])}}function At(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var o=t[e];this.set(o[0],o[1])}}function Rt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var o=t[e];this.set(o[0],o[1])}}function Ht(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Rt;++e<i;)this.add(t[e])}function kt(t){this.size=(this.__data__=new At(t)).size}function Wt(t,e){var i,o=Ir(t),n=!o&&xr(t),s=!o&&!n&&Er(t),r=!o&&!n&&!s&&kr(t),a=(n=(o=o||n||s||r)?A(t.length,vn):[]).length;for(i in t)!e&&!Pn.call(t,i)||o&&("length"==i||s&&("offset"==i||"parent"==i)||r&&("buffer"==i||"byteLength"==i||"byteOffset"==i)||to(i,a))||n.push(i);return n}function Lt(t){var e=t.length;return e?t[Ue(0,e-1)]:W}function jt(t,e,i){(i===W||Bo(t[e],i))&&(i!==W||e in t)||oe(t,e,i)}function Nt(t,e,i){var o=t[e];Pn.call(t,e)&&Bo(o,i)&&(i!==W||e in t)||oe(t,e,i)}function Xt(t,e){for(var i=t.length;i--;)if(Bo(t[i][0],e))return i;return-1}function ee(t,e,i,o){return xs(t,function(t,n,s){e(o,t,i(t),s)}),o}function ie(t,e){return t&&gi(e,on(e),t)}function oe(t,e,i){"__proto__"==e&&$n?$n(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function ne(t,e){for(var i=-1,o=e.length,n=mn(o),s=null==t;++i<o;)n[i]=s?W:tn(t,e[i]);return n}function se(t,e,i){return t==t&&(i!==W&&(t=t<=i?t:i),e!==W&&(t=t>=e?t:e)),t}function re(t,e,i,o,n,s){var a,l=1&e,u=2&e,c=4&e;if(i&&(a=n?i(t,o,n,s):i(t)),a!==W)return a;if(!Uo(t))return t;if(o=Ir(t)){if(a=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&Pn.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(t),!l)return fi(t,a)}else{var h=Ls(t),p="[object Function]"==h||"[object GeneratorFunction]"==h;if(Er(t))return li(t,l);if("[object Object]"==h||"[object Arguments]"==h||p&&!n){if(a=u||p?{}:Zi(t),!l)return u?function(t,e){return gi(t,Ws(t),e)}(t,function(t,e){return t&&gi(e,nn(e),t)}(a,t)):function(t,e){return gi(t,Fs(t),e)}(t,ie(a,t))}else{if(!Et[h])return n?t:{};a=function(t,e,i){var o=t.constructor;switch(e){case"[object ArrayBuffer]":return ui(t);case"[object Boolean]":case"[object Date]":return new o(+t);case"[object DataView]":return e=i?ui(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ci(t,i);case"[object Map]":return new o;case"[object Number]":case"[object String]":return new o(t);case"[object RegExp]":return(e=new t.constructor(t.source,dt.exec(t))).lastIndex=t.lastIndex,e;case"[object Set]":return new o;case"[object Symbol]":return As?wn(As.call(t)):{}}}(t,h,l)}}if(s||(s=new kt),n=s.get(t))return n;if(s.set(t,a),Hr(t))return t.forEach(function(o){a.add(re(o,e,i,o,t,s))}),a;if(Br(t))return t.forEach(function(o,n){a.set(n,re(o,e,i,n,t,s))}),a;u=c?u?zi:Ni:u?nn:on;var d=o?W:u(t);return r(d||t,function(o,n){d&&(o=t[n=o]),Nt(a,n,re(o,e,i,n,t,s))}),a}function ae(t,e,i){var o=i.length;if(null==t)return!o;for(t=wn(t);o--;){var n=i[o],s=e[n],r=t[n];if(r===W&&!(n in t)||!s(r))return!1}return!0}function le(t,e,i){if("function"!=typeof t)throw new An("Expected a function");return Ns(function(){t.apply(W,i)},e)}function ue(t,e,i,o){var n=-1,s=u,r=!0,a=t.length,l=[],p=e.length;if(!a)return l;i&&(e=h(e,C(i))),o?(s=c,r=!1):200<=e.length&&(s=x,r=!1,e=new Ht(e));t:for(;++n<a;){var d=t[n],f=null==i?d:i(d);d=o||0!==d?d:0;if(r&&f==f){for(var g=p;g--;)if(e[g]===f)continue t;l.push(d)}else s(e,f,o)||l.push(d)}return l}function ce(t,e){var i=!0;return xs(t,function(t,o,n){return i=!!e(t,o,n)}),i}function he(t,e,i){for(var o=-1,n=t.length;++o<n;){var s=t[o],r=e(s);if(null!=r&&(a===W?r==r&&!Go(r):i(r,a)))var a=r,l=s}return l}function pe(t,e){var i=[];return xs(t,function(t,o,n){e(t,o,n)&&i.push(t)}),i}function de(t,e,i,o,n){var s=-1,r=t.length;for(i||(i=Qi),n||(n=[]);++s<r;){var a=t[s];0<e&&i(a)?1<e?de(a,e-1,i,o,n):p(n,a):o||(n[n.length]=a)}return n}function fe(t,e){return t&&Ps(t,e,on)}function ge(t,e){return t&&Es(t,e,on)}function _e(t,e){return l(e,function(e){return Fo(t[e])})}function ye(t,e){for(var i=0,o=(e=ri(e,t)).length;null!=t&&i<o;)t=t[co(e[i++])];return i&&i==o?t:W}function me(t,e,i){return e=e(t),Ir(t)?e:p(e,i(t))}function Te(t){if(null==t)t=t===W?"[object Undefined]":"[object Null]";else if(qn&&qn in wn(t)){var e=Pn.call(t,qn),i=t[qn];try{t[qn]=W;var o=!0}catch(t){}var n=Bn.call(t);o&&(e?t[qn]=i:delete t[qn]),t=n}else t=Bn.call(t);return t}function Se(t,e){return t>e}function De(t,e){return null!=t&&Pn.call(t,e)}function Ke(t,e){return null!=t&&e in wn(t)}function we(t,e,i){for(var o=i?c:u,n=t[0].length,s=t.length,r=s,a=mn(s),l=1/0,p=[];r--;){var d=t[r];r&&e&&(d=h(d,C(e))),l=as(d.length,l),a[r]=!i&&(e||120<=n&&120<=d.length)?new Ht(r&&d):W}d=t[0];var f=-1,g=a[0];t:for(;++f<n&&p.length<l;){var _=d[f],y=e?e(_):_;_=i||0!==_?_:0;if(g?!x(g,y):!o(p,y,i)){for(r=s;--r;){var m=a[r];if(m?!x(m,y):!o(t[r],y,i))continue t}g&&g.push(y),p.push(_)}}return p}function be(t,e,i){return null==(e=null==(t=2>(e=ri(e,t)).length?t:ye(t,Ve(e,0,-1)))?t:t[co(To(e))])?W:n(e,t,i)}function ve(t){return jo(t)&&"[object Arguments]"==Te(t)}function Ae(t,e,i,o,n){if(t===e)e=!0;else if(null==t||null==e||!jo(t)&&!jo(e))e=t!=t&&e!=e;else t:{var s=Ir(t),r=Ir(e),a=s?"[object Array]":Ls(t),l=r?"[object Array]":Ls(e),u="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);r="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l);if((l=a==l)&&Er(t)){if(!Er(e)){e=!1;break t}s=!0,u=!1}if(l&&!u)n||(n=new kt),e=s||kr(t)?Ui(t,e,i,o,Ae,n):function(t,e,i,o,n,s,r){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!s(new Ln(t),new Ln(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Bo(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=R;case"[object Set]":if(a||(a=H),t.size!=e.size&&!(1&o))break;return(i=r.get(t))?i==e:(o|=2,r.set(t,e),e=Ui(a(t),a(e),o,n,s,r),r.delete(t),e);case"[object Symbol]":if(As)return As.call(t)==As.call(e)}return!1}(t,e,a,i,o,Ae,n);else{if(!(1&i)&&(s=u&&Pn.call(t,"__wrapped__"),a=r&&Pn.call(e,"__wrapped__"),s||a)){t=s?t.value():t,e=a?e.value():e,n||(n=new kt),e=Ae(t,e,i,o,n);break t}if(l)e:if(n||(n=new kt),s=1&i,a=Ni(t),r=a.length,l=Ni(e).length,r==l||s){for(u=r;u--;){var c=a[u];if(!(s?c in e:Pn.call(e,c))){e=!1;break e}}if((l=n.get(t))&&n.get(e))e=l==e;else{l=!0,n.set(t,e),n.set(e,t);for(var h=s;++u<r;){var p=t[c=a[u]],d=e[c];if(o)var f=s?o(d,p,c,e,t,n):o(p,d,c,t,e,n);if(f===W?p!==d&&!Ae(p,d,i,o,n):!f){l=!1;break}h||(h="constructor"==c)}l&&!h&&((i=t.constructor)!=(o=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof i&&i instanceof i&&"function"==typeof o&&o instanceof o)&&(l=!1)),n.delete(t),n.delete(e),e=l}}else e=!1;else e=!1}}return e}function Ce(t,e,i,o){var n=i.length,s=n,r=!o;if(null==t)return!s;for(t=wn(t);n--;){var a=i[n];if(r&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++n<s;){var l=(a=i[n])[0],u=t[l],c=a[1];if(r&&a[2]){if(u===W&&!(l in t))return!1}else{if(a=new kt,o)var h=o(u,c,l,t,e,a);if(h===W?!Ae(c,u,3,o,a):!h)return!1}}return!0}function Oe(t){return!(!Uo(t)||Rn&&Rn in t)&&(Fo(t)?kn:_t).test(ho(t))}function xe(t){return"function"==typeof t?t:null==t?hn:"object"==typeof t?Ir(t)?Be(t[0],t[1]):Re(t):gn(t)}function Ie(t){if(!no(t))return ss(t);var e,i=[];for(e in wn(t))Pn.call(t,e)&&"constructor"!=e&&i.push(e);return i}function Pe(t,e){return t<e}function Ee(t,e){var i=-1,o=Mo(t)?mn(t.length):[];return xs(t,function(t,n,s){o[++i]=e(t,n,s)}),o}function Re(t){var e=$i(t);return 1==e.length&&e[0][2]?so(e[0][0],e[0][1]):function(i){return i===t||Ce(i,t,e)}}function Be(t,e){return io(t)&&e==e&&!Uo(e)?so(co(t),e):function(i){var o=tn(i,t);return o===W&&o===e?en(i,t):Ae(e,o,3)}}function Me(t,e,i,o,n){t!==e&&Ps(e,function(s,r){if(Uo(s)){n||(n=new kt);var a=n,l="__proto__"==r?W:t[r],u="__proto__"==r?W:e[r];if(f=a.get(u))jt(t,r,f);else{var c=(f=o?o(l,u,r+"",t,e,a):W)===W;if(c){var h=Ir(u),p=!h&&Er(u),d=!h&&!p&&kr(u),f=u;h||p||d?Ir(l)?f=l:Ho(l)?f=fi(l):p?(c=!1,f=li(u,!0)):d?(c=!1,f=ci(u,!0)):f=[]:zo(u)||xr(u)?(f=l,xr(l)?f=Zo(l):(!Uo(l)||i&&Fo(l))&&(f=Zi(u))):c=!1}c&&(a.set(u,f),Me(f,u,i,o,a),a.delete(u)),jt(t,r,f)}}else(a=o?o("__proto__"==r?W:t[r],s,r+"",t,e,n):W)===W&&(a=s),jt(t,r,a)},nn)}function He(t,e){var i=t.length;if(i)return to(e+=0>e?i:0,i)?t[e]:W}function ke(t,e,i){var o=-1;return e=h(e.length?e:[hn],C(Yi())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].c;return t}(t=Ee(t,function(t){return{a:h(e,function(e){return e(t)}),b:++o,c:t}}),function(t,e){var o;t:{o=-1;for(var n=t.a,s=e.a,r=n.length,a=i.length;++o<r;){var l=hi(n[o],s[o]);if(l){o=o>=a?l:l*("desc"==i[o]?-1:1);break t}}o=t.b-e.b}return o})}function Fe(t,e,i){for(var o=-1,n=e.length,s={};++o<n;){var r=e[o],a=ye(t,r);i(a,r)&&ze(s,ri(r,t),a)}return s}function We(t,e,i,o){var n=o?T:m,s=-1,r=e.length,a=t;for(t===e&&(e=fi(e)),i&&(a=h(t,C(i)));++s<r;){var l=0,u=e[s];for(u=i?i(u):u;-1<(l=n(a,u,l,o));)a!==t&&Vn.call(a,l,1),Vn.call(t,l,1)}return t}function Le(t,e){for(var i=t?e.length:0,o=i-1;i--;){var n=e[i];if(i==o||n!==s){var s=n;to(n)?Vn.call(t,n,1):Qe(t,n)}}}function Ue(t,e){return t+ts(cs()*(e-t+1))}function je(t,e){var i="";if(!t||1>e||9007199254740991<e)return i;do{e%2&&(i+=t),(e=ts(e/2))&&(t+=t)}while(e);return i}function Ne(t,e){return zs(ro(t,e,hn),t+"")}function ze(t,e,i,o){if(!Uo(t))return t;for(var n=-1,s=(e=ri(e,t)).length,r=s-1,a=t;null!=a&&++n<s;){var l=co(e[n]),u=i;if(n!=r){var c=a[l];(u=o?o(c,l,a):W)===W&&(u=Uo(c)?c:to(e[n+1])?[]:{})}Nt(a,l,u),a=a[l]}return t}function Ve(t,e,i){var o=-1,n=t.length;for(0>e&&(e=-e>n?0:n+e),0>(i=i>n?n:i)&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0,i=mn(n);++o<n;)i[o]=t[o+e];return i}function Ge(t,e){var i;return xs(t,function(t,o,n){return!(i=e(t,o,n))}),!!i}function Ye(t,e,i){var o=0,n=null==t?o:t.length;if("number"==typeof e&&e==e&&2147483647>=n){for(;o<n;){var s=o+n>>>1,r=t[s];null!==r&&!Go(r)&&(i?r<=e:r<e)?o=s+1:n=s}return n}return qe(t,e,hn,i)}function qe(t,e,i,o){e=i(e);for(var n=0,s=null==t?0:t.length,r=e!=e,a=null===e,l=Go(e),u=e===W;n<s;){var c=ts((n+s)/2),h=i(t[c]),p=h!==W,d=null===h,f=h==h,g=Go(h);(r?o||f:u?f&&(o||p):a?f&&p&&(o||!d):l?f&&p&&!d&&(o||!g):!d&&!g&&(o?h<=e:h<e))?n=c+1:s=c}return as(s,4294967294)}function $e(t,e){for(var i=-1,o=t.length,n=0,s=[];++i<o;){var r=t[i],a=e?e(r):r;if(!i||!Bo(a,l)){var l=a;s[n++]=0===r?0:r}}return s}function Xe(t){return"number"==typeof t?t:Go(t)?U:+t}function Je(t){if("string"==typeof t)return t;if(Ir(t))return h(t,Je)+"";if(Go(t))return Cs?Cs.call(t):"";var e=t+"";return"0"==e&&1/t==-L?"-0":e}function Ze(t,e,i){var o=-1,n=u,s=t.length,r=!0,a=[],l=a;if(i)r=!1,n=c;else if(200<=s){if(n=e?null:Hs(t))return H(n);r=!1,n=x,l=new Ht}else l=e?[]:a;t:for(;++o<s;){var h=t[o],p=e?e(h):h;h=i||0!==h?h:0;if(r&&p==p){for(var d=l.length;d--;)if(l[d]===p)continue t;e&&l.push(p),a.push(h)}else n(l,p,i)||(l!==a&&l.push(p),a.push(h))}return a}function Qe(t,e){return null==(t=2>(e=ri(e,t)).length?t:ye(t,Ve(e,0,-1)))||delete t[co(To(e))]}function ti(t,e,i,o){for(var n=t.length,s=o?n:-1;(o?s--:++s<n)&&e(t[s],s,t););return i?Ve(t,o?0:s,o?s+1:n):Ve(t,o?s+1:0,o?n:s)}function ei(t,e){var i=t;return i instanceof Kt&&(i=i.value()),d(e,function(t,e){return e.func.apply(e.thisArg,p([t],e.args))},i)}function ii(t,e,i){var o=t.length;if(2>o)return o?Ze(t[0]):[];for(var n=-1,s=mn(o);++n<o;)for(var r=t[n],a=-1;++a<o;)a!=n&&(s[n]=ue(s[n]||r,t[a],e,i));return Ze(de(s,1),e,i)}function oi(t,e,i){for(var o=-1,n=t.length,s=e.length,r={};++o<n;)i(r,t[o],o<s?e[o]:W);return r}function ni(t){return Ho(t)?t:[]}function si(t){return"function"==typeof t?t:hn}function ri(t,e){return Ir(t)?t:io(t,e)?[t]:Vs(Qo(t))}function ai(t,e,i){var o=t.length;return i=i===W?o:i,!e&&i>=o?t:Ve(t,e,i)}function li(t,e){if(e)return t.slice();var i=t.length;i=Un?Un(i):new t.constructor(i);return t.copy(i),i}function ui(t){var e=new t.constructor(t.byteLength);return new Ln(e).set(new Ln(t)),e}function ci(t,e){return new t.constructor(e?ui(t.buffer):t.buffer,t.byteOffset,t.length)}function hi(t,e){if(t!==e){var i=t!==W,o=null===t,n=t==t,s=Go(t),r=e!==W,a=null===e,l=e==e,u=Go(e);if(!a&&!u&&!s&&t>e||s&&r&&l&&!a&&!u||o&&r&&l||!i&&l||!n)return 1;if(!o&&!s&&!u&&t<e||u&&i&&n&&!o&&!s||a&&i&&n||!r&&n||!l)return-1}return 0}function pi(t,e,i,o){var n=-1,s=t.length,r=i.length,a=-1,l=e.length,u=rs(s-r,0),c=mn(l+u);for(o=!o;++a<l;)c[a]=e[a];for(;++n<r;)(o||n<s)&&(c[i[n]]=t[n]);for(;u--;)c[a++]=t[n++];return c}function di(t,e,i,o){var n=-1,s=t.length,r=-1,a=i.length,l=-1,u=e.length,c=rs(s-a,0),h=mn(c+u);for(o=!o;++n<c;)h[n]=t[n];for(c=n;++l<u;)h[c+l]=e[l];for(;++r<a;)(o||n<s)&&(h[c+i[r]]=t[n++]);return h}function fi(t,e){var i=-1,o=t.length;for(e||(e=mn(o));++i<o;)e[i]=t[i];return e}function gi(t,e,i,o){var n=!i;i||(i={});for(var s=-1,r=e.length;++s<r;){var a=e[s],l=o?o(i[a],t[a],a,i,t):W;l===W&&(l=t[a]),n?oe(i,a,l):Nt(i,a,l)}return i}function _i(t,e){return function(i,o){var n=Ir(i)?s:ee,r=e?e():{};return n(i,t,Yi(o,2),r)}}function yi(t){return Ne(function(e,i){var o=-1,n=i.length,s=1<n?i[n-1]:W,r=2<n?i[2]:W;s=3<t.length&&"function"==typeof s?(n--,s):W;for(r&&eo(i[0],i[1],r)&&(s=3>n?W:s,n=1),e=wn(e);++o<n;)(r=i[o])&&t(e,r,o,s);return e})}function mi(t,e){return function(i,o){if(null==i)return i;if(!Mo(i))return t(i,o);for(var n=i.length,s=e?n:-1,r=wn(i);(e?s--:++s<n)&&!1!==o(r[s],s,r););return i}}function Ti(t){return function(e,i,o){for(var n=-1,s=wn(e),r=(o=o(e)).length;r--;){var a=o[t?r:++n];if(!1===i(s[a],a,s))break}return e}}function Si(t){return function(e){e=Qo(e);var i=Ot.test(e)?F(e):W,o=i?i[0]:e.charAt(0);return e=i?ai(i,1).join(""):e.slice(1),o[t]()+e}}function Di(t){return function(e){return d(un(ln(e).replace(bt,"")),t,"")}}function Ki(t){return function(){switch((e=arguments).length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var e,i=Os(t.prototype);return Uo(e=t.apply(i,e))?e:i}}function wi(t,e,i){var o=Ki(t);return function s(){for(var r=arguments.length,a=mn(r),l=r,u=Gi(s);l--;)a[l]=arguments[l];return(r-=(l=3>r&&a[0]!==u&&a[r-1]!==u?[]:M(a,u)).length)<i?Bi(t,e,Ai,s.placeholder,W,a,l,W,W,i-r):n(this&&this!==Ft&&this instanceof s?o:t,this,a)}}function bi(t){return function(e,i,o){var n=wn(e);if(!Mo(e)){var s=Yi(i,3);e=on(e),i=function(t){return s(n[t],t,n)}}return-1<(i=t(e,i,o))?n[s?e[i]:i]:W}}function vi(t){return ji(function(e){var i=e.length,o=i,n=w.prototype.thru;for(t&&e.reverse();o--;){if("function"!=typeof(r=e[o]))throw new An("Expected a function");if(n&&!s&&"wrapper"==Vi(r))var s=new w([],!0)}for(o=s?o:i;++o<i;){var r,a="wrapper"==(n=Vi(r=e[o]))?ks(r):W;s=a&&oo(a[0])&&424==a[1]&&!a[4].length&&1==a[9]?s[Vi(a[0])].apply(s,a[3]):1==r.length&&oo(r)?s[n]():s.thru(r)}return function(){var t=(n=arguments)[0];if(s&&1==n.length&&Ir(t))return s.plant(t).value();for(var o=0,n=i?e[o].apply(this,n):t;++o<i;)n=e[o].call(this,n);return n}})}function Ai(t,e,i,o,n,s,r,a,l,u){var c=128&e,h=1&e,p=2&e,d=24&e,f=512&e,g=p?W:Ki(t);return function _(){for(var y=arguments.length,m=mn(y),T=y;T--;)m[T]=arguments[T];if(d){var S,D=Gi(_);for(T=m.length,S=0;T--;)m[T]===D&&++S}if(o&&(m=pi(m,o,n,d)),s&&(m=di(m,s,r,d)),y-=S,d&&y<u)return D=M(m,D),Bi(t,e,Ai,_.placeholder,i,m,D,a,l,u-y);if(D=h?i:this,T=p?D[t]:t,y=m.length,a){S=m.length;for(var K=as(a.length,S),w=fi(m);K--;){var b=a[K];m[K]=to(b,S)?w[b]:W}}else f&&1<y&&m.reverse();return c&&l<y&&(m.length=l),this&&this!==Ft&&this instanceof _&&(T=g||Ki(T)),T.apply(D,m)}}function Ci(t,e){return function(i,o){return function(t,e,i){var o={};return fe(t,function(t,n,s){e(o,i(t),n,s)}),o}(i,t,e(o))}}function Oi(t,e){return function(i,o){var n;if(i===W&&o===W)return e;if(i!==W&&(n=i),o!==W){if(n===W)return o;"string"==typeof i||"string"==typeof o?(i=Je(i),o=Je(o)):(i=Xe(i),o=Xe(o)),n=t(i,o)}return n}}function xi(t){return ji(function(e){return e=h(e,C(Yi())),Ne(function(i){var o=this;return t(e,function(t){return n(t,o,i)})})})}function Ii(t,e){var i=(e=e===W?" ":Je(e)).length;return 2>i?i?je(e,t):e:(i=je(e,Qn(t/k(e))),Ot.test(e)?ai(F(i),0,t).join(""):i.slice(0,t))}function Pi(t,e,i,o){var s=1&e,r=Ki(t);return function e(){for(var a=-1,l=arguments.length,u=-1,c=o.length,h=mn(c+l),p=this&&this!==Ft&&this instanceof e?r:t;++u<c;)h[u]=o[u];for(;l--;)h[u++]=arguments[++a];return n(p,s?i:this,h)}}function Ei(t){return function(e,i,o){o&&"number"!=typeof o&&eo(e,i,o)&&(i=o=W),e=qo(e),i===W?(i=e,e=0):i=qo(i),o=o===W?e<i?1:-1:qo(o);var n=-1;i=rs(Qn((i-e)/(o||1)),0);for(var s=mn(i);i--;)s[t?i:++n]=e,e+=o;return s}}function Ri(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Jo(e),i=Jo(i)),t(e,i)}}function Bi(t,e,i,o,n,s,r,a,l,u){var c=8&e,h=c?r:W;r=c?W:r;var p=c?s:W;return s=c?W:s,4&(e=(e|(c?32:64))&~(c?64:32))||(e&=-4),n=[t,e,n,p,h,s,r,a,l,u],i=i.apply(W,n),oo(t)&&js(i,n),i.placeholder=o,ao(i,t,e)}function Mi(t){var e=Kn[t];return function(t,i){if(t=Jo(t),i=null==i?0:as($o(i),292)){var o=(Qo(t)+"e").split("e");return+((o=(Qo(o=e(o[0]+"e"+(+o[1]+i)))+"e").split("e"))[0]+"e"+(+o[1]-i))}return e(t)}}function Hi(t){return function(e){var i=Ls(e);return"[object Map]"==i?R(e):"[object Set]"==i?function(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=[t,t]}),i}(e):function(t,e){return h(e,function(e){return[e,t[e]]})}(e,t(e))}}function ki(t,e,i,o,n,s,r,a){var l=2&e;if(!l&&"function"!=typeof t)throw new An("Expected a function");var u=o?o.length:0;if(u||(e&=-97,o=n=W),r=r===W?r:rs($o(r),0),a=a===W?a:$o(a),u-=n?n.length:0,64&e){var c=o,h=n;o=n=W}var p=l?W:ks(t);return s=[t,e,i,o,n,c,h,s,r,a],p&&(e=(i=s[1])|(t=p[1]),o=128==t&&8==i||128==t&&256==i&&s[7].length<=p[8]||384==t&&p[7].length<=p[8]&&8==i,131>e||o)&&(1&t&&(s[2]=p[2],e|=1&i?0:4),(i=p[3])&&(o=s[3],s[3]=o?pi(o,i,p[4]):i,s[4]=o?M(s[3],"__lodash_placeholder__"):p[4]),(i=p[5])&&(o=s[5],s[5]=o?di(o,i,p[6]):i,s[6]=o?M(s[5],"__lodash_placeholder__"):p[6]),(i=p[7])&&(s[7]=i),128&t&&(s[8]=null==s[8]?p[8]:as(s[8],p[8])),null==s[9]&&(s[9]=p[9]),s[0]=p[0],s[1]=e),t=s[0],e=s[1],i=s[2],o=s[3],n=s[4],!(a=s[9]=s[9]===W?l?0:t.length:rs(s[9]-u,0))&&24&e&&(e&=-25),ao((p?Rs:js)(e&&1!=e?8==e||16==e?wi(t,e,a):32!=e&&33!=e||n.length?Ai.apply(W,s):Pi(t,e,i,o):function(t,e,i){var o=1&e,n=Ki(t);return function e(){return(this&&this!==Ft&&this instanceof e?n:t).apply(o?i:this,arguments)}}(t,e,i),s),t,e)}function Fi(t,e,i,o){return t===W||Bo(t,On[i])&&!Pn.call(o,i)?e:t}function Wi(t,e,i,o,n,s){return Uo(t)&&Uo(e)&&(s.set(e,t),Me(t,e,W,Wi,s),s.delete(e)),t}function Li(t){return zo(t)?W:t}function Ui(t,e,i,o,n,s){var r=1&i,a=t.length;if(a!=(l=e.length)&&!(r&&l>a))return!1;if((l=s.get(t))&&s.get(e))return l==e;var l=-1,u=!0,c=2&i?new Ht:W;for(s.set(t,e),s.set(e,t);++l<a;){var h=t[l],p=e[l];if(o)var d=r?o(p,h,l,e,t,s):o(h,p,l,t,e,s);if(d!==W){if(d)continue;u=!1;break}if(c){if(!g(e,function(t,e){if(!x(c,e)&&(h===t||n(h,t,i,o,s)))return c.push(e)})){u=!1;break}}else if(h!==p&&!n(h,p,i,o,s)){u=!1;break}}return s.delete(t),s.delete(e),u}function ji(t){return zs(ro(t,W,yo),t+"")}function Ni(t){return me(t,on,Fs)}function zi(t){return me(t,nn,Ws)}function Vi(t){for(var e=t.name+"",i=Ts[e],o=Pn.call(Ts,e)?i.length:0;o--;){var n=i[o],s=n.func;if(null==s||s==t)return n.name}return e}function Gi(t){return(Pn.call(i,"placeholder")?i:t).placeholder}function Yi(){var t=(t=i.iteratee||pn)===pn?xe:t;return arguments.length?t(arguments[0],arguments[1]):t}function qi(t,e){var i=t.__data__,o=typeof e;return("string"==o||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==e:null===e)?i["string"==typeof e?"string":"hash"]:i.map}function $i(t){for(var e=on(t),i=e.length;i--;){var o=e[i],n=t[o];e[i]=[o,n,n==n&&!Uo(n)]}return e}function Xi(t,e){var i=null==t?W:t[e];return Oe(i)?i:W}function Ji(t,e,i){for(var o=-1,n=(e=ri(e,t)).length,s=!1;++o<n;){var r=co(e[o]);if(!(s=null!=t&&i(t,r)))break;t=t[r]}return s||++o!=n?s:!!(n=null==t?0:t.length)&&Lo(n)&&to(r,n)&&(Ir(t)||xr(t))}function Zi(t){return"function"!=typeof t.constructor||no(t)?{}:Os(jn(t))}function Qi(t){return Ir(t)||xr(t)||!!(Gn&&t&&t[Gn])}function to(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&mt.test(t))&&-1<t&&0==t%1&&t<e}function eo(t,e,i){if(!Uo(i))return!1;var o=typeof e;return!!("number"==o?Mo(i)&&to(e,i.length):"string"==o&&e in i)&&Bo(i[e],t)}function io(t,e){if(Ir(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Go(t))||tt.test(t)||!Q.test(t)||null!=e&&t in wn(e)}function oo(t){var e=Vi(t),o=i[e];return"function"==typeof o&&e in Kt.prototype&&(t===o||!!(e=ks(o))&&t===e[0])}function no(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||On)}function so(t,e){return function(i){return null!=i&&i[t]===e&&(e!==W||t in wn(i))}}function ro(t,e,i){return e=rs(e===W?t.length-1:e,0),function(){for(var o=arguments,s=-1,r=rs(o.length-e,0),a=mn(r);++s<r;)a[s]=o[e+s];for(s=-1,r=mn(e+1);++s<e;)r[s]=o[s];return r[e]=i(a),n(t,this,r)}}function ao(t,e,i){var o=e+"";e=zs;var n,s=po;return(s=(i=s(n=(n=o.match(lt))?n[1].split(ut):[],i)).length)&&(i[n=s-1]=(1<s?"& ":"")+i[n],i=i.join(2<s?", ":" "),o=o.replace(at,"{\n/* [wrapped with "+i+"] */\n")),e(t,o)}function lo(t){var e=0,i=0;return function(){var o=ls(),n=16-(o-i);if(i=o,0<n){if(800<=++e)return arguments[0]}else e=0;return t.apply(W,arguments)}}function uo(t,e){var i=-1,o=(n=t.length)-1;for(e=e===W?n:e;++i<e;){var n,s=t[n=Ue(i,o)];t[n]=t[i],t[i]=s}return t.length=e,t}function co(t){if("string"==typeof t||Go(t))return t;var e=t+"";return"0"==e&&1/t==-L?"-0":e}function ho(t){if(null!=t){try{return In.call(t)}catch(t){}return t+""}return""}function po(t,e){return r(j,function(i){var o="_."+i[0];e&i[1]&&!u(t,o)&&t.push(o)}),t.sort()}function fo(t){if(t instanceof Kt)return t.clone();var e=new w(t.__wrapped__,t.__chain__);return e.__actions__=fi(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function go(t,e,i){var o=null==t?0:t.length;return o?(0>(i=null==i?0:$o(i))&&(i=rs(o+i,0)),y(t,Yi(e,3),i)):-1}function _o(t,e,i){var o=null==t?0:t.length;if(!o)return-1;var n=o-1;return i!==W&&(n=$o(i),n=0>i?rs(o+n,0):as(n,o-1)),y(t,Yi(e,3),n,!0)}function yo(t){return null!=t&&t.length?de(t,1):[]}function mo(t){return t&&t.length?t[0]:W}function To(t){var e=null==t?0:t.length;return e?t[e-1]:W}function So(t,e){return t&&t.length&&e&&e.length?We(t,e):t}function Do(t){return null==t?t:hs.call(t)}function Ko(t){if(!t||!t.length)return[];var e=0;return t=l(t,function(t){if(Ho(t))return e=rs(t.length,e),!0}),A(e,function(e){return h(t,K(e))})}function wo(t,e){if(!t||!t.length)return[];var i=Ko(t);return null==e?i:h(i,function(t){return n(e,W,t)})}function bo(t){return(t=i(t)).__chain__=!0,t}function vo(t,e){return e(t)}function Ao(t,e){return(Ir(t)?r:xs)(t,Yi(e,3))}function Co(t,e){return(Ir(t)?function(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}:Is)(t,Yi(e,3))}function Oo(t,e){return(Ir(t)?h:Ee)(t,Yi(e,3))}function xo(t,e,i){return e=i?W:e,e=t&&null==e?t.length:e,ki(t,128,W,W,W,W,e)}function Io(t,e){var i;if("function"!=typeof e)throw new An("Expected a function");return t=$o(t),function(){return 0<--t&&(i=e.apply(this,arguments)),1>=t&&(e=W),i}}function Po(t,e,i){function o(e){var i=l,o=u;return l=u=W,f=e,h=t.apply(o,i)}function n(t){var i=t-d;return t-=f,d===W||i>=e||0>i||_&&t>=c}function s(){var t=mr();if(n(t))return r(t);var i,o=Ns;i=t-f,t=e-(t-d),i=_?as(t,c-i):t,p=o(s,i)}function r(t){return p=W,y&&l?o(t):(l=u=W,h)}function a(){var t=mr(),i=n(t);if(l=arguments,u=this,d=t,i){if(p===W)return f=t=d,p=Ns(s,e),g?o(t):h;if(_)return p=Ns(s,e),o(d)}return p===W&&(p=Ns(s,e)),h}var l,u,c,h,p,d,f=0,g=!1,_=!1,y=!0;if("function"!=typeof t)throw new An("Expected a function");return e=Jo(e)||0,Uo(i)&&(g=!!i.leading,c=(_="maxWait"in i)?rs(Jo(i.maxWait)||0,e):c,y="trailing"in i?!!i.trailing:y),a.cancel=function(){p!==W&&Ms(p),f=0,l=d=u=p=W},a.flush=function(){return p===W?h:r(mr())},a}function Eo(t,e){function i(){var o=arguments,n=e?e.apply(this,o):o[0],s=i.cache;return s.has(n)?s.get(n):(o=t.apply(this,o),i.cache=s.set(n,o)||s,o)}if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new An("Expected a function");return i.cache=new(Eo.Cache||Rt),i}function Ro(t){if("function"!=typeof t)throw new An("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Bo(t,e){return t===e||t!=t&&e!=e}function Mo(t){return null!=t&&Lo(t.length)&&!Fo(t)}function Ho(t){return jo(t)&&Mo(t)}function ko(t){if(!jo(t))return!1;var e=Te(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!zo(t)}function Fo(t){return!!Uo(t)&&("[object Function]"==(t=Te(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)}function Wo(t){return"number"==typeof t&&t==$o(t)}function Lo(t){return"number"==typeof t&&-1<t&&0==t%1&&9007199254740991>=t}function Uo(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function jo(t){return null!=t&&"object"==typeof t}function No(t){return"number"==typeof t||jo(t)&&"[object Number]"==Te(t)}function zo(t){return!(!jo(t)||"[object Object]"!=Te(t))&&(null===(t=jn(t))||"function"==typeof(t=Pn.call(t,"constructor")&&t.constructor)&&t instanceof t&&In.call(t)==Mn)}function Vo(t){return"string"==typeof t||!Ir(t)&&jo(t)&&"[object String]"==Te(t)}function Go(t){return"symbol"==typeof t||jo(t)&&"[object Symbol]"==Te(t)}function Yo(t){if(!t)return[];if(Mo(t))return Vo(t)?F(t):fi(t);if(Yn&&t[Yn]){t=t[Yn]();for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}return("[object Map]"==(e=Ls(t))?R:"[object Set]"==e?H:rn)(t)}function qo(t){return t?(t=Jo(t))===L||t===-L?1.7976931348623157e308*(0>t?-1:1):t==t?t:0:0===t?t:0}function $o(t){var e=(t=qo(t))%1;return t==t?e?t-e:t:0}function Xo(t){return t?se($o(t),0,4294967295):0}function Jo(t){if("number"==typeof t)return t;if(Go(t))return U;if(Uo(t)&&(t=Uo(t="function"==typeof t.valueOf?t.valueOf():t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;t=t.replace(nt,"");var e=gt.test(t);return e||yt.test(t)?Mt(t.slice(2),e?2:8):ft.test(t)?U:+t}function Zo(t){return gi(t,nn(t))}function Qo(t){return null==t?"":Je(t)}function tn(t,e,i){return(t=null==t?W:ye(t,e))===W?i:t}function en(t,e){return null!=t&&Ji(t,e,Ke)}function on(t){return Mo(t)?Wt(t):Ie(t)}function nn(t){if(Mo(t))t=Wt(t,!0);else if(Uo(t)){var e,i=no(t),o=[];for(e in t)("constructor"!=e||!i&&Pn.call(t,e))&&o.push(e);t=o}else{if(e=[],null!=t)for(i in wn(t))e.push(i);t=e}return t}function sn(t,e){if(null==t)return{};var i=h(zi(t),function(t){return[t]});return e=Yi(e),Fe(t,i,function(t,i){return e(t,i[0])})}function rn(t){return null==t?[]:O(t,on(t))}function an(t){return ua(Qo(t).toLowerCase())}function ln(t){return(t=Qo(t))&&t.replace(Tt,Jt).replace(vt,"")}function un(t,e,i){return t=Qo(t),(e=i?W:e)===W?xt.test(t)?t.match(Ct)||[]:t.match(ct)||[]:t.match(e)||[]}function cn(t){return function(){return t}}function hn(t){return t}function pn(t){return xe("function"==typeof t?t:re(t,1))}function dn(t,e,i){var o=on(e),n=_e(e,o);null!=i||Uo(e)&&(n.length||!o.length)||(i=e,e=t,t=this,n=_e(e,on(e)));var s=!(Uo(i)&&"chain"in i&&!i.chain),a=Fo(t);return r(n,function(i){var o=e[i];t[i]=o,a&&(t.prototype[i]=function(){var e=this.__chain__;if(s||e){var i=t(this.__wrapped__);return(i.__actions__=fi(this.__actions__)).push({func:o,args:arguments,thisArg:t}),i.__chain__=e,i}return o.apply(t,p([this.value()],arguments))})}),t}function fn(){}function gn(t){return io(t)?K(co(t)):function(t){return function(e){return ye(e,t)}}(t)}function _n(){return[]}function yn(){return!1}var mn=(e=null==e?Ft:te.defaults(Ft.Object(),e,te.pick(Ft,It))).Array,Tn=e.Date,Sn=e.Error,Dn=e.Function,Kn=e.Math,wn=e.Object,bn=e.RegExp,vn=e.String,An=e.TypeError,Cn=mn.prototype,On=wn.prototype,xn=e["__core-js_shared__"],In=Dn.prototype.toString,Pn=On.hasOwnProperty,En=0,Rn=function(){var t=/[^.]+$/.exec(xn&&xn.keys&&xn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bn=On.toString,Mn=In.call(wn),Hn=Ft._,kn=bn("^"+In.call(Pn).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fn=Ut?e.Buffer:W,Wn=e.Symbol,Ln=e.Uint8Array,Un=Fn?Fn.g:W,jn=B(wn.getPrototypeOf,wn),Nn=wn.create,zn=On.propertyIsEnumerable,Vn=Cn.splice,Gn=Wn?Wn.isConcatSpreadable:W,Yn=Wn?Wn.iterator:W,qn=Wn?Wn.toStringTag:W,$n=function(){try{var t=Xi(wn,"defineProperty");return t({},"",{}),t}catch(t){}}(),Xn=e.clearTimeout!==Ft.clearTimeout&&e.clearTimeout,Jn=Tn&&Tn.now!==Ft.Date.now&&Tn.now,Zn=e.setTimeout!==Ft.setTimeout&&e.setTimeout,Qn=Kn.ceil,ts=Kn.floor,es=wn.getOwnPropertySymbols,is=Fn?Fn.isBuffer:W,os=e.isFinite,ns=Cn.join,ss=B(wn.keys,wn),rs=Kn.max,as=Kn.min,ls=Tn.now,us=e.parseInt,cs=Kn.random,hs=Cn.reverse,ps=Xi(e,"DataView"),ds=Xi(e,"Map"),fs=Xi(e,"Promise"),gs=Xi(e,"Set"),_s=Xi(e,"WeakMap"),ys=Xi(wn,"create"),ms=_s&&new _s,Ts={},Ss=ho(ps),Ds=ho(ds),Ks=ho(fs),ws=ho(gs),bs=ho(_s),vs=Wn?Wn.prototype:W,As=vs?vs.valueOf:W,Cs=vs?vs.toString:W,Os=function(){function t(){}return function(e){return Uo(e)?Nn?Nn(e):(t.prototype=e,e=new t,t.prototype=W,e):{}}}();i.templateSettings={escape:X,evaluate:J,interpolate:Z,variable:"",imports:{_:i}},i.prototype=o.prototype,i.prototype.constructor=i,w.prototype=Os(o.prototype),w.prototype.constructor=w,Kt.prototype=Os(o.prototype),Kt.prototype.constructor=Kt,wt.prototype.clear=function(){this.__data__=ys?ys(null):{},this.size=0},wt.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},wt.prototype.get=function(t){var e=this.__data__;return ys?"__lodash_hash_undefined__"===(t=e[t])?W:t:Pn.call(e,t)?e[t]:W},wt.prototype.has=function(t){var e=this.__data__;return ys?e[t]!==W:Pn.call(e,t)},wt.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=ys&&e===W?"__lodash_hash_undefined__":e,this},At.prototype.clear=function(){this.__data__=[],this.size=0},At.prototype.delete=function(t){var e=this.__data__;return!(0>(t=Xt(e,t))||(t==e.length-1?e.pop():Vn.call(e,t,1),--this.size,0))},At.prototype.get=function(t){var e=this.__data__;return 0>(t=Xt(e,t))?W:e[t][1]},At.prototype.has=function(t){return-1<Xt(this.__data__,t)},At.prototype.set=function(t,e){var i=this.__data__,o=Xt(i,t);return 0>o?(++this.size,i.push([t,e])):i[o][1]=e,this},Rt.prototype.clear=function(){this.size=0,this.__data__={hash:new wt,map:new(ds||At),string:new wt}},Rt.prototype.delete=function(t){return t=qi(this,t).delete(t),this.size-=t?1:0,t},Rt.prototype.get=function(t){return qi(this,t).get(t)},Rt.prototype.has=function(t){return qi(this,t).has(t)},Rt.prototype.set=function(t,e){var i=qi(this,t),o=i.size;return i.set(t,e),this.size+=i.size==o?0:1,this},Ht.prototype.add=Ht.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ht.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.clear=function(){this.__data__=new At,this.size=0},kt.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},kt.prototype.get=function(t){return this.__data__.get(t)},kt.prototype.has=function(t){return this.__data__.has(t)},kt.prototype.set=function(t,e){var i=this.__data__;if(i instanceof At){var o=i.__data__;if(!ds||199>o.length)return o.push([t,e]),this.size=++i.size,this;i=this.__data__=new Rt(o)}return i.set(t,e),this.size=i.size,this};var xs=mi(fe),Is=mi(ge,!0),Ps=Ti(),Es=Ti(!0),Rs=ms?function(t,e){return ms.set(t,e),t}:hn,Bs=$n?function(t,e){return $n(t,"toString",{configurable:!0,enumerable:!1,value:cn(e),writable:!0})}:hn,Ms=Xn||function(t){return Ft.clearTimeout(t)},Hs=gs&&1/H(new gs([,-0]))[1]==L?function(t){return new gs(t)}:fn,ks=ms?function(t){return ms.get(t)}:fn,Fs=es?function(t){return null==t?[]:(t=wn(t),l(es(t),function(e){return zn.call(t,e)}))}:_n,Ws=es?function(t){for(var e=[];t;)p(e,Fs(t)),t=jn(t);return e}:_n,Ls=Te;(ps&&"[object DataView]"!=Ls(new ps(new ArrayBuffer(1)))||ds&&"[object Map]"!=Ls(new ds)||fs&&"[object Promise]"!=Ls(fs.resolve())||gs&&"[object Set]"!=Ls(new gs)||_s&&"[object WeakMap]"!=Ls(new _s))&&(Ls=function(t){var e=Te(t);if(t=(t="[object Object]"==e?t.constructor:W)?ho(t):"")switch(t){case Ss:return"[object DataView]";case Ds:return"[object Map]";case Ks:return"[object Promise]";case ws:return"[object Set]";case bs:return"[object WeakMap]"}return e});var Us=xn?Fo:yn,js=lo(Rs),Ns=Zn||function(t,e){return Ft.setTimeout(t,e)},zs=lo(Bs),Vs=function(t){var e=(t=Eo(t,function(t){return 500===e.size&&e.clear(),t})).cache;return t}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(et,function(t,i,o,n){e.push(o?n.replace(ht,"$1"):i||t)}),e}),Gs=Ne(function(t,e){return Ho(t)?ue(t,de(e,1,Ho,!0)):[]}),Ys=Ne(function(t,e){var i=To(e);return Ho(i)&&(i=W),Ho(t)?ue(t,de(e,1,Ho,!0),Yi(i,2)):[]}),qs=Ne(function(t,e){var i=To(e);return Ho(i)&&(i=W),Ho(t)?ue(t,de(e,1,Ho,!0),W,i):[]}),$s=Ne(function(t){var e=h(t,ni);return e.length&&e[0]===t[0]?we(e):[]}),Xs=Ne(function(t){var e=To(t),i=h(t,ni);return e===To(i)?e=W:i.pop(),i.length&&i[0]===t[0]?we(i,Yi(e,2)):[]}),Js=Ne(function(t){var e=To(t),i=h(t,ni);return(e="function"==typeof e?e:W)&&i.pop(),i.length&&i[0]===t[0]?we(i,W,e):[]}),Zs=Ne(So),Qs=ji(function(t,e){var i=null==t?0:t.length,o=ne(t,e);return Le(t,h(e,function(t){return to(t,i)?+t:t}).sort(hi)),o}),tr=Ne(function(t){return Ze(de(t,1,Ho,!0))}),er=Ne(function(t){var e=To(t);return Ho(e)&&(e=W),Ze(de(t,1,Ho,!0),Yi(e,2))}),ir=Ne(function(t){var e="function"==typeof(e=To(t))?e:W;return Ze(de(t,1,Ho,!0),W,e)}),or=Ne(function(t,e){return Ho(t)?ue(t,e):[]}),nr=Ne(function(t){return ii(l(t,Ho))}),sr=Ne(function(t){var e=To(t);return Ho(e)&&(e=W),ii(l(t,Ho),Yi(e,2))}),rr=Ne(function(t){var e="function"==typeof(e=To(t))?e:W;return ii(l(t,Ho),W,e)}),ar=Ne(Ko),lr=Ne(function(t){var e;return wo(t,e="function"==typeof(e=1<(e=t.length)?t[e-1]:W)?(t.pop(),e):W)}),ur=ji(function(t){function e(e){return ne(e,t)}var i=t.length,o=i?t[0]:0,n=this.__wrapped__;return!(1<i||this.__actions__.length)&&n instanceof Kt&&to(o)?((n=n.slice(o,+o+(i?1:0))).__actions__.push({func:vo,args:[e],thisArg:W}),new w(n,this.__chain__).thru(function(t){return i&&!t.length&&t.push(W),t})):this.thru(e)}),cr=_i(function(t,e,i){Pn.call(t,i)?++t[i]:oe(t,i,1)}),hr=bi(go),pr=bi(_o),dr=_i(function(t,e,i){Pn.call(t,i)?t[i].push(e):oe(t,i,[e])}),fr=Ne(function(t,e,i){var o=-1,s="function"==typeof e,r=Mo(t)?mn(t.length):[];return xs(t,function(t){r[++o]=s?n(e,t,i):be(t,e,i)}),r}),gr=_i(function(t,e,i){oe(t,i,e)}),_r=_i(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]}),yr=Ne(function(t,e){if(null==t)return[];var i=e.length;return 1<i&&eo(t,e[0],e[1])?e=[]:2<i&&eo(e[0],e[1],e[2])&&(e=[e[0]]),ke(t,de(e,1),[])}),mr=Jn||function(){return Ft.Date.now()},Tr=Ne(function(t,e,i){var o=1;if(i.length){var n=M(i,Gi(Tr));o=32|o}return ki(t,o,e,i,n)}),Sr=Ne(function(t,e,i){var o=3;if(i.length){var n=M(i,Gi(Sr));o=32|o}return ki(e,o,t,i,n)}),Dr=Ne(function(t,e){return le(t,1,e)}),Kr=Ne(function(t,e,i){return le(t,Jo(e)||0,i)});Eo.Cache=Rt;var wr=Ne(function(t,e){var i=(e=1==e.length&&Ir(e[0])?h(e[0],C(Yi())):h(de(e,1),C(Yi()))).length;return Ne(function(o){for(var s=-1,r=as(o.length,i);++s<r;)o[s]=e[s].call(this,o[s]);return n(t,this,o)})}),br=Ne(function(t,e){return ki(t,32,W,e,M(e,Gi(br)))}),vr=Ne(function(t,e){return ki(t,64,W,e,M(e,Gi(vr)))}),Ar=ji(function(t,e){return ki(t,256,W,W,W,e)}),Cr=Ri(Se),Or=Ri(function(t,e){return t>=e}),xr=ve(function(){return arguments}())?ve:function(t){return jo(t)&&Pn.call(t,"callee")&&!zn.call(t,"callee")},Ir=mn.isArray,Pr=zt?C(zt):function(t){return jo(t)&&"[object ArrayBuffer]"==Te(t)},Er=is||yn,Rr=Vt?C(Vt):function(t){return jo(t)&&"[object Date]"==Te(t)},Br=Gt?C(Gt):function(t){return jo(t)&&"[object Map]"==Ls(t)},Mr=Yt?C(Yt):function(t){return jo(t)&&"[object RegExp]"==Te(t)},Hr=qt?C(qt):function(t){return jo(t)&&"[object Set]"==Ls(t)},kr=$t?C($t):function(t){return jo(t)&&Lo(t.length)&&!!Pt[Te(t)]},Fr=Ri(Pe),Wr=Ri(function(t,e){return t<=e}),Lr=yi(function(t,e){if(no(e)||Mo(e))gi(e,on(e),t);else for(var i in e)Pn.call(e,i)&&Nt(t,i,e[i])}),Ur=yi(function(t,e){gi(e,nn(e),t)}),jr=yi(function(t,e,i,o){gi(e,nn(e),t,o)}),Nr=yi(function(t,e,i,o){gi(e,on(e),t,o)}),zr=ji(ne),Vr=Ne(function(t,e){t=wn(t);var i=-1,o=e.length;for((n=2<o?e[2]:W)&&eo(e[0],e[1],n)&&(o=1);++i<o;)for(var n,s=nn(n=e[i]),r=-1,a=s.length;++r<a;){var l=s[r],u=t[l];(u===W||Bo(u,On[l])&&!Pn.call(t,l))&&(t[l]=n[l])}return t}),Gr=Ne(function(t){return t.push(W,Wi),n(Jr,W,t)}),Yr=Ci(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Bn.call(e)),t[e]=i},cn(hn)),qr=Ci(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Bn.call(e)),Pn.call(t,e)?t[e].push(i):t[e]=[i]},Yi),$r=Ne(be),Xr=yi(function(t,e,i){Me(t,e,i)}),Jr=yi(function(t,e,i,o){Me(t,e,i,o)}),Zr=ji(function(t,e){var i={};if(null==t)return i;var o=!1;e=h(e,function(e){return e=ri(e,t),o||(o=1<e.length),e}),gi(t,zi(t),i),o&&(i=re(i,7,Li));for(var n=e.length;n--;)Qe(i,e[n]);return i}),Qr=ji(function(t,e){return null==t?{}:function(t,e){return Fe(t,e,function(e,i){return en(t,i)})}(t,e)}),ta=Hi(on),ea=Hi(nn),ia=Di(function(t,e,i){return e=e.toLowerCase(),t+(i?an(e):e)}),oa=Di(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),na=Di(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),sa=Si("toLowerCase"),ra=Di(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}),aa=Di(function(t,e,i){return t+(i?" ":"")+ua(e)}),la=Di(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),ua=Si("toUpperCase"),ca=Ne(function(t,e){try{return n(t,W,e)}catch(t){return ko(t)?t:new Sn(t)}}),ha=ji(function(t,e){return r(e,function(e){e=co(e),oe(t,e,Tr(t[e],t))}),t}),pa=vi(),da=vi(!0),fa=Ne(function(t,e){return function(i){return be(i,t,e)}}),ga=Ne(function(t,e){return function(i){return be(t,i,e)}}),_a=xi(h),ya=xi(a),ma=xi(g),Ta=Ei(),Sa=Ei(!0),Da=Oi(function(t,e){return t+e},0),Ka=Mi("ceil"),wa=Oi(function(t,e){return t/e},1),ba=Mi("floor"),va=Oi(function(t,e){return t*e},1),Aa=Mi("round"),Ca=Oi(function(t,e){return t-e},0);return i.after=function(t,e){if("function"!=typeof e)throw new An("Expected a function");return t=$o(t),function(){if(1>--t)return e.apply(this,arguments)}},i.ary=xo,i.assign=Lr,i.assignIn=Ur,i.assignInWith=jr,i.assignWith=Nr,i.at=zr,i.before=Io,i.bind=Tr,i.bindAll=ha,i.bindKey=Sr,i.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Ir(t)?t:[t]},i.chain=bo,i.chunk=function(t,e,i){if(e=(i?eo(t,e,i):e===W)?1:rs($o(e),0),!(i=null==t?0:t.length)||1>e)return[];for(var o=0,n=0,s=mn(Qn(i/e));o<i;)s[n++]=Ve(t,o,o+=e);return s},i.compact=function(t){for(var e=-1,i=null==t?0:t.length,o=0,n=[];++e<i;){var s=t[e];s&&(n[o++]=s)}return n},i.concat=function(){var t=arguments.length;if(!t)return[];for(var e=mn(t-1),i=arguments[0];t--;)e[t-1]=arguments[t];return p(Ir(i)?fi(i):[i],de(e,1))},i.cond=function(t){var e=null==t?0:t.length,i=Yi();return t=e?h(t,function(t){if("function"!=typeof t[1])throw new An("Expected a function");return[i(t[0]),t[1]]}):[],Ne(function(i){for(var o=-1;++o<e;){var s=t[o];if(n(s[0],this,i))return n(s[1],this,i)}})},i.conforms=function(t){return function(t){var e=on(t);return function(i){return ae(i,t,e)}}(re(t,1))},i.constant=cn,i.countBy=cr,i.create=function(t,e){var i=Os(t);return null==e?i:ie(i,e)},i.curry=function t(e,i,o){return(e=ki(e,8,W,W,W,W,W,i=o?W:i)).placeholder=t.placeholder,e},i.curryRight=function t(e,i,o){return(e=ki(e,16,W,W,W,W,W,i=o?W:i)).placeholder=t.placeholder,e},i.debounce=Po,i.defaults=Vr,i.defaultsDeep=Gr,i.defer=Dr,i.delay=Kr,i.difference=Gs,i.differenceBy=Ys,i.differenceWith=qs,i.drop=function(t,e,i){var o=null==t?0:t.length;return o?Ve(t,0>(e=i||e===W?1:$o(e))?0:e,o):[]},i.dropRight=function(t,e,i){var o=null==t?0:t.length;return o?Ve(t,0,0>(e=o-(e=i||e===W?1:$o(e)))?0:e):[]},i.dropRightWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3),!0,!0):[]},i.dropWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3),!0):[]},i.fill=function(t,e,i,o){var n=null==t?0:t.length;if(!n)return[];for(i&&"number"!=typeof i&&eo(t,e,i)&&(i=0,o=n),n=t.length,0>(i=$o(i))&&(i=-i>n?0:n+i),0>(o=o===W||o>n?n:$o(o))&&(o+=n),o=i>o?0:Xo(o);i<o;)t[i++]=e;return t},i.filter=function(t,e){return(Ir(t)?l:pe)(t,Yi(e,3))},i.flatMap=function(t,e){return de(Oo(t,e),1)},i.flatMapDeep=function(t,e){return de(Oo(t,e),L)},i.flatMapDepth=function(t,e,i){return i=i===W?1:$o(i),de(Oo(t,e),i)},i.flatten=yo,i.flattenDeep=function(t){return null!=t&&t.length?de(t,L):[]},i.flattenDepth=function(t,e){return null!=t&&t.length?de(t,e=e===W?1:$o(e)):[]},i.flip=function(t){return ki(t,512)},i.flow=pa,i.flowRight=da,i.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,o={};++e<i;){var n=t[e];o[n[0]]=n[1]}return o},i.functions=function(t){return null==t?[]:_e(t,on(t))},i.functionsIn=function(t){return null==t?[]:_e(t,nn(t))},i.groupBy=dr,i.initial=function(t){return null!=t&&t.length?Ve(t,0,-1):[]},i.intersection=$s,i.intersectionBy=Xs,i.intersectionWith=Js,i.invert=Yr,i.invertBy=qr,i.invokeMap=fr,i.iteratee=pn,i.keyBy=gr,i.keys=on,i.keysIn=nn,i.map=Oo,i.mapKeys=function(t,e){var i={};return e=Yi(e,3),fe(t,function(t,o,n){oe(i,e(t,o,n),t)}),i},i.mapValues=function(t,e){var i={};return e=Yi(e,3),fe(t,function(t,o,n){oe(i,o,e(t,o,n))}),i},i.matches=function(t){return Re(re(t,1))},i.matchesProperty=function(t,e){return Be(t,re(e,1))},i.memoize=Eo,i.merge=Xr,i.mergeWith=Jr,i.method=fa,i.methodOf=ga,i.mixin=dn,i.negate=Ro,i.nthArg=function(t){return t=$o(t),Ne(function(e){return He(e,t)})},i.omit=Zr,i.omitBy=function(t,e){return sn(t,Ro(Yi(e)))},i.once=function(t){return Io(2,t)},i.orderBy=function(t,e,i,o){return null==t?[]:(Ir(e)||(e=null==e?[]:[e]),Ir(i=o?W:i)||(i=null==i?[]:[i]),ke(t,e,i))},i.over=_a,i.overArgs=wr,i.overEvery=ya,i.overSome=ma,i.partial=br,i.partialRight=vr,i.partition=_r,i.pick=Qr,i.pickBy=sn,i.property=gn,i.propertyOf=function(t){return function(e){return null==t?W:ye(t,e)}},i.pull=Zs,i.pullAll=So,i.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?We(t,e,Yi(i,2)):t},i.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?We(t,e,W,i):t},i.pullAt=Qs,i.range=Ta,i.rangeRight=Sa,i.rearg=Ar,i.reject=function(t,e){return(Ir(t)?l:pe)(t,Ro(Yi(e,3)))},i.remove=function(t,e){var i=[];if(!t||!t.length)return i;var o=-1,n=[],s=t.length;for(e=Yi(e,3);++o<s;){var r=t[o];e(r,o,t)&&(i.push(r),n.push(o))}return Le(t,n),i},i.rest=function(t,e){if("function"!=typeof t)throw new An("Expected a function");return Ne(t,e=e===W?e:$o(e))},i.reverse=Do,i.sampleSize=function(t,e,i){return e=(i?eo(t,e,i):e===W)?1:$o(e),(Ir(t)?function(t,e){return uo(fi(t),se(e,0,t.length))}:function(t,e){var i=rn(t);return uo(i,se(e,0,i.length))})(t,e)},i.set=function(t,e,i){return null==t?t:ze(t,e,i)},i.setWith=function(t,e,i,o){return o="function"==typeof o?o:W,null==t?t:ze(t,e,i,o)},i.shuffle=function(t){return(Ir(t)?function(t){return uo(fi(t))}:function(t){return uo(rn(t))})(t)},i.slice=function(t,e,i){var o=null==t?0:t.length;return o?(i&&"number"!=typeof i&&eo(t,e,i)?(e=0,i=o):(e=null==e?0:$o(e),i=i===W?o:$o(i)),Ve(t,e,i)):[]},i.sortBy=yr,i.sortedUniq=function(t){return t&&t.length?$e(t):[]},i.sortedUniqBy=function(t,e){return t&&t.length?$e(t,Yi(e,2)):[]},i.split=function(t,e,i){return i&&"number"!=typeof i&&eo(t,e,i)&&(e=i=W),(i=i===W?4294967295:i>>>0)?(t=Qo(t))&&("string"==typeof e||null!=e&&!Mr(e))&&(!(e=Je(e))&&Ot.test(t))?ai(F(t),0,i):t.split(e,i):[]},i.spread=function(t,e){if("function"!=typeof t)throw new An("Expected a function");return e=null==e?0:rs($o(e),0),Ne(function(i){var o=i[e];return i=ai(i,0,e),o&&p(i,o),n(t,this,i)})},i.tail=function(t){var e=null==t?0:t.length;return e?Ve(t,1,e):[]},i.take=function(t,e,i){return t&&t.length?Ve(t,0,0>(e=i||e===W?1:$o(e))?0:e):[]},i.takeRight=function(t,e,i){var o=null==t?0:t.length;return o?Ve(t,0>(e=o-(e=i||e===W?1:$o(e)))?0:e,o):[]},i.takeRightWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3),!1,!0):[]},i.takeWhile=function(t,e){return t&&t.length?ti(t,Yi(e,3)):[]},i.tap=function(t,e){return e(t),t},i.throttle=function(t,e,i){var o=!0,n=!0;if("function"!=typeof t)throw new An("Expected a function");return Uo(i)&&(o="leading"in i?!!i.leading:o,n="trailing"in i?!!i.trailing:n),Po(t,e,{leading:o,maxWait:e,trailing:n})},i.thru=vo,i.toArray=Yo,i.toPairs=ta,i.toPairsIn=ea,i.toPath=function(t){return Ir(t)?h(t,co):Go(t)?[t]:fi(Vs(Qo(t)))},i.toPlainObject=Zo,i.transform=function(t,e,i){var o=Ir(t),n=o||Er(t)||kr(t);if(e=Yi(e,4),null==i){var s=t&&t.constructor;i=n?o?new s:[]:Uo(t)&&Fo(s)?Os(jn(t)):{}}return(n?r:fe)(t,function(t,o,n){return e(i,t,o,n)}),i},i.unary=function(t){return xo(t,1)},i.union=tr,i.unionBy=er,i.unionWith=ir,i.uniq=function(t){return t&&t.length?Ze(t):[]},i.uniqBy=function(t,e){return t&&t.length?Ze(t,Yi(e,2)):[]},i.uniqWith=function(t,e){return e="function"==typeof e?e:W,t&&t.length?Ze(t,W,e):[]},i.unset=function(t,e){return null==t||Qe(t,e)},i.unzip=Ko,i.unzipWith=wo,i.update=function(t,e,i){return null==t?t:ze(t,e,si(i)(ye(t,e)),void 0)},i.updateWith=function(t,e,i,o){return o="function"==typeof o?o:W,null!=t&&(t=ze(t,e,si(i)(ye(t,e)),o)),t},i.values=rn,i.valuesIn=function(t){return null==t?[]:O(t,nn(t))},i.without=or,i.words=un,i.wrap=function(t,e){return br(si(e),t)},i.xor=nr,i.xorBy=sr,i.xorWith=rr,i.zip=ar,i.zipObject=function(t,e){return oi(t||[],e||[],Nt)},i.zipObjectDeep=function(t,e){return oi(t||[],e||[],ze)},i.zipWith=lr,i.entries=ta,i.entriesIn=ea,i.extend=Ur,i.extendWith=jr,dn(i,i),i.add=Da,i.attempt=ca,i.camelCase=ia,i.capitalize=an,i.ceil=Ka,i.clamp=function(t,e,i){return i===W&&(i=e,e=W),i!==W&&(i=(i=Jo(i))==i?i:0),e!==W&&(e=(e=Jo(e))==e?e:0),se(Jo(t),e,i)},i.clone=function(t){return re(t,4)},i.cloneDeep=function(t){return re(t,5)},i.cloneDeepWith=function(t,e){return re(t,5,e="function"==typeof e?e:W)},i.cloneWith=function(t,e){return re(t,4,e="function"==typeof e?e:W)},i.conformsTo=function(t,e){return null==e||ae(t,e,on(e))},i.deburr=ln,i.defaultTo=function(t,e){return null==t||t!=t?e:t},i.divide=wa,i.endsWith=function(t,e,i){t=Qo(t),e=Je(e);var o=t.length;o=i=i===W?o:se($o(i),0,o);return 0<=(i-=e.length)&&t.slice(i,o)==e},i.eq=Bo,i.escape=function(t){return(t=Qo(t))&&$.test(t)?t.replace(Y,Zt):t},i.escapeRegExp=function(t){return(t=Qo(t))&&ot.test(t)?t.replace(it,"\\$&"):t},i.every=function(t,e,i){var o=Ir(t)?a:ce;return i&&eo(t,e,i)&&(e=W),o(t,Yi(e,3))},i.find=hr,i.findIndex=go,i.findKey=function(t,e){return _(t,Yi(e,3),fe)},i.findLast=pr,i.findLastIndex=_o,i.findLastKey=function(t,e){return _(t,Yi(e,3),ge)},i.floor=ba,i.forEach=Ao,i.forEachRight=Co,i.forIn=function(t,e){return null==t?t:Ps(t,Yi(e,3),nn)},i.forInRight=function(t,e){return null==t?t:Es(t,Yi(e,3),nn)},i.forOwn=function(t,e){return t&&fe(t,Yi(e,3))},i.forOwnRight=function(t,e){return t&&ge(t,Yi(e,3))},i.get=tn,i.gt=Cr,i.gte=Or,i.has=function(t,e){return null!=t&&Ji(t,e,De)},i.hasIn=en,i.head=mo,i.identity=hn,i.includes=function(t,e,i,o){return t=Mo(t)?t:rn(t),i=i&&!o?$o(i):0,o=t.length,0>i&&(i=rs(o+i,0)),Vo(t)?i<=o&&-1<t.indexOf(e,i):!!o&&-1<m(t,e,i)},i.indexOf=function(t,e,i){var o=null==t?0:t.length;return o?(0>(i=null==i?0:$o(i))&&(i=rs(o+i,0)),m(t,e,i)):-1},i.inRange=function(t,e,i){return e=qo(e),i===W?(i=e,e=0):i=qo(i),(t=Jo(t))>=as(e,i)&&t<rs(e,i)},i.invoke=$r,i.isArguments=xr,i.isArray=Ir,i.isArrayBuffer=Pr,i.isArrayLike=Mo,i.isArrayLikeObject=Ho,i.isBoolean=function(t){return!0===t||!1===t||jo(t)&&"[object Boolean]"==Te(t)},i.isBuffer=Er,i.isDate=Rr,i.isElement=function(t){return jo(t)&&1===t.nodeType&&!zo(t)},i.isEmpty=function(t){if(null==t)return!0;if(Mo(t)&&(Ir(t)||"string"==typeof t||"function"==typeof t.splice||Er(t)||kr(t)||xr(t)))return!t.length;var e=Ls(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(no(t))return!Ie(t).length;for(var i in t)if(Pn.call(t,i))return!1;return!0},i.isEqual=function(t,e){return Ae(t,e)},i.isEqualWith=function(t,e,i){var o=(i="function"==typeof i?i:W)?i(t,e):W;return o===W?Ae(t,e,W,i):!!o},i.isError=ko,i.isFinite=function(t){return"number"==typeof t&&os(t)},i.isFunction=Fo,i.isInteger=Wo,i.isLength=Lo,i.isMap=Br,i.isMatch=function(t,e){return t===e||Ce(t,e,$i(e))},i.isMatchWith=function(t,e,i){return i="function"==typeof i?i:W,Ce(t,e,$i(e),i)},i.isNaN=function(t){return No(t)&&t!=+t},i.isNative=function(t){if(Us(t))throw new Sn("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Oe(t)},i.isNil=function(t){return null==t},i.isNull=function(t){return null===t},i.isNumber=No,i.isObject=Uo,i.isObjectLike=jo,i.isPlainObject=zo,i.isRegExp=Mr,i.isSafeInteger=function(t){return Wo(t)&&-9007199254740991<=t&&9007199254740991>=t},i.isSet=Hr,i.isString=Vo,i.isSymbol=Go,i.isTypedArray=kr,i.isUndefined=function(t){return t===W},i.isWeakMap=function(t){return jo(t)&&"[object WeakMap]"==Ls(t)},i.isWeakSet=function(t){return jo(t)&&"[object WeakSet]"==Te(t)},i.join=function(t,e){return null==t?"":ns.call(t,e)},i.kebabCase=oa,i.last=To,i.lastIndexOf=function(t,e,i){var o=null==t?0:t.length;if(!o)return-1;var n=o;if(i!==W&&(n=0>(n=$o(i))?rs(o+n,0):as(n,o-1)),e==e){for(i=n+1;i--&&t[i]!==e;);t=i}else t=y(t,S,n,!0);return t},i.lowerCase=na,i.lowerFirst=sa,i.lt=Fr,i.lte=Wr,i.max=function(t){return t&&t.length?he(t,hn,Se):W},i.maxBy=function(t,e){return t&&t.length?he(t,Yi(e,2),Se):W},i.mean=function(t){return D(t,hn)},i.meanBy=function(t,e){return D(t,Yi(e,2))},i.min=function(t){return t&&t.length?he(t,hn,Pe):W},i.minBy=function(t,e){return t&&t.length?he(t,Yi(e,2),Pe):W},i.stubArray=_n,i.stubFalse=yn,i.stubObject=function(){return{}},i.stubString=function(){return""},i.stubTrue=function(){return!0},i.multiply=va,i.nth=function(t,e){return t&&t.length?He(t,$o(e)):W},i.noConflict=function(){return Ft._===this&&(Ft._=Hn),this},i.noop=fn,i.now=mr,i.pad=function(t,e,i){t=Qo(t);var o=(e=$o(e))?k(t):0;return!e||o>=e?t:Ii(ts(e=(e-o)/2),i)+t+Ii(Qn(e),i)},i.padEnd=function(t,e,i){t=Qo(t);var o=(e=$o(e))?k(t):0;return e&&o<e?t+Ii(e-o,i):t},i.padStart=function(t,e,i){t=Qo(t);var o=(e=$o(e))?k(t):0;return e&&o<e?Ii(e-o,i)+t:t},i.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),us(Qo(t).replace(st,""),e||0)},i.random=function(t,e,i){if(i&&"boolean"!=typeof i&&eo(t,e,i)&&(e=i=W),i===W&&("boolean"==typeof e?(i=e,e=W):"boolean"==typeof t&&(i=t,t=W)),t===W&&e===W?(t=0,e=1):(t=qo(t),e===W?(e=t,t=0):e=qo(e)),t>e){var o=t;t=e,e=o}return i||t%1||e%1?(i=cs(),as(t+i*(e-t+Bt("1e-"+((i+"").length-1))),e)):Ue(t,e)},i.reduce=function(t,e,i){var o=Ir(t)?d:b,n=3>arguments.length;return o(t,Yi(e,4),i,n,xs)},i.reduceRight=function(t,e,i){var o=Ir(t)?f:b,n=3>arguments.length;return o(t,Yi(e,4),i,n,Is)},i.repeat=function(t,e,i){return e=(i?eo(t,e,i):e===W)?1:$o(e),je(Qo(t),e)},i.replace=function(){var t=arguments,e=Qo(t[0]);return 3>t.length?e:e.replace(t[1],t[2])},i.result=function(t,e,i){var o=-1,n=(e=ri(e,t)).length;for(n||(n=1,t=W);++o<n;){var s=null==t?W:t[co(e[o])];s===W&&(o=n,s=i),t=Fo(s)?s.call(t):s}return t},i.round=Aa,i.runInContext=t,i.sample=function(t){return(Ir(t)?Lt:function(t){return Lt(rn(t))})(t)},i.size=function(t){if(null==t)return 0;if(Mo(t))return Vo(t)?k(t):t.length;var e=Ls(t);return"[object Map]"==e||"[object Set]"==e?t.size:Ie(t).length},i.snakeCase=ra,i.some=function(t,e,i){var o=Ir(t)?g:Ge;return i&&eo(t,e,i)&&(e=W),o(t,Yi(e,3))},i.sortedIndex=function(t,e){return Ye(t,e)},i.sortedIndexBy=function(t,e,i){return qe(t,e,Yi(i,2))},i.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var o=Ye(t,e);if(o<i&&Bo(t[o],e))return o}return-1},i.sortedLastIndex=function(t,e){return Ye(t,e,!0)},i.sortedLastIndexBy=function(t,e,i){return qe(t,e,Yi(i,2),!0)},i.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=Ye(t,e,!0)-1;if(Bo(t[i],e))return i}return-1},i.startCase=aa,i.startsWith=function(t,e,i){return t=Qo(t),i=null==i?0:se($o(i),0,t.length),e=Je(e),t.slice(i,i+e.length)==e},i.subtract=Ca,i.sum=function(t){return t&&t.length?v(t,hn):0},i.sumBy=function(t,e){return t&&t.length?v(t,Yi(e,2)):0},i.template=function(t,e,o){var n=i.templateSettings;o&&eo(t,e,o)&&(e=W),t=Qo(t),e=jr({},e,n,Fi);var s,r,a=on(o=jr({},e.imports,n.imports,Fi)),l=O(o,a),u=0;o=e.interpolate||St;var c="__p+='";o=bn((e.escape||St).source+"|"+o.source+"|"+(o===Z?pt:St).source+"|"+(e.evaluate||St).source+"|$","g");var h="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";if(t.replace(o,function(e,i,o,n,a,l){return o||(o=n),c+=t.slice(u,l).replace(Dt,E),i&&(s=!0,c+="'+__e("+i+")+'"),a&&(r=!0,c+="';"+a+";\n__p+='"),o&&(c+="'+((__t=("+o+"))==null?'':__t)+'"),u=l+e.length,e}),c+="';",(e=e.variable)||(c="with(obj){"+c+"}"),c=(r?c.replace(N,""):c).replace(z,"$1").replace(V,"$1;"),c="function("+(e||"obj")+"){"+(e?"":"obj||(obj={});")+"var __t,__p=''"+(s?",__e=_.escape":"")+(r?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+c+"return __p}",(e=ca(function(){return Dn(a,h+"return "+c).apply(W,l)})).source=c,ko(e))throw e;return e},i.times=function(t,e){if(1>(t=$o(t))||9007199254740991<t)return[];var i=4294967295,o=as(t,4294967295);for(t-=4294967295,o=A(o,e=Yi(e));++i<t;)e(i);return o},i.toFinite=qo,i.toInteger=$o,i.toLength=Xo,i.toLower=function(t){return Qo(t).toLowerCase()},i.toNumber=Jo,i.toSafeInteger=function(t){return t?se($o(t),-9007199254740991,9007199254740991):0===t?t:0},i.toString=Qo,i.toUpper=function(t){return Qo(t).toUpperCase()},i.trim=function(t,e,i){return(t=Qo(t))&&(i||e===W)?t.replace(nt,""):t&&(e=Je(e))?ai(t=F(t),e=I(t,i=F(e)),i=P(t,i)+1).join(""):t},i.trimEnd=function(t,e,i){return(t=Qo(t))&&(i||e===W)?t.replace(rt,""):t&&(e=Je(e))?ai(t=F(t),0,e=P(t,F(e))+1).join(""):t},i.trimStart=function(t,e,i){return(t=Qo(t))&&(i||e===W)?t.replace(st,""):t&&(e=Je(e))?ai(t=F(t),e=I(t,F(e))).join(""):t},i.truncate=function(t,e){var i=30,o="...";if(Uo(e)){var n="separator"in e?e.separator:n;i="length"in e?$o(e.length):i,o="omission"in e?Je(e.omission):o}var s=(t=Qo(t)).length;if(Ot.test(t)){var r=F(t);s=r.length}if(i>=s)return t;if(1>(s=i-k(o)))return o;if(i=r?ai(r,0,s).join(""):t.slice(0,s),n===W)return i+o;if(r&&(s+=i.length-s),Mr(n)){if(t.slice(s).search(n)){var a=i;for(n.global||(n=bn(n.source,Qo(dt.exec(n))+"g")),n.lastIndex=0;r=n.exec(a);)var l=r.index;i=i.slice(0,l===W?s:l)}}else t.indexOf(Je(n),s)!=s&&(-1<(n=i.lastIndexOf(n))&&(i=i.slice(0,n)));return i+o},i.unescape=function(t){return(t=Qo(t))&&q.test(t)?t.replace(G,Qt):t},i.uniqueId=function(t){var e=++En;return Qo(t)+e},i.upperCase=la,i.upperFirst=ua,i.each=Ao,i.eachRight=Co,i.first=mo,dn(i,function(){var t={};return fe(i,function(e,o){Pn.call(i.prototype,o)||(t[o]=e)}),t}(),{chain:!1}),i.VERSION="4.17.10",r("bind bindKey curry curryRight partial partialRight".split(" "),function(t){i[t].placeholder=i}),r(["drop","take"],function(t,e){Kt.prototype[t]=function(i){i=i===W?1:rs($o(i),0);var o=this.__filtered__&&!e?new Kt(this):this.clone();return o.__filtered__?o.__takeCount__=as(i,o.__takeCount__):o.__views__.push({size:as(i,4294967295),type:t+(0>o.__dir__?"Right":"")}),o},Kt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),r(["filter","map","takeWhile"],function(t,e){var i=e+1,o=1==i||3==i;Kt.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Yi(t,3),type:i}),e.__filtered__=e.__filtered__||o,e}}),r(["head","last"],function(t,e){var i="take"+(e?"Right":"");Kt.prototype[t]=function(){return this[i](1).value()[0]}}),r(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");Kt.prototype[t]=function(){return this.__filtered__?new Kt(this):this[i](1)}}),Kt.prototype.compact=function(){return this.filter(hn)},Kt.prototype.find=function(t){return this.filter(t).head()},Kt.prototype.findLast=function(t){return this.reverse().find(t)},Kt.prototype.invokeMap=Ne(function(t,e){return"function"==typeof t?new Kt(this):this.map(function(i){return be(i,t,e)})}),Kt.prototype.reject=function(t){return this.filter(Ro(Yi(t)))},Kt.prototype.slice=function(t,e){t=$o(t);var i=this;return i.__filtered__&&(0<t||0>e)?new Kt(i):(0>t?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==W&&(i=0>(e=$o(e))?i.dropRight(-e):i.take(e-t)),i)},Kt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Kt.prototype.toArray=function(){return this.take(4294967295)},fe(Kt.prototype,function(t,e){var o=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),s=i[n?"take"+("last"==e?"Right":""):e],r=n||/^find/.test(e);s&&(i.prototype[e]=function(){function e(t){return t=s.apply(i,p([t],l)),n&&d?t[0]:t}var a=this.__wrapped__,l=n?[1]:arguments,u=a instanceof Kt,c=l[0],h=u||Ir(a);h&&o&&"function"==typeof c&&1!=c.length&&(u=h=!1);var d=this.__chain__,f=!!this.__actions__.length;c=r&&!d,u=u&&!f;return!r&&h?(a=u?a:new Kt(this),(a=t.apply(a,l)).__actions__.push({func:vo,args:[e],thisArg:W}),new w(a,d)):c&&u?t.apply(this,l):(a=this.thru(e),c?n?a.value()[0]:a.value():a)})}),r("pop push shift sort splice unshift".split(" "),function(t){var e=Cn[t],o=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);i.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var i=this.value();return e.apply(Ir(i)?i:[],t)}return this[o](function(i){return e.apply(Ir(i)?i:[],t)})}}),fe(Kt.prototype,function(t,e){var o=i[e];if(o){var n=o.name+"";(Ts[n]||(Ts[n]=[])).push({name:e,func:o})}}),Ts[Ai(W,2).name]=[{name:"wrapper",func:W}],Kt.prototype.clone=function(){var t=new Kt(this.__wrapped__);return t.__actions__=fi(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=fi(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=fi(this.__views__),t},Kt.prototype.reverse=function(){if(this.__filtered__){var t=new Kt(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Kt.prototype.value=function(){var t,e=this.__wrapped__.value(),i=this.__dir__,o=Ir(e),n=0>i,s=o?e.length:0;t=s;for(var r=this.__views__,a=0,l=-1,u=r.length;++l<u;){var c=r[l],h=c.size;switch(c.type){case"drop":a+=h;break;case"dropRight":t-=h;break;case"take":t=as(t,a+h);break;case"takeRight":a=rs(a,t-h)}}if(r=(t={start:a,end:t}).start,t=(a=t.end)-r,r=n?a:r-1,l=(a=this.__iteratees__).length,u=0,c=as(t,this.__takeCount__),!o||!n&&s==t&&c==t)return ei(e,this.__actions__);o=[];t:for(;t--&&u<c;){for(n=-1,s=e[r+=i];++n<l;){h=(p=a[n]).type;var p=(0,p.iteratee)(s);if(2==h)s=p;else if(!p){if(1==h)continue t;break t}}o[u++]=s}return o},i.prototype.at=ur,i.prototype.chain=function(){return bo(this)},i.prototype.commit=function(){return new w(this.value(),this.__chain__)},i.prototype.next=function(){this.__values__===W&&(this.__values__=Yo(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?W:this.__values__[this.__index__++]}},i.prototype.plant=function(t){for(var e,i=this;i instanceof o;){var n=fo(i);n.__index__=0,n.__values__=W,e?s.__wrapped__=n:e=n;var s=n;i=i.__wrapped__}return s.__wrapped__=t,e},i.prototype.reverse=function(){var t=this.__wrapped__;return t instanceof Kt?(this.__actions__.length&&(t=new Kt(this)),(t=t.reverse()).__actions__.push({func:vo,args:[Do],thisArg:W}),new w(t,this.__chain__)):this.thru(Do)},i.prototype.toJSON=i.prototype.valueOf=i.prototype.value=function(){return ei(this.__wrapped__,this.__actions__)},i.prototype.first=i.prototype.head,Yn&&(i.prototype[Yn]=function(){return this}),i}();Ft._=te,void 0===(o=function(){return te}.call(e,i,e,t))||(t.exports=o)}.call(this),window.DKTools={},Object.defineProperties(DKTools,{SITE:{value:"https://dk-plugins.ru"},VERSION:{value:Imported.DKTools}}),DKTools.Sprite=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.Button=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.Cursor=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.Arrow=function(t,e){this.initialize.apply(this,arguments)},DKTools.Sprite.Selectable=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.ProgressBar=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.ProgressBar.Rectangle=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.ProgressBar.Circle=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.ProgressBar.SemiCircle=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Sprite.CheckBox=function(t,e){this.initialize.apply(this,arguments)},DKTools.Viewport=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Layout=function(t,e){this.initialize.apply(this,arguments)},DKTools.Window=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Window.Selectable=function(t,e,i,o){this.initialize.apply(this,arguments)},DKTools.Scene=function(){this.initialize.apply(this,arguments)},DKTools.Utils=class{constructor(){return DKTools.Utils}static initialize(){this._saidHello=!1,this._isNwjs=Utils.isNwjs(),this._isTest=!!Utils.isOptionValid("test"),this._isMobileDevice=Utils.isMobileDevice(),this._isMobileSafari=Utils.isMobileSafari(),this._isAndroidChrome=Utils.isAndroidChrome(),this._gridSize=64,this._sayHello(),this.__tileSize(),n.get("Debugging Console","Enabled")&&this.openConsole(),n.get("Check Updates","Enabled")&&this._checkUpdates()}static _checkRPGMakerVersion(){if(Utils.RPGMAKER_VERSION<"1.6.0")throw Error("Required to update RPG Maker MV to minimal version 1.6.0 (Installed: %1)".format(Utils.RPGMAKER_VERSION))}static async _checkUpdates(){if(!this.isNwjs()||!this.isTest())return;let t=[];try{const e=new FormData;e.append("version",DKTools.VERSION),t=await DKTools.Network.fetchJson(`${DKTools.SITE}/plugins.php`,{method:"POST",body:e})}catch(t){return void console.error("DKTools can not check updates")}const e=n.get("Check Updates","Show New Plugins");_.forEach(t,t=>{const i=t.version;if(DKTools.PluginManager.isRegistered(t.name)){if(i>DKTools.PluginManager.getVersion(t.name)){const e=[`Available a new version of ${t.name}: ${i} \n`,`Visit site: ${t.url} \n`,`Download: ${DKTools.SITE}/download/${t.name}.js`];console.log.apply(console,e)}}else if(e){const e=[`Try the new plugin: ${t.name} \n`,`Description: ${t.description} \n`,`Visit site: ${t.url} \n`,`Download: ${DKTools.SITE}/download/${t.name}.js`];console.log.apply(console,e)}})}static __hideGrid(){this._gridSprite&&(SceneManager._scene.removeChild(this._gridSprite),this._gridSprite=null)}static isAndroidChrome(){return this._isAndroidChrome}static isArrayLike(t){return!!Array.isArray(t)||"[object Arguments]"===String(t)}static isBoolean(t){return"boolean"==typeof t}static isFunction(t){return"function"==typeof t}static isMobileDevice(){return this._isMobileDevice}static isMobileSafari(){return this._isMobileSafari}static isNumber(t){return Number.isFinite(t)}static isNwjs(){return this._isNwjs}static isString(t){return!!t&&"string"==typeof t}static isTest(){return this._isTest}static async logError(t){if(!t||!this.isNwjs())return;const e=n.get("Errors Log"),i=DKTools.Utils.isTest(),o=e.Enabled;if("None"===o||"Only Game"===o&&i||"Only Test"===o&&!i)return;const s=DKTools.IO.fs,r=DKTools.IO.os;if(!s||!r)return;const a=1024*e["File Size"]*1024,l=e.Filename,u=new DKTools.IO.File(l),c=await u.getStatsAsync().then(t=>t.data);let h=await s.openSync(l,"a");if(c&&c.size>a&&(await s.closeSync(h),await u.removeAsync(),h=await s.openSync(l,"a")),t instanceof Object){let e=`Date: ${(new Date).toString()}`+r.EOL+`Name: ${t.name}`+r.EOL+`Message: ${t.message}`+r.EOL;void 0!==t.filename&&(e+=`Filename: ${t.filename}`+r.EOL),void 0!==t.lineNumber&&(e+=`Line: ${t.lineNumber}`+r.EOL),void 0!==t.columnNumber&&(e+=`Column: ${t.columnNumber}`+r.EOL),e+=`Stack: ${t.stack}`+r.EOL+r.EOL,await s.writeSync(h,e)}else{const e=`Date: ${(new Date).toString()}`+r.EOL+`Error: ${t}`+r.EOL+r.EOL;await s.writeSync(h,e)}await s.closeSync(h)}static makeScreenshot(){if(!this.isNwjs())return;const t=n.get("Screenshots"),e=t.Path,i=t.Type,o=t.Quality,s=SceneManager.snap().canvas.toDataURL("image/"+i,o),r=new RegExp(`^data:image/${i};base64,`),a=s.replace(r,""),l=new Date;let u=t.Filename;const c=(u=(u=(u=(u=(u=(u=u.replace(/%year/gi,l.getFullYear())).replace(/%month/gi,l.getMonth()+1)).replace(/%day/gi,l.getDate())).replace(/%hours/gi,l.getHours())).replace(/%minutes/gi,l.getMinutes())).replace(/%seconds/gi,l.getSeconds()))+"."+i,h=DKTools.IO.normalizePath(e+"/"+c);new DKTools.IO.File(h).save(a,{createDirectory:!0,options:"base64"}),console.log("The screenshot is saved with the name: "+c)}static mixin(t,e){Object.defineProperties(t,Object.getOwnPropertyDescriptors(e))}static openConsole(){if(this.isTest()&&this.isNwjs())try{const t=i(2).Window.get();t.showDevTools(null,()=>t.focus())}catch(t){this.logError(t),console.error("DKTools can not open the console")}}static __tileSize(){const t=n.get("Tile Size");t.Enabled&&(Tilemap.TILE_WIDTH=t.Size,Tilemap.TILE_HEIGHT=t.Size)}static throwError(t){setTimeout(()=>{throw t},0)}static __quickLoad(){if(!DKTools.Utils.isTest()||!n.get("Quick Load","Enabled"))return;const t=n.get("Quick Load","Savefile ID"),e=SceneManager._scene;t>0?DataManager.loadGame(t)&&(SoundManager.playLoad(),e instanceof Scene_Base&&e.fadeOutAll(),$gameSystem.versionId()!==$dataSystem.versionId&&($gamePlayer.reserveTransfer($gameMap.mapId(),$gamePlayer.x,$gamePlayer.y),$gamePlayer.requestMapReload()),SceneManager.goto(Scene_Map)):e instanceof Scene_Load||SceneManager.push(Scene_Load)}static _sayHello(){if(!this._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>=0){const t=[`%c %c %c DKTools.js ${DKTools.VERSION} %c  %c  ${DKTools.SITE}  %c \n`,"background: #279EE8; padding:5px 0;","background: #279EE8; padding:5px 0;","color: #4CCBF5; background: #030307; padding:5px 0;","background: #279EE8; padding:5px 0;","background: #BDE5F2; padding:5px 0;","background: #279EE8; padding:5px 0;"];console.log.apply(console,t)}else window.console&&console.log(`DKTools.js ${DKTools.VERSION} - ${DKTools.SITE}`);this._saidHello=!0}}static __showGrid(){if(!DKTools.Utils.isTest()||!n.get("Grid","Enabled"))return;if(this._gridSprite)return void(this._gridSize>=32?(this._gridSize-=16,this._gridSprite.refreshAll()):(this._gridSize=64,this.__hideGrid()));const t=n.get("Grid");let e=null;this._gridSprite=new DKTools.Sprite.Button(Graphics),this._gridSprite.addEvent({type:"draw-all",onUpdate:()=>{const i=Graphics.boxWidth,o=Graphics.boxHeight,n=this._gridSize,s=t["Grid Color"],r=t["Grid Width"];_.times(Math.ceil(i/n),t=>{this._gridSprite.drawLine({x1:n*t,y1:0,x2:n*t,y2:o,color:s,lineWidth:r})}),_.times(Math.ceil(o/n),t=>{this._gridSprite.drawLine({x1:0,y1:n*t,x2:i,y2:n*t,color:s,lineWidth:r})}),e&&this._gridSprite.drawLine({x1:e.x,y1:e.y,x2:TouchInput.mouseX,y2:TouchInput.mouseY,color:e.color,lineWidth:t["Ruler Width"]})}}),this._gridSprite.addEvent({type:"mouse-inside",onUpdate:()=>{const t=TouchInput.mouseX,e=TouchInput.mouseY,o=Graphics.boxWidth,n=Graphics.boxHeight;let s=t+8,r=e+8;s+i.width>o&&(s=t-i.width-8),r+i.height>n&&(r=e-i.height-8),i.move(s,r),i.refreshAll()}}),this._gridSprite.addEvent({type:"mouse-down-middle",onUpdate:()=>{e||(e={x:TouchInput.mouseX,y:TouchInput.mouseY,color:t["Ruler Color"]||DKTools.Utils.Random.getHexColor()}),this._gridSprite.refreshAll()}}),this._gridSprite.addEvent({type:"mouse-up-middle",onUpdate:()=>{e=null,this._gridSprite.refreshAll()}}),this._gridSprite.start(!0);const i=new DKTools.Sprite(0,0,220,"2");i.addEvent({type:"draw-all",onUpdate:()=>{if(e){const t={x:TouchInput.mouseX,y:TouchInput.mouseY},o=Math.floor(DKTools.Utils.Point.getDistance(e,t));i.drawText(`line: ${o} (${e.x}, ${e.y})`,{y:"0",align:"left"})}i.drawText(`x: ${TouchInput.mouseX}, y: ${TouchInput.mouseY}`,{y:"1",align:"left"})}}),i.start(),this._gridSprite.addChild(i),this._gridSprite.updateMouseInsideEvents(),SceneManager._scene.addChild(this._gridSprite)}},DKTools.Utils.Object=class{static toCamelCase(t){return _.forEach(_.keys(t),e=>{const i=_.camelCase(e);i!==e&&(t[i]=t[e],delete t[e])}),t}},DKTools.Utils.Number=class{static clamp(t,e,i){return _.clamp(t,e,i)}static inRange(t,e,i){return _.inRange(t,e,i)}static isFinite(t){return Number.isFinite(t)}static isNaN(t){return Number.isNaN(t)}},DKTools.Utils.String=class{static toBooleanArray(t){return _.map(this.toStringArray(t),Boolean)}static toNumberArray(t){return _.map(this.toStringArray(t),Number)}static toStringArray(t){return t.trim().replace(/\s*\,\s*/g,",").split(",")}},DKTools.Utils.Array=class{static avg(t){return this.sum(t)/t.length}static compact(t){return _.pull(t,"",null,void 0,Number.NaN)}static conjunction(t){return _.every(t,_.isEqual.bind(this,!0))}static contains(t,e){return _.includes(t,e)}static count(t,e){return _.size(t)-_.size(_.without(t,e))}static counts(t,e){return _.size(t)-_.size(_.difference(t,e))}static disjunction(t){return _.some(t,_.isEqual.bind(this,!0))}static insert(t,e,i=0){t.splice(i,0,e)}static isBitmapArray(t){return _.every(t,t=>t instanceof Bitmap)}static isBooleanArray(t){return _.every(t,t=>DKTools.Utils.isBoolean(t))}static isEmpty(t){return _.isEmpty(t)}static isNumberArray(t){return _.every(t,t=>DKTools.Utils.isNumber(t))}static isSpriteArray(t){return _.every(t,t=>t instanceof Sprite)}static isStringArray(t){return _.every(t,t=>DKTools.Utils.isString(t))}static isWindowArray(t){return _.every(t,t=>t instanceof Window)}static max(t){return Math.max.apply(Math,t)}static min(t){return Math.min.apply(Math,t)}static remove(t,e){return _.pull(t,e)}static sum(t){return _.reduce(t,(t,e)=>t+=e,0)}},DKTools.Utils.Point=class{static clone(t=0,e=0){return this.toPoint(t,e)}static equals(t,e=0,i=0){if(0===arguments.length)return!1;const o=this.toPoint(e,i);return(t=this.toPoint(t)).x===o.x&&t.y===o.y}static getDistance(t,e=0,i=0){const o=this.toPoint(e,i);return t=this.toPoint(t),Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2))}static toArray(t){return[t.x,t.y]}static toPoint(t=0,e=0){const i=this.tryToPoint(t,e);if(null!==i)return i;const o=t=>Number.isFinite(t)?t:0;let n;return t instanceof Object&&(n=t.x,e=t.y),n=o(n),e=o(e),new Point(n,e)}static tryToPoint(t,e){let i,o;return t instanceof Object?(i=t.x,o=t.y):(i=t,o=e),DKTools.Utils.Array.isNumberArray([i,o])?new Point(i,o):null}},DKTools.Utils.Rectangle=class{static clone(t=0,e=0,i=0,o=0){return this.toRectangle(t,e,i,o)}static equals(t,e=0,i=0,o=0,n=0){if(0===arguments.length)return!1;const s=this.toRectangle(e,i,o,n);return(t=this.toRectangle(t)).x===s.x&&t.y===s.y&&t.width===s.width&&t.height===s.height}static isEmpty(t){return this.equals(t,Rectangle.emptyRectangle)}static toArray(t){return[t.x,t.y,t.width,t.height]}static toRectangle(t=0,e=0,i=0,o=0){const n=this.tryToRectangle(t,e,i,o);if(n)return n;const s=t=>Number.isFinite(t)?t:0;let r;return t instanceof Object&&(r=t.x,e=t.y,i=t.width,o=t.height),r=s(r),e=s(e),i=s(i),o=s(o),new Rectangle(r,e,i,o)}static tryToRectangle(t,e,i,o){let n,s,r,a;return t instanceof Object?(n=t.x,s=t.y,r=t.width,a=t.height):(n=t,s=e,r=i,a=o),DKTools.Utils.Array.isNumberArray([n,s,r,a])?new Rectangle(n,s,r,a):null}},DKTools.Utils.WebAudio=class{static load(t,e,i){if(!t)return null;if(t instanceof WebAudio)return t;if(DKTools.Utils.isArrayLike(t))return this.load.apply(this,t);if(t instanceof Object)return this.load(t.folder,t.filename,t.listener,t.hue,t.smooth);if(!DKTools.Utils.isString(t))return null;const o=AudioManager.createBuffer(t,e);return DKTools.Utils.isFunction(i)&&o.addLoadListener(i),o}static async loadAsync(t,e,i){return new Promise(o=>{const n=this.load(t,e,i);n?n.addLoadListener(()=>o(n)):o(n)})}static loadBuffers(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.load(t));const o=[];let n=0;const s=(s,r)=>{e&&(o[s]=r,n++,DKTools.Utils.isFunction(i)&&i(r,o,t),t.length===n&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof WebAudio?t.addLoadListener(t=>s(e,t)):s(e,t)})}static async loadBuffersAsync(t){const e=_.map(t,t=>this.loadAsync(t));return Promise.all(e)}},DKTools.Utils.Bitmap=class{static clone(t){if(!t||t.url)return t;const e=t.canvas,i=new Bitmap(e.width,e.height);return i.context.drawImage(e,0,0),i}static drawLine(t,e,i,o,n,s="white",r=1){const a=t.context;a.save(),a.strokeStyle=s,a.lineWidth=r,a.beginPath(),a.moveTo(e,i),a.lineTo(o,n),a.stroke(),a.restore(),t._setDirty()}static fillArc(t,e,i,o,n,s,r="white",a=!1){const l=t.context;l.save(),l.fillStyle=r,l.beginPath(),l.arc(e,i,o,n,s,a),l.fill(),l.restore(),t._setDirty()}static getBase64(t){return t&&t.canvas?t.canvas.toDataURL("image/png"):null}static load(t,e,i,o,n){if(!t)return null;if(t instanceof Bitmap)return t;if(DKTools.Utils.isArrayLike(t))return this.load.apply(this,t);if(t instanceof Object)return this.load(t.folder,t.filename,t.listener,t.hue,t.smooth);if(!DKTools.Utils.isString(t))return null;const s=DKTools.IO.normalizePath(t+"/",!0),r=ImageManager.loadBitmap(s,e,o,n);return DKTools.Utils.isFunction(i)&&r.addLoadListener(i),r}static async loadAsync(t,e,i,o,n){return new Promise(s=>{const r=this.load(t,e,i,o,n);r?r.addLoadListener(()=>s(r)):s(r)})}static loadBitmaps(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.load(t));const o=[];let n=0;const s=(s,r)=>{e&&(o[s]=r,n++,DKTools.Utils.isFunction(i)&&i(r,o,t),t.length===n&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof Bitmap?t.addLoadListener(t=>s(e,t)):s(e,t)})}static async loadBitmapsAsync(t){Array.isArray(t)||(t=[t]);const e=_.map(t,t=>this.loadAsync(t));return Promise.all(e)}static reserve(t,e,i,o,n,s){if(!t)return null;if(t instanceof Bitmap)return t;if(DKTools.Utils.isArrayLike(t))return this.reserve.apply(this,t);if(t instanceof Object)return this.reserve(t.folder,t.filename,t.listener,t.hue,t.smooth,t.reservationId);if(!DKTools.Utils.isString(t))return null;const r=DKTools.IO.normalizePath(t+"/",!0),a=ImageManager.reserveBitmap(r,e,o,n,s);return DKTools.Utils.isFunction(i)&&a.addLoadListener(i),a}static async reserveAsync(t,e,i,o,n,s){return new Promise(r=>{const a=this.reserve(t,e,i,o,n,s);a?a.addLoadListener(()=>r(a)):r(a)})}static reserveBitmaps(t,e,i){if(!DKTools.Utils.isFunction(e))return;t=_.map(t,t=>this.reserve(t));const o=[];let n=0;const s=(s,r)=>{e&&(o[s]=r,n++,DKTools.Utils.isFunction(i)&&i(r,o,t),t.length===n&&(e(t),e=null))};_.forEach(t,(t,e)=>{t instanceof Bitmap?t.addLoadListener(t=>s(e,t)):s(e,t)})}static async reserveBitmapsAsync(t){Array.isArray(t)||(t=[t]);const e=_.map(t,t=>this.reserveAsync(t));return Promise.all(e)}static strokeArc(t,e,i,o,n,s,r="white",a=1,l=!1){const u=t.context;u.save(),u.strokeStyle=r,u.lineWidth=a,u.beginPath(),u.arc(e,i,o,n,s,l),u.stroke(),u.restore(),t._setDirty()}static strokeRect(t,e,i,o,n,s="white",r=1){const a=t.context;a.save(),a.strokeStyle=s,a.lineWidth=r,a.strokeRect(e,i,o,n),a.restore(),t._setDirty()}},DKTools.Utils.Event=class{static getAllComments(t){return Number.isFinite(t)&&(t=$gameMap.events()[t]),t?(t instanceof Game_Event&&(t=t.event()),_.reduce(t.pages,(t,e,i)=>(t[i+1]=_.reduce(e.list,(t,e)=>(108!==e.code&&408!==e.code||t.push(e.parameters[0]),t),[]),t),{})):[]}static getComments(t){return Number.isFinite(t)&&(t=$gameMap.events()[t]),t&&t.page()?_.reduce(t.list(),(t,e)=>(108!==e.code&&408!==e.code||t.push(e.parameters[0]),t),[]):[]}},DKTools.Utils.Random=class{constructor(){return DKTools.Utils.Random}static getBoolean(){return this.getInt(1)%2==0}static getFloat(t=1){return _.random(0,t,!0)}static getHexColor(){return"#"+(16777215*Math.random()<<0).toString(16)}static getInt(t=1){return _.random(0,t)}static getRgbaColor(t=1){const e=this.getInt(255),i=this.getInt(255),o=this.getInt(255);return"rgba(%1, %2, %3, %4)".format(e,i,o,t)}},DKTools.IO=class{constructor(){return DKTools.IO}static initialize(){let t="";this.isLocalMode()&&(this._fs=i(3),this._os=i(4),this._path=i(5),t=this.joinPath(this._path.dirname(process.mainModule.filename),"/")),this._projectPath=t}static absolutePathExists(t){return!!this.isLocalMode()&&this._fs.existsSync(t)}static getRootDirectory(){return new DKTools.IO.Directory("/")}static getAbsolutePath(t){const e=this.joinPath(this._projectPath,t||"");return this.normalizePath(e)}static isLocalMode(){return DKTools.Utils.isNwjs()}static isFile(t){if(!this.isLocalMode())return!1;const e=this.getAbsolutePath(t);return!!this.absolutePathExists(e)&&this._fs.lstatSync(e).isFile()}static isDirectory(t){if(!this.isLocalMode())return!1;const e=this.getAbsolutePath(t);return!!this.absolutePathExists(e)&&this._fs.lstatSync(e).isDirectory()}static joinPath(){if(this.isLocalMode())return this._path.join(...arguments);const t=_.filter(arguments,t=>DKTools.Utils.isString(t));let e=t.join("\\");return/^[\\\/]{2}[^\\\/]/.test(t[0])||(e=e.replace(/^[\\\/]{2,}/,"\\")),this.normalizePath(e)}static normalizePath(t,e=!1){if(this.isLocalMode()){const i=this._path.normalize(t);return e?i.replace(/\\/g,"/"):i}const i=this._statPath(t),o=i.isUnc,n=i.isAbsolute;let s=i.device,r=i.tail;const a=/[\\\/]$/.test(r),l=_.filter(r.split(/[\\\/]+/),t=>t&&"."!==t),u=[];for(const t of l)".."===t?u.length>0&&".."!==u[u.length-1]?u.pop():n||u.push(".."):u.push(t);(r=u.join("\\"))||n||(r="."),r&&a&&(r+="\\"),o&&(s="\\\\"+s.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\"));const c=s+(n?"\\":"")+r;return e?c.replace(/\\/g,"/"):c}static parsePath(t){if(this.isLocalMode())return this._path.parse(t);const e=this._splitPath(t);return{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}}static pathExists(t){return this.absolutePathExists(this.getAbsolutePath(t))}static _statPath(t){const e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=e[1]||"",o=!!i&&":"!==i[1];return{device:i,isUnc:o,isAbsolute:o||!!e[2],tail:e[3]}}static _splitPath(t){const e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=(e[1]||"")+(e[2]||""),o=e[3]||"",n=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/.exec(o);return[i,n[1],n[2],n[3]]}},Object.defineProperties(DKTools.IO,{fs:{get:function(){return this._fs},configurable:!0},os:{get:function(){return this._os},configurable:!0},path:{get:function(){return this._path},configurable:!0},projectPath:{get:function(){return this._projectPath},configurable:!0},OK:{value:0},WAIT_FOR_ASYNC_OPERATION:{value:1},ERROR_NOT_LOCAL_MODE:{value:2},ERROR_PATH_DOES_NOT_EXIST:{value:3},ERROR_CALLBACK_IS_NOT_AVAILABLE:{value:4},ERROR_DIRECTORY_ALREADY_EXISTS:{value:5},ERROR_DIRECTORY_IS_NOT_EMPTY:{value:6},ERROR_NEW_NAME_IS_NOT_AVAILABLE:{value:7},ERROR_KEY_IS_NOT_AVAILABLE:{value:8},ERROR_OPTIONS_IS_NOT_AVAILABLE:{value:9}}),DKTools.IO.Entity=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){const e=DKTools.IO.parsePath(t);this._path=DKTools.IO.normalizePath(e.dir+"/"),this._name=e.name,this._initialExtension=e.ext,this._extension=e.ext}exists(){return DKTools.IO.absolutePathExists(this.getAbsolutePath())}getPath(){return this._path}getName(){return this._name}getExtension(){return this._extension}getFullPath(){return DKTools.IO.joinPath(this.getPath(),"/",this.getFullName())}getFullName(){return this._name+this._extension}getAbsolutePath(){return DKTools.IO.getAbsolutePath(this.getFullPath())}getStats(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=DKTools.IO.fs,i=this.getAbsolutePath();if(t.sync){return{data:e.statSync(i),status:DKTools.IO.OK}}return DKTools.Utils.isFunction(t.onSuccess)?(e.stat(i,(e,i)=>{e?this.__processError(e,t.onError):t.onSuccess({data:i,status:DKTools.IO.OK},this)}),{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}):{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE}}async getStatsAsync(){return new Promise((t,e)=>{const i=this.getStats({sync:!1,onSuccess:t,onError:e});i.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&t(i)})}hasExtension(){return!!this._extension}isFile(){return this instanceof DKTools.IO.File&&(DKTools.IO.isLocalMode()?DKTools.IO.isFile(this.getFullPath()):!!this.hasExtension())}isDirectory(){return this instanceof DKTools.IO.Directory&&(DKTools.IO.isLocalMode()?DKTools.IO.isDirectory(this.getFullPath()):!this.hasExtension())}__processError(t,e){DKTools.Utils.isFunction(e)?e(t,this):DKTools.Utils.throwError(t)}rename(t){if(!t)return DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE;if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!t.newName)return DKTools.IO.ERROR_NEW_NAME_IS_NOT_AVAILABLE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const e=DKTools.IO.fs,i=t.newName,o=this.getAbsolutePath(),n=DKTools.IO.normalizePath(this._path+"/"+i+"."+this._extension),s=DKTools.IO.getAbsolutePath(n);return DKTools.IO.absolutePathExists(s)?t.sync?(e.renameSync(o,s),this._name=i,DKTools.IO.OK):(e.rename(o,s,e=>{e?this.__processError(e,t.onError):(this._name=i,DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this))}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION):DKTools.IO.ERROR_NEW_NAME_IS_NOT_AVAILABLE}async renameAsync(t){return new Promise((e,i)=>{const o=this.rename({...t,sync:!1,onSuccess:e,onError:i});o!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}},Object.defineProperties(DKTools.IO.Entity.prototype,{path:{get:function(){return this._path},configurable:!0},name:{get:function(){return this._name},configurable:!0},initialExtension:{get:function(){return this._initialExtension},configurable:!0},extension:{get:function(){return this._extension},configurable:!0}}),DKTools.IO.File=class extends DKTools.IO.Entity{initialize(t){DKTools.IO.Entity.prototype.initialize.call(this,t),this._detectExtension()}_detectExtension(){let t=this._extension;this.isAudio()?t=AudioManager.audioFileExt():this.isImage()?t=".png":this.isVideo()&&(t=Graphics.canPlayVideoType("video/webm")&&!DKTools.Utils.isMobileDevice()?".webm":".mp4"),this._extension=t}exists(){return DKTools.IO.isLocalMode()&&(Decrypter.hasEncryptedAudio&&this.isAudio()||Decrypter.hasEncryptedImages&&this.isImage())?DKTools.IO.pathExists(Decrypter.extToEncryptExt(this.getFullName())):DKTools.IO.Entity.prototype.exists.call(this)}getDirectory(){return new DKTools.IO.Directory(this._path)}getDirectoryName(){return this.getDirectory().getName()}isAudio(){return".ogg"===this._extension||".m4a"===this._extension||".rpgmvo"===this._extension}isJson(){return".json"===this._extension}isTxt(){return".txt"===this._extension}isImage(){return".png"===this._extension||".rpgmvp"===this._extension}isScript(){return".js"===this._extension}isVideo(){return".webm"===this._extension||".mp4"===this._extension}isSave(){return".rpgsave"===this._extension}load(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const e=this.getAbsolutePath(),i=e=>(e&&(t.decompress&&(e=LZString.decompressFromBase64(e)),t.parse instanceof Object?e=JSON.parse(e,t.parse.reviver):t.parse&&(e=JSON.parse(e))),{data:e,status:DKTools.IO.OK});if(DKTools.IO.isLocalMode()){if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const o=DKTools.IO.fs,n=t.options||{encoding:"utf8"};if(t.sync){const t=o.readFileSync(e,n);return i(t)}o.readFile(e,n,(e,o)=>{e?this.__processError(e,t.onError):t.onSuccess(i(o),this)})}else{const o=new XMLHttpRequest;o.open("GET",e,!t.sync),o.overrideMimeType(t.mimeType||"application/json"),o.onload=(()=>{4===o.readyState&&(200===o.status?t.onSuccess(i(o.responseText),this):this.__processError(o,t.onError))}),o.onerror=(()=>{this.__processError(o,t.onError)});try{o.send()}catch(t){}}return{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}}async loadAsync(t={}){return new Promise((e,i)=>{const o=this.load({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}loadAudio(){return!this.isAudio()||DKTools.IO.isLocalMode()&&!this.exists()?null:DKTools.Utils.WebAudio.load(this.getDirectoryName(),this.getName())}async loadAudioAsync(){return DKTools.Utils.WebAudio.loadAsync(this.loadAudio())}loadJson(t={}){return(t=t||{}).parse||(t.parse=!0),this.load(t)}async loadJsonAsync(t={}){return new Promise((e,i)=>{const o=this.loadJson({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}loadBitmap(t,e,i){return t instanceof Object?this.loadBitmap(t.listener,t.hue,t.smooth):!this.isImage()||DKTools.IO.isLocalMode()&&!this.exists()?null:DKTools.Utils.Bitmap.load({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i})}async loadBitmapAsync(t,e,i){return DKTools.Utils.Bitmap.loadAsync(this.loadBitmap(t,e,i))}remove(t={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;const e=DKTools.IO.fs,i=this.getAbsolutePath();return t.sync?(e.unlinkSync(i),DKTools.IO.OK):(e.unlink(i,e=>{e?this.__processError(e,t.onError):DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION)}async removeAsync(t={}){return new Promise((e,i)=>{const o=this.remove({...t,sync:!1,onSuccess:e,onError:i});o!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}reserveBitmap(t,e,i,o){return t instanceof Object?this.reserveBitmap(t.listener,t.hue,t.smooth,t.reservationId):this.isImage()&&this.exists()?DKTools.Utils.Bitmap.reserve({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i,reservationId:o}):null}async reserveBitmapAsync(t,e,i,o){return t instanceof Object?this.reserveBitmapAsync(t.listener,t.hue,t.smooth,t.reservationId):this.isImage()&&this.exists()?DKTools.Utils.Bitmap.reserveAsync({folder:this.getPath(),filename:this.getName(),listener:t,hue:e,smooth:i,reservationId:o}):null}save(t,e={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;const i=DKTools.IO.fs,o=this.getAbsolutePath(),n=this.getDirectory();return(e=e||{}).createDirectory&&!n.exists()&&n.create(),n.exists()?(e.stringify instanceof Object?t=JSON.stringify(t,e.stringify.replacer,e.stringify.space):e.stringify&&(t=JSON.stringify(t)),e.compress&&(t=LZString.compressToBase64(t)),e.sync?(i.writeFileSync(o,t,e.options),DKTools.IO.OK):(i.writeFile(o,t,e.options,t=>{t?this.__processError(t,e.onError):DKTools.Utils.isFunction(e.onSuccess)&&e.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION)):DKTools.IO.ERROR_PATH_DOES_NOT_EXIST}async saveAsync(t,e={}){return new Promise((i,o)=>{const n=this.save(t,{...e,sync:!1,onSuccess:i,onError:o});n!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&i(n)})}saveJson(t,e={}){return(e=e||{}).stringify||(e.stringify={space:"\t"}),this.save(t,e)}async saveJsonAsync(t,e={}){return new Promise((i,o)=>{const n=this.saveJson(t,{...e,sync:!1,onSuccess:i,onError:o});n!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&i(n)})}},DKTools.IO.Directory=class extends DKTools.IO.Entity{create(){return DKTools.IO.isLocalMode()?this.exists()?DKTools.IO.ERROR_DIRECTORY_ALREADY_EXISTS:(DKTools.IO.fs.mkdirSync(this.getAbsolutePath()),DKTools.IO.OK):DKTools.IO.ERROR_NOT_LOCAL_MODE}async createAsync(){return new Promise((t,e)=>{DKTools.IO.isLocalMode()||t(DKTools.IO.ERROR_NOT_LOCAL_MODE),this.exists()&&t(DKTools.IO.ERROR_DIRECTORY_ALREADY_EXISTS),DKTools.IO.fs.mkdir(this.getAbsolutePath(),i=>{i?e(i):t(DKTools.IO.OK)})})}findFiles(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=t.searchLimit||1,i=[];let o=1,n=0;const s=n=>{_.forEach(n,n=>{if(n.isFile()){const e=n.getFullName();t.template instanceof RegExp&&t.template.test(e)?i.push(n):t.template&&e!==t.template||i.push(n)}else o<e&&n.isDirectory()&&(o++,r(n))})},r=e=>{if(t.sync){const i=e.getAll({sync:!0,options:t.options}).data;s(i)}else e.getAll({sync:!1,options:t.options,onError:t.onError,onSuccess:e=>{n++,s(e.data),o===n&&t.onSuccess({data:i,status:DKTools.IO.OK})}})};return r(this),t.sync?{data:i,status:DKTools.IO.OK}:{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}}async findFilesAsync(t={}){return new Promise((e,i)=>{const o=this.findFiles({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}findDirectories(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!t.sync&&!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=t.searchLimit||1,i=[];let o=1,n=0;const s=n=>{_.forEach(n,n=>{const s=n.getFullName();t.template instanceof RegExp&&t.template.test(s)?i.push(n):t.template&&s!==t.template||i.push(n),o<e&&(o++,r(n))})},r=e=>{if(t.sync){const i=e.getDirectories({sync:!0,options:t.options}).data;s(i)}else e.getDirectories({sync:!1,options:t.options,onError:t.onError,onSuccess:e=>{n++,s(e.data),o===n&&t.onSuccess({data:i,status:DKTools.IO.OK})}})};return r(this),t.sync?{data:i,status:DKTools.IO.OK}:{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}}async findDirectoriesAsync(t={}){return new Promise((e,i)=>{const o=this.findDirectories({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}getAll(t){if(!t)return{data:null,status:DKTools.IO.ERROR_OPTIONS_IS_NOT_AVAILABLE};if(!DKTools.IO.isLocalMode())return{data:null,status:DKTools.IO.ERROR_NOT_LOCAL_MODE};if(!this.exists())return{data:null,status:DKTools.IO.ERROR_PATH_DOES_NOT_EXIST};const e=DKTools.IO.fs,i=this.getFullPath(),o=this.getAbsolutePath(),n=e=>{return t.template instanceof RegExp?e=_.filter(e,e=>t.template.test(e)):DKTools.Utils.isString(t.template)&&(e=_.filter(e,e=>e===t.template)),{data:_.reduce(e,(t,e)=>{const o=DKTools.IO.normalizePath(i+"/"+e);return DKTools.IO.isFile(o)?t.push(new DKTools.IO.File(o)):DKTools.IO.isDirectory(o)&&t.push(new DKTools.IO.Directory(o)),t},[]),status:DKTools.IO.OK}};if(t.sync){const i=e.readdirSync(o,t.options);return n(i)}return DKTools.Utils.isFunction(t.onSuccess)?(e.readdir(o,t.options,(e,i)=>{e?this.__processError(e,t.onError):t.onSuccess(n(i),this)}),{data:null,status:DKTools.IO.WAIT_FOR_ASYNC_OPERATION}):{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE}}async getAllAsync(t={}){return new Promise((e,i)=>{const o=this.getAll({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}getFiles(t){const e=t=>_.filter(t,t=>t.isFile());if((t=t||{}).sync){const i=this.getAll(t);return i.status===DKTools.IO.OK?{...i,data:e(i.data)}:i}{if(!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const i=t.onSuccess;return t.onSuccess=((t,o)=>{i({...t,data:e(t.data)},o)}),this.getAll(t)}}async getFilesAsync(t={}){return this.getAllAsync(t).then(t=>{if(t.status===DKTools.IO.OK){const e=_.filter(t.data,t=>t.isFile());return{...t,data:e}}return t})}getDirectories(t){const e=t=>_.filter(t,t=>t.isDirectory());if(t.sync){const i=this.getAll(t);return i.status===DKTools.IO.OK?{...i,data:e(i.data)}:i}{if(!DKTools.Utils.isFunction(t.onSuccess))return{data:null,status:DKTools.IO.ERROR_CALLBACK_IS_NOT_AVAILABLE};const i=t.onSuccess;return t.onSuccess=((t,o)=>{i({...t,data:e(t.data)},o)}),this.getAll(t)}}async getDirectoriesAsync(t={}){return this.getAllAsync(t).then(t=>{if(t.status===DKTools.IO.OK){const e=_.filter(t.data,t=>t.isDirectory());return{...t,data:e}}return t})}getAudioFiles(t){return this.getFiles({...t,template:/(.ogg|.rpgmvo)/})}async getAudioFilesAsync(t={}){return new Promise((e,i)=>{const o=this.getAudioFiles({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}getJsonFiles(t){return this.getFiles({...t,template:/(.json)/})}async getJsonFilesAsync(t={}){return new Promise((e,i)=>{const o=this.getJsonFiles({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}getTxtFiles(t){return this.getFiles({...t,template:/(.txt)/})}async getTxtFilesAsync(t={}){return new Promise((e,i)=>{const o=this.getTxtFiles({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}getImageFiles(t){return this.getFiles({...t,template:/(.png|.rpgmvp)/})}async getImageFilesAsync(t={}){return new Promise((e,i)=>{const o=this.getImageFiles({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}getVideoFiles(t){return this.getFiles({...t,template:/(.webm)/})}async getVideoFilesAsync(t={}){return new Promise((e,i)=>{const o=this.getVideoFiles({...t,sync:!1,onSuccess:e,onError:i});o.status!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&e(o)})}isEmpty(){const t=this.getAll({sync:!0}).data;return!t||0===t.length}loadAudioFiles(){const t=this.getAudioFiles({sync:!0});return t.status!==DKTools.IO.OK?[]:_.map(t.data,t=>t.loadAudio())}async loadAudioFilesAsync(){const t=await this.getAudioFilesAsync();if(t.status!==DKTools.IO.OK)return[];const e=_.map(t.data,t=>t.loadAudioAsync());return Promise.all(e)}loadBitmaps(t,e,i){const o=this.getImageFiles({sync:!0});return o.status!==DKTools.IO.OK?[]:_.map(o.data,o=>o.loadBitmap(t,e,i))}async loadBitmapsAsync(t,e,i){const o=await this.getImageFilesAsync();if(o.status!==DKTools.IO.OK)return[];const n=_.map(o.data,o=>o.loadBitmapAsync(t,e,i));return Promise.all(n)}remove(t={}){if(!DKTools.IO.isLocalMode())return DKTools.IO.ERROR_NOT_LOCAL_MODE;if(!this.exists())return DKTools.IO.ERROR_PATH_DOES_NOT_EXIST;if(!this.isEmpty())return DKTools.IO.ERROR_DIRECTORY_IS_NOT_EMPTY;const e=DKTools.IO.fs,i=this.getAbsolutePath();return t.sync?(e.rmdirSync(i),DKTools.IO.OK):(e.rmdir(i,e=>{e?this.__processError(e,t.onError):DKTools.Utils.isFunction(t.onSuccess)&&t.onSuccess(DKTools.IO.OK,this)}),DKTools.IO.WAIT_FOR_ASYNC_OPERATION)}async removeAync(){return new Promise((t,e)=>{const i=this.remove({sync:!1,onSuccess:t,onError:e});i!==DKTools.IO.WAIT_FOR_ASYNC_OPERATION&&t(i)})}reserveBitmaps(t,e,i,o){const n=this.getImageFiles({sync:!0});return n.status!==DKTools.IO.OK?[]:_.map(n.data,n=>n.reserveBitmap(t,e,i,o))}async reserveBitmapsAsync(t,e,i,o){const n=await this.getImageFilesAsync();if(n.status!==DKTools.IO.OK)return[];const s=_.map(n.data,n=>n.reserveBitmapAsync(t,e,i,o));return Promise.all(s)}},DKTools.IO.WebStorage=class{static exists(t){return localStorage.hasOwnProperty(t)}static load(t,e={}){if(!this.exists(t))return{data:null,status:DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE};let i=localStorage.getItem(t);return i&&(e.decompress&&(i=LZString.decompressFromBase64(i)),e.parse&&(i=JSON.parse(i))),{data:i,status:DKTools.IO.OK}}static remove(t){return this.exists(t)?(localStorage.removeItem(t),DKTools.IO.OK):DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE}static rename(t,e){if(!this.exists(t))return DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE;if(this.exists(e)||null==e)return DKTools.IO.ERROR_NEW_NAME_IS_NOT_AVAILABLE;const i=localStorage.getItem(t);return localStorage.setItem(e,i),localStorage.removeItem(t),DKTools.IO.OK}static save(t,e,i={}){return null==t||""===t?DKTools.IO.ERROR_KEY_IS_NOT_AVAILABLE:(i.stringify&&(e=JSON.stringify(e)),i.compress&&(e=LZString.compressToBase64(e)),localStorage.setItem(t,e),DKTools.IO.OK)}},DKTools.Network=class{constructor(){return DKTools.Network}static async fetchFile(t,e={}){return fetch(t,e).then(t=>{if(t.ok)return this._toFile(t);throw t})}static async fetchJson(t,e={}){return e.headers||(e.headers={}),e.headers.Accept="application/json",fetch(t,e).then(t=>{if(t.ok)return this._toJson(t);throw t})}static async _toFile(t){return t.arrayBuffer().then(t=>t,()=>null)}static async _toJson(t){return t.json().then(t=>t,()=>null)}},DKTools.ParameterManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){this._pluginName=t,this._params={},this.initializeParams()}initializeParams(){_.forEach(PluginManager.parameters(this._pluginName),(t,e)=>{this._params[e]=DKTools.ParameterManager.parse(t)})}get(t,e,i){if(!DKTools.Utils.isString(t))return void console.error("Parameter name is not a string!",this._pluginName,t,e,i);let o=this._params[t];return void 0!==o?(e instanceof Object?o=_.find(o,e):void 0!==e&&(o=o[e]),o instanceof Object&&(i instanceof Object?(void 0!==i.key&&(o=o[i.key]),void 0!==i.index&&(o=o[i.index])):void 0!==i&&(o=o[i])),o):void 0}static parse(t){try{return DKTools.Utils.isNumber(t)||DKTools.Utils.isBoolean(t)?t:JSON.parse(t,(t,e)=>{if(Array.isArray(e))return _.map(e,t=>this.parse(t));try{return this.parse(e)}catch(t){return e}})}catch(e){return t}}},Object.defineProperties(DKTools.ParameterManager.prototype,{pluginName:{get:function(){return this._pluginName},configurable:!0},initialParams:{get:function(){return this._initialParams||(this._initialParams=PluginManager.parameters(this._pluginName)),this._initialParams},configurable:!0},params:{get:function(){return this._params},configurable:!0}}),DKTools.PluginManager=class{constructor(){return DKTools.PluginManager}static initialize(){this.registerPlugins(Imported),this._checkRequirements()}static _checkRequirements(){_.forEach(this._requirements,(t,e)=>{const i=_.max(t),o=this.getVersion(e);if(void 0===o){const t='Required to install the plugin "%1". Minimal version: %2'.format(e,i);throw new Error(t)}if(o<i){const t='Required to update the plugin "%1" to minimal version %2 (Installed: %3)'.format(e,i,o);throw new Error(t)}})}static getVersion(t){return this._plugins[t]}static isRegistered(t){return!!this._plugins[t]}static isRequired(t){return!!this._requirements[t]}static registerPlugin(t,e){!e||this.isRegistered(t)||DKTools.Utils.isBoolean(e)||(this._plugins[t]=e)}static registerPlugins(t){_.forEach(t,(t,e)=>{this.registerPlugin(e,t)})}static requirePlugin(t,e){this._requirements[t]||(this._requirements[t]=[]),this._requirements[t].push(e)}static requirePlugins(t){_.forEach(t,(t,e)=>{this.requirePlugin(e,t)})}},Object.defineProperties(DKTools.PluginManager,{_plugins:{value:{}},_requirements:{value:{}},plugins:{get:function(){return this._plugins},configurable:!0},requirements:{get:function(){return this._requirements},configurable:!0}}),DKTools.PluginCommandManager=class{constructor(){return DKTools.PluginCommandManager}static has(t){return!!this._pluginCommands[t.toLowerCase()]}static process(t,e,i){const o=this._pluginCommands[e.toLowerCase()];DKTools.Utils.isFunction(o)&&o.call(t,i)}static set(t,e){this._pluginCommands[t.toLowerCase()]=e}},Object.defineProperties(DKTools.PluginCommandManager,{_pluginCommands:{value:{}}}),DKTools.PreloadManager=class{constructor(){return DKTools.PreloadManager}static initialize(){this.clearCache();const t=n.get("Preload Manager");this._enabled=t.Enabled,this.isEnabled()&&(_.forEach(t["Audio Files"],t=>{this.preloadAudio({path:t.Path,caching:t.Caching})}),_.forEach(t["Image Files"],t=>{this.preloadImage({path:t.Path,hue:t.Hue,caching:t.Caching})}),this.start())}static clearCache(){this._cache={audio:{},image:{}}}static clearQueue(){this._queue={audio:[],image:[]}}static _finish(){this._finishTime=new Date,this.clearQueue(),this._log("Preloading complete! \nLoaded/Skipped/Total: "+this._loaded+"/"+this._skipped+"/"+this._total+"\nPreloading time: "+(this._finishTime-this._startTime)/1e3+" sec"),Graphics.endLoading()}static _generateAudioKey(t){return DKTools.IO.normalizePath(t,!0)}static _generateImageKey(t,e=0){return DKTools.IO.normalizePath(ImageManager._generateCacheKey(t,e||0),!0)}static getCachedAudioByKey(t){return this._cache.audio[t]}static getCachedAudioByPath(t){return this.getCachedAudioByKey(this._generateAudioKey(t))}static getCachedImageByKey(t){return this._cache.image[t]}static getCachedImageByPath(t){return this.getCachedImageByKey(this._generateImageKey(t))}static isAudioCachedByKey(t){return!!this._cache.audio[t]}static isAudioCachedByPath(t){return this.isAudioCachedByKey(this._generateAudioKey(t))}static isEnabled(){return this._enabled}static isFinished(){return!!this._finishTime}static isReady(){return!this.isEnabled()||this.isFinished()}static isImageCachedByKey(t){return!!this._cache.image[t]}static isImageCachedByPath(t,e){return this.isImageCachedByKey(this._generateImageKey(t,e))}static _log(t){this.isEnabled()&&DKTools.Utils.isTest()&&n.get("Preload Manager","Debugging")&&t&&console.log(t)}static _onFileLoad(t){this._loaded++,this._log(`Loaded ${t instanceof WebAudio?"audio":"image"}: ${t.url}`),Graphics.updateLoading()}static _preload(t,e){if(this.isEnabled()&&e instanceof Object&&DKTools.Utils.isString(e.path)){const i=new DKTools.IO.Directory(e.path);if(i.isDirectory()){if(!DKTools.IO.isLocalMode())throw new Error("Web browsers and mobile phones cannot load directories!");{const o={sync:!0};let n=[];"audio"===t?n=i.getAudioFiles(o).data:"image"===t&&(n=i.getImageFiles(o).data),_.forEach(n,i=>{const o=i.getFullPath();this._queue[t][o]||(this._queue[t][o]={...e,path:o})})}}else{const i=new DKTools.IO.File(e.path),o=i.getFullPath();i.isFile()?this._queue[t][o]||(this._queue[t][o]=e):console.error("This is not a file: "+o)}}}static _processLoadAudioFiles(){const t=[];return _.forEach(this._queue.audio,e=>{const i=new DKTools.IO.File(e.path),o=i.getFullPath();if(i.isFile())if(i.isAudio()){if(this.isAudioCachedByPath(o))return this._skipped++,void this._log("Audio already preloaded: "+o+". Skipped...");const n=i.loadAudio();n?(e.caching&&(this._cache.audio[this._generateAudioKey(n.url)]=n),t.push(n)):(this._skipped++,this._log("Cannot load an audio: "+o+". Skipped..."))}else this._skipped++,this._log("This is not an audio: "+o+". Skipped...");else this._skipped++,this._log("This is not a file: "+e.path+". Skipped...")}),_.map(t,t=>DKTools.Utils.WebAudio.loadAsync(t).then(()=>this._onFileLoad(t)))}static _processLoadImageFiles(){const t=[];return _.forEach(this._queue.image,e=>{const i=new DKTools.IO.File(e.path),o=i.getFullPath();if(i.isFile())if(i.isImage()){if(this.isImageCachedByPath(o,e.hue))return this._skipped++,void this._log("Image already preloaded: "+o+". Skipped...");const n=DKTools.Utils.Bitmap.reserve({folder:i.getPath(),filename:i.getName(),hue:e.hue});n?(e.caching&&(this._cache.image[this._generateImageKey(n.url,e.hue)]=n),t.push(n)):(this._skipped++,this._log("Cannot load an image: "+o+". Skipped..."))}else this._skipped++,this._log("This is not an image: "+o+". Skipped...");else this._skipped++,this._log("This is not a file: "+e.path+". Skipped...")}),_.map(t,t=>DKTools.Utils.Bitmap.loadAsync(t).then(()=>this._onFileLoad(t)))}static preloadAudio(t){this._preload("audio",t)}static preloadImage(t){this._preload("image",t)}static releaseAudioByKey(t){this._cache.audio[t]=void 0}static releaseAudioByPath(t){this.releaseAudioByKey(this._generateAudioKey(t))}static releaseImageByKey(t){this._cache.image[t]=void 0}static releaseImageByPath(t,e){this.releaseImageByKey(this._generateImageKey(t,e))}static start(){if(!this.isEnabled())return;if(this._loaded=0,this._skipped=0,this._total=_.size(this._queue.audio)+_.size(this._queue.image),this._startTime=new Date,this._finishTime=null,this._log("DKTools Preload Manager is running... \nTotal files to load: "+this._total),0===this._total)return void this._finish();const t=Promise.all(this._processLoadAudioFiles()),e=Promise.all(this._processLoadImageFiles());Promise.all([t,e]).then(()=>this._finish())}},Object.defineProperties(DKTools.PreloadManager,{_queue:{value:{audio:{},image:{}},writable:!0},_cache:{value:{audio:[],image:[]},writable:!0}}),DKTools.Audio=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this._id=t.id,this._type=t.type.toLowerCase(),this._name=t.name,this._volume=_.defaultTo(t.volume,this.standardVolume()),this._pitch=_.defaultTo(t.pitch,this.standardPitch()),this._pan=_.defaultTo(t.pan,this.standardPan()),this._loop=_.defaultTo(t.loop,this.standardLoop()),this._buffer=this._createBuffer(),this._pausePos=null}_createBuffer(){return AudioManager.createBuffer(this._type,this._name)}clone(){return new DKTools.Audio(this)}equals(t){return!!t&&(this._type===t.type&&this._name===t.name&&this._volume===t.volume&&this._pitch===t.pitch&&this._pan===t.pan&&this._loop===t.loop)}fadeIn(t=0){this._buffer.fadeIn(t)}fadeOut(t=0){this._buffer.fadeOut(t)}isPaused(){return!this.isPlaying()&&null!=this._pausePos}isPlaying(){return this._buffer.isPlaying()}pause(){this.isPlaying()&&(this._pausePos=this.seek(),this.stop())}play(t=0){this._buffer.play(this._loop,t),this._updateBufferParameters(),this._pausePos=null}resume(){this.isPaused()&&this.play(this._pausePos)}seek(){return this._buffer.seek()}standardLoop(){return"bgm"===this._type||"bgs"===this._type}standardPan(){return 0}standardPitch(){return 100}standardVolume(){return 90}stop(){this.isPlaying()&&this._buffer.stop()}_updateBufferParameters(){const t=this._buffer;let e=AudioManager[this._type+"Volume"];Number.isFinite(e)||(e=100),t.volume=e*this._volume/1e4,t.pitch=this._pitch/100,t.pan=this._pan/100}},Object.defineProperties(DKTools.Audio.prototype,{id:{get:function(){return this._id},configurable:!0},type:{get:function(){return this._type},configurable:!0},name:{get:function(){return this._name},configurable:!0},volume:{get:function(){return this._volume},set:function(t){this._volume!==t&&(this._volume=t,this._updateBufferParameters())},configurable:!0},pitch:{get:function(){return this._pitch},set:function(t){this._pitch!==t&&(this._pitch=t,this._updateBufferParameters())},configurable:!0},pan:{get:function(){return this._pan},set:function(t){this._pan!==t&&(this._pan=t,this._updateBufferParameters())},configurable:!0},loop:{get:function(){return this._loop},configurable:!0},buffer:{get:function(){return this._buffer},configurable:!0},pos:{get:function(){return this.seek()},set:function(t){this.play(t)},configurable:!0}}),DKTools.Event=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this._id=t.id,this._target=t.target,this._type=t.type,this._repeatTime=t.repeatTime||-1,this._repeats=_.defaultTo(t.repeats,-1),this._remainingPauseTime=t.remainingPauseTime||0,this._onStart=t.onStart,this._onUpdate=t.onUpdate,this._onPause=t.onPause,this._onReset=t.onReset,this._onRepeat=t.onRepeat,this._onSuccess=t.onSuccess,this._onFail=t.onFail,this._started=!1,this._resetRemainingTime(),this._resetRemainingRepeats()}addRemainingPauseTime(t=1){this._remainingPauseTime+=t}addRemainingRepeats(t=1){this._remainingRepeats+=t}addRemainingTime(t=1){this._remainingTime+=t}_callOnPauseHandler(){this._canCallOnPauseHandler()&&this._onPause(this)}_callOnRepeatHandler(){this._canCallOnRepeatHandler()&&this._onRepeat(this)}_callOnResetHandler(){this._canCallOnResetHandler()&&this._onReset(this)}_callOnStartHandler(){this._canCallOnStartHandler()&&this._onStart(this),this._started=!0}_callOnSuccessHandler(t=!1){(this._canCallOnSuccessHandler()||t)&&this._onSuccess(this)}_callOnUpdateHandler(){this._canCallOnUpdateHandler()&&this._onUpdate(this)}_callonFailHandler(){this._canCallonFailHandler()&&this._onFail(this)}_canCallOnPauseHandler(){return this.hasOnPauseHandler()&&this.isPaused()}_canCallOnRepeatHandler(){return this.hasOnRepeatHandler()}_canCallOnResetHandler(){return this.hasOnResetHandler()}_canCallOnStartHandler(){return this.hasOnStartHandler()&&!this.isStarted()}_canCallOnSuccessHandler(){return this.hasOnSuccessHandler()&&this.isFinished()}_canCallOnUpdateHandler(){return this.hasOnUpdateHandler()&&this.isUpdated()}_canCallonFailHandler(){return this.hasonFailHandler()}_clearRemainingRepeats(){this._remainingRepeats=0}_clearRemainingTime(){this._remainingTime=0}clone(){return new this.constructor(this)}finish(t=!1){this.isFinished()||t?this._callOnSuccessHandler(t):this._callonFailHandler(),this._clearRemainingTime(),this._clearRemainingRepeats()}getElapsedRepeats(){return this._repeats-this._remainingRepeats}getElapsedTime(){return this._repeatTime-this._remainingTime}hasManager(){return!!this._manager}hasOnPauseHandler(){return!!this._onPause}hasOnRepeatHandler(){return!!this._onRepeat}hasOnResetHandler(){return!!this._onReset}hasOnStartHandler(){return!!this._onStart}hasOnSuccessHandler(){return!!this._onSuccess}hasOnUpdateHandler(){return!!this._onUpdate}hasTarget(){return!!this._target}hasType(){return!!this._type}hasonFailHandler(){return!!this._onFail}isAnimation(){return this instanceof DKTools.Animation}isAnimationAction(){return this instanceof DKTools.Animation.Action}isFinished(){return 0===this._remainingTime&&0===this._remainingRepeats}isPaused(){return 0!==this._remainingPauseTime}isStarted(){return this._started}isUpdated(){return this.isStarted()&&!this.isPaused()&&!this.isFinished()}pause(t=-1){this._remainingPauseTime=t}_resetRemainingRepeats(){this._remainingRepeats=this._repeats}_resetRemainingTime(){this._remainingTime=this._repeatTime}remove(){this.hasTarget()&&this._target.removeEvent(this)}repeat(){this._remainingRepeats>0&&this._remainingRepeats--,this._resetRemainingTime(),this._callOnRepeatHandler()}reset(){this._resetRemainingTime(),this._resetRemainingRepeats(),this._callOnResetHandler()}resume(){this._remainingPauseTime=0}setManager(t){this._manager=t}setOnPauseHandler(t){this._onPause=t}setOnRepeatHandler(t){this._onRepeat=t}setOnResetHandler(t){this._onReset=t}setOnStartHandler(t){this._onStart=t}setOnSuccessHandler(t){this._onSuccess=t}setOnUpdateHandler(t){this._onUpdate=t}setTarget(t){this._target=t}setonFailHandler(t){this._onFail=t}stop(t=!1){this.finish(t),this.reset()}_update(){this._callOnUpdateHandler(),this._updateRemainingRepeats()}_updatePause(){this._callOnPauseHandler(),this._updateRemainingPauseTime()}_updateRemainingPauseTime(){this._remainingPauseTime>0&&this._remainingPauseTime--}_updateRemainingRepeats(){this.isFinished()||(0===this._remainingTime?this.repeat():this._updateRemainingTime())}_updateRemainingTime(){this._remainingTime>0&&this._remainingTime--}update(){this.isPaused()?this._updatePause():(this._callOnStartHandler(),this._update(),this.isFinished()&&this.finish())}},Object.defineProperties(DKTools.Event.prototype,{id:{get:function(){return this._id},configurable:!0},target:{get:function(){return this._target},configurable:!0},manager:{get:function(){return this._manager},configurable:!0},type:{get:function(){return this._type},configurable:!0},repeatTime:{get:function(){return this._duration},configurable:!0},repeats:{get:function(){return this._repeats},configurable:!0},remainingTime:{get:function(){return this._remainingTime},set:function(t){this._remainingTime=t},configurable:!0},remainingRepeats:{get:function(){return this._remainingRepeats},set:function(t){this._remainingRepeats=t},configurable:!0},remainingPauseTime:{get:function(){return this._remainingPauseTime},set:function(t){this._remainingPauseTime=t},configurable:!0},onStart:{get:function(){return this._onStart},configurable:!0},onUpdate:{get:function(){return this._onUpdate},configurable:!0},onPause:{get:function(){return this._onPause},configurable:!0},onReset:{get:function(){return this._onReset},configurable:!0},onRepeat:{get:function(){return this._onRepeat},configurable:!0},onSuccess:{get:function(){return this._onSuccess},configurable:!0},onFail:{get:function(){return this._onFail},configurable:!0}}),DKTools.Animation=class extends DKTools.Event{initialize(t){this._actions=[],DKTools.Event.prototype.initialize.call(this,t)}addAction(t){t&&(Number.isFinite(t.startTime)||(t.startTime=0),Number.isFinite(t.endTime)||(t.endTime=this._repeatTime),t.setAnimation(this),this._actions.push(t))}addActions(t){_.forEach(t,this.addAction.bind(this))}_canUpdateAction(t){return _.inRange(this.getElapsedTime(),t.startTime,t.endTime)}hasAction(t){return DKTools.Utils.Array.contains(this._actions,t)}hasActions(){return!DKTools.Utils.Array.isEmpty(this._actions)}isActionFinished(t){return t.isStarted()&&!t.isPaused()&&this.getElapsedTime()>=t.endTime}isActionUpdated(t){return t.isStarted()&&!t.isPaused()&&this._canUpdateAction(t)}isFinished(){return DKTools.Event.prototype.isFinished.call(this)||!this.hasActions()}removeAction(t){this.hasAction(t)&&DKTools.Utils.Array.remove(this._actions,t)}repeat(){this.repeatActions(),DKTools.Event.prototype.repeat.call(this)}repeatActions(){_.forEach(this._actions,function(t){t.repeat()})}reset(){this.resetActions(),DKTools.Event.prototype.reset.call(this)}resetActions(){_.forEach(this._actions,function(t){t.reset()})}_update(){this._updateActions(),DKTools.Event.prototype._update.call(this)}_updateAction(t){this._canUpdateAction(t)?t.update():this.getElapsedTime()===t.endTime&&this.isActionFinished(t)&&t.finish()}_updateActions(){_.forEach(this._actions,this._updateAction.bind(this))}},Object.defineProperties(DKTools.Animation.prototype,{actions:{get:function(){return this._actions},configurable:!0}}),DKTools.Animation.Action=class extends DKTools.Event{static Anchor(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,o=e.anchor,n=(i.x-o.x)/t,s=(i.y-o.y)/t,r=o.x+n,a=o.y+s;e.setAnchor(r,a)}.bind(e)),e}static Close(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=-e.openness/t,o=e.openness+i;e.openness=o}.bind(e)),e}static Frame(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,o=e.frame,n=(i.x-o.x)/t,s=(i.y-o.y)/t,r=(i.width-o.width)/t,a=(i.height-o.height)/t,l=new Rectangle(o.x+n,o.y+s,o.width+r,o.height+a);e.setFrame(l)}.bind(e)),e}static Move(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data.x-e.x)/t,o=(this._data.y-e.y)/t,n=e.x+i,s=e.y+o;e.move(n,s)}.bind(e)),e}static OpacitySprite(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.opacity)/t,o=e.opacity+i;e.setOpacity(o)}.bind(e)),e}static OpacityWindow(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data.windowOpacity-e.windowOpacity)/t,o=(this._data.contentsOpacity-e.contentsOpacity)/t,n=(this._data.frameOpacity-e.frameOpacity)/t,s=(this._data.backOpacity-e.backOpacity)/t,r={windowOpacity:e.windowOpacity+i,contentsOpacity:e.contentsOpacity+o,frameOpacity:e.frameOpacity+n,backOpacity:e.backOpacity+s};e.setOpacity(r)}.bind(e)),e}static Open(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(255-e.openness)/t;e.openness=e.openness+i}.bind(e)),e}static Pivot(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,o=e.pivot,n=(i.x-o.x)/t,s=(i.y-o.y)/t,r=o.x+n,a=o.y+s;e.setPivot(r,a)}.bind(e)),e}static Rotation(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.rotation)/t,o=e.rotation+i;e.setRotation(o)}.bind(e)),e}static Scale(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,o=e.scale,n=(i.x-o.x)/t,s=(i.y-o.y)/t,r=o.x+n,a=o.y+s;e.setScale(r,a)}.bind(e)),e}static Skew(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=this._data,o=e.skew,n=(i.x-o.x)/t,s=(i.y-o.y)/t,r=o.x+n,a=o.y+s;e.setSkew(r,a)}.bind(e)),e}static Sound(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this._data;t.isPlaying()||t.play()}.bind(e)),e}static Tint(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=(this._data-e.tint)/t,o=e.tint+i;e.setTint(o)}.bind(e)),e}static Tone(t){const e=new DKTools.Animation.Action(t);return e.setOnUpdateHandler(function(){const t=this.getRemainingTime(),e=this._target,i=e.tone,o=(this._data[0]-i[0])/t,n=(this._data[1]-i[1])/t,s=(this._data[2]-i[2])/t,r=i[0]+o,a=i[1]+n,l=i[2]+s;e.setTone([r,a,l])}.bind(e)),e}initialize(t){t=t||{},this._animation=null,this._startTime=t.startTime,this._endTime=t.endTime,this._data=t.data,DKTools.Event.prototype.initialize.call(this,t)}getElapsedTime(){return this._animation.getElapsedTime()-this._startTime}getRemainingTime(){return this._endTime-this._animation.getElapsedTime()}isFinished(){return this._animation.isActionFinished(this)}isUpdated(){return this._animation.isActionUpdated(this)}remove(){this._animation.removeAction(this)}repeat(){this._callOnRepeatHandler()}reset(){this._callOnResetHandler()}setAnimation(t){this._animation=t}},Object.defineProperties(DKTools.Animation.Action.prototype,{animation:{get:function(){return this._animation},configurable:!0},startTime:{get:function(){return this._startTime},set:function(t){this._startTime=t},configurable:!0},endTime:{get:function(){return this._endTime},set:function(t){this._endTime=t},configurable:!0},data:{get:function(){return this._data},configurable:!0}}),DKTools.OptionManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(){this.clear()}addOptionChangeListener(t,e){this._optionChangeListeners[t]||(this._optionChangeListeners[t]=[]),this._optionChangeListeners[t].push(e)}clear(){this._options=[],this._optionChangeListeners={}}clone(t=!1){const e=new DKTools.OptionManager;return e.enableOptions(this._options),t&&_.forEach(this._optionChangeListeners,(t,i)=>{_.forEach(t,t=>{e.addOptionChangeListener(i,t)})}),e}disableOption(t){this.isOptionEnabled(t)&&(DKTools.Utils.Array.remove(this._options,t),this._onOptionChange(t,!1))}disableOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.disableOption.bind(this))}enableOption(t){this.isOptionDisabled(t)&&(this._options.push(t),this._onOptionChange(t,!0))}enableOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.enableOption.bind(this))}equals(t){return t instanceof DKTools.OptionManager&&_.isEqual(this._options,t.options)}isOptionDisabled(t){return!this.isOptionEnabled(t)}isOptionEnabled(t){return DKTools.Utils.Array.contains(this._options,t)}isOptionsDisabled(t){const e=arguments.length>1?arguments:t;return _.every(e,this.isOptionDisabled.bind(this))}isOptionsEnabled(t){const e=arguments.length>1?arguments:t;return _.every(e,this.isOptionEnabled.bind(this))}isSomeOptionEnabled(){return this._options.length>0}isSomeOptionsDisabled(t){const e=arguments.length>1?arguments:t;return _.some(e,this.isOptionDisabled.bind(this))}isSomeOptionsEnabled(t){const e=arguments.length>1?arguments:t;return _.some(e,this.isOptionEnabled.bind(this))}_onOptionChange(t,e){_.forEach(this._optionChangeListeners[t],i=>{i(t,e)})}removeOptionChangeListener(t,e){DKTools.Utils.Array.remove(this._optionChangeListeners[t],e)}switchOption(t){this.isOptionEnabled(t)?this.disableOption(t):this.enableOption(t)}switchOptions(t){const e=arguments.length>1?arguments:t;_.forEach(e,this.switchOption.bind(this))}},Object.defineProperties(DKTools.OptionManager,{options:{get:function(){return this._options},configurable:!0}}),DKTools.EventManager=class{constructor(){this.initialize.apply(this,arguments)}initialize(t){this._target=t,this._events={}}addAnimation(t){return this.addEventToContainer(t)}addEvent(t){let e;return t instanceof DKTools.Event||t instanceof DKTools.Animation?e=t:t instanceof Object&&(e=new DKTools.Event(t)),this.addEventToContainer(e)}addEventToContainer(t){if(!t)return null;return t.hasTarget()||t.setTarget(this._target),t.setManager(this),this.getEventsContainer(t).push(t),t}addOneTimeEvent(t){return t.repeatTime=1,t.repeats=0,this.addEvent(t)}_checkEvent(t){return t&&!t.isFinished()}_checkEvents(){_.forEach(this._events,(t,e)=>{this._events[e]=this._checkEventsContainer(t)})}_checkEventsContainer(t){return _.filter(t,this._checkEvent.bind(this))}clearEvents(t){t?Array.isArray(t)?_.forEach(t,t=>{this._events[t]=[]}):this._events[t]=[]:this._events={}}createEventsContainer(t){return this._events[t]=[],this._events[t]}findAnimation(t,e){return _.find(this.getAnimations(e),{id:t})}findEvent(t,e){return _.find(this.getEvents(e),{id:t})}finishEvents(t,e=!1){this.iterateEventsContainer(t,t=>{t.finish(e)})}getAnimations(t){return _.filter(this.getEvents(t),t=>t instanceof DKTools.Animation)}getEventIndex(t){return this.getEventsContainer(t).indexOf(t)}getEvents(t){if(t)return this.getEventsContainerByType(t);let e=[];return _.forEach(this._events,t=>{e=e.concat(t)}),e}getEventsContainer(t){return this.getEventsContainerByType(t.type)}getEventsContainerByType(t){return this._events[t]||this.createEventsContainer(t)}hasAnimation(t){return t instanceof DKTools.Animation&&this.getEventIndex(t)>=0}hasAnimations(t){return!DKTools.Utils.Array.isEmpty(this.getAnimations(t))}hasEvent(t){return this.getEventIndex(t)>=0}hasEvents(t){return!DKTools.Utils.Array.isEmpty(this.getEvents(t))}isEventsPaused(t){const e=this.getEventsContainerByType(t);return _.every(e,t=>t.isPaused())}iterateEventsContainer(t,e){const i=this.getEventsContainerByType(t);_.forEach(i,e)}pauseEvents(t,e=-1){this.iterateEventsContainer(t,t=>{t.pause(e)})}removeEvent(t){const e=this.getEventIndex(t);if(e>=0){return this.getEventsContainer(t)[e]=null,!0}return!1}resumeEvents(t){this.iterateEventsContainer(t,t=>{t.resume()})}stopEvents(t,e=!1){this.iterateEventsContainer(t,t=>{t.stop(e)})}update(){this._checkEvents()}updateEvent(t){t&&t.update()}updateEventsContainer(t){this.iterateEventsContainer(t,this.updateEvent.bind(this))}},Object.defineProperties(DKTools.EventManager,{events:{get:function(){return this._events},configurable:!0}}),DKTools.Unit=class{constructor(t){this.initialize.apply(this,arguments)}initialize(t){t=t||{},this.setSource(t.source),this.setPercents(t.percents),this.setGetValueHandler(t.getValueHandler)}add(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.add(e):this._source+=e,this):this}clone(){return new this.constructor(this)}div(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.div(e):this._source/=e,this):this}equals(t){return!!t&&(this._source===t.source&&this._percents===t.percents)}_getValueFromUnit(t){return t instanceof DKTools.Unit?t.getValue():t}getPercents(){return DKTools.Utils.isFunction(this._percents)?this._percents(this)||100:this._percents||100}getValue(){let t;return(t=DKTools.Utils.isFunction(this._getValueHandler)?this._getValueHandler(this):this.getValueBase())||0}getValueBase(){const t=this.getPercents()/100;return this._source instanceof DKTools.Unit?this._source.getValue()*t:Number.isFinite(this._source)?this._source*t:0}mul(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.mul(e):this._source*=e,this):this}setGetValueHandler(t){this._getValueHandler=t}setPercents(t=100){this._percents=t}setSource(t){this._source=t}sub(t){if(!t)return this;const e=this._getValueFromUnit(t);return e?(this._source instanceof DKTools.Unit?this._source.rem(e):this._source-=e,this):this}},Object.defineProperties(DKTools.Unit.prototype,{source:{get:function(){return this._source},configurable:!0},percents:{get:function(){return this._percents},configurable:!0},getValueHandler:{get:function(){return this._getValueHandler},configurable:!0}}),DKTools.Unit.Property=class extends DKTools.Unit{initialize(t){t=t||{},DKTools.Unit.prototype.initialize.call(this,t),this.setProperty(t.property)}add(t){if(!t)return this;const e=this._property,i=this._source[e];let o=this._getValueFromUnit(t);return o instanceof Object&&(o=o[e]),o?(i instanceof DKTools.Unit?i.add(o):this._source[e]+=o,this):this}div(t){if(!t)return this;const e=this._property,i=this._source[e];let o=this._getValueFromUnit(t);return o instanceof Object&&(o=o[e]),o?(i instanceof DKTools.Unit?i.div(o):this._source[e]/=o,this):this}equals(t){return!!t&&(_.isEqual(this._source,t.source)&&this._percents===t.percents&&this._property===t.property)}getValueBase(){if(!(this._source instanceof Object))return 0;return new DKTools.Unit({source:this._source[this._property],percents:this.getPercents()}).getValue()}mul(t){if(!t)return this;const e=this._property,i=this._source[e];let o=this._getValueFromUnit(t);return o instanceof Object&&(o=o[e]),o?(i instanceof DKTools.Unit?i.mul(o):this._source[e]*=o,this):this}setProperty(t){this._property=t}sub(t){if(!t)return this;const e=this._property,i=this._source[e];let o=this._getValueFromUnit(t);return o instanceof Object&&(o=o[e]),o?(i instanceof DKTools.Unit?i.rem(o):this._source[e]-=o,this):this}},Object.defineProperties(DKTools.Unit.Property.prototype,{property:{get:function(){return this._property},configurable:!0}}),DKTools.Unit.Properties=class extends DKTools.Unit{initialize(t){t=t||{},DKTools.Unit.prototype.initialize.call(this,t),this.setProperties(t.properties)}add(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].add(i):this._source[e]+=i)}),this}addProperty(t){Array.isArray(this._properties)&&this._properties.push(t)}div(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].div(i):this._source[e]/=i)}),this}equals(t){return!!t&&(_.isEqual(this._source,t.source)&&_.isEqual(this._percents,t.percents)&&_.isEqual(this._properties,t.properties))}getPercents(t){return DKTools.Utils.isFunction(this._percents)?this._percents(t,this)||100:this._percents instanceof Object?DKTools.Utils.isFunction(this._percents[t])?this._percents[t](this)||100:this._percents[t]||100:this._percents||100}getValue(t){return DKTools.Utils.isFunction(this._getValueHandler)?this._getValueHandler(t,this):this.getValueBase(t)}getValueBase(t){const e=t=>{const e=this.getPercents(t);return this._source[t]instanceof DKTools.Unit?this._source[t].getValue(t)*e/100:new DKTools.Unit.Property({source:this._source,property:t,percents:e}).getValue()};return t?e(t):_.reduce(this._properties,(t,i)=>(t[i]=e(i),t),{})}mul(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].mul(i):this._source[e]*=i)}),this}removeProperty(t){Array.isArray(this._properties)&&DKTools.Utils.Array.remove(this._properties,t)}setProperties(t){this._properties=DKTools.Utils.isFunction(t)?t:_.clone(t)}sub(t){if(!t)return this;let e=this._properties;return DKTools.Utils.isFunction(e)&&(e=e(this)),_.forEach(e,e=>{let i=this._getValueFromUnit(t);i instanceof Object&&(i=i[e]),i&&(this._source[e]instanceof DKTools.Unit?this._source[e].rem(i):this._source[e]-=i)}),this}},Object.defineProperties(DKTools.Unit.Properties.prototype,{properties:{get:function(){return this._properties},configurable:!0}}),DKTools.Unit.Function=class extends DKTools.Unit{add(){return this}div(){return this}getValueBase(){return this._source(this)*this.getPercents()/100}mul(){return this}sub(){return this}},DKTools.Base=class{constructor(){throw new Error("This is an abstract class!")}initialize(t,e,i,o){let n;t instanceof Graphics?(i=Graphics.boxWidth,o=Graphics.boxHeight):t instanceof Object?(n=t.x,e=t.y,i=t.width,o=t.height):Number.isFinite(t)&&(n=t),this.move(n,e),this.setupSize(i,o),this._clearAll(),this._createAll(),this._setupAll(),this._addAllChildren(),this.setupAll(t)}_addAllChildren(){}activate(){this.setActive(!0)&&this.updateActivateEvents()}actorName(t){const e=t>=1?$gameActors.actor(t):null;return e?e.name():""}addAllChildren(){this.updateAddAllChildrenEvents()}addAnimation(t){this._eventManager.addAnimation(t)}addEvent(t){return this._eventManager.addEvent(t)}addOneTimeEvent(t){return this._eventManager.addOneTimeEvent(t)}addOptionChangeListener(t,e){this._optionManager.addOptionChangeListener(t,e)}_clearAll(){this._clearMouseEnterTime(),this._clearWheel()}_clearMouseEnterTime(){this._mouseEnterTime=0}_clearWheel(){this._clearWheelX(),this._clearWheelY()}_clearWheelX(){this._wheelX=0}_clearWheelY(){this._wheelY=0}_createAll(){this._createOptionManager(),this._createEventManager()}_createEventManager(){this._eventManager=new DKTools.EventManager(this)}_createOptionManager(){this._optionManager=new DKTools.OptionManager}_checkHeight(t){const e=this.getMinHeight();return t?Math.max(e,t):e}_checkWidth(t){const e=this.getMinWidth();return t?Math.max(e,t):e}calcTextHeight(t,e=!1){if(!this.hasBitmap()||!t)return 0;const i=this.bitmap.fontSize,o=t.text.slice(t.index).split("\n"),n=e?o.length:1;let s=0;for(let t=0;t<n;t++){const e=/\x1b[\{\}]/g;let i=this.bitmap.fontSize;for(;;){const n=e.exec(o[t]);if(!n)break;"{"===n[0]&&this.makeFontBigger(),"}"===n[0]&&this.makeFontSmaller(),i<this.bitmap.fontSize&&(i=this.bitmap.fontSize)}s+=i+8}return this.bitmap.fontSize=i,s}canRedrawAll(){return this.hasBitmap()}canvasToLocalX(t){let e=this;for(;e;)t-=e.x,e=e.parent;return t}canvasToLocalY(t){let e=this;for(;e;)t-=e.y,e=e.parent;return t}checkAll(){this.updateCheckAllEvents(),this.checkSize()}checkSize(){}clear(){return this.clearRect()}clearEvents(t){this._eventManager.clearEvents(t)}clearLine(t){return this.clearRect(this.getLineRect(t))}clearOptions(){this._optionManager.clear()}clearRect(t,e,i,o){if(!this.hasBitmap())return!1;let n=t;return t instanceof Object&&(n=t.x,e=t.y,i=t.width,o=t.height),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),DKTools.Utils.isString(o)&&(e=this.getLineHeight()*parseFloat(o)),n=n||0,e=e||0,i=i||this.standardDrawingWidth(),o=o||this.standardDrawingHeight(),this.bitmap.clearRect(n,e,i,o),!0}clone(t={}){t=t||{};const e=new this.constructor(this);return t.cloneTexts&&_.forEach(this._texts,t=>{e.addText(t.text,{...t.options})}),t.cloneOptions&&e.enableOptions(this._optionManager.options),t.blockStart||e.start(),t.activate&&e.activate(),e}convertEscapeCharacters(t){try{return Window_Base.prototype.convertEscapeCharacters.call(this,t)}catch(e){return t=(t=(t=(t=(t=(t=(t=t.replace(/\\/g,"")).replace(/\x1b\x1b/g,"\\")).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bV\[(\d+)\]/gi,function(){return $gameVariables.value(parseInt(arguments[1]))}.bind(this))).replace(/\x1bN\[(\d+)\]/gi,function(){return this.actorName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bP\[(\d+)\]/gi,function(){return this.partyMemberName(parseInt(arguments[1]))}.bind(this))).replace(/\x1bG/gi,TextManager.currencyUnit)}}createAll(){this.updateCreateAllEvents()}deactivate(){this.setActive(!1)&&this.updateDeactivateEvents()}disableOption(t){this._optionManager.disableOption(t)}disableOptions(t){this._optionManager.disableOptions.apply(this._optionManager,arguments)}drawAll(){}drawArrow(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=ImageManager.loadSystem(this.standardWindowskin()),o=DKTools.Sprite.Arrow.getRect(t);return this.drawBitmap(i,{...e,source:o})}drawBitmap(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=DKTools.Utils.Bitmap.load(t);return!(!i||e.sync&&!i.isReady())&&(i.addLoadListener(()=>{const t=DKTools.Utils.isFunction,o=DKTools.Utils.isString,n=this.getLineHeight(),{paintOpacity:s,resetPaintOpacity:r}=e;let{source:a,destination:l}=e,u={};t(e.callback)&&(u=e.callback(i,this)),a=a||u.source||{},l=l||u.destination||{},t(a)&&(a=a(i,this)),t(l)&&(l=l(i,this));const c=_.defaultTo(a.x,0),h=_.defaultTo(a.width,i.width);let p=_.defaultTo(a.y,0),d=_.defaultTo(a.height,i.height);const f=_.defaultTo(l.x,0),g=_.defaultTo(l.width,h);let y=_.defaultTo(l.y,0),m=_.defaultTo(l.height,d);o(p)&&(p=n*parseFloat(p)),o(d)&&(d=n*parseFloat(d)),o(y)&&(y=n*parseFloat(y)),o(m)&&(m=n*parseFloat(m)),Number.isFinite(s)&&this.changePaintOpacity(s),this.bitmap.blt(i,c,p,h,d,f,y,g,m),r&&this.resetPaintOpacity()}),!0)}async drawBitmapAsync(t,e={}){if(!t)return!1;const i=await DKTools.Utils.Bitmap.loadAsync(t);return this.drawBitmap(i,e)}drawCharacter(t,e,i={}){if(!this.hasBitmap()||null==t||null==e)return!1;i=i||{};const o=ImageManager.loadCharacter(t),n=ImageManager.isBigCharacter(t),s=o.width/(n?3:12),r=o.height/(n?4:8),a=(e%4*3+1)*s,l=4*Math.floor(e/4)*r,u=new Rectangle(a,l,s,r),c=i.pos;let{x:h,y:p}=i;return c instanceof Object&&(h=c.x,p=c.y),h=h||0,p=p||0,this.drawBitmap(o,{...i,source:u,destination:{x:h,y:p}})}drawCircle(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:o,paintOpacity:n,resetPaintOpacity:s}=t;let{x:r,y:a}=t;return e instanceof Object&&(r=e.x,a=e.y),DKTools.Utils.isString(a)&&(a=this.getLineHeight()*parseFloat(a)),Number.isFinite(n)&&this.changePaintOpacity(n),this.bitmap.drawCircle(r||0,a||0,i||1,o||"white"),s&&this.resetPaintOpacity(),!0}drawFace(t,e,i={}){if(!this.hasBitmap()||null==t||null==e)return!1;i=i||{};const{pos:o,rect:n}=i;let{x:s,y:r,width:a,height:l}=i;o instanceof Object&&(s=o.x,r=o.y),n instanceof Object&&(s=n.x,r=n.y,a=n.width,l=n.height),a=a||Window_Base._faceWidth,l=l||Window_Base._faceHeight;const u=ImageManager.loadFace(t),c=Window_Base._faceWidth,h=Window_Base._faceHeight,p=Math.min(a,c),d=Math.min(l,h),f=e%4*c+(c-p)/2,g=Math.floor(e/4)*h+(h-d)/2,_=new Rectangle(f,g,p,d);return s=Math.floor((s||0)+Math.max(a-c,0)/2),r=Math.floor((r||0)+Math.max(l-h,0)/2),this.drawBitmap(u,{...i,source:_,destination:{x:s,y:r}})}drawIcon(t,e={}){if(!this.hasBitmap()||null==t)return!1;const i=ImageManager.loadSystem("IconSet"),o=Window_Base._iconWidth,n=Window_Base._iconHeight,s=t%16*o,r=Math.floor(t/16)*n,a=new Rectangle(s,r,o,n),l=e.pos;let{x:u,y:c}=e;return l instanceof Object&&(u=l.x,c=l.y),this.drawBitmap(i,{...e,source:a,destination:{x:u,y:c}})}drawItemName(t,e={}){if(!this.hasBitmap()||!t)return!1;e=e||{};const i=Window_Base._iconWidth+4,{pos:o,iconPos:n,paintOpacity:s,resetPaintOpacity:r}=e;let{x:a,y:l,iconX:u,iconY:c}=e;return o instanceof Object&&(a=o.x,l=o.y),n instanceof Object&&(u=n.x,c=n.y),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),Number.isFinite(s)&&this.changePaintOpacity(s),a=a||0,l=l||0,u=_.defaultTo(u,a+2),c=_.defaultTo(c,l+2),this.drawIcon(t.iconIndex,{x:u,y:c}),this.drawText(t.name,{x:a+i,y:l,width:(e.width||312)-i,height:e.height,align:"left",font:e.font,textColor:e.textColor,resetFont:e.resetFont,resetTextColor:e.resetTextColor}),r&&this.resetPaintOpacity(),!0}drawLine(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos1:e,pos2:i,color:o,lineWidth:n,paintOpacity:s,resetPaintOpacity:r}=t;let{x1:a,y1:l,x2:u,y2:c}=t;return e instanceof Object&&(a=e.x,l=e.y),i instanceof Object&&(u=i.x,c=i.y),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(c)&&(c=this.getLineHeight()*parseFloat(c)),Number.isFinite(s)&&this.changePaintOpacity(s),DKTools.Utils.Bitmap.drawLine(this.bitmap,a||0,l||0,u||0,c||0,o,n),r&&this.resetPaintOpacity(),!0}drawPolygon(t){if(!this.hasBitmap())return!1;t=t||{};const{points:e,paintOpacity:i,resetPaintOpacity:o}=t;Number.isFinite(i)&&this.changePaintOpacity(i);for(let i=0;i<e.length-1;i++){const o=e[i],n=e[i+1];this.drawLine({...t,pos1:o,pos2:n})}return o&&this.resetPaintOpacity(),!0}drawTextEx(t,e={}){if(!this.hasBitmap()||""===t||null==t)return 0;t=String(t),(e=e||{}).wrap instanceof Object&&(t=this.textWrap(t,e.wrap));const i=e.pos;let{x:o,y:n,index:s,left:r}=e;i instanceof Object&&(o=i.x,n=i.y),DKTools.Utils.isString(n)&&(n=this.getLineHeight()*parseFloat(n));const a={x:o=_.defaultTo(o,0),y:n=_.defaultTo(n,0),index:s=_.defaultTo(s,0),left:r=_.defaultTo(r,o)};for(a.text=this.convertEscapeCharacters(t),a.height=this.calcTextHeight(a,!1);a.index<a.text.length;)this.processCharacter(a);return a.width||a.x-o}drawWindowskinBack(t={}){if(!this.hasBitmap())return!1;t=t||{};const e=ImageManager.loadSystem(this.standardWindowskin());if(!e)return!1;const i=96,{pos:o,rect:n}=t;let{x:s,y:r,width:a,height:l,tone:u}=t;o instanceof Object&&(s=o.x,r=o.y),n instanceof Object&&(s=n.x,r=n.y,a=n.width,l=n.height);try{u=u||$gameSystem.windowTone()}catch(t){}s=s||0,r=r||0,a=a||this.standardDrawingWidth(),l=l||this.standardDrawingHeight(),u=u||[0,0,0];const c=new Bitmap(a,l);c.blt(e,0,0,i,i,0,0,a,l);for(let t=0;t<l;t+=i)for(let o=0;o<a;o+=i)c.blt(e,0,i,i,i,o,t,i,i);return c.adjustTone(...u),this.drawBitmap(c,{...t,source:{width:a,height:l},destination:{x:s,y:r}})}enableOption(t){this._optionManager.enableOption(t)}enableOptions(t){this._optionManager.enableOptions.apply(this._optionManager,arguments)}fillAll(t){return this.fillRect({color:t})}fillArc(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:o,lineWidth:n,anticlockwise:s,paintOpacity:r,resetPaintOpacity:a}=t;let{x:l,y:u,startAngle:c,endAngle:h}=t;return e instanceof Object&&(l=e.x,u=e.y),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),Number.isFinite(r)&&this.changePaintOpacity(r),l=l||0,u=u||0,c=c||0,h=_.defaulTo(h,2*Math.PI),DKTools.Utils.Bitmap.fillArc(this.bitmap,l,u,i,c,h,o,s),a&&this.resetPaintOpacity(),!0}fillRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,rect:i,paintOpacity:o,resetPaintOpacity:n}=t;let{x:s,y:r,width:a,height:l,color:u}=t;return e instanceof Object&&(s=e.x,r=e.y),i instanceof Object&&(s=i.x,r=i.y,a=i.width,l=i.height),DKTools.Utils.isString(r)&&(r=this.getLineHeight()*parseFloat(r)),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),Number.isFinite(o)&&this.changePaintOpacity(o),s=s||0,r=r||0,a=a||this.standardDrawingWidth(),l=l||this.standardDrawingHeight(),u=u||"white",this.bitmap.fillRect(s,r,a,l,u),n&&this.resetPaintOpacity(),!0}findAnimation(t,e){return this._eventManager.findAnimation(t,e)}findEvent(t,e){return this._eventManager.findEvent(t,e)}finishEvents(t,e=!1){this._eventManager.finishEvents(t,e)}getAnimations(t){return this._eventManager.getAnimations(t)}getChildById(t){return _.find(this.children,{id:t})}getEventIndex(t){return this._eventManager.getEventIndex(t)}getEvents(t){return this._eventManager.getEvents(t)}getEventsContainer(t){return this._eventManager.getEventsContainer(t)}getEventsContainerByType(t){return this._eventManager.getEventsContainerByType(t)}getFontHeight(t){let e;return(t=t||this.getLineHeight())-(t-.7*(e=this.hasBitmap()?this.bitmap.fontSize:this._font.fontSize))/2}getLineHeight(){try{return Window_Base.prototype.lineHeight.call(this)}catch(t){return 36}}getLineRect(t){const e=this.getLineHeight();return new Rectangle(0,e*parseInt(t),this.realWidth,e)}getLines(){return this.realHeight/this.getLineHeight()}getMinWidth(){return 0}getMinHeight(){return 0}getMinSize(){return{width:this.getMinWidth(),height:this.getMinHeight()}}getRealCenter(){const t=this.getRealSize();return new Point(t.width/2,t.height/2)}getCenter(){const t=this.getSize();return new Point(t.width/2,t.height/2)}getRealSize(){return{width:this.realWidth,height:this.realHeight}}getSize(){return{width:this.width,height:this.height}}getTextHeight(t,e={}){return this.getTextLines(t,e)*this.getLineHeight()}getTextFontHeight(t,e={}){return this.getTextLines(t,e)*this.getFontHeight()}getTextHeightEx(t,e={}){return e instanceof Object&&e.wrap instanceof Object&&(t=this.textWrap(t,e.wrap)),this.calcTextHeight({text:t,index:0},!0)}getTextLines(t,e){return e instanceof Object&&(t=this.textWrap(t,e)),t.split("\n").length}getTextWidth(t){return this.hasBitmap()&&""!==t&&null!=t?this.bitmap.measureTextWidth(String(t)):0}getTextWidthEx(t,e={}){try{return this.drawTextEx(t,{...e,x:-Number.MAX_SAFE_INTEGER,y:-Number.MAX_SAFE_INTEGER})}catch(t){return 0}}getWindowskinTextColor(t){const e=96+t%8*12+6,i=144+12*Math.floor(t/8)+6;if(this.hasWindowskin())return this.windowskin.getPixel(e,i);return ImageManager.loadSystem(this.standardWindowskin()).getPixel(e,i)}gradientFillAll(t="black",e="white",i=!1){return this.gradientFillRect({color1:t,color2:e,vertical:i})}gradientFillRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{vertical:e,rect:i,paintOpacity:o,resetPaintOpacity:n}=t;let{color1:s,color2:r,x:a,y:l,width:u,height:c}=t;return i instanceof Object&&(a=i.x,l=i.y,u=i.width,c=i.height),DKTools.Utils.isString(l)&&(l=this.getLineHeight()*parseFloat(l)),DKTools.Utils.isString(c)&&(c=this.getLineHeight()*parseFloat(c)),a=a||0,l=l||0,u=u||this.standardDrawingWidth(),c=c||this.standardDrawingHeight(),s=s||"black",r=r||"white",Number.isFinite(o)&&this.changePaintOpacity(o),this.bitmap.gradientFillRect(a,l,u,c,s,r,e),n&&this.resetPaintOpacity(),!0}hasAnimation(t){return this._eventManager.hasAnimation(t)}hasAnimations(t){return this._eventManager.hasAnimations(t)}hasBitmap(){return!!this.bitmap}hasEvent(t){return this._eventManager.hasEvent(t)}hasEvents(t){return this._eventManager.hasEvents(t)}hasMask(){return!!this.mask}hasParent(){return!!this.parent}hasWindowskin(){return!!this.windowskin}hide(t=!1){this.setVisible(!1)&&this.updateHideEvents(),t||this.deactivate()}isActive(){let t=this;for(;t;){if(!t.visible)return!1;t=t.parent}return this.active}isBusy(){return!this.isReady()}isButton(){return this instanceof DKTools.Sprite.Button}isChild(t){return t?DKTools.Utils.Array.contains(this.children,t):this.hasParent()}isCursor(){return this instanceof DKTools.Sprite.Cursor}isEventsPaused(t){return this._eventManager.isEventsPaused(t)}isInside(t,e){return!1}isLayout(){return this instanceof DKTools.Layout}isMouseInside(){return this.isInside(TouchInput.mouseX,TouchInput.mouseY)}isOptionDisabled(t){return this._optionManager.isOptionDisabled(t)}isOptionEnabled(t){return this._optionManager.isOptionEnabled(t)}isOptionsDisabled(t){return this._optionManager.isOptionsDisabled.apply(this._optionManager,arguments)}isOptionsEnabled(t){return this._optionManager.isOptionsEnabled.apply(this._optionManager,arguments)}isOutside(t,e){return!this.isInside(t,e)}isParent(t){return!!t&&this.parent===t}isReady(){return this.hasBitmap()&&this.bitmap.isReady()}isSelectable(){return this instanceof DKTools.Sprite.Selectable||this instanceof DKTools.Window.Selectable}isSomeOptionEnabled(){return this._optionManager.isSomeOptionEnabled()}isSomeOptionsDisabled(t){return this._optionManager.isSomeOptionsDisabled.apply(this._optionManager,arguments)}isSomeOptionsEnabled(t){return this._optionManager.isSomeOptionsEnabled.apply(this._optionManager,arguments)}isSprite(){return this instanceof DKTools.Sprite}isStarted(){return this._started}isViewport(){return this instanceof DKTools.Viewport}isVisible(){return this.visible}isVisibleAndActive(){return this.isVisible()&&this.isActive()}isWindow(){return this instanceof DKTools.Window}iterateChildren(t){_.forEach(this.children,t)}iterateEventsContainer(t,e){this._eventManager.iterateEventsContainer(t,e)}makeFontBigger(){this.hasBitmap()&&this.bitmap.fontSize<=96&&(this.bitmap.fontSize+=12)}makeFontSmaller(){this.hasBitmap()&&this.bitmap.fontSize>=24&&(this.bitmap.fontSize-=12)}move(t,e){t instanceof Object&&(e=t.y),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e));const i=DKTools.Utils.Point.toPoint(t,e);this.position.copy(i)}moveWithAnchor(t,e){t instanceof Object&&(e=t.y),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e));const i=DKTools.Utils.Point.toPoint(t,e),o=this.getRealSize(),n=this.anchor;this.move(i.x+n.x*o.width,i.y+n.y*o.height)}obtainEscapeCode(t){return Window_Base.prototype.obtainEscapeCode.call(this,t)}obtainEscapeParam(t){return Window_Base.prototype.obtainEscapeParam.call(this,t)}partyMemberName(t){const e=t>=1?$gameParty.members()[t-1]:null;return e?e.name():""}pauseEvents(t,e){this._eventManager.pauseEvents(t,e)}processAll(){this.processMouse(),this.processWheel()}processCharacter(t){Window_Base.prototype.processCharacter.call(this,t)}processDrawIcon(t,e){this.drawIcon(t,{x:e.x+2,y:e.y+2}),e.x+=Window_Base._iconWidth+4}processEscapeCharacter(t,e){try{Window_Base.prototype.processEscapeCharacter.call(this,t,e)}catch(i){switch(t){case"C":this.changeTextColor(this.getWindowskinTextColor(this.obtainEscapeParam(e)));break;case"I":this.processDrawIcon(this.obtainEscapeParam(e),e);break;case"{":this.makeFontBigger();break;case"}":this.makeFontSmaller()}}}processMouse(){this.isOptionEnabled("process-mouse")&&this.isVisible()&&(this.isActive()||this.isOptionEnabled("process-mouse-ignore-active"))?this.isMouseInside()?(0===this._mouseEnterTime&&this.updateMouseEnterEvents(),this.updateMouseInsideEvents(),TouchInput.isMouseMoved()&&this.updateMouseMoveEvents(),this._mouseEnterTime++):(this._mouseEnterTime>0&&this.updateMouseLeaveEvents(),this.updateMouseOutsideEvents(),this._clearMouseEnterTime()):this._clearMouseEnterTime()}processNewLine(t){t.width?t.width<t.x&&(t.width=t.x):t.width=t.x,Window_Base.prototype.processNewLine.call(this,t)}processNewPage(t){Window_Base.prototype.processNewPage.call(this,t)}processNormalCharacter(t){const e=t.text[t.index++],i=this.getTextWidth(e);this.drawText(e,{align:"left",pos:t,width:2*i,height:t.height}),t.x+=i}processWheel(){if(this._wheelX=TouchInput.wheelX,this._wheelY=TouchInput.wheelY,0!==this._wheelX||0!==this._wheelY){let t;t=this.isMouseInside()?"inside":"outside",0!==this._wheelX&&this.updateWheelXEvents(t),0!==this._wheelY&&this.updateWheelYEvents(t)}}redrawAll(){}refreshAll(){this.updateAll(),this.canRedrawAll()&&this.redrawAll(),this.updateRefreshAllEvents()}removeAll(){this.updateRemoveAllEvents()}removeAllChildren(){this.updateRemoveAllChildrenEvents()}removeEvent(t){return this._eventManager.removeEvent(t)}removeFromParent(){return!!this.hasParent()&&(this.parent.removeChild(this),!0)}removeMask(){this.mask=null}removeOptionChangeListener(t,e){this._optionManager.removeOptionChangeListener(t,e)}resumeEvents(t){this._eventManager.resumeEvents(t)}_setupAll(){this._setupOptions(),this._setupEvents(),this._setupAnimations()}_setupAnimations(){}_setupEvents(){}_setupOptions(){}standardActive(){return!0}standardDrawingHeight(){return this.hasBitmap()?this.bitmap.height:this.isSprite()?this._bitmapHeight:this.isWindow()?this.realHeight:null}standardDrawingWidth(){return this.hasBitmap()?this.bitmap.width:this.isSprite()?this._bitmapWidth:this.isWindow()?this.realWidth:null}standardPivot(){return new Point(0,0)}standardRotation(){return 0}standardScale(){return new Point(1,1)}standardSkew(){return new Point(0,0)}standardTint(){return 16777215}standardVisible(){return!0}standardWindowskin(){return"Window"}setupAll(t={}){t=t||{},this.setupId(t.id),this.setupActive(t.active),this.setupVisible(t.visible),this.setupScale(t.scale),this.setupPivot(t.pivot),this.setupSkew(t.skew),this.setupRotation(t.rotation),this.setupTint(t.tint)}setupActive(t){this.active=_.defaultTo(t,this.standardActive())}setupId(t){this._id=_.defaultTo(t,null)}setupPivot(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),o=Object.assign(this.standardPivot(),i);this.pivot.copy(o)}setupRotation(t){this.rotation=_.defaultTo(t,this.standardRotation())}setupScale(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),o=Object.assign(this.standardScale(),i);this.scale.copy(o)}setupSize(t,e){}setupSkew(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),o=Object.assign(this.standardSkew(),i);this.skew.copy(o)}setupTint(t){this.tint=_.defaultTo(t,this.standardTint())}setupVisible(t){this.visible=_.defaultTo(t,this.standardVisible())}setAll(t={},e=!1,i=!1){t=t||{};let o=0;return this.setId(t.id)&&o++,this.setActive(t.active)&&o++,this.setVisible(t.visible)&&o++,this.setScale(t.scale)&&o++,this.setPivot(t.pivot)&&o++,this.setSkew(t.skew)&&o++,this.setRotation(t.rotation)&&o++,this.setTint(t.tint)&&o++,o>0&&(e||this.start(),i&&this.activate()),o}setActive(t){if(this.active===t)return!1;const e=this.active;return this.setupActive(t),this.active!==e}setId(t){if(this._id===t)return!1;const e=this._id;return this.setupId(t),this._id!==e}setPivot(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.pivot,i))return!1;const o=DKTools.Utils.Point.clone(this.pivot);return this.setupPivot(i),!DKTools.Utils.Point.equals(this.pivot,o)}setRotation(t){if(this.rotation===t)return!1;const e=this.rotation;return this.setupRotation(t),this.rotation!==e}setScale(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.scale,i))return!1;const o=DKTools.Utils.Point.clone(this.scale);return this.setupScale(i),!DKTools.Utils.Point.equals(this.scale,o)}setSkew(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.skew,i))return!1;const o=DKTools.Utils.Point.clone(this.skew);return this.setupSkew(i),!DKTools.Utils.Point.equals(this.skew,o)}setTint(t){if(this.tint===t)return!1;const e=this.tint;return this.setupTint(t),this.tint!==e}setVisible(t){if(this.visible===t)return!1;const e=this.visible;return this.setupVisible(t),this.visible!==e}show(t=!1){this.setVisible(!0)&&this.updateShowEvents(),t&&this.activate()}start(t=!1){this._started=!0,this.removeAllChildren(),this.terminateAll(),this.removeAll(),this.checkAll(),this.createAll(),this.startAll(),this.addAllChildren(),this.refreshAll(),this.updateStartEvents(),t&&this.activate()}startAll(){this.updateStartAllEvents()}stopEvents(t,e=!1){this._eventManager.stopEvents(t,e)}strokeArc(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,radius:i,color:o,lineWidth:n,anticlockwise:s,paintOpacity:r,resetPaintOpacity:a}=t;let{x:l,y:u,startAngle:c,endAngle:h}=t;return e instanceof Object&&(l=e.x,u=e.y),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),Number.isFinite(r)&&this.changePaintOpacity(r),l=l||0,u=u||0,c=c||0,h=_.defaulTo(h,2*Math.PI),DKTools.Utils.Bitmap.strokeArc(this.bitmap,l,u,i,c,h,o,n,s),a&&this.resetPaintOpacity(),!0}strokeRect(t={}){if(!this.hasBitmap())return!1;t=t||{};const{pos:e,rect:i,lineWidth:o,paintOpacity:n,resetPaintOpacity:s}=t;let{x:r,y:a,width:l,height:u,color:c}=t;return e instanceof Object&&(r=e.x,a=pox.y),i instanceof Object&&(r=i.x,a=i.y,l=i.width,u=i.height),DKTools.Utils.isString(a)&&(a=this.getLineHeight()*parseFloat(a)),DKTools.Utils.isString(u)&&(u=this.getLineHeight()*parseFloat(u)),Number.isFinite(n)&&this.changePaintOpacity(n),r=r||0,a=a||0,l=l||this.standardDrawingWidth(),u=u||this.standardDrawingHeight(),c=c||"white",DKTools.Utils.Bitmap.strokeRect(this.bitmap,r,a,l,u,c,o),s&&this.resetPaintOpacity(),!0}switchOption(t){this._optionManager.switchOption(t)}switchOptions(t){this._optionManager.switchOptions.apply(this._optionManager,arguments)}terminate(){}terminateAll(){this.updateTerminateAllEvents()}textWrap(t,e={}){if(!this.hasBitmap()||""===t||null==t)return"";t=String(t),e=e||{};const i=t.split("\n"),o=e.maxWidth||this.bitmap.width,n=this.getTextWidth(" ");let s="",r=1;for(let t=0;t<i.length;t++){const a=i[t].split(" ");let l=o;for(let t=0;t<a.length;t++){const i=a[t],u=this.getTextWidth(i);if(e.breakWords&&u>o){const t=i.split("");for(let e=0;e<t.length;e++){const i=this.getTextWidth(t[e]);i>l?(s+="\n"+t[e],l=o-i):(0===e&&(s+=" "),s+=t[e],l-=i)}}else{const a=u+n;if(0===t||a>l){if(t>0){if(e.maxLines===r)return s;s+="\n",r++}s+=i,l=o-u}else l-=a,s+=" "+i}}t<i.length-1&&(s+="\n")}return s}update(){this.updateChildren(),this.processAll(),this.updateEvents()}updateAll(){this.updateOpacity(),this.updateUpdateAllEvents()}updateActivateEvents(){this.updateEventsContainer("activate")}updateAddAllChildrenEvents(){this.updateEventsContainer("add-all-children")}updateCheckAllEvents(){this.updateEventsContainer("check-all")}updateChild(t){t&&DKTools.Utils.isFunction(t.update)&&t.update()}updateChildren(){this.iterateChildren(this.updateChild)}updateCreateAllEvents(){this.updateEventsContainer("create-all")}updateDeactivateEvents(){this.updateEventsContainer("deactivate")}updateEvent(t){this._eventManager.updateEvent(t)}updateEvents(){this._eventManager.update(),this.updateReadyEvents(),this.updateUpdateEvents(),this.updateQueueEvents()}updateEventsContainer(t){this._eventManager.updateEventsContainer(t)}updateHideEvents(){this.updateEventsContainer("hide")}updateInputData(){SceneManager.updateInputData()}updateMouseEnterEvents(){this.updateEventsContainer("mouse-enter")}updateMouseInsideEvents(){this.updateEventsContainer("mouse-inside")}updateMouseLeaveEvents(){this.updateEventsContainer("mouse-leave")}updateMouseMoveEvents(){this.updateEventsContainer("mouse-move")}updateMouseOutsideEvents(){this.updateEventsContainer("mouse-outside")}updateOpacity(){}updateQueueEvents(){const t=this.getEventsContainerByType("queue")[0];this.updateEvent(t)}updateReadyEvents(){this.isReady()&&this.updateEventsContainer("ready")}updateRedrawAllEvents(){this.updateEventsContainer("redraw-all")}updateRefreshAllEvents(){this.updateEventsContainer("refresh-all")}updateRemoveAllChildrenEvents(){this.updateEventsContainer("remove-all-children")}updateRemoveAllEvents(){this.updateEventsContainer("remove-all")}updateShowEvents(){this.updateEventsContainer("show")}updateStartAllEvents(){this.updateEventsContainer("start-all")}updateStartEvents(){this.isStarted()&&this.updateEventsContainer("start")}updateTerminateAllEvents(){this.updateEventsContainer("terminate-all-children")}updateUpdateAllEvents(){this.updateEventsContainer("update-all")}updateUpdateEvents(){this.updateEventsContainer("update")}updateWheelXEvents(t){this.updateEventsContainer("wheel-X-"+t)}updateWheelYEvents(t){this.updateEventsContainer("wheel-Y-"+t)}},Object.defineProperties(DKTools.Base.prototype,{id:{get:function(){return this._id},configurable:!0},mouseX:{get:function(){return this.canvasToLocalX(TouchInput.mouseX)},configurable:!0},mouseY:{get:function(){return this.canvasToLocalY(TouchInput.mouseY)},configurable:!0},wheelX:{get:function(){return this._wheelX},configurable:!0},wheelY:{get:function(){return this._wheelY},configurable:!0},mouseEnterTime:{get:function(){return this._mouseEnterTime},configurable:!0}}),DKTools.Sprite.prototype=Object.create(Sprite.prototype),DKTools.Utils.mixin(DKTools.Sprite.prototype,DKTools.Base.prototype),DKTools.Sprite.prototype.constructor=DKTools.Sprite,Object.defineProperties(DKTools.Sprite.prototype,{windowskin:{get:function(){return this._windowskin},configurable:!0},frame:{get:function(){return this._frame},configurable:!0},realWidth:{get:function(){return this._frame.width},set:function(t){this._frame.width=t,this._refresh()},configurable:!0},realHeight:{get:function(){return this._frame.height},set:function(t){this._frame.height=t,this._refresh()},configurable:!0},width:{get:function(){return this.realWidth*this.scale.x},set:function(t){this.realWidth=Math.floor(t/this.scale.x)},configurable:!0},height:{get:function(){return this.realHeight*this.scale.y},set:function(t){this.realHeight=Math.floor(t/this.scale.y)},configurable:!0},align:{get:function(){return this._align},configurable:!0},font:{get:function(){return this._font},configurable:!0},textColor:{get:function(){return this._textColor},configurable:!0},paintOpacity:{get:function(){return this._paintOpacity},configurable:!0},fillColor:{get:function(){return this._fillColor},configurable:!0},opacity:{get:function(){return this._opacity},configurable:!0},graphicFolder:{get:function(){return this._graphicFolder},configurable:!0},graphicName:{get:function(){return this._graphicName},configurable:!0},texts:{get:function(){return this._texts},configurable:!0}}),DKTools.Sprite.prototype.initialize=function(t,e,i,o){Sprite.prototype.initialize.call(this),DKTools.Base.prototype.initialize.call(this,t,e,i,o),t instanceof DKTools.Sprite&&!t.isStarted()&&!t.hasFixedBitmap()?this.setupSize(t._getBitmapWidth(),t._getBitmapHeight()):t instanceof Bitmap&&this.setupBitmap(t),this.updateBitmap()},DKTools.Sprite.prototype.addText=function(t,e={},i=!1){null!=t&&""!==t&&(t=String(t),e=e||{},this._texts.push({text:t,options:e,id:e.id,type:e.type||"drawText"}),i&&this.refreshAll())},DKTools.Sprite.prototype.adjustTone=function(t){return!(!this.hasBitmap()||!t)&&(Bitmap.prototype.adjustTone.apply(this.bitmap,t),!0)},DKTools.Sprite.prototype.blur=function(){return!!this.hasBitmap()&&(this.bitmap.blur(),!0)},DKTools.Sprite.prototype._clearAll=function(){DKTools.Base.prototype._clearAll.call(this),this._clearTexts()},DKTools.Sprite.prototype._clearTexts=function(){this._texts=[]},DKTools.Sprite.prototype.canCloneFixedBitmap=function(){return!0},DKTools.Sprite.prototype.canRedrawAll=function(){return DKTools.Base.prototype.canRedrawAll.call(this)&&!this.hasGraphicName()&&!this.hasFixedBitmap()},DKTools.Sprite.prototype.changeFont=function(t){this.hasBitmap()&&this.updateFont(t)},DKTools.Sprite.prototype.changePaintOpacity=function(t){this.hasBitmap()&&this.updatePaintOpacity(t)},DKTools.Sprite.prototype.changeTextColor=function(t){this.hasBitmap()&&this.updateTextColor(t)},DKTools.Sprite.prototype.checkSize=function(){const t=this.getMinWidth(),e=this.getMinHeight();let i=0;return this._bitmapWidth<t&&(this.setupWidth(t),i++),this._bitmapHeight<e&&(this.setupHeight(e),i++),i},DKTools.Sprite.prototype.createAll=function(){DKTools.Base.prototype.createAll.call(this),this.createBitmap(),this.createMask()},DKTools.Sprite.prototype.createBitmap=function(){this.hasGraphicName()?this._loadGraphic():this.hasFixedBitmap()||(this.bitmap=new Bitmap(this._getBitmapWidth(),this._getBitmapHeight()))},DKTools.Sprite.prototype.createRectMask=function(){const t=new PIXI.Graphics;t.beginFill(),t.drawRect(this.x,this.y,this.bitmap.width,this.bitmap.height),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createCircleMask=function(){const t=new PIXI.Graphics,e=this.bitmap.width/2,i=this.x+e,o=this.y+e;t.beginFill(),t.drawCircle(i,o,e),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createEllipseMask=function(){const t=new PIXI.Graphics,e=this.bitmap.width/2,i=this.bitmap.height/2,o=this.x+e,n=this.y+i;t.beginFill(),t.drawEllipse(o,n,e,i),t.endFill(),this.setMask(t)},DKTools.Sprite.prototype.createMask=function(t){switch(t){case"rect":this.createRectMask();break;case"circle":this.createCircleMask();break;case"ellipse":this.createEllipseMask()}},DKTools.Sprite.prototype.drawAll=function(){this.updateFill(),this.drawAllTexts(),this.updateDrawAllEvents()},DKTools.Sprite.prototype.drawAllTexts=function(){_.forEach(this._texts,t=>{this[t.type](t.text,t.options)})},DKTools.Sprite.prototype.drawText=function(t,e={}){if(!this.hasBitmap()||null==t||""===t)return!1;t=String(t),e=e||{};const{pos:i,rect:o,font:n,textColor:s,paintOpacity:r,resetFont:a,resetTextColor:l,resetPaintOpacity:u}=e;let{x:c,y:h,width:p,height:d,align:f}=e;return i instanceof Object&&(c=i.x,h=i.y),o instanceof Object&&(c=o.x,h=o.y,p=o.width,d=o.height),DKTools.Utils.isString(h)&&(h=this.getLineHeight()*parseFloat(h)),DKTools.Utils.isString(d)&&(d=this.getLineHeight()*parseFloat(d)),c=c||0,h=h||0,p=p||this.standardDrawingWidth(),d=d||this.getLineHeight(),f=f||this.align,n&&this.changeFont(n),s&&this.changeTextColor(s),Number.isFinite(r)&&this.changePaintOpacity(r),this.bitmap.drawText(t,c,h,p,d,f),a&&this.resetFont(),l&&this.resetTextColor(),u&&this.resetPaintOpacity(),!0},DKTools.Sprite.prototype.findText=function(t){return _.find(this._texts,{id:t})},DKTools.Sprite.prototype._getBitmapHeight=function(){return this._bitmapHeight},DKTools.Sprite.prototype._getBitmapWidth=function(){return this._bitmapWidth},DKTools.Sprite.prototype.getCurrentOpacity=function(){return 255*this.alpha},DKTools.Sprite.prototype.hasFillColor=function(){return!!this._fillColor},DKTools.Sprite.prototype.hasFixedBitmap=function(){return!!this._fixedBitmap},DKTools.Sprite.prototype.hasGraphicFolder=function(){return!!this._graphicFolder},DKTools.Sprite.prototype.hasGraphicName=function(){return!!this._graphicName},DKTools.Sprite.prototype.hasTexts=function(){return this._texts.length>0},DKTools.Sprite.prototype.isInside=function(t,e){const i=this.canvasToLocalX(t),o=this.canvasToLocalY(e),n=this.width,s=this.height,r=this.anchor;return new Rectangle(-n*r.x,-s*r.y,n,s).contains(i,o)},DKTools.Sprite.prototype.isResizable=function(){return!this.hasGraphicName()&&!this.hasFixedBitmap()},DKTools.Sprite.prototype._loadGraphic=function(){if(this.hasGraphicFolder()&&this.hasGraphicName()){const t=this._graphicFolder,e=this._graphicName,i=this._graphicLoadListener;this.loadBitmap(t,e,i),this.updateReadyEvents()}},DKTools.Sprite.prototype.loadAnimation=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/animations/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/animations/",t,e,i,o)},DKTools.Sprite.prototype.loadBattleback1=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/battlebacks1/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/battlebacks1/",t,e,i,o)},DKTools.Sprite.prototype.loadBattleback2=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/battlebacks2/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/battlebacks2/",t,e,i,o)},DKTools.Sprite.prototype.loadBitmap=function(t,e,i,o,n){if(t instanceof Object)return this.loadBitmap(t.folder,t.filename,t.listener,t.hue,t.smooth);const s=DKTools.Utils.Bitmap.load(t,e,null,o,n);return!!this.setBitmap(s)&&(DKTools.Utils.isFunction(i)&&this.hasBitmap()&&this.bitmap.addLoadListener(i),!0)},DKTools.Sprite.prototype.loadCharacter=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/characters/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/characters/",t,e,i,o)},DKTools.Sprite.prototype.loadEnemy=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/enemies/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/enemies/",t,e,i,o)},DKTools.Sprite.prototype.loadFace=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/faces/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/faces/",t,e,i,o)},DKTools.Sprite.prototype.loadParallax=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/parallaxes/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/parallaxes/",t,e,i,o)},DKTools.Sprite.prototype.loadPicture=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/pictures/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/pictures/",t,e,i,o)},DKTools.Sprite.prototype.loadSvActor=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/sv_actors/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/sv_actors/",t,e,i,o)},DKTools.Sprite.prototype.loadSvEnemy=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/sv_enemies/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/sv_enemies/",t,e,i,o)},DKTools.Sprite.prototype.loadSystem=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/system/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/system/",t,e,i,o)},DKTools.Sprite.prototype.loadTileset=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/tilesets/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/tilesets/",t,e,i,o)},DKTools.Sprite.prototype.loadTitle1=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/titles1/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/titles1/",t,e,i,o)},DKTools.Sprite.prototype.loadTitle2=function(t,e,i,o){return t instanceof Object?this.loadBitmap("img/titles2/",t.filename,t.listener,t.hue,t.smooth):this.loadBitmap("img/titles2/",t,e,i,o)},DKTools.Sprite.prototype.loadWindowskin=function(t,e,i,o){return t instanceof Object?this.loadSystem(t.filename||this.standardWindowskin(),t.listener,t.hue,t.smooth):this.loadSystem(t||this.standardWindowskin(),e,i,o)},DKTools.Sprite.prototype.standardAlign=function(){return"center"},DKTools.Sprite.prototype.standardAnchor=function(){return new Point(0,0)},DKTools.Sprite.prototype.standardFillColor=function(){return null},DKTools.Sprite.prototype.standardFont=function(){return{fontFace:this.standardFontFace(),fontItalic:this.standardFontItalic(),fontSize:this.standardFontSize()}},DKTools.Sprite.prototype.standardFontFace=function(){return"GameFont"},DKTools.Sprite.prototype.standardFontItalic=function(){return!1},DKTools.Sprite.prototype.standardFontSize=function(){return 28},DKTools.Sprite.prototype.standardFrame=function(){return new Rectangle(0,0,this.realWidth,this.realHeight)},DKTools.Sprite.prototype.standardGraphicFolder=function(){return"img/system/"},DKTools.Sprite.prototype.standardGraphicName=function(){return""},DKTools.Sprite.prototype.standardOpacity=function(){return 255},DKTools.Sprite.prototype.standardPaintOpacity=function(){return 255},DKTools.Sprite.prototype.standardTextColor=function(){return"#ffffff"},DKTools.Sprite.prototype.standardMask=function(){return null},DKTools.Sprite.prototype.setupAll=function(t={}){t=t||{},DKTools.Base.prototype.setupAll.call(this,t),this.setupBitmap(t),this.setupFrame(t.frame),this.setupAnchor(t.anchor),this.setupAlign(t.align),this.setupFont(t.font),this.setupTextColor(t.textColor),this.setupPaintOpacity(t.paintOpacity),this.setupFillColor(t.fillColor),this.setupOpacity(t.opacity),this.setupGraphicFolder(t.graphicFolder),this.setupGraphicName(t.graphicName)},DKTools.Sprite.prototype.setupAlign=function(t){this._align=t||this.standardAlign()},DKTools.Sprite.prototype.setupAnchor=function(t,e){const i=DKTools.Utils.Point.tryToPoint(t,e),o=Object.assign(this.standardAnchor(),i);this.anchor.copy(o)},DKTools.Sprite.prototype.setupBitmap=function(t){let e=null;t instanceof DKTools.Sprite&&t.hasFixedBitmap()&&t.canCloneFixedBitmap()?e=DKTools.Utils.Bitmap.clone(t.bitmap):t instanceof Object&&(e=DKTools.Utils.Bitmap.load(t.bitmap||t)),e?(this.bitmap=e,this.bitmap.addLoadListener(this.setupSize.bind(this))):this.bitmap=null,this._fixedBitmap=!!this.bitmap},DKTools.Sprite.prototype.setupFillColor=function(t){this._fillColor=null!==t?_.defaultTo(t,this.standardFillColor()):null},DKTools.Sprite.prototype.setupFont=function(t){this._font=Object.assign(this.standardFont(),t)},DKTools.Sprite.prototype.setupFrame=function(t,e,i,o){const n=DKTools.Utils.Rectangle.tryToRectangle(t,e,i,o),s=Object.assign(this.standardFrame(),n);Sprite.prototype.setFrame.call(this,s.x,s.y,s.width,s.height)},DKTools.Sprite.prototype.setupGraphicFolder=function(t){this._graphicFolder=_.defaultTo(t,this.standardGraphicFolder())},DKTools.Sprite.prototype.setupGraphicLoadListener=function(t){this._graphicLoadListener=t||null},DKTools.Sprite.prototype.setupGraphicName=function(t){this._graphicName=null!==t?_.defaultTo(t,this.standardGraphicName()):null},DKTools.Sprite.prototype.setupHeight=function(t){DKTools.Utils.isString(t)&&(t=this.getLineHeight()*parseFloat(t)),this._bitmapHeight=this._checkHeight(t)},DKTools.Sprite.prototype.setupMask=function(t){this.mask=null!==t?_.defaultTo(t,this.standardMask()):null},DKTools.Sprite.prototype.setupOpacity=function(t){this._opacity=_.defaultTo(t,this.standardOpacity())},DKTools.Sprite.prototype.setupPaintOpacity=function(t){this._paintOpacity=_.defaultTo(t,this.standardPaintOpacity())},DKTools.Sprite.prototype.setupSize=function(t,e){if(t instanceof Object)return this.setupSize(t.width,t.height);this.setupWidth(t),this.setupHeight(e)},DKTools.Sprite.prototype.setupTextColor=function(t){this._textColor=t||this.standardTextColor()},DKTools.Sprite.prototype.setupWidth=function(t){this._bitmapWidth=this._checkWidth(t)},DKTools.Sprite.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Base.prototype.setAll.call(this,t,!0);return this.setAlign(t.align,!0)&&o++,this.setAnchor(t.anchor)&&o++,this.setFont(t.font,!0)&&o++,this.setTextColor(t.textColor,!0)&&o++,this.setPaintOpacity(t.paintOpacity,!0)&&o++,this.setFillColor(t.fillColor,!0)&&o++,this.setOpacity(t.opacity,!0)&&o++,this.setGraphicFolder(t.graphicFolder,!0)&&o++,this.setGraphicName(t.graphicName,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.prototype.setAlign=function(t,e=!1){if(this._align===t)return!1;const i=this._align;return this.setupAlign(t),this._align!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setAnchor=function(t,e){const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this.anchor,i))return!1;const o=DKTools.Utils.Point.clone(this.anchor);return this.setupAnchor(i),!DKTools.Utils.Point.equals(this.anchor,o)},DKTools.Sprite.prototype.setBitmap=function(t){return this.bitmap!==t&&(this.setupBitmap(t),!0)},DKTools.Sprite.prototype.setFillColor=function(t,e=!1){if(this._fillColor===t)return!1;const i=this._fillColor;return this.setupFillColor(t),this._fillColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setFont=function(t,e=!1){if(_.isEqual(this._font,Object.assign(this.standardFont(),t)))return!1;const i={...this._font};return this.setupFont(t),!_.isEqual(this._font,i)&&(e||this.start(),!0)},DKTools.Sprite.prototype.setFrame=function(t,e,i,o){const n=DKTools.Utils.Rectangle.toRectangle(t,e,i,o);if(DKTools.Utils.Rectangle.equals(this._frame,n))return!1;const s=DKTools.Utils.Rectangle.clone(this._frame);return this.setupFrame(n),!DKTools.Utils.Rectangle.equals(this._frame,s)},DKTools.Sprite.prototype.setGraphicFolder=function(t,e=!1){if(this._graphicFolder===t)return!1;const i=this._graphicFolder;return this.setupGraphicFolder(t),this._graphicFolder!==i&&(e||this.start(),!0)},DKTools.Sprite.prototype.setGraphicName=function(t,e=!1){if(this._graphicName===t)return!1;const i=this._graphicName;return this.setupGraphicName(t),this._graphicName!==i&&(e||this.start(),!0)},DKTools.Sprite.prototype.setHeight=function(t,e=!1){return this.resize(this._getBitmapWidth(),t,e)},DKTools.Sprite.prototype.setMask=function(t){return this.mask!==t&&(this.setupMask(t),!0)},DKTools.Sprite.prototype.setOpacity=function(t,e=!1){if(this._opacity===t)return!1;const i=this._opacity;return this.setupOpacity(t),this._opacity!==i&&(e||this.updateOpacity(),!0)},DKTools.Sprite.prototype.setPaintOpacity=function(t,e=!1){if(this._paintOpacity===t)return!1;const i=this._paintOpacity;return this.setupPaintOpacity(t),this._paintOpacity!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setTextColor=function(t,e=!1){if(this._textColor===t)return!1;const i=this._textColor;return this.setupTextColor(t),this._textColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.prototype.setWidth=function(t,e=!1){return this.resize(t,this._getBitmapHeight(),e)},DKTools.Sprite.prototype.redrawAll=function(){this.clear(),this.drawAll(),this.updateRedrawAllEvents()},DKTools.Sprite.prototype.removeBitmap=function(){this.hasBitmap()&&this.setBitmap(null)},DKTools.Sprite.prototype.removeFillColor=function(){this.hasFillColor()&&this.setFillColor(null)},DKTools.Sprite.prototype.removeGraphicName=function(){this.hasGraphicName()&&this.setGraphicName(null)},DKTools.Sprite.prototype.removeText=function(t,e=!1){const i=this.findText(t);return i?(DKTools.Utils.Array.remove(this._texts,i),e||this.refreshAll(),i):null},DKTools.Sprite.prototype.reserveAnimation=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/animations/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/animations/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveBattleback1=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/battlebacks1/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/battlebacks1/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveBattleback2=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/battlebacks2/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/battlebacks2/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveBitmap=function(t,e,i,o,n,s){if(t instanceof Object)return this.reserveBitmap(t.folder,t.filename,t.listener,t.hue,t.smooth,t.reservationId);const r=DKTools.Utils.Bitmap.reserve(t,e,null,o,n,s);return!!this.setBitmap(r)&&(DKTools.Utils.isFunction(i)&&this.hasBitmap()&&this.bitmap.addLoadListener(i),!0)},DKTools.Sprite.prototype.reserveCharacter=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/characters/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/characters/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveEnemy=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/enemies/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/enemies/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveFace=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/faces/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/faces/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveParallax=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/parallaxes/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/parallaxes/",t,e,i,o,n)},DKTools.Sprite.prototype.reservePicture=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/pictures/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/pictures/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveSvActor=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/sv_actors/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/sv_actors/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveSvEnemy=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/sv_enemies/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/sv_enemies/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveSystem=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/system/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/system/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveTileset=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/tilesets/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/tilesets/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveTitle1=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/titles1/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/titles1/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveTitle2=function(t,e,i,o,n){return t instanceof Object?this.reserveBitmap("img/titles2/",t.filename,t.listener,t.hue,t.smooth,t.reservationId):this.reserveBitmap("img/titles2/",t,e,i,o,n)},DKTools.Sprite.prototype.reserveWindowskin=function(t,e,i,o,n){return t instanceof Object?this.reserveSystem(t.filename||this.standardWindowskin(),t.listener,t.hue,t.smooth,t.reservationId):this.reserveSystem(t||this.standardWindowskin(),e,i,o,n)},DKTools.Sprite.prototype.resetAll=function(){this.resetFont(),this.resetPaintOpacity(),this.resetTextColor()},DKTools.Sprite.prototype.resetFont=function(){this.changeFont(this.font)},DKTools.Sprite.prototype.resetPaintOpacity=function(){this.changePaintOpacity(this.paintOpacity)},DKTools.Sprite.prototype.resetTextColor=function(){this.changeTextColor(this.textColor)},DKTools.Sprite.prototype.resize=function(t,e,i=!1,o=!1){if(!this.isResizable())return!1;if(t=_.defaultTo(t,this.getMinWidth()),e=_.defaultTo(e,this.getMinHeight()),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),this._bitmapWidth===t&&this._bitmapHeight===e)return!1;const n=this._bitmapWidth,s=this._bitmapHeight;return this.setupSize(t,e),(this._bitmapWidth!==n||this._bitmapHeight!==s)&&(i||this.start(),o&&this.activate(),!0)},DKTools.Sprite.prototype.rotateHue=function(t){return!(!this.hasBitmap()||!t)&&(this.bitmap.rotateHue(t),!0)},DKTools.Sprite.prototype.updateAll=function(){DKTools.Base.prototype.updateAll.call(this),this.updateBitmap()},DKTools.Sprite.prototype.updateBitmap=function(){this.hasBitmap()&&(this.updateFont(),this.updatePaintOpacity(),this.updateTextColor())},DKTools.Sprite.prototype.updateDrawAllEvents=function(){this.updateEventsContainer("draw-all")},DKTools.Sprite.prototype.updateFill=function(){this.hasFillColor()&&this.fillAll(this.fillColor)},DKTools.Sprite.prototype.updateFont=function(t={}){t=t||{},this.bitmap.fontFace=t.fontFace||this.font.fontFace,this.bitmap.fontItalic=!!t.fontItalic,this.bitmap.fontSize=t.fontSize||this.font.fontSize},DKTools.Sprite.prototype.updatePaintOpacity=function(t){Number.isFinite(t)||(t=this.paintOpacity),this.bitmap.paintOpacity=t},DKTools.Sprite.prototype.updateTextColor=function(t){this.bitmap.textColor=t||this.textColor},DKTools.Sprite.prototype.updateOpacity=function(t){Number.isFinite(t)||(t=this.opacity),this.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},DKTools.Sprite.Button.prototype=Object.create(DKTools.Sprite.prototype),DKTools.Sprite.Button.prototype.constructor=DKTools.Sprite.Button,Object.defineProperties(DKTools.Sprite.Button.prototype,{longPressInterval:{get:function(){return this._longPressInterval},configurable:!0},mousePressTime:{get:function(){return this._mousePressTime},configurable:!0},pressX:{get:function(){return this.canvasToLocalX(TouchInput.x)},configurable:!0},pressY:{get:function(){return this.canvasToLocalY(TouchInput.y)},configurable:!0}}),DKTools.Sprite.Button.prototype._clearAll=function(){DKTools.Sprite.prototype._clearAll.call(this),this._clearMousePressTime()},DKTools.Sprite.Button.prototype._clearMousePressTime=function(){this._mousePressTime=0},DKTools.Sprite.Button.prototype.isPressed=function(){return this._mousePressTime>0&&!this.isLongPressed()},DKTools.Sprite.Button.prototype.isLongPressed=function(){return this._mousePressTime>=this._longPressInterval},DKTools.Sprite.Button.prototype._setupEvents=function(){DKTools.Sprite.prototype._setupEvents.call(this),this._setupUpdateButtonStateEvent()},DKTools.Sprite.Button.prototype._setupOptions=function(){DKTools.Sprite.prototype._setupOptions.call(this),this._setupProcessMouseOption()},DKTools.Sprite.Button.prototype._setupUpdateButtonStateEvent=function(){this.addEvent({type:"update",onUpdate:this.updateButtonState.bind(this)})},DKTools.Sprite.Button.prototype._setupProcessMouseOption=function(){this.enableOption("process-mouse")},DKTools.Sprite.Button.prototype.standardActive=function(){return!1},DKTools.Sprite.Button.prototype.standardLongPressInterval=function(){return 18},DKTools.Sprite.Button.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupLongPressInterval(t.longPressInterval)},DKTools.Sprite.Button.prototype.setupLongPressInterval=function(t){this._longPressInterval=t||this.standardLongPressInterval()},DKTools.Sprite.Button.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setLongPressInterval(t.longPressInterval)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.Button.prototype.setLongPressInterval=function(t){if(this._longPressInterval===t)return!1;const e=this._longPressInterval;return this.setupLongPressInterval(t),this._longPressInterval!==e},DKTools.Sprite.Button.prototype.processAll=function(){DKTools.Sprite.prototype.processAll.call(this),this.processMousePress()},DKTools.Sprite.Button.prototype.processMousePress=function(){if(this.isVisible()&&this.isMouseInside()&&(this.isActive()||this.isOptionEnabled("process-mouse-press-ignore-active")))if(TouchInput.isMousePressed()){let t;this._mousePressTime++,TouchInput.isLeftButtonPressed()?t="left":TouchInput.isMiddleButtonPressed()?t="middle":TouchInput.isRightButtonPressed()&&(t="right"),t&&(this.updateMouseDownEvents(t),this.isLongPressed()&&(this._mousePressTime===this._longPressInterval&&this.updateMouseLongPressStartedEvents(t),this.updateMouseLongPressEvents(t)))}else{let t;TouchInput.isLeftButtonReleased()?t="left":TouchInput.isMiddleButtonReleased()?t="middle":TouchInput.isRightButtonReleased()&&(t="right"),t&&(this.isLongPressed()?this.updateMouseLongPressFinishedEvents(t):this.isPressed()&&this.updateMouseClickEvents(t),this._mousePressTime>0&&this.updateMouseUpEvents(t)),this._clearMousePressTime()}else this._clearMousePressTime()},DKTools.Sprite.Button.prototype.updateMouseDownEvents=function(t){this.updateEventsContainer("mouse-down-"+t)},DKTools.Sprite.Button.prototype.updateMouseUpEvents=function(t){this.updateEventsContainer("mouse-up-"+t)},DKTools.Sprite.Button.prototype.updateMouseClickEvents=function(t){this.updateEventsContainer("mouse-click-"+t)},DKTools.Sprite.Button.prototype.updateMouseLongPressEvents=function(t){this.updateEventsContainer("mouse-long-press-"+t)},DKTools.Sprite.Button.prototype.updateMouseLongPressStartedEvents=function(t){this.updateEventsContainer(`mouse-long-press-${t}-started`)},DKTools.Sprite.Button.prototype.updateMouseLongPressFinishedEvents=function(t){this.updateEventsContainer(`mouse-long-press-${t}-finished`)},DKTools.Sprite.Button.prototype.updateStateNormalEvents=function(){this.updateEventsContainer("state-normal")},DKTools.Sprite.Button.prototype.updateStatePressedEvents=function(){this.updateEventsContainer("state-pressed")},DKTools.Sprite.Button.prototype.updateButtonState=function(){this._mousePressTime>0?this.updateStatePressedEvents():this.updateStateNormalEvents()},DKTools.Sprite.Cursor.prototype=Object.create(DKTools.Sprite.prototype),DKTools.Sprite.Cursor.prototype.constructor=DKTools.Sprite.Cursor,Object.defineProperties(DKTools.Sprite.Cursor.prototype,{cursorRect:{get:function(){return this._cursorRect},configurable:!0},blinkSpeed:{get:function(){return this._blinkSpeed},configurable:!0}}),DKTools.Sprite.Cursor.prototype._clearAll=function(){DKTools.Sprite.prototype._clearAll.call(this),this._clearAnimationCount()},DKTools.Sprite.Cursor.prototype._clearAnimationCount=function(){this._animationCount=0},DKTools.Sprite.Cursor.prototype._createAll=function(){DKTools.Sprite.prototype._createAll.call(this),this._createWindowskin()},DKTools.Sprite.Cursor.prototype._createWindowskin=function(){this._windowskin=ImageManager.loadSystem(this.standardWindowskin())},DKTools.Sprite.Cursor.prototype.refreshAll=function(){DKTools.Sprite.prototype.refreshAll.call(this),this.refreshCursor()},DKTools.Sprite.Cursor.prototype.refreshCursor=function(){const t=this._cursorRect.x,e=this._cursorRect.y,i=this._cursorRect.width,o=this._cursorRect.height,n=this.parent,s=Math.min(i,n.realWidth-t),r=Math.min(o,n.realHeight-e);if(this.move(t,e),i>0&&o>0){const t=this._windowskin,e=new Bitmap(s,r),n=96,a=48;e.blt(t,n+4,n+4,a-8,a-8,4,4,i-8,o-8),e.blt(t,n+4,n,a-8,4,4,0,i-8,4),e.blt(t,n+4,n+a-4,a-8,4,4,0+o-4,i-8,4),e.blt(t,n,n+4,4,a-8,0,4,4,o-8),e.blt(t,n+a-4,n+4,4,a-8,0+i-4,4,4,o-8),e.blt(t,n,n,4,4,0,0,4,4),e.blt(t,n+a-4,n,4,4,0+i-4,0,4,4),e.blt(t,n,n+a-4,4,4,0,0+o-4,4,4),e.blt(t,n+a-4,n+a-4,4,4,0+i-4,0+o-4,4,4),this.setupBitmap(e)}},DKTools.Sprite.Cursor.prototype.standardBlinkSpeed=function(){return 8},DKTools.Sprite.Cursor.prototype.standardCursorRect=function(){return new Rectangle(0,0,0,0)},DKTools.Sprite.Cursor.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupBlinkSpeed(t.blinkSpeed),this.setupCursorRect(t.cursorRect)},DKTools.Sprite.Cursor.prototype.setupBlinkSpeed=function(t){this._blinkSpeed=_.defaultTo(t,this.standardBlinkSpeed())},DKTools.Sprite.Cursor.prototype.setupCursorRect=function(t,e,i,o){const n=DKTools.Utils.Rectangle.tryToRectangle(t,e,i,o);this._cursorRect=Object.assign(this.standardCursorRect(),n)},DKTools.Sprite.Cursor.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setBlinkSpeed(t.blinkSpeed)&&o++,this.setCursorRect(t.cursorRect)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.Cursor.prototype.setBlinkSpeed=function(t){if(this._blinkSpeed===t)return!1;const e=this._blinkSpeed;return this.setupBlinkSpeed(t),this._blinkSpeed!==e},DKTools.Sprite.Cursor.prototype.setCursorRect=function(t,e,i,o){const n=DKTools.Utils.Rectangle.toRectangle(t,e,i,o);if(DKTools.Utils.Rectangle.equals(this._cursorRect,n))return!1;const s=DKTools.Utils.Rectangle.clone(this._cursorRect);return this.setupCursorRect(n),!DKTools.Utils.Rectangle.equals(this._cursorRect,s)&&(this.refreshCursor(),!0)},DKTools.Sprite.Cursor.prototype.processAll=function(){DKTools.Sprite.prototype.processAll.call(this),this.processCursorAnimation()},DKTools.Sprite.Cursor.prototype.processCursorAnimation=function(){const t=this._animationCount%40;let e=this.parent.getCurrentOpacity();this.parent.isVisibleAndActive()&&(this._animationCount++,e-=t<20?t*this._blinkSpeed:(40-t)*this._blinkSpeed),this.setOpacity(e)},DKTools.Sprite.Arrow.prototype=Object.create(DKTools.Sprite.Button.prototype),DKTools.Sprite.Arrow.prototype.constructor=DKTools.Sprite.Arrow,Object.defineProperties(DKTools.Sprite.Arrow.prototype,{arrowType:{get:function(){return this._arrowType},configurable:!0}}),DKTools.Sprite.Arrow.getRect=function(t){const e=24,i=12;let o,n,s,r;switch(t){case"up":o=132,n=24,s=e,r=i;break;case"down":o=132,n=60,s=e,r=i;break;case"left":o=120,n=36,s=i,r=e;break;case"right":o=156,n=36,s=i,r=e}return DKTools.Utils.Rectangle.tryToRectangle(o,n,s,r)},DKTools.Sprite.Arrow.prototype.refreshAll=function(){DKTools.Sprite.Button.prototype.refreshAll.call(this),this.refreshArrow()},DKTools.Sprite.Arrow.prototype.refreshArrow=function(){this.setFrame(DKTools.Sprite.Arrow.getRect(this._arrowType))},DKTools.Sprite.Arrow.prototype.standardVisible=function(){return!1},DKTools.Sprite.Arrow.prototype.standardGraphicName=function(){return this.standardWindowskin()},DKTools.Sprite.Arrow.prototype.standardAnchor=function(){return new Point(.5,.5)},DKTools.Sprite.Arrow.prototype.standardArrowType=function(){return null},DKTools.Sprite.Arrow.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupArrowType(t.arrowType)},DKTools.Sprite.Arrow.prototype.setupArrowType=function(t){this._arrowType=t||this.standardArrowType()},DKTools.Sprite.Arrow.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setArrowType(t.arrowType,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.Arrow.prototype.setArrowType=function(t,e=!1){if(this._arrowType===t)return!1;const i=this._arrowType;return this.setupArrowType(t),this._arrowType!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype=Object.create(DKTools.Sprite.Button.prototype),DKTools.Sprite.Selectable.prototype.constructor=DKTools.Sprite.Selectable,Object.defineProperties(DKTools.Sprite.Selectable.prototype,{cursorSprite:{get:function(){return this._cursorSprite},configurable:!0},lastIndex:{get:function(){return this._lastIndex},configurable:!0},index:{get:function(){return this._index},configurable:!0},maxCols:{get:function(){return this._maxCols},configurable:!0},cursorFixed:{get:function(){return this._cursorFixed},configurable:!0},cursorAll:{get:function(){return this._cursorAll},configurable:!0},cursorDownHandler:{get:function(){return this._cursorDownHandler},configurable:!0},cursorUpHandler:{get:function(){return this._cursorUpHandler},configurable:!0},cursorRightHandler:{get:function(){return this._cursorRightHandler},configurable:!0},cursorLeftHandler:{get:function(){return this._cursorLeftHandler},configurable:!0},cursorPageDownHandler:{get:function(){return this._cursorPageDownHandler},configurable:!0},cursorPageUpHandler:{get:function(){return this._cursorPageUpHandler},configurable:!0},horizontalSpacing:{get:function(){return this._horizontalSpacing},configurable:!0},verticalSpacing:{get:function(){return this._verticalSpacing},configurable:!0},textPadding:{get:function(){return this._textPadding},configurable:!0},items:{get:function(){return this._items},configurable:!0},itemDrawHandler:{get:function(){return this._itemDrawHandler},configurable:!0},itemWidth:{get:function(){return this._itemWidth},configurable:!0},itemHeight:{get:function(){return this._itemHeight},configurable:!0},itemFont:{get:function(){return this._itemFont},configurable:!0},itemTextColor:{get:function(){return this._itemTextColor},configurable:!0},itemPaintOpacity:{get:function(){return this._itemPaintOpacity},configurable:!0},itemAlign:{get:function(){return this._itemAlign},configurable:!0}}),DKTools.Sprite.Selectable.prototype._addAllChildren=function(){DKTools.Sprite.Button.prototype._addAllChildren.call(this),this._addCursorSprite()},DKTools.Sprite.Selectable.prototype._addCursorSprite=function(){this.addChild(this._cursorSprite)},DKTools.Sprite.Selectable.prototype.activate=function(){DKTools.Sprite.Button.prototype.activate.call(this),this.reselect()},DKTools.Sprite.Selectable.prototype.addItem=function(t,e=!1){const i=this.insertItem(t,this.getMaxItems()-1,!0);return e||this.refreshAll(),i},DKTools.Sprite.Selectable.prototype.addItems=function(t,e=!1){const i=_.map(t,t=>this.addItem(t,!0));return e||this.refreshAll(),i},DKTools.Sprite.Selectable.prototype._clearAll=function(){DKTools.Sprite.Button.prototype._clearAll.call(this),this._clearItems(),this._clearHandlers(),this._clearTopRow(),this._clearTopCol()},DKTools.Sprite.Selectable.prototype._clearItems=function(){this._items=[]},DKTools.Sprite.Selectable.prototype._clearHandlers=function(){this._handlers={}},DKTools.Sprite.Selectable.prototype._clearTopRow=function(){this._topRow=0},DKTools.Sprite.Selectable.prototype._clearTopCol=function(){this._topCol=0},DKTools.Sprite.Selectable.prototype._createAll=function(){DKTools.Sprite.Button.prototype._createAll.call(this),this._createCursorSprite()},DKTools.Sprite.Selectable.prototype._createCursorSprite=function(){this._cursorSprite=new DKTools.Sprite.Cursor},DKTools.Sprite.Selectable.prototype._checkItem=function(t){return void 0===t.enabled&&(t.enabled=!0),void 0===t.ext&&(t.ext=null),t.symbol&&DKTools.Utils.isFunction(t.handler)&&this.setHandler(t.symbol,t.handler),t},DKTools.Sprite.Selectable.prototype.callHandler=function(t){this.isHandled(t)&&this._handlers[t](this._index,this)},DKTools.Sprite.Selectable.prototype.callOkHandler=function(){const t=this.getCurrentItemSymbol();this.isHandled(t)?this.callHandler(t):this.isHandled("ok")?this.callHandler("ok"):this.activate()},DKTools.Sprite.Selectable.prototype.callCancelHandler=function(){this.callHandler("cancel")},DKTools.Sprite.Selectable.prototype.clearItem=function(t){this.clearRect(this.getItemRect(t))},DKTools.Sprite.Selectable.prototype.cursorDown=function(t=!1){this.hasCursorDownHandler()&&this._cursorDownHandler(t,this)},DKTools.Sprite.Selectable.prototype.cursorUp=function(t=!1){this.hasCursorUpHandler()&&this._cursorUpHandler(t,this)},DKTools.Sprite.Selectable.prototype.cursorRight=function(t=!1){this.hasCursorRightHandler()&&this._cursorRightHandler(t,this)},DKTools.Sprite.Selectable.prototype.cursorLeft=function(t=!1){this.hasCursorLeftHandler()&&this._cursorLeftHandler(t,this)},DKTools.Sprite.Selectable.prototype.cursorPageDown=function(){this.hasCursorPageDownHandler()&&this._cursorPageDownHandler(this)},DKTools.Sprite.Selectable.prototype.cursorPageUp=function(){this.hasCursorPageUpHandler()&&this._cursorPageUpHandler(this)},DKTools.Sprite.Selectable.prototype.deactivate=function(t=!1){DKTools.Sprite.Button.prototype.deactivate.call(this),t&&this.deselect()},DKTools.Sprite.Selectable.prototype.deselect=function(){this.selectItem(-1)},DKTools.Sprite.Selectable.prototype.disableItem=function(t,e=!1){(this.getItem(t)||{}).enabled=!1,e||this.refreshAll()},DKTools.Sprite.Selectable.prototype.drawAll=function(){DKTools.Sprite.Button.prototype.drawAll.call(this),this.drawAllItems()},DKTools.Sprite.Selectable.prototype.drawAllItems=function(){const t=this.getMaxPageItems(),e=this.getMaxItems();let i=this.getTopIndex();for(let o=0;o<t&&i<e;o++,i++)this.drawItem(i)},DKTools.Sprite.Selectable.prototype.drawItem=function(t){const e=this.getItem(t)||{};DKTools.Utils.isFunction(e.drawHandler)?e.drawHandler(t,this):this.hasDrawItemHandler()&&this._itemDrawHandler(t,this)},DKTools.Sprite.Selectable.prototype.enableItem=function(t,e=!1){(this.getItem(t)||{}).enabled=!0,e||this.refreshAll()},DKTools.Sprite.Selectable.prototype.findSymbol=function(t){return _.findIndex(this._items,{symbol:t})},DKTools.Sprite.Selectable.prototype.findExt=function(t){return _.findIndex(this._items,{ext:t})},DKTools.Sprite.Selectable.prototype.getItemName=function(t){const e=this.getItem(t)||{};return DKTools.Utils.isFunction(e.name)?e.name(t,this):e.name},DKTools.Sprite.Selectable.prototype.getCurrentItemName=function(){return this.getItemName(this._index)},DKTools.Sprite.Selectable.prototype.getItemRect=function(t){const e=(this.getItem(t)||{}).rect||this._itemRect;return DKTools.Utils.isFunction(e)?e(t,this):e},DKTools.Sprite.Selectable.prototype.getCurrentItemRect=function(){return this.getItemRect(this._index)},DKTools.Sprite.Selectable.prototype.getItemRectForText=function(t){const e=this.getItemRect(t);return e.x+=this._textPadding,e.width-=2*this._textPadding,e},DKTools.Sprite.Selectable.prototype.getItemWidth=function(){return DKTools.Utils.isFunction(this._itemWidth)?this._itemWidth(this):this._itemWidth},DKTools.Sprite.Selectable.prototype.getItemHeight=function(){return DKTools.Utils.isFunction(this._itemHeight)?this._itemHeight(this):DKTools.Utils.isString(this._itemHeight)?this.getLineHeight()*parseFloat(this._itemHeight):this._itemHeight},DKTools.Sprite.Selectable.prototype.getItem=function(t){return this._items[t]||null},DKTools.Sprite.Selectable.prototype.getItemIndex=function(t){return _.indexOf(this._items,t)},DKTools.Sprite.Selectable.prototype.getItemFont=function(t){const e=(this.getItem(t)||{}).font||this._itemFont;return DKTools.Utils.isFunction(e)?e(t,this):e},DKTools.Sprite.Selectable.prototype.getItemTextColor=function(t){const e=(this.getItem(t)||{}).textColor||this._itemTextColor;return DKTools.Utils.isFunction(e)?e(t,this):e},DKTools.Sprite.Selectable.prototype.getItemPaintOpacity=function(t){const e=this.getItem(t)||{};return DKTools.Utils.isFunction(e.paintOpacity)?e.paintOpacity(t,this):DKTools.Utils.isNumber(e.paintOpacity)?e.paintOpacity:DKTools.Utils.isFunction(this._itemPaintOpacity)?this._itemPaintOpacity(t,this):this._itemPaintOpacity},DKTools.Sprite.Selectable.prototype.getItemAlign=function(t){const e=(this.getItem(t)||{}).align||this._itemAlign;return DKTools.Utils.isFunction(e)?e(t,this):e},DKTools.Sprite.Selectable.prototype.getItemFullInfo=function(t){const e=this.getItem(t);return{...e,index:t,item:e,name:this.getItemName(t),enabled:this.isItemEnabled(t),handled:this.isItemHandled(t),rect:this.getItemRect(t),rectForText:this.getItemRectForText(t),font:this.getItemFont(t),textColor:this.getItemTextColor(t),paintOpacity:this.getItemPaintOpacity(t),align:this.getItemAlign(t)}},DKTools.Sprite.Selectable.prototype.getPrevIndex=function(t=!1){return this._index>0?this._index-1:t?this.getMaxItems()-1:-1},DKTools.Sprite.Selectable.prototype.getNextIndex=function(t=!1){return this._index<this.getMaxItems()-1?this._index+1:t?0:-1},DKTools.Sprite.Selectable.prototype.getPrevItem=function(t=!1){return this.getItem(this.getPrevIndex(t))},DKTools.Sprite.Selectable.prototype.getNextItem=function(t=!1){return this.getItem(this.getNextIndex(t))},DKTools.Sprite.Selectable.prototype.getCurrentItem=function(){return this.getItem(this._index)},DKTools.Sprite.Selectable.prototype.getVisibleItems=function(){const t=this.getMaxPageItems(),e=this.getMaxItems(),i=[];let o=this.getTopIndex();for(let n=0;n<t&&o<e;n++,o++)i.push(this.getItem(o));return i},DKTools.Sprite.Selectable.prototype.getItemSymbol=function(t){const e=this.getItem(t);return e?e.symbol:null},DKTools.Sprite.Selectable.prototype.getItemExt=function(t){var e=this.getItem(t);return e?e.ext:null},DKTools.Sprite.Selectable.prototype.getCurrentItemSymbol=function(){return this.getItemSymbol(this._index)},DKTools.Sprite.Selectable.prototype.getCurrentItemExt=function(){return this.getItemExt(this._index)},DKTools.Sprite.Selectable.prototype.getMaxItems=function(){return this._items.length},DKTools.Sprite.Selectable.prototype.getMaxRows=function(){return this.isFixedHorizontal()?1:Math.max(1,Math.ceil(this.getMaxItems()/this.getMaxCols()))},DKTools.Sprite.Selectable.prototype.getMaxCols=function(){return this._maxCols},DKTools.Sprite.Selectable.prototype.getMaxTopRow=function(){return Math.max(0,this.getMaxRows()-this.getMaxPageRows())},DKTools.Sprite.Selectable.prototype.getMaxTopCol=function(){return Math.max(0,this.getMaxItems()-this.getMaxPageCols())},DKTools.Sprite.Selectable.prototype.getMaxPageRows=function(){const t=this._verticalSpacing,e=this.realHeight,i=this.getItemHeight(),o=this.getMaxRows();let n=0,s=0;for(;n<o;n++){if(n===o-1){if(s+i>e)break}else if(s+i+t>e)break;s+=i+t}return n},DKTools.Sprite.Selectable.prototype.getMaxPageCols=function(){return this.getMaxCols()},DKTools.Sprite.Selectable.prototype.getMaxPageItems=function(){return this.isHorizontal()?this.getMaxPageCols():this.getMaxPageRows()*this.getMaxPageCols()},DKTools.Sprite.Selectable.prototype.getRow=function(t){return Math.floor(t/this.getMaxCols())},DKTools.Sprite.Selectable.prototype.getCurrentRow=function(){return this.getRow(this._index)},DKTools.Sprite.Selectable.prototype.getItemRow=function(t){return this.hasItem(t)?this.getRow(t):-1},DKTools.Sprite.Selectable.prototype.getRowItems=function(t){const e=[];if(DKTools.Utils.Number.inRange(t,0,this.getMaxRows())){const i=this.getMaxPageItems(),o=this.getMaxItems();let n=t*this.getMaxCols();for(let s=0;s<i&&n<o&&this.getRow(n)===t;s++,n++)e.push(this.getItem(n))}return e},DKTools.Sprite.Selectable.prototype.getCol=function(t){return Math.floor(t%this.getMaxCols())},DKTools.Sprite.Selectable.prototype.getCurrentCol=function(){return this.isHorizontal()?this._index:this.getCol(this._index)},DKTools.Sprite.Selectable.prototype.getItemCol=function(t){return this.hasItem(t)?this.getCol(t):-1},DKTools.Sprite.Selectable.prototype.getColItems=function(t){const e=[];if(DKTools.Utils.Number.inRange(t,0,this.getMaxCols())){const i=this.getMaxItems();for(let o=0;o<i;o++)this.getCol(o)===t&&e.push(this.getItem(o))}return e},DKTools.Sprite.Selectable.prototype.getTopIndex=function(){return this.isHorizontal()?this.getTopCol():this.getTopRow()*this.getMaxCols()},DKTools.Sprite.Selectable.prototype.getTopRow=function(){return this._topRow},DKTools.Sprite.Selectable.prototype.getTopCol=function(){return this._topCol},DKTools.Sprite.Selectable.prototype.getBottomRow=function(){return Math.max(0,this.getTopRow()+this.getMaxPageRows()-1)},DKTools.Sprite.Selectable.prototype.getBottomCol=function(){return Math.max(0,this.getTopCol()+this.getMaxPageCols()-1)},DKTools.Sprite.Selectable.prototype.getBottomIndex=function(){return Math.min(this.getTopIndex()+this.getMaxPageItems(),this.getMaxItems())-1},DKTools.Sprite.Selectable.prototype.hasItem=function(t){return!!this.getItem(t)},DKTools.Sprite.Selectable.prototype.hasItems=function(){return this.getMaxItems()>0},DKTools.Sprite.Selectable.prototype.hasSymbol=function(t){return _.includes(this._items,{symbol:t})},DKTools.Sprite.Selectable.prototype.hasExt=function(t){return _.includes(this._items,{ext:t})},DKTools.Sprite.Selectable.prototype.hasCursorDownHandler=function(){return!!this._cursorDownHandler},DKTools.Sprite.Selectable.prototype.hasCursorUpHandler=function(){return!!this._cursorUpHandler},DKTools.Sprite.Selectable.prototype.hasCursorRightHandler=function(){return!!this._cursorRightHandler},DKTools.Sprite.Selectable.prototype.hasCursorLeftHandler=function(){return!!this._cursorLeftHandler},DKTools.Sprite.Selectable.prototype.hasCursorPageDownHandler=function(){return!!this._cursorPageDownHandler},DKTools.Sprite.Selectable.prototype.hasCursorPageUpHandler=function(){return!!this._cursorPageUpHandler},DKTools.Sprite.Selectable.prototype.hasDrawItemHandler=function(){return!!this._itemDrawHandler},DKTools.Sprite.Selectable.prototype.hideCursor=function(){this._cursorSprite.hide()},DKTools.Sprite.Selectable.prototype.hitTest=function(t,e){if(this.isOutside(t,e))return-1;const i=this.scale,o=this.canvasToLocalX(t),n=this.canvasToLocalY(e),s=this.getMaxPageItems(),r=this.getMaxItems();let a=this.getTopIndex();for(let t=0;t<s&&a<r;t++,a++){const t=this.getItemRect(a);if(t.x*=i.x,t.y*=i.y,t.width*=i.x,t.height*=i.y,t.contains(o,n))return a}return-1},DKTools.Sprite.Selectable.prototype.insertItem=function(t,e,i=!1){const o=this._checkItem(t);return DKTools.Utils.Array.insert(this._items,o,e),i||this.refreshAll(),o},DKTools.Sprite.Selectable.prototype.insertItems=function(t,e,i=!1){e=e||0;const o=_.map(t,(t,i)=>this.insertItem(t,e+i,!0));return i||this.refreshAll(),o},DKTools.Sprite.Selectable.prototype.isCursorFixed=function(){return this._cursorFixed},DKTools.Sprite.Selectable.prototype.isCursorAll=function(){return this._cursorAll},DKTools.Sprite.Selectable.prototype.isFixedHorizontal=function(){return this._fixedHorizontal},DKTools.Sprite.Selectable.prototype.isHorizontal=function(){return this.isFixedHorizontal()||1===this.getMaxPageRows()},DKTools.Sprite.Selectable.prototype.isVertical=function(){return!this.isHorizontal()},DKTools.Sprite.Selectable.prototype.isCursorMovable=function(){return this.isVisibleAndActive()&&!this.isCursorFixed()&&!this.isCursorAll()&&this.hasItems()},DKTools.Sprite.Selectable.prototype.isOkEnabled=function(){return!0},DKTools.Sprite.Selectable.prototype.isCancelEnabled=function(){return this.isHandled("cancel")},DKTools.Sprite.Selectable.prototype.isOkTriggered=function(){return Input.isRepeated("ok")},DKTools.Sprite.Selectable.prototype.isCancelTriggered=function(){return Input.isRepeated("cancel")||TouchInput.isCancelled()},DKTools.Sprite.Selectable.prototype.isCursorVisible=function(){if(!this._cursorSprite.isVisible())return!1;if(this.isHorizontal()){const t=this.getCurrentCol();return t>=this.getTopCol()&&t<=this.getBottomCol()}const t=this.getCurrentRow();return t>=this.getTopRow()&&t<=this.getBottomRow()},DKTools.Sprite.Selectable.prototype.isItemEnabled=function(t){const e=(this.getItem(t)||{}).enabled;return DKTools.Utils.isFunction(e)?e(t,this):e},DKTools.Sprite.Selectable.prototype.isCurrentItemEnabled=function(){return this.isItemEnabled(this._index)},DKTools.Sprite.Selectable.prototype.isItemVisible=function(t){return DKTools.Utils.Number.inRange(t,this.getTopIndex(),this.getBottomIndex()+1)},DKTools.Sprite.Selectable.prototype.isItemSelected=function(t){return this._index===t},DKTools.Sprite.Selectable.prototype.isHandled=function(t){return!!this._handlers[t]},DKTools.Sprite.Selectable.prototype.isItemHandled=function(t){const e=this.getItem(t)||{};return this.isHandled(e.symbol)||DKTools.Utils.isFunction(e.okHandler)},DKTools.Sprite.Selectable.prototype.isCurrentItemHandled=function(){return this.isItemHandled(this._index)},DKTools.Sprite.Selectable.prototype._onTouch=function(t=!1){const e=this._index,i=TouchInput.x,o=TouchInput.y,n=this.hitTest(i,o);n>=0&&(this._index===n?t&&this.isOkEnabled()&&this.processOk():this.isCursorMovable()&&this.selectItem(n)),this._index!==e&&this.playCursorSound()},DKTools.Sprite.Selectable.prototype.playOkSound=function(){SoundManager.playOk()},DKTools.Sprite.Selectable.prototype.playCancelSound=function(){SoundManager.playCancel()},DKTools.Sprite.Selectable.prototype.playCursorSound=function(){SoundManager.playCursor()},DKTools.Sprite.Selectable.prototype.playBuzzerSound=function(){SoundManager.playBuzzer()},DKTools.Sprite.Selectable.prototype.processAll=function(){DKTools.Sprite.Button.prototype.processAll.call(this),this.processCursorMove(),this.processHandling()},DKTools.Sprite.Selectable.prototype.processCursorMove=function(){if(!this.isCursorMovable())return;const t=this._index;Input.isRepeated("down")&&this.cursorDown(Input.isTriggered("down")),Input.isRepeated("up")&&this.cursorUp(Input.isTriggered("up")),Input.isRepeated("right")&&this.cursorRight(Input.isTriggered("right")),Input.isRepeated("left")&&this.cursorLeft(Input.isTriggered("left")),Input.isTriggered("pagedown")&&this.cursorPageDown(),Input.isTriggered("pageup")&&this.cursorPageUp(),this._index!==t&&this.playCursorSound()},DKTools.Sprite.Selectable.prototype.processHandling=function(){this.isVisibleAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()&&this.processCancel())},DKTools.Sprite.Selectable.prototype.processMouseHover=function(){if(this.isOptionEnabled("process-mouse-hover")&&this.isCursorMovable()){const t=this._index,e=TouchInput.mouseX,i=TouchInput.mouseY,o=this.hitTest(e,i);o>=0&&o!==t&&this.selectItem(o,!0)}},DKTools.Sprite.Selectable.prototype.processWheelScroll=function(){if(this.isOptionEnabled("process-wheel-scroll")&&this.isVisibleAndActive()){this._wheelY>0?this.isHorizontal()?this.scrollRight():this.scrollDown():this.isHorizontal()?this.scrollLeft():this.scrollUp()}},DKTools.Sprite.Selectable.prototype.processOk=function(){if(this.isCurrentItemEnabled()){this.playOkSound(),this.updateInputData(),this.deactivate();const t=this.getCurrentItem()||{};DKTools.Utils.isFunction(t.okHandler)?t.okHandler(this._index,this):this.callOkHandler()}else this.playBuzzerSound()},DKTools.Sprite.Selectable.prototype.processCancel=function(){this.playCancelSound(),this.updateInputData(),this.deactivate();const t=this.getCurrentItem();t&&DKTools.Utils.isFunction(t.cancelHandler)?t.cancelHandler(this._index,this):this.callCancelHandler()},DKTools.Sprite.Selectable.prototype.redrawItem=function(t){this.isItemVisible(t)&&(this.clearItem(t),this.drawItem(t))},DKTools.Sprite.Selectable.prototype.redrawCurrentItem=function(){this.redrawItem(this._index)},DKTools.Sprite.Selectable.prototype.removeHandler=function(t){delete this._handlers[t]},DKTools.Sprite.Selectable.prototype.removeItem=function(t,e=!1){const i=this.getItem(t);return i?(DKTools.Utils.Array.remove(this._items,i),e||this.refreshAll(),i):null},DKTools.Sprite.Selectable.prototype.removeItems=function(t,e=!1){const i=_.map(t,t=>this.removeItem(t,!0));return e||this.refreshAll(),i},DKTools.Sprite.Selectable.prototype.replaceItem=function(t,e,i=!1){const o=this._checkItem(t);e=e||0;const n=this._items[e];return this._items[e]=o,i||this.refreshAll(),n},DKTools.Sprite.Selectable.prototype.reselect=function(){this.selectItem(this._index)},DKTools.Sprite.Selectable.prototype.resetScroll=function(){0!==this._index&&this.selectItem(0)},DKTools.Sprite.Selectable.prototype._setupEvents=function(){DKTools.Sprite.Button.prototype._setupEvents.call(this),this._setupMouseClickEvent(),this._setupMouseLongPressEvent(),this._setupMouseHoverEvents(),this._setupWheelScrollEvents()},DKTools.Sprite.Selectable.prototype._setupMouseClickEvent=function(){this.addEvent({type:"mouse-click-left",onUpdate:this._onTouch.bind(this,!0)})},DKTools.Sprite.Selectable.prototype._setupMouseLongPressEvent=function(){this.addEvent({type:"mouse-long-press-left",onUpdate:this._onTouch.bind(this,!1)})},DKTools.Sprite.Selectable.prototype._setupMouseHoverEvents=function(){this.addEvent({type:"mouse-enter",onUpdate:this.processMouseHover.bind(this)}),this.addEvent({type:"mouse-move",onUpdate:this.processMouseHover.bind(this)})},DKTools.Sprite.Selectable.prototype._setupWheelScrollEvents=function(){this.addEvent({type:"wheel-Y-inside",onUpdate:this.processWheelScroll.bind(this)}),this.addEvent({type:"wheel-Y-outside",onUpdate:this.processWheelScroll.bind(this)})},DKTools.Sprite.Selectable.prototype.standardIndex=function(){return 0},DKTools.Sprite.Selectable.prototype.standardMaxCols=function(){return 1},DKTools.Sprite.Selectable.prototype.standardCursorFixed=function(){return!1},DKTools.Sprite.Selectable.prototype.standardCursorAll=function(){return!1},DKTools.Sprite.Selectable.prototype.standardFixedHorizontal=function(){return!1},DKTools.Sprite.Selectable.prototype.standardHorizontalSpacing=function(){return 0},DKTools.Sprite.Selectable.prototype.standardVerticalSpacing=function(){return 0},DKTools.Sprite.Selectable.prototype.standardTextPadding=function(){return 6},DKTools.Sprite.Selectable.prototype.standardCursorDownHandler=function(){return t=>{if(this.isHorizontal())return;const e=this._index,i=this.getMaxItems(),o=this.getMaxCols();(e<i-o||t&&i===this.getMaxRows()*o)&&this.selectItem((e+o)%i)}},DKTools.Sprite.Selectable.prototype.standardCursorUpHandler=function(){return t=>{if(this.isHorizontal())return;const e=this._index,i=this.getMaxItems(),o=this.getMaxCols();(e>=o||t&&i===this.getMaxRows()*o)&&this.selectItem((e-o+i)%i)}},DKTools.Sprite.Selectable.prototype.standardCursorRightHandler=function(){return t=>{const e=this.getMaxItems();if(!(e<2))if(this.isVertical()){const i=this._index;this.getMaxCols()>=2&&(i<e-1||t)&&this.selectItem((i+1)%e)}else this.selectNextItem(t)}},DKTools.Sprite.Selectable.prototype.standardCursorLeftHandler=function(){return t=>{const e=this.getMaxItems();if(!(e<2))if(this.isVertical()){const i=this._index;this.getMaxCols()>=2&&(i>0||t)&&this.selectItem((i-1+e)%e)}else this.selectPrevItem(t)}},DKTools.Sprite.Selectable.prototype.standardCursorPageDownHandler=function(){return()=>{if(this.isHorizontal()){const t=this.getTopCol(),e=this.getMaxPageCols(),i=this.getMaxItems();t+e<i&&(this.setTopCol(t+e),this.selectItem(Math.min(this._index+this.getMaxPageItems(),i-1)))}else{const t=this.getTopRow(),e=this.getMaxPageRows();t+e<this.getMaxRows()&&(this.setTopRow(t+e),this.selectItem(Math.min(this._index+this.getMaxPageItems(),this.getMaxItems()-1)))}}},DKTools.Sprite.Selectable.prototype.standardCursorPageUpHandler=function(){return()=>{if(this.isHorizontal()){const t=this.getTopCol();t>0&&(this.setTopCol(t-this.getMaxPageCols()),this.selectItem(Math.max(0,this._index-this.getMaxPageItems())))}else{const t=this.getTopRow();t>0&&(this.setTopRow(t-this.getMaxPageRows()),this.selectItem(Math.max(0,this._index-this.getMaxPageItems())))}}},DKTools.Sprite.Selectable.prototype.standardItems=function(){return[]},DKTools.Sprite.Selectable.prototype.standardItemDrawHandler=function(){return t=>{const e=this.getItemName(t),i=this.getItemFont(t),o=this.getItemTextColor(t),n=this.getItemPaintOpacity(t),s=this.getItemAlign(t),r=this.getItemRectForText(t);this.drawText(e,{font:i,textColor:o,paintOpacity:n,align:s,rect:r,resetFont:!0,resetTextColor:!0,resetPaintOpacity:!0})}},DKTools.Sprite.Selectable.prototype.standardItemWidth=function(){return()=>Math.floor((this.realWidth+this._horizontalSpacing)/this.getMaxCols()-this._horizontalSpacing)},DKTools.Sprite.Selectable.prototype.standardItemHeight=function(){return this.getLineHeight()},DKTools.Sprite.Selectable.prototype.standardItemRect=function(){return t=>{const e=new Rectangle(0,0,this.getItemWidth(),this.getItemHeight()),i=this.getMaxCols();return this.isHorizontal()?(e.x=(t-this.getTopCol())*(e.width+this._horizontalSpacing),e.y=0):(e.x=t%i*(e.width+this._horizontalSpacing),e.y=(Math.floor(t/i)-this.getTopRow())*(e.height+this._verticalSpacing)),e}},DKTools.Sprite.Selectable.prototype.standardItemFont=function(){return()=>this.font},DKTools.Sprite.Selectable.prototype.standardItemTextColor=function(){return()=>this.textColor},DKTools.Sprite.Selectable.prototype.standardItemPaintOpacity=function(){return t=>this.isItemEnabled(t)?this.standardEnabledItemPaintOpacity():this.standardDisabledItemPaintOpacity()},DKTools.Sprite.Selectable.prototype.standardEnabledItemPaintOpacity=function(){return 255},DKTools.Sprite.Selectable.prototype.standardDisabledItemPaintOpacity=function(){try{return Window_Base.prototype.translucentOpacity.call(this)}catch(t){return 160}},DKTools.Sprite.Selectable.prototype.standardItemAlign=function(){return this.align},DKTools.Sprite.Selectable.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupIndex(t.index),this.setupMaxCols(t.maxCols),this.setupFixedHorizontal(t.fixedHorizontal),this.setupCursorFixed(t.cursorFixed),this.setupCursorAll(t.cursorAll),this.setupCursorDownHandler(t.cursorDownHandler),this.setupCursorUpHandler(t.cursorUpHandler),this.setupCursorRightHandler(t.cursorRightHandler),this.setupCursorLeftHandler(t.cursorLeftHandler),this.setupCursorPageDownHandler(t.cursorPageDownHandler),this.setupCursorPageUpHandler(t.cursorPageUpHandler),this.setupSpacing(t.horizontalSpacing,t.verticalSpacing),this.setupTextPadding(t.textPadding),this.setupItems(t.items),this.setupItemDrawHandler(t.drawItemHandler),this.setupItemWidth(t.itemWidth),this.setupItemHeight(t.itemHeight),this.setupItemRect(t.itemRect),this.setupItemFont(t.itemFont),this.setupItemTextColor(t.itemTextColor),this.setupItemPaintOpacity(t.itemPaintOpacity),this.setupItemAlign(t.itemAlign)},DKTools.Sprite.Selectable.prototype.setupIndex=function(t){this._lastIndex=this._index,this._index=_.defaultTo(t,this.standardIndex())},DKTools.Sprite.Selectable.prototype.setupMaxCols=function(t){this._maxCols=t||this.standardMaxCols()},DKTools.Sprite.Selectable.prototype.setupFixedHorizontal=function(t){this._fixedHorizontal=_.defaultTo(t,this.standardFixedHorizontal())},DKTools.Sprite.Selectable.prototype.setupCursorFixed=function(t){this._cursorFixed=_.defaultTo(t,this.standardCursorFixed())},DKTools.Sprite.Selectable.prototype.setupCursorAll=function(t){this._cursorAll=_.defaultTo(t,this.standardCursorAll())},DKTools.Sprite.Selectable.prototype.setupCursorDownHandler=function(t){this._cursorDownHandler=t||this.standardCursorDownHandler()},DKTools.Sprite.Selectable.prototype.setupCursorUpHandler=function(t){this._cursorUpHandler=t||this.standardCursorUpHandler()},DKTools.Sprite.Selectable.prototype.setupCursorRightHandler=function(t){this._cursorRightHandler=t||this.standardCursorRightHandler()},DKTools.Sprite.Selectable.prototype.setupCursorLeftHandler=function(t){this._cursorLeftHandler=t||this.standardCursorLeftHandler()},DKTools.Sprite.Selectable.prototype.setupCursorPageDownHandler=function(t){this._cursorPageDownHandler=t||this.standardCursorPageDownHandler()},DKTools.Sprite.Selectable.prototype.setupCursorPageUpHandler=function(t){this._cursorPageUpHandler=t||this.standardCursorPageUpHandler()},DKTools.Sprite.Selectable.prototype.setupHorizontalSpacing=function(t){this._horizontalSpacing=_.defaultTo(t,this.standardHorizontalSpacing())},DKTools.Sprite.Selectable.prototype.setupVerticalSpacing=function(t){this._verticalSpacing=_.defaultTo(t,this.standardVerticalSpacing())},DKTools.Sprite.Selectable.prototype.setupSpacing=function(t,e){this.setupHorizontalSpacing(t),this.setupVerticalSpacing(e)},DKTools.Sprite.Selectable.prototype.setupTextPadding=function(t){this._textPadding=_.defaultTo(t,this.standardTextPadding())},DKTools.Sprite.Selectable.prototype.setupItems=function(t){this._items=_.map(t||this.standardItems(),t=>this._checkItem(t))},DKTools.Sprite.Selectable.prototype.setupItemDrawHandler=function(t){this._itemDrawHandler=t||this.standardItemDrawHandler()},DKTools.Sprite.Selectable.prototype.setupItemWidth=function(t){this._itemWidth=t||this.standardItemWidth()},DKTools.Sprite.Selectable.prototype.setupItemHeight=function(t){this._itemHeight=t||this.standardItemHeight()},DKTools.Sprite.Selectable.prototype.setupItemRect=function(t){this._itemRect=t||this.standardItemRect()},DKTools.Sprite.Selectable.prototype.setupItemFont=function(t){this._itemFont=t||this.standardItemFont()},DKTools.Sprite.Selectable.prototype.setupItemTextColor=function(t){this._itemTextColor=t||this.standardItemTextColor()},DKTools.Sprite.Selectable.prototype.setupItemPaintOpacity=function(t){this._itemPaintOpacity=t||this.standardItemPaintOpacity()},DKTools.Sprite.Selectable.prototype.setupItemAlign=function(t){this._itemAlign=t||this.standardItemAlign()},DKTools.Sprite.Selectable.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setIndex(t.index,!0)&&o++,this.setMaxCols(t.maxCols,!0)&&o++,this.setFixedHorizontal(t.fixedHorizontal,!0)&&o++,this.setCursorFixed(t.cursorFixed,!0)&&o++,this.setCursorAll(t.cursorAll,!0)&&o++,this.setCursorDownHandler(t.cursorDownHandler,!0)&&o++,this.setCursorUpHandler(t.cursorUpHandler,!0)&&o++,this.setCursorRightHandler(t.cursorRightHandler,!0)&&o++,this.setCursorLeftHandler(t.cursorLeftHandler,!0)&&o++,this.setCursorPageDownHandler(t.cursorPageDownHandler,!0)&&o++,this.setCursorPageUpHandler(t.cursorPageUpHandler,!0)&&o++,o+=this.setSpacing(t.horizontalSpacing,t.verticalSpacing,!0),this.setTextPadding(t.textPadding,!0)&&o++,this.setItems(t.items,!0)&&o++,this.setItemDrawHandler(t.drawItemHandler,!0)&&o++,this.setItemWidth(t.itemWidth,!0)&&o++,this.setItemHeight(t.itemHeight,!0)&&o++,this.setItemRect(t.itemRect,!0)&&o++,this.setItemFont(t.itemFont,!0)&&o++,this.setItemTextColor(t.itemTextColor,!0)&&o++,this.setItemPaintOpacity(t.itemPaintOpacity,!0)&&o++,this.setItemAlign(t.itemAlign,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.Selectable.prototype.setIndex=function(t,e=!1){return this._index!==t&&(this.setupIndex(t),this._index!==this._lastIndex&&(e||this.refreshAll(),!0))},DKTools.Sprite.Selectable.prototype.setMaxCols=function(t,e=!1){if(this._maxCols===t)return!1;const i=this._maxCols;return this.setupMaxCols(t),this._maxCols!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setFixedHorizontal=function(t,e=!1){if(this._fixedHorizontal===t)return!1;const i=this._fixedHorizontal;return this.setupFixedHorizontal(t),this._fixedHorizontal!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorFixed=function(t,e=!1){if(this._cursorFixed===t)return!1;const i=this._cursorFixed;return this.setupCursorFixed(t),this._cursorFixed!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorAll=function(t,e=!1){if(this._cursorAll===t)return!1;const i=this._cursorAll;return this.setupCursorAll(t),this._cursorAll!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorDownHandler=function(t,e=!1){if(this._cursorDownHandler===t)return!1;const i=this._cursorDownHandler;return this.setupCursorDownHandler(t),this._cursorDownHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorUpHandler=function(t,e=!1){if(this._cursorUpHandler===t)return!1;const i=this._cursorUpHandler;return this.setupCursorUpHandler(t),this._cursorUpHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorRightHandler=function(t,e=!1){if(this._cursorRightHandler===t)return!1;const i=this._cursorRightHandler;return this.setupCursorRightHandler(t),this._cursorRightHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorLeftHandler=function(t,e=!1){if(this._cursorLeftHandler===t)return!1;const i=this._cursorLeftHandler;return this.setupCursorLeftHandler(t),this._cursorLeftHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorPageDownHandler=function(t,e=!1){if(this._cursorPageDownHandler===t)return!1;const i=this._cursorPageDownHandler;return this.setupCursorPageDownHandler(t),this._cursorPageDownHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setCursorPageUpHandler=function(t,e=!1){if(this._cursorPageUpHandler===t)return!1;const i=this._cursorPageUpHandler;return this.setupCursorPageUpHandler(t),this._cursorPageUpHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setHorizontalSpacing=function(t,e=!1){if(this._horizontalSpacing===t)return!1;const i=this._horizontalSpacing;return this.setupHorizontalSpacing(t),this._horizontalSpacing!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setVerticalSpacing=function(t,e=!1){if(this._verticalSpacing===t)return!1;const i=this._verticalSpacing;return this.setupVerticalSpacing(t),this._verticalSpacing!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setSpacing=function(t,e,i=!1){let o=0;return this.setHorizontalSpacing(t,!0)&&o++,this.setVerticalSpacing(e,!0)&&o++,o>0&&!i&&this.refreshAll(),o},DKTools.Sprite.Selectable.prototype.setTextPadding=function(t,e=!1){if(this._textPadding===t)return!1;const i=this._textPadding;return this.setupTextPadding(t),this._textPadding!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItems=function(t,e=!1){return this._items!=t&&(this.setupItems(t),e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemDrawHandler=function(t,e=!1){if(this._itemDrawHandler===t)return!1;const i=this._itemDrawHandler;return this.setupItemDrawHandler(t),this._itemDrawHandler!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemWidth=function(t,e=!1){if(this._itemWidth===t)return!1;const i=this._itemWidth;return this.setupItemWidth(t),this._itemWidth!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemHeight=function(t,e=!1){if(this._itemHeight===t)return!1;const i=this._itemHeight;return this.setupItemHeight(t),this._itemHeight!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemFont=function(t,e=!1){if(this._itemFont===t)return!1;const i=this._itemFont;return this.setupItemFont(t),this._itemFont!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemTextColor=function(t,e=!1){if(this._itemTextColor===t)return!1;const i=this._itemTextColor;return this.setupItemTextColor(t),this._itemTextColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemPaintOpacity=function(t,e=!1){if(this._itemPaintOpacity===t)return!1;const i=this._itemPaintOpacity;return this.setupItemPaintOpacity(t),this._itemPaintOpacity!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setItemAlign=function(t,e=!1){if(this._itemAlign===t)return!1;const i=this._itemAlign;return this.setupItemAlign(t),this._itemAlign!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.Selectable.prototype.setTopRow=function(t,e=!1){const i=DKTools.Utils.Number.clamp(t,0,this.getMaxTopRow());this._topRow!==i&&(this._topRow=i,e||this.refreshAll())},DKTools.Sprite.Selectable.prototype.setTopCol=function(t,e=!1){const i=DKTools.Utils.Number.clamp(t,0,this.getMaxTopCol());this._topCol!==i&&(this._topCol=i,e||this.refreshAll())},DKTools.Sprite.Selectable.prototype.setBottomRow=function(t,e=!1){this.setTopRow(t-(this.getMaxPageRows()-1),e)},DKTools.Sprite.Selectable.prototype.setBottomCol=function(t,e=!1){this.setTopCol(t-(this.getMaxPageCols()-1),e)},DKTools.Sprite.Selectable.prototype.setHandler=function(t,e){this._handlers[t]=e},DKTools.Sprite.Selectable.prototype.setCursorRect=function(t,e,i,o){return this._cursorSprite.setCursorRect(t,e,i,o)},DKTools.Sprite.Selectable.prototype.showCursor=function(){this._cursorSprite.show(!0)},DKTools.Sprite.Selectable.prototype.selectItem=function(t,e=!1){const i=this.getItem(t);this.setupIndex(t),this.refreshAll(),e&&this.playCursorSound(),i&&DKTools.Utils.isFunction(i.selectHandler)&&i.selectHandler(t,this),this.updateSelectEvents()},DKTools.Sprite.Selectable.prototype.selectSymbol=function(t){const e=Math.max(0,this.findSymbol(t));this.selectItem(e)},DKTools.Sprite.Selectable.prototype.selectExt=function(t){const e=Math.max(0,this.findExt(t));this.selectItem(e)},DKTools.Sprite.Selectable.prototype.selectPrevItem=function(t=!1,e=!1){const i=this.getPrevIndex(t);i>=0&&this.selectItem(i,e)},DKTools.Sprite.Selectable.prototype.selectNextItem=function(t=!1,e=!1){const i=this.getNextIndex(t);i>=0&&this.selectItem(i,e)},DKTools.Sprite.Selectable.prototype.selectLastItem=function(t=!1){this.selectItem(this.getMaxItems()-1,t)},DKTools.Sprite.Selectable.prototype.scrollDown=function(){this.getTopRow()+1<this.getMaxRows()&&this.cursorDown()},DKTools.Sprite.Selectable.prototype.scrollUp=function(){this.getCurrentRow()>0&&this.cursorUp()},DKTools.Sprite.Selectable.prototype.scrollRight=function(){this.getTopCol()+1<this.getMaxItems()&&this.cursorRight()},DKTools.Sprite.Selectable.prototype.scrollLeft=function(){this.getCurrentCol()>0&&this.cursorLeft()},DKTools.Sprite.Selectable.prototype.updateAll=function(){DKTools.Sprite.Button.prototype.updateAll.call(this),this.updateCursor()},DKTools.Sprite.Selectable.prototype.updateCursor=function(){if(this.isHorizontal()){const t=this.getCurrentCol();t<this.getTopCol()?this.setTopCol(t):t>this.getBottomCol()&&this.setBottomCol(t)}else{const t=this.getCurrentRow();t<this.getTopRow()?this.setTopRow(t):t>this.getBottomRow()&&this.setBottomRow(t)}if(this.isCursorAll()){const t=this.getMaxRows()*this.getItemHeight();this.setCursorRect(0,0,this.realWidth,t),this.resetScroll()}else if(this.isCursorVisible()||!this._cursorSprite.hasBitmap()){const t=this.getItemRect(this._index);this.setCursorRect(t)}else this.setCursorRect(Rectangle.emptyRectangle)},DKTools.Sprite.Selectable.prototype.updateSelectEvents=function(){this.updateEventsContainer("select")},DKTools.Sprite.ProgressBar.prototype=Object.create(DKTools.Sprite.prototype),DKTools.Sprite.ProgressBar.prototype.constructor=DKTools.Sprite.ProgressBar,Object.defineProperties(DKTools.Sprite.ProgressBar.prototype,{valueStep:{get:function(){return this._valueStep},configurable:!0},maxValue:{get:function(){return this._maxValue},configurable:!0},value:{get:function(){return this._value},configurable:!0},backgroundColor:{get:function(){return this._backgroundColor},configurable:!0},progressColor:{get:function(){return this._progressColor},configurable:!0},drawGraphicHandler:{get:function(){return this._drawGraphicHandler},configurable:!0},drawTextHandler:{get:function(){return this._drawTextHandler},configurable:!0}}),DKTools.Sprite.ProgressBar.prototype.standardActive=function(){return!1},DKTools.Sprite.ProgressBar.prototype.standardValueStep=function(){return 1},DKTools.Sprite.ProgressBar.prototype.standardMaxValue=function(){return 100},DKTools.Sprite.ProgressBar.prototype.standardValue=function(){return 0},DKTools.Sprite.ProgressBar.prototype.standardBackgroundColor=function(){return"grey"},DKTools.Sprite.ProgressBar.prototype.standardProgressColor=function(){return"#33ccff"},DKTools.Sprite.ProgressBar.prototype.standardDrawGraphicHandler=function(){return null},DKTools.Sprite.ProgressBar.prototype.standardDrawTextHandler=function(){return null},DKTools.Sprite.ProgressBar.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupValueStep(t.valueStep),this.setupMaxValue(t.maxValue),this.setupValue(t.value),this.setupBackgroundColor(t.progressColor),this.setupProgressColor(t.progressColor),this.setupDrawGraphicHandler(t.drawGraphicHandler),this.setupDrawTextHandler(t.drawTextHandler)},DKTools.Sprite.ProgressBar.prototype.setupValueStep=function(t){this._valueStep=t||this.standardValueStep()},DKTools.Sprite.ProgressBar.prototype.setupMaxValue=function(t){this._maxValue=t||this.standardMaxValue()},DKTools.Sprite.ProgressBar.prototype.setupValue=function(t){const e=this._maxValue,i=Math.max(0,Math.min(t,e));this._value=_.defaultTo(i,this.standardValue())},DKTools.Sprite.ProgressBar.prototype.setupBackgroundColor=function(t){this._backgroundColor=t||this.standardBackgroundColor()},DKTools.Sprite.ProgressBar.prototype.setupProgressColor=function(t){this._progressColor=t||this.standardProgressColor()},DKTools.Sprite.ProgressBar.prototype.setupDrawGraphicHandler=function(t){this._drawGraphicHandler=t||this.standardDrawGraphicHandler()},DKTools.Sprite.ProgressBar.prototype.setupDrawTextHandler=function(t){this._drawTextHandler=t||this.standardDrawTextHandler()},DKTools.Sprite.ProgressBar.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setValueStep(t.valueStep,!0)&&o++,this.setMaxValue(t.maxValue,!0)&&o++,this.setValue(t.value,!0)&&o++,this.setBackgroundColor(t.backgroundColor,!0)&&o++,this.setProgressColor(t.progressColor,!0)&&o++,this.setDrawGraphicHandler(t.drawGraphicHandler,!0)&&o++,this.setDrawTextHandler(t.drawTextHandler,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.ProgressBar.prototype.setValueStep=function(t,e=!1){if(this._valueStep===t)return!1;const i=this._valueStep;return this.setupValueStep(t),this._valueStep!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.prototype.setMaxValue=function(t,e=!1){if(this._maxValue===t)return!1;const i=this._maxValue;return this.setupMaxValue(t),this._maxValue!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.prototype.setValue=function(t,e=!1){if(this._value===t)return!1;const i=this._value;return this.setupValue(t),this._value!==i&&(e||this.refreshAll(),this.updateValueEvents(),!0)},DKTools.Sprite.ProgressBar.prototype.setBackgroundColor=function(t,e=!1){if(this._backgroundColor===t)return!1;const i=this._backgroundColor;return this.setupBackgroundColor(t),this._backgroundColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.prototype.setProgressColor=function(t,e=!1){if(this._progressColor===t)return!1;const i=this._progressColor;return this.setupProgressColor(t),this._progressColor!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.prototype.setDrawGraphicHandler=function(t,e=!1){return this._drawGraphicHandler!==t&&(this.setupDrawGraphicHandler(t),e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.prototype.setDrawTextHandler=function(t,e=!1){return this._drawTextHandler!==t&&(this.setupDrawTextHandler(t),e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.prototype.canCloneFixedBitmap=function(){return!1},DKTools.Sprite.ProgressBar.prototype.isHorizontal=function(){return this.width>this.height},DKTools.Sprite.ProgressBar.prototype.isVertical=function(){return!this.isHorizontal()},DKTools.Sprite.ProgressBar.prototype.isEmpty=function(){return 0===this._value},DKTools.Sprite.ProgressBar.prototype.isFull=function(){return this._value===this._maxValue},DKTools.Sprite.ProgressBar.prototype.updateEvents=function(){DKTools.Sprite.prototype.updateEvents.call(this),this.updateEmptyEvents(),this.updateFullEvents()},DKTools.Sprite.ProgressBar.prototype.updateValueEvents=function(){this.updateEventsContainer("value")},DKTools.Sprite.ProgressBar.prototype.updateEmptyEvents=function(){this.isEmpty()&&this.updateEventsContainer("empty")},DKTools.Sprite.ProgressBar.prototype.updateFullEvents=function(){this.isFull()&&this.updateEventsContainer("full")},DKTools.Sprite.ProgressBar.prototype._updateAnimateValue=function(t,e){const i=e.remainingTime,o=(this._value*(i-1)+t)/i;this.setValue(o)},DKTools.Sprite.ProgressBar.prototype.animateValue=function(t,e){return this.addEvent({type:"update",repeatTime:e,repeats:0,onUpdate:this._updateAnimateValue.bind(this,t)})},DKTools.Sprite.ProgressBar.prototype.animateEmpty=function(t){return this.animateValue(0,t)},DKTools.Sprite.ProgressBar.prototype.aimateFull=function(t){return this.animateValue(this._maxValue,t)},DKTools.Sprite.ProgressBar.prototype._drawProgressGraphic=function(){this.hasDrawGraphicHandler()&&this._drawGraphicHandler(this)},DKTools.Sprite.ProgressBar.prototype._drawProgressText=function(){this.hasDrawTextHandler()&&this._drawTextHandler(this)},DKTools.Sprite.ProgressBar.prototype.drawAll=function(){DKTools.Sprite.prototype.drawAll.call(this),this.drawProgress()},DKTools.Sprite.ProgressBar.prototype.drawProgress=function(){this._drawProgressGraphic(),this._drawProgressText()},DKTools.Sprite.ProgressBar.prototype.hasDrawGraphicHandler=function(){return!!this._drawGraphicHandler},DKTools.Sprite.ProgressBar.prototype.hasDrawTextHandler=function(){return!!this._drawTextHandler},DKTools.Sprite.ProgressBar.prototype.getPercents=function(){return Math.ceil(this._value/this._maxValue*100)},DKTools.Sprite.ProgressBar.prototype.getPrevValue=function(){return Math.max(0,this._value-this._valueStep)},DKTools.Sprite.ProgressBar.prototype.getNextValue=function(){return Math.min(this._value+this._valueStep,this._maxValue)},DKTools.Sprite.ProgressBar.prototype.addValue=function(t){t&&this.setValue(this._value+t)},DKTools.Sprite.ProgressBar.prototype.subValue=function(t){this.addValue(-t)},DKTools.Sprite.ProgressBar.prototype.prevValue=function(){return this.setValue(this.getPrevValue())},DKTools.Sprite.ProgressBar.prototype.nextValue=function(){return this.setValue(this.getNextValue())},DKTools.Sprite.ProgressBar.prototype.makeEmpty=function(){this.setValue(0)},DKTools.Sprite.ProgressBar.prototype.makeFull=function(){this.setValue(this._maxValue)},DKTools.Sprite.ProgressBar.Rectangle.prototype=Object.create(DKTools.Sprite.ProgressBar.prototype),DKTools.Sprite.ProgressBar.Rectangle.prototype.constructor=DKTools.Sprite.ProgressBar.Rectangle,DKTools.Sprite.ProgressBar.Rectangle.prototype.standardHorizontalDrawGraphicHandler=function(){return()=>{this.fillAll(this._backgroundColor),this.isEmpty()||this.fillRect({color:this._progressColor,width:this._value*this.realWidth/this._maxValue})}},DKTools.Sprite.ProgressBar.Rectangle.prototype.standardVerticalDrawGraphicHandler=function(){return()=>{if(this.fillAll(this._backgroundColor),!this.isEmpty()){const t=this.realHeight,e=this._value*t/this._maxValue;this.fillRect({color:this._progressColor,y:t-e,width:this.realWidth,height:e})}}},DKTools.Sprite.ProgressBar.Rectangle.prototype.standardDrawGraphicHandler=function(){return()=>{let t;t=this.isHorizontal()?this.standardHorizontalDrawGraphicHandler():this.standardVerticalDrawGraphicHandler(),DKTools.Utils.isFunction(t)&&t(this)}},DKTools.Sprite.ProgressBar.Rectangle.prototype.standardDrawTextHandler=function(){return()=>{const t=`${this.getPercents()}%`;this.drawText(t,{height:this.realHeight})}},DKTools.Sprite.ProgressBar.Circle.prototype=Object.create(DKTools.Sprite.ProgressBar.prototype),DKTools.Sprite.ProgressBar.Circle.prototype.constructor=DKTools.Sprite.ProgressBar.Circle,Object.defineProperties(DKTools.Sprite.ProgressBar.Circle.prototype,{lineWidth:{get:function(){return this._lineWidth},configurable:!0}}),DKTools.Sprite.ProgressBar.Circle.prototype.standardDrawGraphicHandler=function(){return()=>{const t=this._lineWidth,e=(this.realWidth-t)/2,i=e+t/2,o=i;this.strokeArc({x:i,y:o,radius:e,color:this._backgroundColor,lineWidth:t}),this.strokeArc({x:i,y:o,radius:e,startAngle:-Math.PI/2,endAngle:-Math.PI/2+2*Math.PI*this._value/this._maxValue,color:this._progressColor,lineWidth:t})}},DKTools.Sprite.ProgressBar.Circle.prototype.standardDrawTextHandler=function(){return()=>{const t=`${this.getPercents()}%`;this.drawText(t,{height:this.realHeight})}},DKTools.Sprite.ProgressBar.Circle.prototype.standardLineWidth=function(){return 10},DKTools.Sprite.ProgressBar.Circle.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.ProgressBar.prototype.setupAll.call(this,t),this.setupLineWidth(t.lineWidth)},DKTools.Sprite.ProgressBar.Circle.prototype.setupLineWidth=function(t){this._lineWidth=t||this.standardLineWidth()},DKTools.Sprite.ProgressBar.Circle.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.ProgressBar.prototype.setAll.call(this,t,!0);return this.setLineWidth(t.lineWidth,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.ProgressBar.Circle.prototype.setLineWidth=function(t,e=!1){if(this._lineWidth===t)return!1;const i=this._lineWidth;return this.setupLineWidth(t),this._lineWidth!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.ProgressBar.SemiCircle.prototype=Object.create(DKTools.Sprite.ProgressBar.Circle.prototype),DKTools.Sprite.ProgressBar.SemiCircle.prototype.constructor=DKTools.Sprite.ProgressBar.SemiCircle,DKTools.Sprite.ProgressBar.SemiCircle.prototype.standardDrawGraphicHandler=function(){return()=>{const t=this._lineWidth,e=(this.realWidth-t)/2,i=e+t/2,o=this.realHeight;this.strokeArc({x:i,y:o,radius:e,startAngle:Math.PI,color:this._backgroundColor,lineWidth:t}),this.strokeArc({x:i,y:o,radius:e,startAngle:Math.PI,endAngle:-Math.PI+Math.PI*this._value/this._maxValue,color:this._progressColor,lineWidth:t})}},DKTools.Sprite.CheckBox.prototype=Object.create(DKTools.Sprite.Button.prototype),DKTools.Sprite.CheckBox.prototype.constructor=DKTools.Sprite.CheckBox,Object.defineProperties(DKTools.Sprite.CheckBox.prototype,{checked:{get:function(){return this._checked},configurable:!0},checkedGraphic:{get:function(){return this._checkedGraphic},configurable:!0},uncheckedGraphic:{get:function(){return this._uncheckedGraphic},configurable:!0}}),DKTools.Sprite.CheckBox.prototype.standardChecked=function(){return!1},DKTools.Sprite.CheckBox.prototype.standardCheckedGraphic=function(){return null},DKTools.Sprite.CheckBox.prototype.standardUncheckedGraphic=function(){return null},DKTools.Sprite.CheckBox.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.Button.prototype.setupAll.call(this,t),this.setupChecked(t.checked),this.setupCheckedGraphic(t.checkedGraphic),this.setupUncheckedGraphic(t.uncheckedGraphic)},DKTools.Sprite.CheckBox.prototype.setupChecked=function(t){this._checked=_.defaultTo(t,this.standardChecked())},DKTools.Sprite.CheckBox.prototype.setupCheckedGraphic=function(t){this._checkedGraphic=t||this.standardCheckedGraphic()},DKTools.Sprite.CheckBox.prototype.setupUncheckedGraphic=function(t){this._uncheckedGraphic=t||this.standardUncheckedGraphic()},DKTools.Sprite.CheckBox.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.Button.prototype.setAll.call(this,t,!0);return this.setChecked(t.checked,!0)&&o++,this.setCheckedGraphic(t.checkedGraphic,!0)&&o++,this.setUncheckedGraphic(t.uncheckedGraphic,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Sprite.CheckBox.prototype.setChecked=function(t,e=!1){if(this._checked===t)return!1;const i=this._checked;return this.setupChecked(t),this._checked!==i&&(e||this.refreshAll(),!0)},DKTools.Sprite.CheckBox.prototype.setCheckedGraphic=function(t,e=!1){const i=this._checkedGraphic;if(i==t)return!1;if(i instanceof Bitmap)this.setupCheckedGraphic(t);else{if(!(DKTools.Utils.isString(i)||i instanceof Object))return!1;{const e=i;if(this.setupCheckedGraphic(t),_.isEqual(this._checkedGraphic,e))return!1}}return e||this.refreshAll(),!0},DKTools.Sprite.CheckBox.prototype.setUncheckedGraphic=function(t,e=!1){const i=this._uncheckedGraphic;if(i==t)return!1;if(i instanceof Bitmap)this.setupUncheckedGraphic(t);else{if(!(DKTools.Utils.isString(i)||i instanceof Object))return!1;{const e=i;if(this.setupUncheckedGraphic(t),_.isEqual(this._uncheckedGraphic,e))return!1}}return e||this.refreshAll(),!0},DKTools.Sprite.CheckBox.prototype._refreshCheckedGraphic=function(){let t=null;DKTools.Utils.isString(this._checkedGraphic)?t={folder:this._graphicFolder,filename:this._checkedGraphic}:this._checkedGraphic instanceof Object&&(t=this._checkedGraphic),t&&this.loadBitmap(t)},DKTools.Sprite.CheckBox.prototype._refreshUncheckedGraphic=function(){let t=null;DKTools.Utils.isString(this._uncheckedGraphic)?t={folder:this._graphicFolder,filename:this._uncheckedGraphic}:this._uncheckedGraphic instanceof Object&&(t=this._uncheckedGraphic),t&&this.loadBitmap(t)},DKTools.Sprite.CheckBox.prototype._refreshGraphic=function(){this.isChecked()?this._refreshCheckedGraphic():this._refreshUncheckedGraphic()},DKTools.Sprite.CheckBox.prototype.refreshAll=function(){this._refreshGraphic(),DKTools.Sprite.Button.prototype.refreshAll.call(this)},DKTools.Sprite.CheckBox.prototype.isChecked=function(){return this._checked},DKTools.Sprite.CheckBox.prototype.updateMouseClickEvents=function(t){this.switch(),DKTools.Sprite.Button.prototype.updateMouseClickEvents.call(this,t)},DKTools.Sprite.CheckBox.prototype.updateCheckedEvents=function(){this.updateEventsContainer("checked")},DKTools.Sprite.CheckBox.prototype.updateUncheckedEvents=function(){this.updateEventsContainer("unchecked")},DKTools.Sprite.CheckBox.prototype.switch=function(){this.setChecked(!this.isChecked())},DKTools.Sprite.CheckBox.prototype.check=function(){this.isChecked()||(this.switch(),this.updateCheckedEvents())},DKTools.Sprite.CheckBox.prototype.uncheck=function(){this.isChecked()&&(this.switch(),this.updateUncheckedEvents())},DKTools.Viewport.prototype=Object.create(DKTools.Sprite.prototype),DKTools.Viewport.prototype.constructor=DKTools.Viewport,Object.defineProperties(DKTools.Viewport.prototype,{maskShape:{get:function(){return this._maskShape},configurable:!0}}),DKTools.Viewport.prototype.standardMaskShape=function(){return"rect"},DKTools.Viewport.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupMaskShape(t.maskShape)},DKTools.Viewport.prototype.setupMaskShape=function(t){this._maskShape=t||this.standardMaskShape()},DKTools.Viewport.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setMaskShape(t.maskShape,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Viewport.prototype.setMaskShape=function(t,e=!1){if(this._maskShape===t)return!1;const i=this._maskShape;return this.setupShape(t),this._maskShape!==i&&(e||this.start(),!0)},DKTools.Viewport.prototype.canCloneFixedBitmap=function(){return!1},DKTools.Viewport.prototype.createAll=function(){DKTools.Sprite.prototype.createAll.call(this),this.createMask()},DKTools.Viewport.prototype.createMask=function(){DKTools.Sprite.prototype.createMask.call(this,this._maskShape)},DKTools.Layout.prototype=Object.create(DKTools.Sprite.prototype),DKTools.Layout.prototype.constructor=DKTools.Layout,Object.defineProperties(DKTools.Layout.prototype,{maxCols:{get:function(){return this._maxCols},configurable:!0},items:{get:function(){return this._items},configurable:!0},rowHeight:{get:function(){return this._rowHeight},configurable:!0},colWidth:{get:function(){return this._colWidth},configurable:!0},horizontalSpacing:{get:function(){return this._horizontalSpacing},configurable:!0},verticalSpacing:{get:function(){return this._verticalSpacing},configurable:!0},inverted:{get:function(){return this._inverted},configurable:!0}}),DKTools.Layout.prototype._clearAll=function(){DKTools.Sprite.prototype._clearAll.call(this),this._clearItems()},DKTools.Layout.prototype._clearItems=function(){this._items=[]},DKTools.Layout.prototype.clearItems=function(t=!1){this.removeAllItems(),this._clearItems(),t||this.start()},DKTools.Layout.prototype.standardActive=function(){return!1},DKTools.Layout.prototype.standardMaxCols=function(){return 1},DKTools.Layout.prototype.standardHorizontalSpacing=function(){return 12},DKTools.Layout.prototype.standardVerticalSpacing=function(){return this.getLineHeight()/2},DKTools.Layout.prototype.standardItems=function(){return[]},DKTools.Layout.prototype.standardRowHeight=function(){return t=>{const e=this.getItemsInRow(t);return _.max(_.map(e,"height"))}},DKTools.Layout.prototype.standardColWidth=function(){return t=>{const e=this.getItemsInCol(t);return _.max(_.map(e,"width"))}},DKTools.Layout.prototype.standardInverted=function(){return!1},DKTools.Layout.prototype.setupAll=function(t={}){t=t||{},DKTools.Sprite.prototype.setupAll.call(this,t),this.setupMaxCols(t.maxCols),this.setupSpacing(t.horizontalSpacing,t.verticalSpacing),this.setupItems(t.items),this.setupRowHeight(t.rowHeight),this.setupColWidth(t.colWidth),this.setupInverted(t.inverted)},DKTools.Layout.prototype.setupMaxCols=function(t){this._maxCols=_.defaultTo(t,this.standardMaxCols())},DKTools.Layout.prototype.setupHorizontalSpacing=function(t){this._horizontalSpacing=_.defaultTo(t,this.standardHorizontalSpacing())},DKTools.Layout.prototype.setupVerticalSpacing=function(t){this._verticalSpacing=_.defaultTo(t,this.standardVerticalSpacing())},DKTools.Layout.prototype.setupSpacing=function(t,e){this.setupHorizontalSpacing(t),this.setupVerticalSpacing(e)},DKTools.Layout.prototype.setupItems=function(t){this._items=_.clone(t||this.standardItems())},DKTools.Layout.prototype.setupRowHeight=function(t){this._rowHeight=t||this.standardRowHeight()},DKTools.Layout.prototype.setupColWidth=function(t){this._colWidth=t||this.standardColWidth()},DKTools.Layout.prototype.setupInverted=function(t){this._inverted=_.defaultTo(t,this.standardInverted())},DKTools.Layout.prototype.setAll=function(t,e=!1,i=!1){t=t||{};let o=DKTools.Sprite.prototype.setAll.call(this,t,!0);return this.setMaxCols(t.maxCols,!0)&&o++,o+=this.setSpacing(t.horizontalSpacing,t.verticalSpacing,!0),this.setItems(t.items,!0)&&o++,this.setRowHeight(t.rowHeight,!0)&&o++,this.setColWidth(t.colWidth,!0)&&o++,this.setInverted(t.reversed,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Layout.prototype.setMaxCols=function(t,e=!1){if(this._maxCols===t)return!1;const i=this._maxCols;return this.setupMaxCols(t),this._maxCols!==i&&(e||this.start(),!0)},DKTools.Layout.prototype.setHorizontalSpacing=function(t,e=!1){if(this._horizontalSpacing===t)return!1;const i=this._horizontalSpacing;return this.setupHorizontalSpacing(t),this._horizontalSpacing!==i&&(e||this.start(),!0)},DKTools.Layout.prototype.setVerticalSpacing=function(t,e=!1){if(this._verticalSpacing===t)return!1;const i=this._verticalSpacing;return this.setupVerticalSpacing(t),this._verticalSpacing!==i&&(e||this.start(),!0)},DKTools.Layout.prototype.setSpacing=function(t,e,i=!1){let o=0;return this.setHorizontalSpacing(t,!0)&&o++,this.setVerticalSpacing(e,!0)&&o++,o>0&&!i&&this.start(),o},DKTools.Layout.prototype.setItems=function(t,e=!1){return this._items!=t&&(this.removeAllItems(),this.setupItems(t),e||this.start(),!0)},DKTools.Layout.prototype.setRowHeight=function(t,e=!1){if(this._rowHeight===t)return!1;const i=this._rowHeight;return this.setupRowHeight(t),this._rowHeight!==i&&(e||this.start(),!0)},DKTools.Layout.prototype.setColWidth=function(t,e=!1){if(this._colWidth===t)return!1;const i=this._colWidth;return this.setupColWidth(t),this._colWidth!==i&&(e||this.start(),!0)},DKTools.Layout.prototype.setInverted=function(t,e=!1){if(this._inverted===t)return!1;const i=this._inverted;return this.setupInverted(t),this._inverted!==i&&(e||this.start(),!0)},DKTools.Layout.prototype.start=function(){this._started=!0,this.isReady()?DKTools.Sprite.prototype.start.call(this):this.addOneTimeEvent({type:"ready",onSuccess:this.start.bind(this)})},DKTools.Layout.prototype.removeAllChildren=function(){DKTools.Sprite.prototype.removeAllChildren.call(this),this.removeAllItems()},DKTools.Layout.prototype.removeAllItems=function(){this.hasItems()&&this.removeChild.apply(this,this._items)},DKTools.Layout.prototype.removeItem=function(t,e=!1){return Number.isFinite(t)&&(t=this.getItem(t)),this.hasItem(t)?(this.removeChild(t),DKTools.Utils.Array.remove(this._items,t),e||this.start(),t):null},DKTools.Layout.prototype.removeItems=function(t,e=!1){const i=_.map(t,t=>this.removeItem(t,!0));return i.length>0&&!e&&this.start(),i},DKTools.Layout.prototype.removeCols=function(t){this.getMaxCols()-t>=1&&this.addCols(-t)},DKTools.Layout.prototype.removeCol=function(){this.removeCols(1)},DKTools.Layout.prototype.addAllChildren=function(){DKTools.Sprite.prototype.addAllChildren.call(this),this.addAllItems()},DKTools.Layout.prototype.addAllItems=function(){this.hasItems()&&this.addChild.apply(this,this._items)},DKTools.Layout.prototype.addItem=function(t,e=!1){return t instanceof DKTools.Sprite?(this._items.push(t),e||this.start(),t):null},DKTools.Layout.prototype.addItems=function(t,e=!1){const i=_.map(t,t=>this.addItem(t,!0));return i.length>0&&!e&&this.start(),i},DKTools.Layout.prototype.addCols=function(t){this.setMaxCols(this.getMaxCols()+t)},DKTools.Layout.prototype.addCol=function(){this.addCols(1)},DKTools.Layout.prototype.canCloneFixedBitmap=function(){return!1},DKTools.Layout.prototype._getBitmapWidth=function(){let t=0;const e=this.getMaxCols();for(let i=1;i<=e;i++)t+=this.getColWidth(i)+this._horizontalSpacing;return t-this._horizontalSpacing},DKTools.Layout.prototype._getBitmapHeight=function(){let t=0;const e=this.getMaxRows();for(let i=1;i<=e;i++)t+=this.getRowHeight(i)+this._verticalSpacing;return t-this._verticalSpacing},DKTools.Layout.prototype.getMaxRows=function(){return Math.max(1,Math.ceil(this.getMaxItems()/this.getMaxCols()))},DKTools.Layout.prototype.getMaxCols=function(){return this._maxCols},DKTools.Layout.prototype.getItems=function(){return this.isInverted()?_.reverse(_.clone(this._items)):this._items},DKTools.Layout.prototype.getMaxItems=function(){return this._items.length},DKTools.Layout.prototype.getItemIndex=function(t){return _.indexOf(this.getItems(),t)},DKTools.Layout.prototype.getItem=function(t){return this.getItems()[t]},DKTools.Layout.prototype.getItemsInRow=function(t){const e=[],i=this.getMaxCols();if(t<1||t>this.getMaxRows())return e;const o=i*(t-1);for(let t=0;t<i;t++)e.push(this.getItem(o+t));return e},DKTools.Layout.prototype.getItemsInCol=function(t){const e=[],i=this.getMaxRows(),o=this.getMaxCols();if(t<1||t>o)return e;const n=t-1;for(let t=0;t<i;t++)e.push(this.getItem(n+o*t));return e},DKTools.Layout.prototype.getRowHeight=function(t){return DKTools.Utils.isFunction(this._rowHeight)?this._rowHeight(t,this):this._rowHeight},DKTools.Layout.prototype.getColWidth=function(t){return DKTools.Utils.isFunction(this._colWidth)?this._colWidth(t,this):this._colWidth},DKTools.Layout.prototype.getRowY=function(t){let e=0;for(let i=1;i<t;i++)e+=this.getRowHeight(i)+this._verticalSpacing;return e},DKTools.Layout.prototype.getColX=function(t){let e=0;for(let i=1;i<t;i++)e+=this.getColWidth(i)+this._horizontalSpacing;return e},DKTools.Layout.prototype.getItemRow=function(t){const e=this.getItemIndex(t);return e>=0?Math.floor(e/this.getMaxCols())+1:-1},DKTools.Layout.prototype.getItemCol=function(t){const e=this.getItemIndex(t);return e>=0?e%this.getMaxCols()+1:-1},DKTools.Layout.prototype.getCell=function(t,e){const i=this.getMaxCols()*(t-1)+(e-1);return{item:this.getItem(i),x:this.getColX(e),y:this.getRowY(t),width:this.getColWidth(e),height:this.getRowHeight(t)}},DKTools.Layout.prototype.moveItem=function(t,e,i){const o=this.getItem(t);o&&o.move(e,i)},DKTools.Layout.prototype.invert=function(){this.setInverted(!this.isInverted())},DKTools.Layout.prototype.isEmpty=function(){return 0===this.getMaxItems()},DKTools.Layout.prototype.isReady=function(){return this.isEmpty()||_.every(this._items,t=>t.isReady())},DKTools.Layout.prototype.isInverted=function(){return this._inverted},DKTools.Layout.prototype.isHorizontal=function(){return 1===this.getMaxRows()},DKTools.Layout.prototype.isVertical=function(){return 1===this.getMaxCols()},DKTools.Layout.prototype.hasItems=function(){return!this.isEmpty()},DKTools.Layout.prototype.hasItem=function(t){return this.getItemIndex(t)>=0},DKTools.Layout.prototype.iterateItems=function(t,e=!1){_.forEach(this.getItems(),t),e&&this.start()},DKTools.Layout.prototype.startItems=function(t=!1,e=!1){this.iterateItems(e=>{e.start(t)},!e)},DKTools.Layout.prototype.resizeItem=function(t,e,i,o=!1){Number.isFinite(t)&&(t=this.getItem(t)),this.hasItem(t)&&t.resize(e,i)&&(o||this.start())},DKTools.Layout.prototype.resizeItems=function(t,e,i=!1){this.iterateItems(i=>{this.resizeItem(i,t,e,!0)},!i)},DKTools.Layout.prototype.activateItems=function(t=!1){this.iterateItems(t=>{t.activate()},t)},DKTools.Layout.prototype.deactivateItems=function(t=!1){this.iterateItems(t=>{t.deactivate()},t)},DKTools.Layout.prototype.showItems=function(t=!1,e=!1){this.iterateItems(e=>{e.show(t)},e)},DKTools.Layout.prototype.hideItems=function(t=!1,e=!1){this.iterateItems(e=>{e.hide(t)},e)},DKTools.Layout.prototype.insertItem=function(t,e,i=!1){return t instanceof DKTools.Sprite?(DKTools.Utils.Array.insert(this._items,t,e),i||this.start(),t):null},DKTools.Layout.prototype.insertItems=function(t,e,i=!1){e=e||0;const o=_.map(t,(t,i)=>this.insertItem(t,e+i,!0));return o.length>0&&!i&&this.start(),o},DKTools.Layout.prototype.alignItem=function(t){if(this.isReady()){const e=this.getItemRow(t),i=this.getItemCol(t),o=this.getRowHeight(e),n=this.getColWidth(i),s=this.getColX(i)+(n-t.width)/2,r=this.getRowY(e)+(o-t.height)/2;t.move(s,r)}else this.addOneTimeEvent({type:"ready",onSuccess:this.alignItem.bind(this,t)})},DKTools.Layout.prototype.alignRow=function(t){_.forEach(this.getItemsInRow(t),this.alignItem.bind(this))},DKTools.Layout.prototype.alignCol=function(t){_.forEach(this.getItemsInCol(t),this.alignItem.bind(this))},DKTools.Layout.prototype.alignItems=function(){this.addOneTimeEvent({type:"ready",onSuccess:()=>{this.iterateItems(this.alignItem.bind(this))}})},DKTools.Layout.prototype.updateAll=function(){DKTools.Sprite.prototype.updateAll.call(this),this.updateLayout()},DKTools.Layout.prototype.updateLayout=function(){const t=this.getMaxItems(),e=this.getMaxRows(),i=this.getMaxCols();let o=0;for(let n=1;n<=e&&o<t;n++)for(let e=1;e<=i&&o<t;e++){const t=this.getColX(e),i=this.getRowY(n);this.moveItem(o++,t,i)}},DKTools.Window.prototype=Object.create(Window_Base.prototype),DKTools.Utils.mixin(DKTools.Window.prototype,DKTools.Base.prototype),DKTools.Window.prototype.constructor=DKTools.Window,Object.defineProperties(DKTools.Window.prototype,{realWidth:{get:function(){return this._width},set:function(t){this._width=t,this._refreshAllParts()},configurable:!0},realHeight:{get:function(){return this._height},set:function(t){this._height=t,this._refreshAllParts()},configurable:!0},width:{get:function(){return this.realWidth*this.scale.x},set:function(t){this._width=Math.floor(t/this.scale.x),this._refreshAllParts()},configurable:!0},height:{get:function(){return this.realHeight*this.scale.y},set:function(t){this._height=Math.floor(t/this.scale.y),this._refreshAllParts()},configurable:!0},origin:{get:function(){return this._origin},configurable:!0},windowOpacity:{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(t){this._windowSpriteContainer.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},configurable:!0},frameOpacity:{get:function(){return 255*this._windowFrameSprite.alpha},set:function(t){this._windowFrameSprite.alpha=DKTools.Utils.Number.clamp(t,0,255)/255},configurable:!0},opacity:{get:function(){return this._opacity},configurable:!0},tone:{get:function(){return this._tone},configurable:!0},contentsSprite:{get:function(){return this._windowContentsSprite},configurable:!0},frameSprite:{get:function(){return this._windowFrameSprite},configurable:!0},backSprite:{get:function(){return this._windowBackSprite},configurable:!0},bitmap:{get:function(){return this.contents},set:function(t){this.contents=t},configurable:!0},arrows:{get:function(){return this._arrows},configurable:!0}}),DKTools.Window.prototype.initialize=function(t,e,i,o){PIXI.Container.call(this),DKTools.Base.prototype.initialize.call(this,t,e,i,o)},DKTools.Window.prototype._addAllChildren=function(){DKTools.Base.prototype._addAllChildren.call(this),this._addAllParts()},DKTools.Window.prototype._addAllParts=function(){this._addSpriteContainer(),this._addPauseSignSprite(),this._addArrows()},DKTools.Window.prototype._addSpriteContainer=function(){this.hasSpriteContainer()&&(this.hasBackSprite()&&this._windowSpriteContainer.addChild(this._windowBackSprite),this.hasFrameSprite()&&this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowSpriteContainer))},DKTools.Window.prototype._addContentsSprite=function(){this.hasContentsSprite()&&this.addChild(this._windowContentsSprite)},DKTools.Window.prototype._addPauseSignSprite=function(){this.hasPauseSignSprite()&&this.addChild(this._windowPauseSignSprite)},DKTools.Window.prototype._addArrows=function(){_.forEach(["up","down","left","right"],t=>{const e=this.findArrow(t);e&&this.addChild(e)})},DKTools.Window.prototype.activate=function(){DKTools.Base.prototype.activate.call(this),this.hasContentsSprite()&&this._windowContentsSprite.activate()},DKTools.Window.prototype.addAllChildren=function(){DKTools.Base.prototype.addAllChildren.call(this),this.addContentsSprite()},DKTools.Window.prototype.addContentsSprite=function(){this._addContentsSprite(),this._refreshContents()},DKTools.Window.prototype._clearAll=function(){DKTools.Base.prototype._clearAll.call(this),this._clearIsWindow(),this._clearOpenness(),this._clearPadding(),this._clearMargin(),this._clearColorTone(),this._clearOrigin(),this._clearArrows()},DKTools.Window.prototype._clearIsWindow=function(){this._isWindow=!0},DKTools.Window.prototype._clearOpenness=function(){this._openness=this.standardOpenness()},DKTools.Window.prototype._clearPadding=function(){this._padding=this.standardPadding()},DKTools.Window.prototype._clearMargin=function(){this._margin=this.standardMargin()},DKTools.Window.prototype._clearColorTone=function(){this._colorTone=this.standardTone()},DKTools.Window.prototype._clearOrigin=function(){this._origin=this.standardOrigin()},DKTools.Window.prototype._clearArrows=function(){this._arrows=[]},DKTools.Window.prototype._createAll=function(){DKTools.Base.prototype._createAll.call(this),this._createAllParts(),this._createWindowskin()},DKTools.Window.prototype._createAllParts=function(){this._createSpriteContainer(),this._createBackSprite(),this._createFrameSprite(),this._createPauseSignSprite(),this._createArrows()},DKTools.Window.prototype._createSpriteContainer=function(){this._windowSpriteContainer=new PIXI.Container},DKTools.Window.prototype._createBackSprite=function(){this.needsCreateBackSprite()&&(this._windowBackSprite=new Sprite,this._windowBackSprite.opacity=this.standardBackOpacity(),this._windowBackSprite.visible=this.standardBackVisible())},DKTools.Window.prototype._createFrameSprite=function(){this.needsCreateFrameSprite()&&(this._windowFrameSprite=new Sprite,this._windowFrameSprite.visible=this.standardFrameVisible())},DKTools.Window.prototype._createPauseSignSprite=function(){this.needsCreatePauseSignSprite()&&(this._windowPauseSignSprite=new Sprite)},DKTools.Window.prototype._createArrows=function(){this.needsCreateArrowsSprites()&&(this.needsCreateUpArrowSprite()&&this.createArrow("up","up",{onUpdate:this.onUpArrowUpdate.bind(this),onMouseClick:this.onUpArrowMouseClick.bind(this),onMouseLongPress:this.onUpArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateDownArrowSprite()&&this.createArrow("down","down",{onUpdate:this.onDownArrowUpdate.bind(this),onMouseClick:this.onDownArrowMouseClick.bind(this),onMouseLongPress:this.onDownArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateLeftArrowSprite()&&this.createArrow("left","left",{onUpdate:this.onLeftArrowUpdate.bind(this),onMouseClick:this.onLeftArrowMouseClick.bind(this),onMouseLongPress:this.onLeftArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}),this.needsCreateRightArrowSprite()&&this.createArrow("right","right",{onUpdate:this.onRightArrowUpdate.bind(this),onMouseClick:this.onRightArrowMouseClick.bind(this),onMouseLongPress:this.onRightArrowMouseLongPress.bind(this),onStateNormal:this.standardArrowStateNormal(),onStatePressed:this.standardArrowStatePressed()}))},DKTools.Window.prototype._createWindowskin=function(){this.windowskin=DKTools.Utils.Bitmap.load({folder:"img/system",filename:this.standardWindowskin()})},DKTools.Window.prototype.canRedrawAll=function(){return this.hasContentsSprite()&&DKTools.Base.prototype.canRedrawAll.call(this)},DKTools.Window.prototype.changeFont=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changeFont(t)},DKTools.Window.prototype.changeTextColor=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changeTextColor(t)},DKTools.Window.prototype.changePaintOpacity=function(t){this.hasContentsSprite()&&this._windowContentsSprite.changePaintOpacity(t)},DKTools.Window.prototype.checkSize=function(){const t=this.getMinWidth(),e=this.getMinHeight();let i=0;return this._width<t&&(this.setupWidth(t),i++),this._height<e&&(this.setupHeight(e),i++),i},DKTools.Window.prototype.createArrow=function(t,e,i={}){const o=new DKTools.Sprite.Arrow({...i,id:e,arrowType:t});return o.start(),o.addEvent({type:"update",onUpdate:t=>{this.isOpenAndVisible()?o.show():o.hide(),DKTools.Utils.isFunction(i.onUpdate)&&i.onUpdate(t)}}),DKTools.Utils.isFunction(i.onMouseDown)&&o.addEvent({type:"mouse-down-left",onUpdate:i.onMouseDown}),DKTools.Utils.isFunction(i.onMouseUp)&&o.addEvent({type:"mouse-up-left",onUpdate:i.onMouseUp}),DKTools.Utils.isFunction(i.onMouseClick)&&o.addEvent({type:"mouse-click-left",onUpdate:i.onMouseClick}),DKTools.Utils.isFunction(i.onMouseLongPress)&&o.addEvent({type:"mouse-long-press-left",onUpdate:i.onMouseLongPress}),DKTools.Utils.isFunction(i.onMouseLongPressStarted)&&o.addEvent({type:"mouse-long-press-left-started",onUpdate:i.onMouseLongPressStarted}),DKTools.Utils.isFunction(i.onMouseLongPressFinished)&&o.addEvent({type:"mouse-long-press-left-finished",onUpdate:i.onMouseLongPressFinished}),DKTools.Utils.isFunction(i.onStateNormal)&&o.addEvent({type:"state-normal",onUpdate:i.onStateNormal}),DKTools.Utils.isFunction(i.onStatePressed)&&o.addEvent({type:"state-pressed",onUpdate:i.onStatePressed}),this._arrows.push(o),this.addChild(o),o},DKTools.Window.prototype.deactivate=function(){DKTools.Base.prototype.deactivate.call(this),this.hasContentsSprite()&&this._windowContentsSprite.deactivate()},DKTools.Window.prototype.drawText=function(t,e){return!!this.hasContentsSprite()&&this._windowContentsSprite.drawText(t,e)},DKTools.Window.prototype.findArrow=function(t){return _.find(this._arrows,{id:t})},DKTools.Window.prototype.getMinWidth=function(){return 2*this.standardPadding()+DKTools.Base.prototype.getMinWidth.call(this)},DKTools.Window.prototype.getMinHeight=function(){return 2*this.standardPadding()+DKTools.Base.prototype.getMinHeight.call(this)},DKTools.Window.prototype.getContentsWidth=function(){return DKTools.Utils.isFunction(this._contentsWidth)?this._contentsWidth(this):this._contentsWidth},DKTools.Window.prototype.getContentsHeight=function(){return DKTools.Utils.isFunction(this._contentsHeight)?this._contentsHeight(this):this._contentsHeight},DKTools.Window.prototype.getContentsSize=function(){return{width:this.getContentsWidth(),height:this.getContentsHeight()}},DKTools.Window.prototype.getCurrentOpacity=function(){return this.windowOpacity},DKTools.Window.prototype.hasBitmap=function(){return!!this.hasContentsSprite()&&this._windowContentsSprite.hasBitmap()},DKTools.Window.prototype.hasSpriteContainer=function(){return!!this._windowSpriteContainer},DKTools.Window.prototype.hasBackSprite=function(){return!!this._windowBackSprite},DKTools.Window.prototype.hasFrameSprite=function(){return!!this._windowFrameSprite},DKTools.Window.prototype.hasContentsSprite=function(){return!!this._windowContentsSprite},DKTools.Window.prototype.hasArrow=function(t){return!!this.findArrow(t)},DKTools.Window.prototype.hasArrowSprites=function(){return this.hasUpArrowSprite()&&this.hasDownArrowSprite()&&this.hasLeftArrowSprite()&&this.hasRightArrowSprite()},DKTools.Window.prototype.hasUpArrowSprite=function(){return this.hasArrow("up")},DKTools.Window.prototype.hasDownArrowSprite=function(){return this.hasArrow("down")},DKTools.Window.prototype.hasLeftArrowSprite=function(){return this.hasArrow("left")},DKTools.Window.prototype.hasRightArrowSprite=function(){return this.hasArrow("right")},DKTools.Window.prototype.hasPauseSignSprite=function(){return!!this._windowPauseSignSprite},DKTools.Window.prototype.hasBackgroundDimmer=function(){return!!this._dimmerSprite},DKTools.Window.prototype.hideBack=function(){this.hasBackSprite()&&(this._windowBackSprite.visible=!1)},DKTools.Window.prototype.hideContents=function(){this.hasContentsSprite()&&this._windowContentsSprite.hide()},DKTools.Window.prototype.hideFrame=function(){this.hasFrameSprite()&&(this._windowFrameSprite.visible=!1)},DKTools.Window.prototype.isOpenAndVisible=function(){return this.isOpen()&&this.isVisible()},DKTools.Window.prototype.isOpenAndActive=function(){return this.isOpen()&&this.isActive()},DKTools.Window.prototype.isInside=function(t,e){const i=this.canvasToLocalX(t),o=this.canvasToLocalY(e);return new Rectangle(0,0,this.width,this.height).contains(i,o)},DKTools.Window.prototype.needsCreateBackSprite=function(){return!0},DKTools.Window.prototype.needsCreateFrameSprite=function(){return!0},DKTools.Window.prototype.needsCreateArrowsSprites=function(){return!1},DKTools.Window.prototype.needsCreateDownArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateUpArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateLeftArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreateRightArrowSprite=function(){return!0},DKTools.Window.prototype.needsCreatePauseSignSprite=function(){return!0},DKTools.Window.prototype.onUpArrowUpdate=function(t){},DKTools.Window.prototype.onDownArrowUpdate=function(t){},DKTools.Window.prototype.onLeftArrowUpdate=function(t){},DKTools.Window.prototype.onRightArrowUpdate=function(t){},DKTools.Window.prototype.onUpArrowMouseClick=function(t){},DKTools.Window.prototype.onDownArrowMouseClick=function(t){},DKTools.Window.prototype.onLeftArrowMouseClick=function(t){},DKTools.Window.prototype.onRightArrowMouseClick=function(t){},DKTools.Window.prototype.onUpArrowMouseLongPress=function(t){},DKTools.Window.prototype.onDownArrowMouseLongPress=function(t){},DKTools.Window.prototype.onLeftArrowMouseLongPress=function(t){},DKTools.Window.prototype.onRightArrowMouseLongPress=function(t){},DKTools.Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshContents(),this._refreshPauseSign(),this._refreshArrows()},DKTools.Window.prototype._refreshBack=function(){this.hasBackSprite()&&Window.prototype._refreshBack.call(this)},DKTools.Window.prototype._refreshFrame=function(){this.hasFrameSprite()&&Window.prototype._refreshFrame.call(this)},DKTools.Window.prototype._refreshContents=function(){if(this.hasContentsSprite()){let t=this._contentsPosition;DKTools.Utils.isFunction(t)&&(t=t(this)),this._windowContentsSprite.move(t)}},DKTools.Window.prototype._refreshPauseSign=function(){this.hasPauseSignSprite()&&Window.prototype._refreshPauseSign.call(this)},DKTools.Window.prototype._refreshArrows=function(){const t={up:this.standardUpArrowPosition(),down:this.standardDownArrowPosition(),left:this.standardLeftArrowPosition(),right:this.standardRightArrowPosition()};_.forEach(t,(t,e)=>{const i=this.findArrow(e);i&&i.move(t)})},DKTools.Window.prototype.redrawAll=function(){this.hasContentsSprite()&&this._windowContentsSprite.redrawAll()},DKTools.Window.prototype.refreshAll=function(){this._refreshAllParts(),DKTools.Base.prototype.refreshAll.call(this)},DKTools.Window.prototype.refreshArrows=function(){_.forEach(this._arrows,t=>{t.refreshAll()})},DKTools.Window.prototype.removeAllChildren=function(){DKTools.Base.prototype.removeAllChildren.call(this),this.removeContentsSprite()},DKTools.Window.prototype.removeContentsSprite=function(){this.hasContentsSprite()&&this.removeChild(this._windowContentsSprite)},DKTools.Window.prototype.removeArrow=function(t){const e=this.findArrow(t);e&&(DKTools.Utils.Array.remove(this._arrows,e),this.removeChild(e))},DKTools.Window.prototype.resetAll=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetAll()},DKTools.Window.prototype.resetFont=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetFont()},DKTools.Window.prototype.resetTextColor=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetTextColor()},DKTools.Window.prototype.resetPaintOpacity=function(){this.hasContentsSprite()&&this._windowContentsSprite.resetPaintOpacity()},DKTools.Window.prototype.resize=function(t,e,i=!1,o=!1){if(t=_.defaultTo(t,this.getMinWidth()),e=_.defaultTo(e,this.getMinHeight()),DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),this._width===t&&this._height===e)return!1;const n=this._width,s=this._height;return this.setupSize(t,e),(this._width!==n||this._height!==s)&&(i||this.start(),o&&this.activate(),!0)},DKTools.Window.prototype.standardOpenness=function(){return 255},DKTools.Window.prototype.standardOpennessSpeed=function(){return 16},DKTools.Window.prototype.standardMargin=function(){return 4},DKTools.Window.prototype.standardOrigin=function(){return new Point(0,0)},DKTools.Window.prototype.standardUpArrowPosition=function(){return new Point(this._width/2,12)};DKTools.Window.prototype.standardDownArrowPosition=function(){return new Point(this._width/2,this._height-12)},DKTools.Window.prototype.standardLeftArrowPosition=function(){return new Point(12,this._height/2)},DKTools.Window.prototype.standardRightArrowPosition=function(){return new Point(this._width-12,this._height/2)},DKTools.Window.prototype.standardArrowStateNormal=function(){return t=>{const e=t.target;e.setScale(1,1),e.setOpacity(255)}},DKTools.Window.prototype.standardArrowStatePressed=function(){return t=>{const e=t.target;e.setScale(.9,.9),e.setOpacity(160)}},DKTools.Window.prototype.standardContentsSprite=function(){return new DKTools.Sprite},DKTools.Window.prototype.standardChildX=function(){return this._padding},DKTools.Window.prototype.standardChildY=function(){return this._padding},DKTools.Window.prototype.standardChildPosition=function(){return()=>new Point(this.standardChildX(),this.standardChildY())},DKTools.Window.prototype.standardContentsPosition=function(){return this.standardChildPosition()},DKTools.Window.prototype.standardBackVisible=function(){return!0},DKTools.Window.prototype.standardFrameVisible=function(){return!0},DKTools.Window.prototype.standardContentsWidth=function(){return()=>this._width-2*this._padding},DKTools.Window.prototype.standardContentsHeight=function(){return()=>this._height-2*this._padding},DKTools.Window.prototype.standardWindowOpacity=function(){return 255},DKTools.Window.prototype.standardContentsOpacity=function(){return 255},DKTools.Window.prototype.standardFrameOpacity=function(){return 255},DKTools.Window.prototype.standardOpacity=function(){return{windowOpacity:this.standardWindowOpacity(),contentsOpacity:this.standardContentsOpacity(),frameOpacity:this.standardFrameOpacity(),backOpacity:this.standardBackOpacity()}},DKTools.Window.prototype.standardTone=function(){try{return _.clone($gameSystem.windowTone())}catch(t){return[0,0,0]}},DKTools.Window.prototype.setupAll=function(t={}){t=t||{},DKTools.Base.prototype.setupAll.call(this,t);let e=t.contentsSprite;t instanceof DKTools.Window&&e instanceof DKTools.Sprite&&(e=e.clone({blockStart:!0})),this.setupPadding(t.padding),this.setupMargin(t.margin),this.setupContentsWidth(t.contentsWidth),this.setupContentsHeight(t.contentsHeight),this.setupContentsSprite(e),this.setupContentsPosition(t.contentsPosition),this.setupOpacity(t.opacity),this.setupTone(t.tone)},DKTools.Window.prototype.setupWidth=function(t){this.realWidth=this._checkWidth(t)},DKTools.Window.prototype.setupHeight=function(t){DKTools.Utils.isString(t)&&(t=this.getLineHeight()*parseFloat(t)),this.realHeight=this._checkHeight(t)},DKTools.Window.prototype.setupSize=function(t,e){if(t instanceof Object)return this.setupSize(t.width,t.height);DKTools.Utils.isString(e)&&(e=this.getLineHeight()*parseFloat(e)),t=this._checkWidth(t),e=this._checkHeight(e),Window.prototype.move.call(this,this.x,this.y,t,e)},DKTools.Window.prototype.setupPadding=function(t){this._padding=_.defaultTo(t,this.standardPadding())},DKTools.Window.prototype.setupMargin=function(t){this._margin=_.defaultTo(t,this.standardMargin())},DKTools.Window.prototype.setupContentsWidth=function(t){this._contentsWidth=t||this.standardContentsWidth()},DKTools.Window.prototype.setupContentsHeight=function(t){this._contentsHeight=t||this.standardContentsHeight()},DKTools.Window.prototype.setupContentsSprite=function(t){this._windowContentsSprite=t||this.standardContentsSprite()},DKTools.Window.prototype.setupContentsPosition=function(t,e){let i=t;DKTools.Utils.isFunction(t)||(i=DKTools.Utils.Point.tryToPoint(t,e)||this.standardContentsPosition()),this._contentsPosition=i},DKTools.Window.prototype.setupOpacity=function(t){this._opacity=Object.assign(this.standardOpacity(),t)},DKTools.Window.prototype.setupTone=function(t){this._tone=Object.assign(this.standardTone(),t)},DKTools.Window.prototype.setAll=function(t={},e=!1,i=!1){t=t||{};let o=DKTools.Base.prototype.setAll.call(this,t,!0);return this.setPadding(t.padding,!0)&&o++,this.setMargin(t.margin,!0)&&o++,this.setOpacity(t.opacity,!0)&&o++,this.setTone(t.tone,!0)&&o++,o>0&&(e||this.start(),i&&this.activate()),o},DKTools.Window.prototype.setWidth=function(t,e=!1,i=!1){return this.resize(t,this._height,e,i)},DKTools.Window.prototype.setHeight=function(t,e=!1,i=!1){return this.resize(this._width,t,e,i)},DKTools.Window.prototype.setPadding=function(t,e=!1){if(this._padding===t)return!1;const i=this._padding;return this.setupPadding(t),this._padding!==i&&(e||this.start(),!0)},DKTools.Window.prototype.setMargin=function(t,e=!1){if(this._margin===t)return!1;const i=this._margin;return this.setupMargin(padding),this._margin!==i&&(e||this.start(),!0)},DKTools.Window.prototype.setContentsSprite=function(t,e=!1,i=!1){return this._windowContentsSprite!=t&&(this.removeContentsSprite(),this.setupContentsSprite(t),this.addContentsSprite(),e||this.start(),i&&this.activate(),!0)},DKTools.Window.prototype.setContentsPosition=function(t,e){const i=DKTools.Utils.isFunction,o=i(this._contentsPosition),n=i(t);if(o||n){if(this._contentsPosition===t)return!1;this.setupContentsPosition(t,e)}else{const i=DKTools.Utils.Point.toPoint(t,e);if(DKTools.Utils.Point.equals(this._contentsPosition,i))return!1;const o=DKTools.Utils.Point.clone(this._contentsPosition);if(this.setupContentsPosition(i),DKTools.Utils.Point.equals(this._contentsPosition,o))return!1}return this._refreshContents(),!0},DKTools.Window.prototype.setOpacity=function(t,e=!1){if(_.isEqual(this._opacity,Object.assign(this.standardOpacity(),t)))return!1;const i=_.clone(this._opacity);return this.setupOpacity(t),!_.isEqual(this._opacity,i)&&(e||this.updateOpacity(),!0)},DKTools.Window.prototype.setTone=function(t,e=!1){if(_.isEqual(this._tone,Object.assign(this.standardTone(),t)))return!1;const i=_.clone(this._tone);return this.setupTone(t),!_.isEqual(this._tone,i)&&(e||this.updateTone(),!0)},DKTools.Window.prototype.start=function(t=!1){if(this.hasContentsSprite()){const e=this._windowContentsSprite;e.resize(this.getContentsWidth(),this.getContentsHeight(),!0),e.start(t)}DKTools.Base.prototype.start.call(this,t)},DKTools.Window.prototype.showBack=function(){this.hasBackSprite()&&(this._windowBackSprite.visible=!0)},DKTools.Window.prototype.showContents=function(t=!1){this.hasContentsSprite()&&this._windowContentsSprite.show(t)},DKTools.Window.prototype.showFrame=function(){this.hasFrameSprite()&&(this._windowFrameSprite.visible=!0)},DKTools.Window.prototype._updateContents=function(){this.hasContentsSprite()&&Window.prototype._updateContents.call(this)},DKTools.Window.prototype._updatePauseSign=function(){this.hasPauseSignSprite()&&Window.prototype._updatePauseSign.call(this)},DKTools.Window.prototype.updateOpenEvents=function(){this.updateEventsContainer("open")},DKTools.Window.prototype.updateCloseEvents=function(){this.updateEventsContainer("close")},DKTools.Window.prototype.updateAll=function(){this.updateContents(),DKTools.Base.prototype.updateAll.call(this),this.updateTone()},DKTools.Window.prototype.updateContents=function(){this.hasContentsSprite()&&this._windowContentsSprite.updateAll()},DKTools.Window.prototype.updateTransform=function(){this._updateContents(),this._updatePauseSign(),PIXI.Container.prototype.updateTransform.call(this)},DKTools.Window.prototype.updateOpacity=function(t={}){t=t||{},this.hasSpriteContainer()&&(this.windowOpacity=_.defaultTo(t.windowOpacity,this.opacity.windowOpacity)),this.hasContentsSprite()&&(this.contentsOpacity=_.defaultTo(t.contentsOpacity,this.opacity.contentsOpacity)),this.hasFrameSprite()&&(this.frameOpacity=_.defaultTo(t.frameOpacity,this.opacity.frameOpacity)),this.hasBackSprite()&&(this.backOpacity=_.defaultTo(t.backOpacity,this.opacity.backOpacity))},DKTools.Window.prototype.updateTone=function(t){t=t||this.tone,this.hasBackSprite()&&Window.prototype.setTone.apply(this,t)},DKTools.Window.prototype.updateOpen=function(){this._opening&&(this.openness+=this.standardOpennessSpeed(),this.isOpen()&&(this._opening=!1,this.updateOpenEvents()))},DKTools.Window.prototype.updateClose=function(){this._closing&&(this.openness-=this.standardOpennessSpeed(),this.isClosed()&&(this._closing=!1,this.updateCloseEvents()))},DKTools.Window.prototype.update=function(){DKTools.Base.prototype.update.call(this),this.updateOpen(),this.updateClose(),this.updateBackgroundDimmer()},DKTools.Window.Selectable.prototype=Object.create(DKTools.Window.prototype),DKTools.Window.Selectable.prototype.constructor=DKTools.Window.Selectable,DKTools.Window.Selectable.prototype.standardContentsSprite=function(){return new DKTools.Sprite.Selectable},DKTools.Window.Selectable.prototype.needsCreateArrowsSprites=function(){return!0},DKTools.Window.Selectable.prototype.onUpArrowUpdate=function(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isVertical()&&t.getTopRow()>0&&e.show(this.isVisibleAndActive()&&t.isActive())}},DKTools.Window.Selectable.prototype.onDownArrowUpdate=function(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;if(this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isVertical()){const i=t.getTopRow(),o=t.getMaxTopRow();o>0&&i<o&&e.show(this.isVisibleAndActive()&&t.isActive())}}},DKTools.Window.Selectable.prototype.onLeftArrowUpdate=function(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isHorizontal()&&t.getTopCol()>0&&e.show(this.isVisibleAndActive()&&t.isActive())}},DKTools.Window.Selectable.prototype.onRightArrowUpdate=function(t){const e=t.target;if(e.hide(),this.hasContentsSprite()){const t=this._windowContentsSprite;if(this.isChild(t)&&t.isVisible()&&t.isSelectable()&&t.isHorizontal()){const i=t.getTopCol(),o=t.getMaxTopCol();o>0&&i<o&&e.show(this.isVisibleAndActive()&&t.isActive())}}},DKTools.Window.Selectable.prototype.onUpArrowMouseClick=function(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectPrevItem()},DKTools.Window.Selectable.prototype.onDownArrowMouseClick=function(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectNextItem()},DKTools.Window.Selectable.prototype.onLeftArrowMouseClick=function(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectPrevItem()},DKTools.Window.Selectable.prototype.onRightArrowMouseClick=function(t){t.target.isVisibleAndActive()&&this._windowContentsSprite.selectNextItem()},DKTools.Window.Selectable.prototype.onUpArrowMouseLongPress=function(t){this.onUpArrowMouseClick(t)},DKTools.Window.Selectable.prototype.onDownArrowMouseLongPress=function(t){this.onDownArrowMouseClick(t)},DKTools.Window.Selectable.prototype.onLeftArrowMouseLongPress=function(t){this.onLeftArrowMouseClick(t)},DKTools.Window.Selectable.prototype.onRightArrowMouseLongPress=function(t){this.onRightArrowMouseClick(t)},DKTools.Scene.prototype=Object.create(Scene_Base.prototype),DKTools.Scene.prototype.constructor=DKTools.Scene,DKTools.Scene.prototype.initialize=function(){this._clearAll(),this._createAll(),this._setupAll(),this._addAllChildren(),Scene_Base.prototype.initialize.call(this)},DKTools.Scene.prototype._clearAll=function(){},DKTools.Scene.prototype._createAll=function(){this._createOptionManager(),this._createEventManager()},DKTools.Scene.prototype._createOptionManager=function(){this._optionManager=new DKTools.OptionManager},DKTools.Scene.prototype._createEventManager=function(){this._eventManager=new DKTools.EventManager(this)},DKTools.Scene.prototype._setupAll=function(){this._setupOptions(),this._setupEvents(),this._setupAnimations()},DKTools.Scene.prototype._setupOptions=function(){},DKTools.Scene.prototype._setupEvents=function(){},DKTools.Scene.prototype._setupAnimations=function(){},DKTools.Scene.prototype._addAllChildren=function(){},DKTools.Scene.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.createAllSprites(),this.createWindowLayer(),this.createAllWindows(),this.createForeground()},DKTools.Scene.prototype.createBackground=function(){},DKTools.Scene.prototype.createAllSprites=function(){},DKTools.Scene.prototype.createAllWindows=function(){},DKTools.Scene.prototype.createForeground=function(){},DKTools.Scene.prototype.start=function(){Scene_Base.prototype.start.call(this),this.startAllSprites(),this.startAllWindows()},DKTools.Scene.prototype.startAllSprites=function(){},DKTools.Scene.prototype.startAllWindows=function(){},DKTools.Scene.prototype.removeWindow=function(t){this.hasWindowLayer()&&this.isChild(t)&&this._windowLayer.removeChild(t)},DKTools.Scene.prototype.hasWindowLayer=function(){return!!this._windowLayer},DKTools.Scene.prototype.isChild=function(t){return t instanceof Window&&this.hasWindowLayer()?DKTools.Utils.Array.contains(this._windowLayer.children,t):DKTools.Utils.Array.contains(this.children,t)},DKTools.Scene.prototype.stop=function(){Scene_Base.prototype.stop.call(this),this.stopAll()},DKTools.Scene.prototype.stopAll=function(){},DKTools.Scene.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),this.terminateAll()},DKTools.Scene.prototype.terminateAll=function(){},DKTools.Scene.prototype.clearOptions=function(){this._optionManager.clear()},DKTools.Scene.prototype.isOptionEnabled=function(t){return this._optionManager.isOptionEnabled(t)},DKTools.Scene.prototype.isOptionsEnabled=function(t){return this._optionManager.isOptionsEnabled(t)},DKTools.Scene.prototype.isSomeOptionsEnabled=function(t){return this._optionManager.isSomeOptionsEnabled(t)},DKTools.Scene.prototype.isOptionDisabled=function(t){return this._optionManager.isOptionDisabled(t)},DKTools.Scene.prototype.isOptionsDisabled=function(t){return this._optionManager.isOptionsDisabled(t)},DKTools.Scene.prototype.isSomeOptionsDisabled=function(t){return this._optionManager.isSomeOptionsDisabled(t)},DKTools.Scene.prototype.isSomeOptionEnabled=function(){return this._optionManager.isSomeOptionEnabled()},DKTools.Scene.prototype.addOptionChangeListener=function(t,e){this._optionManager.addOptionChangeListener(t,e)},DKTools.Scene.prototype.removeOptionChangeListener=function(t,e){this._optionManager.removeOptionChangeListener(t,e)},DKTools.Scene.prototype.enableOption=function(t){this._optionManager.enableOption(t)},DKTools.Scene.prototype.enableOptions=function(t){this._optionManager.enableOption(t)},DKTools.Scene.prototype.disableOption=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.disableOptions=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.switchOption=function(t){this._optionManager.disableOption(t)},DKTools.Scene.prototype.switchOptions=function(t){this._optionManager.switchOptions(t)},DKTools.Scene.prototype.clearEvents=function(t){this._eventManager.clearEvents(t)},DKTools.Scene.prototype.removeEvent=function(t){return this._eventManager.removeEvent(t)},DKTools.Scene.prototype.iterateEventsContainer=function(t,e){this._eventManager.iterateEventsContainer(t,e)},DKTools.Scene.prototype.isEventsPaused=function(t){return this._eventManager.isEventsPaused(t)},DKTools.Scene.prototype.pauseEvents=function(t,e){this._eventManager.pauseEvents(t,e)},DKTools.Scene.prototype.resumeEvents=function(t){this._eventManager.resumeEvents(t)},DKTools.Scene.prototype.finishEvents=function(t,e=!1){this._eventManager.finishEvents(t,e)},DKTools.Scene.prototype.stopEvents=function(t,e=!1){this._eventManager.stopEvents(t,e)},DKTools.Scene.prototype.updateEvents=function(){this._eventManager.update(),this.updateReadyEvents(),this.updateUpdateEvents(),this.updateQueueEvents()},DKTools.Scene.prototype.updateEvent=function(t){this._eventManager.updateEvent(t)},DKTools.Scene.prototype.updateEventsContainer=function(t){this._eventManager.updateEventsContainer(t)},DKTools.Scene.prototype.updateReadyEvents=function(){this.isReady()&&this.updateEventsContainer("ready")},DKTools.Scene.prototype.updateUpdateEvents=function(){this.updateEventsContainer("update")},DKTools.Scene.prototype.updateQueueEvents=function(){const t=this.getEventsContainerByType("queue")[0];this.updateEvent(t)},DKTools.Scene.prototype.getEventsContainerByType=function(t){return this._eventManager.getEventsContainerByType(t)},DKTools.Scene.prototype.getEventsContainer=function(t){return this._eventManager.getEventsContainer(t)},DKTools.Scene.prototype.getEventIndex=function(t){return this._eventManager.getEventIndex(t)},DKTools.Scene.prototype.getEvents=function(t){return this._eventManager.getEvents(t)},DKTools.Scene.prototype.getAnimations=function(t){return this._eventManager.getAnimations(t)},DKTools.Scene.prototype.hasEvent=function(t){return this._eventManager.hasEvent(t)},DKTools.Scene.prototype.hasEvents=function(t){return this._eventManager.hasEvents(t)},DKTools.Scene.prototype.hasAnimation=function(t){return this._eventManager.hasAnimation(t)},DKTools.Scene.prototype.hasAnimations=function(t){return this._eventManager.hasAnimations(t)},DKTools.Scene.prototype.addEvent=function(t){return this._eventManager.addEvent(t)},DKTools.Scene.prototype.addOneTimeEvent=function(t){return this._eventManager.addOneTimeEvent(t)},DKTools.Scene.prototype.addAnimation=function(t){this._eventManager.addAnimation(t)},DKTools.Scene.prototype.iterateChildren=function(t){_.forEach(this.children,t)},DKTools.Scene.prototype.update=function(){this.updateChildren(),this.updateFade(),this.updateEvents()},DKTools.Scene.prototype.updateChild=function(t){t&&DKTools.Utils.isFunction(t.update)&&t.update()},DKTools.Scene.prototype.updateChildren=function(){this.iterateChildren(this.updateChild)},DKTools.Scene.Preloader=class{constructor(){this.initialize.apply(this,arguments)}initialize(){this._queue=[],this._finished=!1,this._errors=0}add(t){t instanceof Bitmap?t=DKTools.Utils.Bitmap.reserveAsync(t):t instanceof WebAudio&&(t=DKTools.Utils.WebAudio.loadAsync(t)),t instanceof Promise&&this._queue.push(t)}addMany(t){_.forEach(t,t=>this.add(t))}finish(){this._queue=[],this._finished=!0}hasErrors(){return this._errors>0}isReady(){return this._finished}_onError(){this._errors++}start(){const t=_.map(this._queue,t=>t.catch(t=>{throw this._onError(),t}));Promise.all(t).then(()=>this.finish())}};const n=new DKTools.ParameterManager("DKTools");DKTools.PluginCommandManager.set("DKPluginsCheckUpdates",()=>{DKTools.Utils.openConsole(),DKTools.Utils._checkUpdates()});const s=window.onload;window.onload=function(){DKTools.Utils.initialize(),DKTools.IO.initialize(),s.call(this),DKTools.PluginManager.initialize()};const r=ImageCache.prototype.get;ImageCache.prototype.get=function(t){return r.call(this,t)||DKTools.PreloadManager.getCachedImageByKey(t)},ImageCache.prototype._truncateCache=function(){const t=this._items;let e=ImageCache.limit;Object.keys(t).map(e=>t[e]).filter(t=>!this._mustBeHeld(t)).sort((t,e)=>e.touch-t.touch).forEach(i=>{if(e>0){const t=i.bitmap;e-=t.width*t.height}else delete t[i.key]})};const a=ImageCache.prototype._mustBeHeld;ImageCache.prototype._mustBeHeld=function(t){return!DKTools.PreloadManager.isImageCachedByKey(t.key)&&a.call(this,t)};const l=Graphics.printLoadingError;Graphics.printLoadingError=function(t){l.call(this,t),DKTools.Utils.logError(`Failed to load: ${t}`)};const u=Graphics.initialize;Graphics.initialize=function(t,e,i){u.call(this,t,e,i);const o=n.get("FPS Meter");if(DKTools.Utils.isTest()&&o.Enabled){const t=this._fpsMeter;t&&(this.showFps(),"FPS"===o.Mode?(t.showFps(),this._fpsMeterToggled=!1):(t.showDuration(),this._fpsMeterToggled=!0))}};const c=Graphics._createFPSMeter;Graphics._createFPSMeter=function(){const t=n.get("FPS Meter");if(t.Enabled){const e={toggleOn:null,graph:1,decimals:0,theme:t.Theme,history:t.History};this._fpsMeter=new FPSMeter(e),this._fpsMeter.hide()}else c.call(this)};const h=TouchInput.clear;TouchInput.clear=function(){h.call(this),this._mouseMoved=!1,this._leftButtonPressed=!1,this._middleButtonPressed=!1,this._rightButtonPressed=!1,this._leftButtonReleased=!1,this._middleButtonReleased=!1,this._rightButtonReleased=!1,this._mouseX=0,this._mouseY=0,this._events.mouseMoved=!1,this._events.leftButtonPressed=!1,this._events.middleButtonPressed=!1,this._events.rightButtonPressed=!1,this._events.leftButtonReleased=!1,this._events.middleButtonReleased=!1,this._events.rightButtonReleased=!1};const p=TouchInput.update;TouchInput.update=function(){this._mouseMoved=this._events.mouseMoved,this._leftButtonPressed=this._events.leftButtonPressed,this._middleButtonPressed=this._events.middleButtonPressed,this._rightButtonPressed=this._events.rightButtonPressed,this._leftButtonReleased=this._events.leftButtonReleased,this._middleButtonReleased=this._events.middleButtonReleased,this._rightButtonReleased=this._events.rightButtonReleased,this._events.mouseMoved=!1,this._events.leftButtonReleased=!1,this._events.middleButtonReleased=!1,this._events.rightButtonReleased=!1,p.call(this)},TouchInput.isMouseMoved=function(){return this._mouseMoved},TouchInput.isMousePressed=function(){return this.isLeftButtonPressed()||this.isMiddleButtonPressed()||this.isRightButtonPressed()},TouchInput.isMouseReleased=function(){return this.isLeftButtonReleased()||this.isMiddleButtonReleased()||this.isRightButtonReleased()},TouchInput.isLeftButtonPressed=function(){return this._leftButtonPressed},TouchInput.isLeftButtonReleased=function(){return this._leftButtonReleased},TouchInput.isMiddleButtonPressed=function(){return this._middleButtonPressed},TouchInput.isMiddleButtonReleased=function(){return this._middleButtonReleased},TouchInput.isRightButtonPressed=function(){return this._rightButtonPressed},TouchInput.isRightButtonReleased=function(){return this._rightButtonReleased};const d=TouchInput._onLeftButtonDown;TouchInput._onLeftButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);d.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.leftButtonPressed=!0)};const f=TouchInput._onMiddleButtonDown;TouchInput._onMiddleButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);f.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.middleButtonPressed=!0)};const g=TouchInput._onRightButtonDown;TouchInput._onRightButtonDown=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);g.call(this,t),Graphics.isInsideCanvas(e,i)&&(this._events.rightButtonPressed=!0)};const y=TouchInput._onMouseMove;TouchInput._onMouseMove=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);y.call(this,t),this._mouseX===e&&this._mouseY===i||(this._events.mouseMoved=!0,this._mouseX=e,this._mouseY=i)};const m=TouchInput._onMouseUp;TouchInput._onMouseUp=function(t){const e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);m.call(this,t),this._events.leftButtonPressed=!1,this._events.middleButtonPressed=!1,this._events.rightButtonPressed=!1,Graphics.isInsideCanvas(e,i)&&(0===t.button?this._events.leftButtonReleased=!0:1===t.button?this._events.middleButtonReleased=!0:2===t.button&&(this._events.rightButtonReleased=!0))},Object.defineProperties(TouchInput,{mouseX:{get:function(){return this._mouseX},configurable:!0},mouseY:{get:function(){return this._mouseY},configurable:!0}});const T=Tilemap.prototype.initialize;Tilemap.prototype.initialize=function(){T.call(this),this._tileWidth=Tilemap.TILE_WIDTH||this._tileWidth,this._tileHeight=Tilemap.TILE_HEIGHT||this._tileHeight};const S=WebAudio.prototype.addLoadListener;WebAudio.prototype.addLoadListener=function(t){this.isReady()?t(this):S.call(this,t)},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){this._loadListeners.shift()(this)}};const D=DataManager.onLoad;DataManager.onLoad=function(t){D.call(this,t),t===$dataSystem&&DKTools.PreloadManager.initialize()};const K=AudioManager.createBuffer;AudioManager.createBuffer=function(t,e){const i=this.audioFileExt(),o=this._path+t+"/"+encodeURIComponent(e)+i;return DKTools.PreloadManager.isAudioCachedByPath(o)?DKTools.PreloadManager.getCachedAudioByPath(o):K.call(this,t,e)};const w=SceneManager.initialize;SceneManager.initialize=function(){w.call(this),DKTools.Utils._checkRPGMakerVersion()};const b=SceneManager.initGraphics;SceneManager.initGraphics=function(){const t=n.get("Screen Resolution"),e=t.Width,i=t.Height;t.Enabled?(this._boxWidth=e,this._screenWidth=e,this._boxHeight=i,this._screenHeight=i,b.call(this),DKTools.Utils.isNwjs()&&this.updateResolution()):b.call(this)},SceneManager.updateResolution=function(){const t=this._screenWidth-window.innerWidth,e=this._screenHeight-window.innerHeight;!Imported.ScreenResolution&&t>0&&e>0&&(window.moveBy(-1*t/2,-1*e/2),window.resizeBy(t,e))};const v=SceneManager.onKeyDown;SceneManager.onKeyDown=function(t){if(v.call(this,t),t.ctrlKey||t.altKey)return;const e=n.get("Quick Load","Key Code"),i=n.get("Screenshots","Key Code"),o=n.get("Grid","Key Code");switch(t.keyCode){case e:DKTools.Utils.__quickLoad();break;case i:n.get("Screenshots","Enabled")&&DKTools.Utils.makeScreenshot();break;case o:DKTools.Utils.__showGrid()}};const A=SceneManager.catchException;SceneManager.catchException=function(t){A.call(this,t),DKTools.Utils.logError(t),n.get("Debugging Console","Open On Error")&&DKTools.Utils.openConsole()};const C=SceneManager.onError;SceneManager.onError=function(t){C.call(this,t),DKTools.Utils.logError(t),n.get("Debugging Console","Open On Error")&&DKTools.Utils.openConsole()},SceneManager.changeScene=function(){this.isSceneChanging()&&!this.isCurrentSceneBusy()&&(this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor),this._scene=this._nextScene,this._scene&&(this._scene.attachReservation(),this._scene.startPreloading(),this._sceneCreated=!1,this._sceneStarted=!1,this._nextScene=null,this._scene.isPreloaded()&&(this._scene.create(),this._sceneCreated=!0,this.onSceneCreate())),this._exiting&&this.terminate())},SceneManager.updateScene=function(){this._scene&&(!this._sceneCreated&&this._scene.isPreloaded()&&(this._scene.create(),this._sceneCreated=!0,this.onSceneCreate()),!this._sceneStarted&&this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart()),this.isCurrentSceneStarted()&&this._scene.update())},SceneManager.isCurrentScene=function(t){return this._scene instanceof t};const O=SceneManager.goto;SceneManager.goto=function(t){O.call(this,t),DKTools.Utils.__hideGrid()};const x=Scene_Base.prototype.initialize;Scene_Base.prototype.initialize=function(){x.call(this),this._preloader=new DKTools.Scene.Preloader},Scene_Base.prototype.isPreloaded=function(){return this._preloader.isReady()};const I=Scene_Base.prototype.isReady;Scene_Base.prototype.isReady=function(){return I.call(this)&&this.isPreloaded()},Scene_Base.prototype.setupPreloading=function(){},Scene_Base.prototype.startPreloading=function(){this.setupPreloading(),this._preloader.start()};const P=Scene_Boot.prototype.isReady;Scene_Boot.prototype.isReady=function(){return P.call(this)&&DKTools.PreloadManager.isReady()};const E=Scene_Boot.prototype.start;Scene_Boot.prototype.start=function(){const t=n.get("Quick Start");t.Enabled?(E.call(this),DataManager.isBattleTest()||DataManager.isEventTest()||!t["Skip Saves"]&&DataManager.isAnySavefileExists()||(Scene_Base.prototype.start.call(this),SoundManager.preloadImportantSounds(),this.checkPlayerLocation(),DataManager.setupNewGame(),this.updateDocumentTitle(),SceneManager.goto(window[t["Scene Name"]]))):E.call(this)};const R=Scene_Map.prototype.isReady;Scene_Map.prototype.isReady=function(){return!!this.isPreloaded()&&R.call(this)};const B=Game_Map.prototype.tileWidth;Game_Map.prototype.tileWidth=function(){return Tilemap.TILE_WIDTH||B.call(this)};const M=Game_Map.prototype.tileHeight;Game_Map.prototype.tileHeight=function(){return Tilemap.TILE_HEIGHT||M.call(this)};const H=Game_Interpreter.prototype.pluginCommand;Game_Interpreter.prototype.pluginCommand=function(t,e){H.call(this,t,e),DKTools.PluginCommandManager.process(this,t,e)}}).call(this,i(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=require("nw.gui")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("path")}]);